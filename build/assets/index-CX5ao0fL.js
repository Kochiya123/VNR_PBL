(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))S(T);new MutationObserver(T=>{for(const E of T)if(E.type==="childList")for(const b of E.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&S(b)}).observe(document,{childList:!0,subtree:!0});function f(T){const E={};return T.integrity&&(E.integrity=T.integrity),T.referrerPolicy&&(E.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?E.credentials="include":T.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function S(T){if(T.ep)return;T.ep=!0;const E=f(T);fetch(T.href,E)}})();function o0(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Km={exports:{}},Ld={},Ym={exports:{}},Tr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gy;function Kv(){if(Gy)return Tr;Gy=1;var d=Symbol.for("react.element"),l=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),b=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),V=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),oe=Symbol.iterator;function le(Pe){return Pe===null||typeof Pe!="object"?null:(Pe=oe&&Pe[oe]||Pe["@@iterator"],typeof Pe=="function"?Pe:null)}var Y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Be=Object.assign,Ne={};function Ze(Pe,Je,Wt){this.props=Pe,this.context=Je,this.refs=Ne,this.updater=Wt||Y}Ze.prototype.isReactComponent={},Ze.prototype.setState=function(Pe,Je){if(typeof Pe!="object"&&typeof Pe!="function"&&Pe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Pe,Je,"setState")},Ze.prototype.forceUpdate=function(Pe){this.updater.enqueueForceUpdate(this,Pe,"forceUpdate")};function He(){}He.prototype=Ze.prototype;function Ge(Pe,Je,Wt){this.props=Pe,this.context=Je,this.refs=Ne,this.updater=Wt||Y}var nt=Ge.prototype=new He;nt.constructor=Ge,Be(nt,Ze.prototype),nt.isPureReactComponent=!0;var Le=Array.isArray,Re=Object.prototype.hasOwnProperty,Ue={current:null},pt={key:!0,ref:!0,__self:!0,__source:!0};function lt(Pe,Je,Wt){var er,mr={},Qt=null,Ir=null;if(Je!=null)for(er in Je.ref!==void 0&&(Ir=Je.ref),Je.key!==void 0&&(Qt=""+Je.key),Je)Re.call(Je,er)&&!pt.hasOwnProperty(er)&&(mr[er]=Je[er]);var cr=arguments.length-2;if(cr===1)mr.children=Wt;else if(1<cr){for(var wr=Array(cr),Bn=0;Bn<cr;Bn++)wr[Bn]=arguments[Bn+2];mr.children=wr}if(Pe&&Pe.defaultProps)for(er in cr=Pe.defaultProps,cr)mr[er]===void 0&&(mr[er]=cr[er]);return{$$typeof:d,type:Pe,key:Qt,ref:Ir,props:mr,_owner:Ue.current}}function Ft(Pe,Je){return{$$typeof:d,type:Pe.type,key:Je,ref:Pe.ref,props:Pe.props,_owner:Pe._owner}}function Pt(Pe){return typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===d}function Ur(Pe){var Je={"=":"=0",":":"=2"};return"$"+Pe.replace(/[=:]/g,function(Wt){return Je[Wt]})}var Cr=/\/+/g;function yr(Pe,Je){return typeof Pe=="object"&&Pe!==null&&Pe.key!=null?Ur(""+Pe.key):Je.toString(36)}function fr(Pe,Je,Wt,er,mr){var Qt=typeof Pe;(Qt==="undefined"||Qt==="boolean")&&(Pe=null);var Ir=!1;if(Pe===null)Ir=!0;else switch(Qt){case"string":case"number":Ir=!0;break;case"object":switch(Pe.$$typeof){case d:case l:Ir=!0}}if(Ir)return Ir=Pe,mr=mr(Ir),Pe=er===""?"."+yr(Ir,0):er,Le(mr)?(Wt="",Pe!=null&&(Wt=Pe.replace(Cr,"$&/")+"/"),fr(mr,Je,Wt,"",function(Bn){return Bn})):mr!=null&&(Pt(mr)&&(mr=Ft(mr,Wt+(!mr.key||Ir&&Ir.key===mr.key?"":(""+mr.key).replace(Cr,"$&/")+"/")+Pe)),Je.push(mr)),1;if(Ir=0,er=er===""?".":er+":",Le(Pe))for(var cr=0;cr<Pe.length;cr++){Qt=Pe[cr];var wr=er+yr(Qt,cr);Ir+=fr(Qt,Je,Wt,wr,mr)}else if(wr=le(Pe),typeof wr=="function")for(Pe=wr.call(Pe),cr=0;!(Qt=Pe.next()).done;)Qt=Qt.value,wr=er+yr(Qt,cr++),Ir+=fr(Qt,Je,Wt,wr,mr);else if(Qt==="object")throw Je=String(Pe),Error("Objects are not valid as a React child (found: "+(Je==="[object Object]"?"object with keys {"+Object.keys(Pe).join(", ")+"}":Je)+"). If you meant to render a collection of children, use an array instead.");return Ir}function xn(Pe,Je,Wt){if(Pe==null)return Pe;var er=[],mr=0;return fr(Pe,er,"","",function(Qt){return Je.call(Wt,Qt,mr++)}),er}function qr(Pe){if(Pe._status===-1){var Je=Pe._result;Je=Je(),Je.then(function(Wt){(Pe._status===0||Pe._status===-1)&&(Pe._status=1,Pe._result=Wt)},function(Wt){(Pe._status===0||Pe._status===-1)&&(Pe._status=2,Pe._result=Wt)}),Pe._status===-1&&(Pe._status=0,Pe._result=Je)}if(Pe._status===1)return Pe._result.default;throw Pe._result}var Rr={current:null},yt={transition:null},_t={ReactCurrentDispatcher:Rr,ReactCurrentBatchConfig:yt,ReactCurrentOwner:Ue};function bt(){throw Error("act(...) is not supported in production builds of React.")}return Tr.Children={map:xn,forEach:function(Pe,Je,Wt){xn(Pe,function(){Je.apply(this,arguments)},Wt)},count:function(Pe){var Je=0;return xn(Pe,function(){Je++}),Je},toArray:function(Pe){return xn(Pe,function(Je){return Je})||[]},only:function(Pe){if(!Pt(Pe))throw Error("React.Children.only expected to receive a single React element child.");return Pe}},Tr.Component=Ze,Tr.Fragment=f,Tr.Profiler=T,Tr.PureComponent=Ge,Tr.StrictMode=S,Tr.Suspense=N,Tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_t,Tr.act=bt,Tr.cloneElement=function(Pe,Je,Wt){if(Pe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Pe+".");var er=Be({},Pe.props),mr=Pe.key,Qt=Pe.ref,Ir=Pe._owner;if(Je!=null){if(Je.ref!==void 0&&(Qt=Je.ref,Ir=Ue.current),Je.key!==void 0&&(mr=""+Je.key),Pe.type&&Pe.type.defaultProps)var cr=Pe.type.defaultProps;for(wr in Je)Re.call(Je,wr)&&!pt.hasOwnProperty(wr)&&(er[wr]=Je[wr]===void 0&&cr!==void 0?cr[wr]:Je[wr])}var wr=arguments.length-2;if(wr===1)er.children=Wt;else if(1<wr){cr=Array(wr);for(var Bn=0;Bn<wr;Bn++)cr[Bn]=arguments[Bn+2];er.children=cr}return{$$typeof:d,type:Pe.type,key:mr,ref:Qt,props:er,_owner:Ir}},Tr.createContext=function(Pe){return Pe={$$typeof:b,_currentValue:Pe,_currentValue2:Pe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Pe.Provider={$$typeof:E,_context:Pe},Pe.Consumer=Pe},Tr.createElement=lt,Tr.createFactory=function(Pe){var Je=lt.bind(null,Pe);return Je.type=Pe,Je},Tr.createRef=function(){return{current:null}},Tr.forwardRef=function(Pe){return{$$typeof:s,render:Pe}},Tr.isValidElement=Pt,Tr.lazy=function(Pe){return{$$typeof:K,_payload:{_status:-1,_result:Pe},_init:qr}},Tr.memo=function(Pe,Je){return{$$typeof:V,type:Pe,compare:Je===void 0?null:Je}},Tr.startTransition=function(Pe){var Je=yt.transition;yt.transition={};try{Pe()}finally{yt.transition=Je}},Tr.unstable_act=bt,Tr.useCallback=function(Pe,Je){return Rr.current.useCallback(Pe,Je)},Tr.useContext=function(Pe){return Rr.current.useContext(Pe)},Tr.useDebugValue=function(){},Tr.useDeferredValue=function(Pe){return Rr.current.useDeferredValue(Pe)},Tr.useEffect=function(Pe,Je){return Rr.current.useEffect(Pe,Je)},Tr.useId=function(){return Rr.current.useId()},Tr.useImperativeHandle=function(Pe,Je,Wt){return Rr.current.useImperativeHandle(Pe,Je,Wt)},Tr.useInsertionEffect=function(Pe,Je){return Rr.current.useInsertionEffect(Pe,Je)},Tr.useLayoutEffect=function(Pe,Je){return Rr.current.useLayoutEffect(Pe,Je)},Tr.useMemo=function(Pe,Je){return Rr.current.useMemo(Pe,Je)},Tr.useReducer=function(Pe,Je,Wt){return Rr.current.useReducer(Pe,Je,Wt)},Tr.useRef=function(Pe){return Rr.current.useRef(Pe)},Tr.useState=function(Pe){return Rr.current.useState(Pe)},Tr.useSyncExternalStore=function(Pe,Je,Wt){return Rr.current.useSyncExternalStore(Pe,Je,Wt)},Tr.useTransition=function(){return Rr.current.useTransition()},Tr.version="18.3.1",Tr}var Zy;function Fg(){return Zy||(Zy=1,Ym.exports=Kv()),Ym.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function Yv(){if(Hy)return Ld;Hy=1;var d=Fg(),l=Symbol.for("react.element"),f=Symbol.for("react.fragment"),S=Object.prototype.hasOwnProperty,T=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,E={key:!0,ref:!0,__self:!0,__source:!0};function b(s,N,V){var K,oe={},le=null,Y=null;V!==void 0&&(le=""+V),N.key!==void 0&&(le=""+N.key),N.ref!==void 0&&(Y=N.ref);for(K in N)S.call(N,K)&&!E.hasOwnProperty(K)&&(oe[K]=N[K]);if(s&&s.defaultProps)for(K in N=s.defaultProps,N)oe[K]===void 0&&(oe[K]=N[K]);return{$$typeof:l,type:s,key:le,ref:Y,props:oe,_owner:T.current}}return Ld.Fragment=f,Ld.jsx=b,Ld.jsxs=b,Ld}var Wy;function Jv(){return Wy||(Wy=1,Km.exports=Yv()),Km.exports}var ge=Jv(),Vf={},Jm={exports:{}},ro={},Qm={exports:{}},eg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy;function Qv(){return Xy||(Xy=1,(function(d){function l(yt,_t){var bt=yt.length;yt.push(_t);e:for(;0<bt;){var Pe=bt-1>>>1,Je=yt[Pe];if(0<T(Je,_t))yt[Pe]=_t,yt[bt]=Je,bt=Pe;else break e}}function f(yt){return yt.length===0?null:yt[0]}function S(yt){if(yt.length===0)return null;var _t=yt[0],bt=yt.pop();if(bt!==_t){yt[0]=bt;e:for(var Pe=0,Je=yt.length,Wt=Je>>>1;Pe<Wt;){var er=2*(Pe+1)-1,mr=yt[er],Qt=er+1,Ir=yt[Qt];if(0>T(mr,bt))Qt<Je&&0>T(Ir,mr)?(yt[Pe]=Ir,yt[Qt]=bt,Pe=Qt):(yt[Pe]=mr,yt[er]=bt,Pe=er);else if(Qt<Je&&0>T(Ir,bt))yt[Pe]=Ir,yt[Qt]=bt,Pe=Qt;else break e}}return _t}function T(yt,_t){var bt=yt.sortIndex-_t.sortIndex;return bt!==0?bt:yt.id-_t.id}if(typeof performance=="object"&&typeof performance.now=="function"){var E=performance;d.unstable_now=function(){return E.now()}}else{var b=Date,s=b.now();d.unstable_now=function(){return b.now()-s}}var N=[],V=[],K=1,oe=null,le=3,Y=!1,Be=!1,Ne=!1,Ze=typeof setTimeout=="function"?setTimeout:null,He=typeof clearTimeout=="function"?clearTimeout:null,Ge=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function nt(yt){for(var _t=f(V);_t!==null;){if(_t.callback===null)S(V);else if(_t.startTime<=yt)S(V),_t.sortIndex=_t.expirationTime,l(N,_t);else break;_t=f(V)}}function Le(yt){if(Ne=!1,nt(yt),!Be)if(f(N)!==null)Be=!0,qr(Re);else{var _t=f(V);_t!==null&&Rr(Le,_t.startTime-yt)}}function Re(yt,_t){Be=!1,Ne&&(Ne=!1,He(lt),lt=-1),Y=!0;var bt=le;try{for(nt(_t),oe=f(N);oe!==null&&(!(oe.expirationTime>_t)||yt&&!Ur());){var Pe=oe.callback;if(typeof Pe=="function"){oe.callback=null,le=oe.priorityLevel;var Je=Pe(oe.expirationTime<=_t);_t=d.unstable_now(),typeof Je=="function"?oe.callback=Je:oe===f(N)&&S(N),nt(_t)}else S(N);oe=f(N)}if(oe!==null)var Wt=!0;else{var er=f(V);er!==null&&Rr(Le,er.startTime-_t),Wt=!1}return Wt}finally{oe=null,le=bt,Y=!1}}var Ue=!1,pt=null,lt=-1,Ft=5,Pt=-1;function Ur(){return!(d.unstable_now()-Pt<Ft)}function Cr(){if(pt!==null){var yt=d.unstable_now();Pt=yt;var _t=!0;try{_t=pt(!0,yt)}finally{_t?yr():(Ue=!1,pt=null)}}else Ue=!1}var yr;if(typeof Ge=="function")yr=function(){Ge(Cr)};else if(typeof MessageChannel<"u"){var fr=new MessageChannel,xn=fr.port2;fr.port1.onmessage=Cr,yr=function(){xn.postMessage(null)}}else yr=function(){Ze(Cr,0)};function qr(yt){pt=yt,Ue||(Ue=!0,yr())}function Rr(yt,_t){lt=Ze(function(){yt(d.unstable_now())},_t)}d.unstable_IdlePriority=5,d.unstable_ImmediatePriority=1,d.unstable_LowPriority=4,d.unstable_NormalPriority=3,d.unstable_Profiling=null,d.unstable_UserBlockingPriority=2,d.unstable_cancelCallback=function(yt){yt.callback=null},d.unstable_continueExecution=function(){Be||Y||(Be=!0,qr(Re))},d.unstable_forceFrameRate=function(yt){0>yt||125<yt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ft=0<yt?Math.floor(1e3/yt):5},d.unstable_getCurrentPriorityLevel=function(){return le},d.unstable_getFirstCallbackNode=function(){return f(N)},d.unstable_next=function(yt){switch(le){case 1:case 2:case 3:var _t=3;break;default:_t=le}var bt=le;le=_t;try{return yt()}finally{le=bt}},d.unstable_pauseExecution=function(){},d.unstable_requestPaint=function(){},d.unstable_runWithPriority=function(yt,_t){switch(yt){case 1:case 2:case 3:case 4:case 5:break;default:yt=3}var bt=le;le=yt;try{return _t()}finally{le=bt}},d.unstable_scheduleCallback=function(yt,_t,bt){var Pe=d.unstable_now();switch(typeof bt=="object"&&bt!==null?(bt=bt.delay,bt=typeof bt=="number"&&0<bt?Pe+bt:Pe):bt=Pe,yt){case 1:var Je=-1;break;case 2:Je=250;break;case 5:Je=1073741823;break;case 4:Je=1e4;break;default:Je=5e3}return Je=bt+Je,yt={id:K++,callback:_t,priorityLevel:yt,startTime:bt,expirationTime:Je,sortIndex:-1},bt>Pe?(yt.sortIndex=bt,l(V,yt),f(N)===null&&yt===f(V)&&(Ne?(He(lt),lt=-1):Ne=!0,Rr(Le,bt-Pe))):(yt.sortIndex=Je,l(N,yt),Be||Y||(Be=!0,qr(Re))),yt},d.unstable_shouldYield=Ur,d.unstable_wrapCallback=function(yt){var _t=le;return function(){var bt=le;le=_t;try{return yt.apply(this,arguments)}finally{le=bt}}}})(eg)),eg}var Ky;function ex(){return Ky||(Ky=1,Qm.exports=Qv()),Qm.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yy;function tx(){if(Yy)return ro;Yy=1;var d=Fg(),l=ex();function f(a){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+a,v=1;v<arguments.length;v++)c+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var S=new Set,T={};function E(a,c){b(a,c),b(a+"Capture",c)}function b(a,c){for(T[a]=c,a=0;a<c.length;a++)S.add(c[a])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),N=Object.prototype.hasOwnProperty,V=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,K={},oe={};function le(a){return N.call(oe,a)?!0:N.call(K,a)?!1:V.test(a)?oe[a]=!0:(K[a]=!0,!1)}function Y(a,c,v,C){if(v!==null&&v.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return C?!1:v!==null?!v.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function Be(a,c,v,C){if(c===null||typeof c>"u"||Y(a,c,v,C))return!0;if(C)return!1;if(v!==null)switch(v.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function Ne(a,c,v,C,A,D,X){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=C,this.attributeNamespace=A,this.mustUseProperty=v,this.propertyName=a,this.type=c,this.sanitizeURL=D,this.removeEmptyString=X}var Ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){Ze[a]=new Ne(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var c=a[0];Ze[c]=new Ne(c,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){Ze[a]=new Ne(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){Ze[a]=new Ne(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){Ze[a]=new Ne(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){Ze[a]=new Ne(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){Ze[a]=new Ne(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){Ze[a]=new Ne(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){Ze[a]=new Ne(a,5,!1,a.toLowerCase(),null,!1,!1)});var He=/[\-:]([a-z])/g;function Ge(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var c=a.replace(He,Ge);Ze[c]=new Ne(c,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var c=a.replace(He,Ge);Ze[c]=new Ne(c,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var c=a.replace(He,Ge);Ze[c]=new Ne(c,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){Ze[a]=new Ne(a,1,!1,a.toLowerCase(),null,!1,!1)}),Ze.xlinkHref=new Ne("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){Ze[a]=new Ne(a,1,!1,a.toLowerCase(),null,!0,!0)});function nt(a,c,v,C){var A=Ze.hasOwnProperty(c)?Ze[c]:null;(A!==null?A.type!==0:C||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(Be(c,v,A,C)&&(v=null),C||A===null?le(c)&&(v===null?a.removeAttribute(c):a.setAttribute(c,""+v)):A.mustUseProperty?a[A.propertyName]=v===null?A.type===3?!1:"":v:(c=A.attributeName,C=A.attributeNamespace,v===null?a.removeAttribute(c):(A=A.type,v=A===3||A===4&&v===!0?"":""+v,C?a.setAttributeNS(C,c,v):a.setAttribute(c,v))))}var Le=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Re=Symbol.for("react.element"),Ue=Symbol.for("react.portal"),pt=Symbol.for("react.fragment"),lt=Symbol.for("react.strict_mode"),Ft=Symbol.for("react.profiler"),Pt=Symbol.for("react.provider"),Ur=Symbol.for("react.context"),Cr=Symbol.for("react.forward_ref"),yr=Symbol.for("react.suspense"),fr=Symbol.for("react.suspense_list"),xn=Symbol.for("react.memo"),qr=Symbol.for("react.lazy"),Rr=Symbol.for("react.offscreen"),yt=Symbol.iterator;function _t(a){return a===null||typeof a!="object"?null:(a=yt&&a[yt]||a["@@iterator"],typeof a=="function"?a:null)}var bt=Object.assign,Pe;function Je(a){if(Pe===void 0)try{throw Error()}catch(v){var c=v.stack.trim().match(/\n( *(at )?)/);Pe=c&&c[1]||""}return`
`+Pe+a}var Wt=!1;function er(a,c){if(!a||Wt)return"";Wt=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(Oe){var C=Oe}Reflect.construct(a,[],c)}else{try{c.call()}catch(Oe){C=Oe}a.call(c.prototype)}else{try{throw Error()}catch(Oe){C=Oe}a()}}catch(Oe){if(Oe&&C&&typeof Oe.stack=="string"){for(var A=Oe.stack.split(`
`),D=C.stack.split(`
`),X=A.length-1,pe=D.length-1;1<=X&&0<=pe&&A[X]!==D[pe];)pe--;for(;1<=X&&0<=pe;X--,pe--)if(A[X]!==D[pe]){if(X!==1||pe!==1)do if(X--,pe--,0>pe||A[X]!==D[pe]){var ve=`
`+A[X].replace(" at new "," at ");return a.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",a.displayName)),ve}while(1<=X&&0<=pe);break}}}finally{Wt=!1,Error.prepareStackTrace=v}return(a=a?a.displayName||a.name:"")?Je(a):""}function mr(a){switch(a.tag){case 5:return Je(a.type);case 16:return Je("Lazy");case 13:return Je("Suspense");case 19:return Je("SuspenseList");case 0:case 2:case 15:return a=er(a.type,!1),a;case 11:return a=er(a.type.render,!1),a;case 1:return a=er(a.type,!0),a;default:return""}}function Qt(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case pt:return"Fragment";case Ue:return"Portal";case Ft:return"Profiler";case lt:return"StrictMode";case yr:return"Suspense";case fr:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Ur:return(a.displayName||"Context")+".Consumer";case Pt:return(a._context.displayName||"Context")+".Provider";case Cr:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case xn:return c=a.displayName||null,c!==null?c:Qt(a.type)||"Memo";case qr:c=a._payload,a=a._init;try{return Qt(a(c))}catch{}}return null}function Ir(a){var c=a.type;switch(a.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=c.render,a=a.displayName||a.name||"",c.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qt(c);case 8:return c===lt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function cr(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function wr(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Bn(a){var c=wr(a)?"checked":"value",v=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),C=""+a[c];if(!a.hasOwnProperty(c)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var A=v.get,D=v.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return A.call(this)},set:function(X){C=""+X,D.call(this,X)}}),Object.defineProperty(a,c,{enumerable:v.enumerable}),{getValue:function(){return C},setValue:function(X){C=""+X},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function io(a){a._valueTracker||(a._valueTracker=Bn(a))}function Pi(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var v=c.getValue(),C="";return a&&(C=wr(a)?a.checked?"true":"false":a.value),a=C,a!==v?(c.setValue(a),!0):!1}function Qr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function an(a,c){var v=c.checked;return bt({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??a._wrapperState.initialChecked})}function ea(a,c){var v=c.defaultValue==null?"":c.defaultValue,C=c.checked!=null?c.checked:c.defaultChecked;v=cr(c.value!=null?c.value:v),a._wrapperState={initialChecked:C,initialValue:v,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function da(a,c){c=c.checked,c!=null&&nt(a,"checked",c,!1)}function ao(a,c){da(a,c);var v=cr(c.value),C=c.type;if(v!=null)C==="number"?(v===0&&a.value===""||a.value!=v)&&(a.value=""+v):a.value!==""+v&&(a.value=""+v);else if(C==="submit"||C==="reset"){a.removeAttribute("value");return}c.hasOwnProperty("value")?ta(a,c.type,v):c.hasOwnProperty("defaultValue")&&ta(a,c.type,cr(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(a.defaultChecked=!!c.defaultChecked)}function fa(a,c,v){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var C=c.type;if(!(C!=="submit"&&C!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+a._wrapperState.initialValue,v||c===a.value||(a.value=c),a.defaultValue=c}v=a.name,v!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,v!==""&&(a.name=v)}function ta(a,c,v){(c!=="number"||Qr(a.ownerDocument)!==a)&&(v==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+v&&(a.defaultValue=""+v))}var Na=Array.isArray;function Fi(a,c,v,C){if(a=a.options,c){c={};for(var A=0;A<v.length;A++)c["$"+v[A]]=!0;for(v=0;v<a.length;v++)A=c.hasOwnProperty("$"+a[v].value),a[v].selected!==A&&(a[v].selected=A),A&&C&&(a[v].defaultSelected=!0)}else{for(v=""+cr(v),c=null,A=0;A<a.length;A++){if(a[A].value===v){a[A].selected=!0,C&&(a[A].defaultSelected=!0);return}c!==null||a[A].disabled||(c=a[A])}c!==null&&(c.selected=!0)}}function Fa(a,c){if(c.dangerouslySetInnerHTML!=null)throw Error(f(91));return bt({},c,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function oo(a,c){var v=c.value;if(v==null){if(v=c.children,c=c.defaultValue,v!=null){if(c!=null)throw Error(f(92));if(Na(v)){if(1<v.length)throw Error(f(93));v=v[0]}c=v}c==null&&(c=""),v=c}a._wrapperState={initialValue:cr(v)}}function Zo(a,c){var v=cr(c.value),C=cr(c.defaultValue);v!=null&&(v=""+v,v!==a.value&&(a.value=v),c.defaultValue==null&&a.defaultValue!==v&&(a.defaultValue=v)),C!=null&&(a.defaultValue=""+C)}function so(a){var c=a.textContent;c===a._wrapperState.initialValue&&c!==""&&c!==null&&(a.value=c)}function lo(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ba(a,c){return a==null||a==="http://www.w3.org/1999/xhtml"?lo(c):a==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var uo,xe=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,v,C,A){MSApp.execUnsafeLocalFunction(function(){return a(c,v,C,A)})}:a})(function(a,c){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=c;else{for(uo=uo||document.createElement("div"),uo.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=uo.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;c.firstChild;)a.appendChild(c.firstChild)}});function Z(a,c){if(c){var v=a.firstChild;if(v&&v===a.lastChild&&v.nodeType===3){v.nodeValue=c;return}}a.textContent=c}var W={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Q=["Webkit","ms","Moz","O"];Object.keys(W).forEach(function(a){Q.forEach(function(c){c=c+a.charAt(0).toUpperCase()+a.substring(1),W[c]=W[a]})});function ue(a,c,v){return c==null||typeof c=="boolean"||c===""?"":v||typeof c!="number"||c===0||W.hasOwnProperty(a)&&W[a]?(""+c).trim():c+"px"}function ye(a,c){a=a.style;for(var v in c)if(c.hasOwnProperty(v)){var C=v.indexOf("--")===0,A=ue(v,c[v],C);v==="float"&&(v="cssFloat"),C?a.setProperty(v,A):a[v]=A}}var be=bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ae(a,c){if(c){if(be[a]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(f(137,a));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(f(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(f(61))}if(c.style!=null&&typeof c.style!="object")throw Error(f(62))}}function we(a,c){if(a.indexOf("-")===-1)return typeof c.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ve=null;function Ke(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var $e=null,vt=null,Te=null;function Ot(a){if(a=El(a)){if(typeof $e!="function")throw Error(f(280));var c=a.stateNode;c&&(c=vu(c),$e(a.stateNode,a.type,c))}}function rr(a){vt?Te?Te.push(a):Te=[a]:vt=a}function Mt(){if(vt){var a=vt,c=Te;if(Te=vt=null,Ot(a),c)for(a=0;a<c.length;a++)Ot(c[a])}}function Xt(a,c){return a(c)}function Gr(){}var dn=!1;function bn(a,c,v){if(dn)return a(c,v);dn=!0;try{return Xt(a,c,v)}finally{dn=!1,(vt!==null||Te!==null)&&(Gr(),Mt())}}function en(a,c){var v=a.stateNode;if(v===null)return null;var C=vu(v);if(C===null)return null;v=C[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(a=a.type,C=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!C;break e;default:a=!1}if(a)return null;if(v&&typeof v!="function")throw Error(f(231,c,typeof v));return v}var nr=!1;if(s)try{var lr={};Object.defineProperty(lr,"passive",{get:function(){nr=!0}}),window.addEventListener("test",lr,lr),window.removeEventListener("test",lr,lr)}catch{nr=!1}function wn(a,c,v,C,A,D,X,pe,ve){var Oe=Array.prototype.slice.call(arguments,3);try{c.apply(v,Oe)}catch(rt){this.onError(rt)}}var Qe=!1,Mn=null,Kr=!1,ja=null,il={onError:function(a){Qe=!0,Mn=a}};function ft(a,c,v,C,A,D,X,pe,ve){Qe=!1,Mn=null,wn.apply(il,arguments)}function ur(a,c,v,C,A,D,X,pe,ve){if(ft.apply(this,arguments),Qe){if(Qe){var Oe=Mn;Qe=!1,Mn=null}else throw Error(f(198));Kr||(Kr=!0,ja=Oe)}}function Gt(a){var c=a,v=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(v=c.return),a=c.return;while(a)}return c.tag===3?v:null}function jn(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function Ho(a){if(Gt(a)!==a)throw Error(f(188))}function Wo(a){var c=a.alternate;if(!c){if(c=Gt(a),c===null)throw Error(f(188));return c!==a?null:a}for(var v=a,C=c;;){var A=v.return;if(A===null)break;var D=A.alternate;if(D===null){if(C=A.return,C!==null){v=C;continue}break}if(A.child===D.child){for(D=A.child;D;){if(D===v)return Ho(A),a;if(D===C)return Ho(A),c;D=D.sibling}throw Error(f(188))}if(v.return!==C.return)v=A,C=D;else{for(var X=!1,pe=A.child;pe;){if(pe===v){X=!0,v=A,C=D;break}if(pe===C){X=!0,C=A,v=D;break}pe=pe.sibling}if(!X){for(pe=D.child;pe;){if(pe===v){X=!0,v=D,C=A;break}if(pe===C){X=!0,C=D,v=A;break}pe=pe.sibling}if(!X)throw Error(f(189))}}if(v.alternate!==C)throw Error(f(190))}if(v.tag!==3)throw Error(f(188));return v.stateNode.current===v?a:c}function Yt(a){return a=Wo(a),a!==null?Hl(a):null}function Hl(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var c=Hl(a);if(c!==null)return c;a=a.sibling}return null}var co=l.unstable_scheduleCallback,Wl=l.unstable_cancelCallback,Oa=l.unstable_shouldYield,al=l.unstable_requestPaint,ir=l.unstable_now,Ou=l.unstable_getCurrentPriorityLevel,ei=l.unstable_ImmediatePriority,Vr=l.unstable_UserBlockingPriority,Xl=l.unstable_NormalPriority,Kl=l.unstable_LowPriority,Uu=l.unstable_IdlePriority,ma=null,Gn=null;function Ic(a){if(Gn&&typeof Gn.onCommitFiberRoot=="function")try{Gn.onCommitFiberRoot(ma,a,void 0,(a.current.flags&128)===128)}catch{}}var ra=Math.clz32?Math.clz32:ep,Qh=Math.log,ol=Math.LN2;function ep(a){return a>>>=0,a===0?32:31-(Qh(a)/ol|0)|0}var Vu=64,$u=4194304;function Yl(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function sl(a,c){var v=a.pendingLanes;if(v===0)return 0;var C=0,A=a.suspendedLanes,D=a.pingedLanes,X=v&268435455;if(X!==0){var pe=X&~A;pe!==0?C=Yl(pe):(D&=X,D!==0&&(C=Yl(D)))}else X=v&~A,X!==0?C=Yl(X):D!==0&&(C=Yl(D));if(C===0)return 0;if(c!==0&&c!==C&&(c&A)===0&&(A=C&-C,D=c&-c,A>=D||A===16&&(D&4194240)!==0))return c;if((C&4)!==0&&(C|=v&16),c=a.entangledLanes,c!==0)for(a=a.entanglements,c&=C;0<c;)v=31-ra(c),A=1<<v,C|=a[v],c&=~A;return C}function ll(a,c){switch(a){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ac(a,c){for(var v=a.suspendedLanes,C=a.pingedLanes,A=a.expirationTimes,D=a.pendingLanes;0<D;){var X=31-ra(D),pe=1<<X,ve=A[X];ve===-1?((pe&v)===0||(pe&C)!==0)&&(A[X]=ll(pe,c)):ve<=c&&(a.expiredLanes|=pe),D&=~pe}}function Jl(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function Ss(){var a=Vu;return Vu<<=1,(Vu&4194240)===0&&(Vu=64),a}function Ql(a){for(var c=[],v=0;31>v;v++)c.push(a);return c}function Ts(a,c,v){a.pendingLanes|=c,c!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,c=31-ra(c),a[c]=v}function qp(a,c){var v=a.pendingLanes&~c;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=c,a.mutableReadLanes&=c,a.entangledLanes&=c,c=a.entanglements;var C=a.eventTimes;for(a=a.expirationTimes;0<v;){var A=31-ra(v),D=1<<A;c[A]=0,C[A]=-1,a[A]=-1,v&=~D}}function Xo(a,c){var v=a.entangledLanes|=c;for(a=a.entanglements;v;){var C=31-ra(v),A=1<<C;A&c|a[C]&c&&(a[C]|=c),v&=~A}}var Pr=0;function na(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var ar,ho,po,Ua,Ko,tr=!1,Va=[],ga=null,ya=null,un=null,cn=new Map,kn=new Map,Wr=[],Zr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zc(a,c){switch(a){case"focusin":case"focusout":ga=null;break;case"dragenter":case"dragleave":ya=null;break;case"mouseover":case"mouseout":un=null;break;case"pointerover":case"pointerout":cn.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":kn.delete(c.pointerId)}}function En(a,c,v,C,A,D){return a===null||a.nativeEvent!==D?(a={blockedOn:c,domEventName:v,eventSystemFlags:C,nativeEvent:D,targetContainers:[A]},c!==null&&(c=El(c),c!==null&&ho(c)),a):(a.eventSystemFlags|=C,c=a.targetContainers,A!==null&&c.indexOf(A)===-1&&c.push(A),a)}function Bi(a,c,v,C,A){switch(c){case"focusin":return ga=En(ga,a,c,v,C,A),!0;case"dragenter":return ya=En(ya,a,c,v,C,A),!0;case"mouseover":return un=En(un,a,c,v,C,A),!0;case"pointerover":var D=A.pointerId;return cn.set(D,En(cn.get(D)||null,a,c,v,C,A)),!0;case"gotpointercapture":return D=A.pointerId,kn.set(D,En(kn.get(D)||null,a,c,v,C,A)),!0}return!1}function Zn(a){var c=To(a.target);if(c!==null){var v=Gt(c);if(v!==null){if(c=v.tag,c===13){if(c=jn(v),c!==null){a.blockedOn=c,Ko(a.priority,function(){po(v)});return}}else if(c===3&&v.stateNode.current.memoizedState.isDehydrated){a.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}a.blockedOn=null}function $r(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var v=Jo(a.domEventName,a.eventSystemFlags,c[0],a.nativeEvent);if(v===null){v=a.nativeEvent;var C=new v.constructor(v.type,v);Ve=C,v.target.dispatchEvent(C),Ve=null}else return c=El(v),c!==null&&ho(c),a.blockedOn=v,!1;c.shift()}return!0}function Yo(a,c,v){$r(a)&&v.delete(c)}function Bt(){tr=!1,ga!==null&&$r(ga)&&(ga=null),ya!==null&&$r(ya)&&(ya=null),un!==null&&$r(un)&&(un=null),cn.forEach(Yo),kn.forEach(Yo)}function Ut(a,c){a.blockedOn===c&&(a.blockedOn=null,tr||(tr=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,Bt)))}function ji(a){function c(A){return Ut(A,a)}if(0<Va.length){Ut(Va[0],a);for(var v=1;v<Va.length;v++){var C=Va[v];C.blockedOn===a&&(C.blockedOn=null)}}for(ga!==null&&Ut(ga,a),ya!==null&&Ut(ya,a),un!==null&&Ut(un,a),cn.forEach(c),kn.forEach(c),v=0;v<Wr.length;v++)C=Wr[v],C.blockedOn===a&&(C.blockedOn=null);for(;0<Wr.length&&(v=Wr[0],v.blockedOn===null);)Zn(v),v.blockedOn===null&&Wr.shift()}var or=Le.ReactCurrentBatchConfig,ti=!0;function $a(a,c,v,C){var A=Pr,D=or.transition;or.transition=null;try{Pr=1,ul(a,c,v,C)}finally{Pr=A,or.transition=D}}function qa(a,c,v,C){var A=Pr,D=or.transition;or.transition=null;try{Pr=4,ul(a,c,v,C)}finally{Pr=A,or.transition=D}}function ul(a,c,v,C){if(ti){var A=Jo(a,c,v,C);if(A===null)zs(a,c,C,cl,v),zc(a,C);else if(Bi(A,a,c,v,C))C.stopPropagation();else if(zc(a,C),c&4&&-1<Zr.indexOf(a)){for(;A!==null;){var D=El(A);if(D!==null&&ar(D),D=Jo(a,c,v,C),D===null&&zs(a,c,C,cl,v),D===A)break;A=D}A!==null&&C.stopPropagation()}else zs(a,c,C,null,v)}}var cl=null;function Jo(a,c,v,C){if(cl=null,a=Ke(C),a=To(a),a!==null)if(c=Gt(a),c===null)a=null;else if(v=c.tag,v===13){if(a=jn(c),a!==null)return a;a=null}else if(v===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null);return cl=a,null}function hl(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ou()){case ei:return 1;case Vr:return 4;case Xl:case Kl:return 16;case Uu:return 536870912;default:return 16}default:return 16}}var _a=null,pl=null,Cs=null;function ia(){if(Cs)return Cs;var a,c=pl,v=c.length,C,A="value"in _a?_a.value:_a.textContent,D=A.length;for(a=0;a<v&&c[a]===A[a];a++);var X=v-a;for(C=1;C<=X&&c[v-C]===A[D-C];C++);return Cs=A.slice(a,1<C?1-C:void 0)}function fn(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function fo(){return!0}function dl(){return!1}function In(a){function c(v,C,A,D,X){this._reactName=v,this._targetInst=A,this.type=C,this.nativeEvent=D,this.target=X,this.currentTarget=null;for(var pe in a)a.hasOwnProperty(pe)&&(v=a[pe],this[pe]=v?v(D):D[pe]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?fo:dl,this.isPropagationStopped=dl,this}return bt(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=fo)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=fo)},persist:function(){},isPersistent:fo}),c}var Xr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qu=In(Xr),mo=bt({},Xr,{view:0,detail:0}),Lc=In(mo),Rc,Qo,mn,es=bt({},mo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==mn&&(mn&&a.type==="mousemove"?(Rc=a.screenX-mn.screenX,Qo=a.screenY-mn.screenY):Qo=Rc=0,mn=a),Rc)},movementY:function(a){return"movementY"in a?a.movementY:Qo}}),va=In(es),eu=bt({},es,{dataTransfer:0}),tu=In(eu),ru=bt({},mo,{relatedTarget:0}),On=In(ru),tp=bt({},Xr,{animationName:0,elapsedTime:0,pseudoElement:0}),Gu=In(tp),Gp=bt({},Xr,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Dc=In(Gp),Zp=bt({},Xr,{data:0}),rp=In(Zp),Zu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ps={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fc(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=Ps[a])?!!c[a]:!1}function fl(){return Fc}var xa=bt({},mo,{key:function(a){if(a.key){var c=Zu[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=fn(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Nc[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fl,charCode:function(a){return a.type==="keypress"?fn(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?fn(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Hp=In(xa),Hu=bt({},es,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ml=In(Hu),nu=bt({},mo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fl}),Wp=In(nu),Wu=bt({},Xr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xp=In(Wu),Ms=bt({},es,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),np=In(Ms),Bc=[9,13,27,32],jc=s&&"CompositionEvent"in window,gl=null;s&&"documentMode"in document&&(gl=document.documentMode);var Oc=s&&"TextEvent"in window&&!gl,Uc=s&&(!jc||gl&&8<gl&&11>=gl),iu=" ",Vc=!1;function $c(a,c){switch(a){case"keyup":return Bc.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ts(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var rs=!1;function qc(a,c){switch(a){case"compositionend":return ts(c);case"keypress":return c.which!==32?null:(Vc=!0,iu);case"textInput":return a=c.data,a===iu&&Vc?null:a;default:return null}}function au(a,c){if(rs)return a==="compositionend"||!jc&&$c(a,c)?(a=ia(),Cs=pl=_a=null,rs=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Uc&&c.locale!=="ko"?null:c.data;default:return null}}var Kp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yl(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!Kp[a.type]:c==="textarea"}function Gc(a,c,v,C){rr(C),c=fu(c,"onChange"),0<c.length&&(v=new qu("onChange","change",null,v,C),a.push({event:v,listeners:c}))}var ou=null,_l=null;function ip(a){lp(a,0)}function vl(a){var c=Rs(a);if(Pi(c))return a}function Zc(a,c){if(a==="change")return c}var Hc=!1;if(s){var xl;if(s){var ba="oninput"in document;if(!ba){var br=document.createElement("div");br.setAttribute("oninput","return;"),ba=typeof br.oninput=="function"}xl=ba}else xl=!1;Hc=xl&&(!document.documentMode||9<document.documentMode)}function Xu(){ou&&(ou.detachEvent("onpropertychange",Ku),_l=ou=null)}function Ku(a){if(a.propertyName==="value"&&vl(_l)){var c=[];Gc(c,_l,a,Ke(a)),bn(ip,c)}}function ap(a,c,v){a==="focusin"?(Xu(),ou=c,_l=v,ou.attachEvent("onpropertychange",Ku)):a==="focusout"&&Xu()}function Wc(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return vl(_l)}function ks(a,c){if(a==="click")return vl(c)}function Xc(a,c){if(a==="input"||a==="change")return vl(c)}function Yp(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var wa=typeof Object.is=="function"?Object.is:Yp;function su(a,c){if(wa(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var v=Object.keys(a),C=Object.keys(c);if(v.length!==C.length)return!1;for(C=0;C<v.length;C++){var A=v[C];if(!N.call(c,A)||!wa(a[A],c[A]))return!1}return!0}function op(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Kc(a,c){var v=op(a);a=0;for(var C;v;){if(v.nodeType===3){if(C=a+v.textContent.length,a<=c&&C>=c)return{node:v,offset:c-a};a=C}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=op(v)}}function sp(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?sp(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function Yc(){for(var a=window,c=Qr();c instanceof a.HTMLIFrameElement;){try{var v=typeof c.contentWindow.location.href=="string"}catch{v=!1}if(v)a=c.contentWindow;else break;c=Qr(a.document)}return c}function bl(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}function Yu(a){var c=Yc(),v=a.focusedElem,C=a.selectionRange;if(c!==v&&v&&v.ownerDocument&&sp(v.ownerDocument.documentElement,v)){if(C!==null&&bl(v)){if(c=C.start,a=C.end,a===void 0&&(a=c),"selectionStart"in v)v.selectionStart=c,v.selectionEnd=Math.min(a,v.value.length);else if(a=(c=v.ownerDocument||document)&&c.defaultView||window,a.getSelection){a=a.getSelection();var A=v.textContent.length,D=Math.min(C.start,A);C=C.end===void 0?D:Math.min(C.end,A),!a.extend&&D>C&&(A=C,C=D,D=A),A=Kc(v,D);var X=Kc(v,C);A&&X&&(a.rangeCount!==1||a.anchorNode!==A.node||a.anchorOffset!==A.offset||a.focusNode!==X.node||a.focusOffset!==X.offset)&&(c=c.createRange(),c.setStart(A.node,A.offset),a.removeAllRanges(),D>C?(a.addRange(c),a.extend(X.node,X.offset)):(c.setEnd(X.node,X.offset),a.addRange(c)))}}for(c=[],a=v;a=a.parentNode;)a.nodeType===1&&c.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<c.length;v++)a=c[v],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Ju=s&&"documentMode"in document&&11>=document.documentMode,ns=null,go=null,yo=null,is=!1;function Oi(a,c,v){var C=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;is||ns==null||ns!==Qr(C)||(C=ns,"selectionStart"in C&&bl(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),yo&&su(yo,C)||(yo=C,C=fu(go,"onSelect"),0<C.length&&(c=new qu("onSelect","select",null,c,v),a.push({event:c,listeners:C}),c.target=ns)))}function lu(a,c){var v={};return v[a.toLowerCase()]=c.toLowerCase(),v["Webkit"+a]="webkit"+c,v["Moz"+a]="moz"+c,v}var Es={animationend:lu("Animation","AnimationEnd"),animationiteration:lu("Animation","AnimationIteration"),animationstart:lu("Animation","AnimationStart"),transitionend:lu("Transition","TransitionEnd")},uu={},as={};s&&(as=document.createElement("div").style,"AnimationEvent"in window||(delete Es.animationend.animation,delete Es.animationiteration.animation,delete Es.animationstart.animation),"TransitionEvent"in window||delete Es.transitionend.transition);function Is(a){if(uu[a])return uu[a];if(!Es[a])return a;var c=Es[a],v;for(v in c)if(c.hasOwnProperty(v)&&v in as)return uu[a]=c[v];return a}var cu=Is("animationend"),wl=Is("animationiteration"),hu=Is("animationstart"),Jc=Is("transitionend"),As=new Map,_o="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vo(a,c){As.set(a,c),E(c,[a])}for(var pu=0;pu<_o.length;pu++){var sr=_o[pu],du=sr.toLowerCase(),Jp=sr[0].toUpperCase()+sr.slice(1);vo(du,"on"+Jp)}vo(cu,"onAnimationEnd"),vo(wl,"onAnimationIteration"),vo(hu,"onAnimationStart"),vo("dblclick","onDoubleClick"),vo("focusin","onFocus"),vo("focusout","onBlur"),vo(Jc,"onTransitionEnd"),b("onMouseEnter",["mouseout","mouseover"]),b("onMouseLeave",["mouseout","mouseover"]),b("onPointerEnter",["pointerout","pointerover"]),b("onPointerLeave",["pointerout","pointerover"]),E("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),E("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),E("onBeforeInput",["compositionend","keypress","textInput","paste"]),E("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),E("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),E("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),os=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sl));function Qc(a,c,v){var C=a.type||"unknown-event";a.currentTarget=v,ur(C,c,void 0,a),a.currentTarget=null}function lp(a,c){c=(c&4)!==0;for(var v=0;v<a.length;v++){var C=a[v],A=C.event;C=C.listeners;e:{var D=void 0;if(c)for(var X=C.length-1;0<=X;X--){var pe=C[X],ve=pe.instance,Oe=pe.currentTarget;if(pe=pe.listener,ve!==D&&A.isPropagationStopped())break e;Qc(A,pe,Oe),D=ve}else for(X=0;X<C.length;X++){if(pe=C[X],ve=pe.instance,Oe=pe.currentTarget,pe=pe.listener,ve!==D&&A.isPropagationStopped())break e;Qc(A,pe,Oe),D=ve}}}if(Kr)throw a=ja,Kr=!1,ja=null,a}function Yr(a,c){var v=c[wo];v===void 0&&(v=c[wo]=new Set);var C=a+"__bubble";v.has(C)||(Cl(c,a,2,!1),v.add(C))}function eh(a,c,v){var C=0;c&&(C|=4),Cl(v,a,C,c)}var Tl="_reactListening"+Math.random().toString(36).slice(2);function ss(a){if(!a[Tl]){a[Tl]=!0,S.forEach(function(v){v!=="selectionchange"&&(os.has(v)||eh(v,!1,a),eh(v,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Tl]||(c[Tl]=!0,eh("selectionchange",!1,c))}}function Cl(a,c,v,C){switch(hl(c)){case 1:var A=$a;break;case 4:A=qa;break;default:A=ul}v=A.bind(null,c,v,a),A=void 0,!nr||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(A=!0),C?A!==void 0?a.addEventListener(c,v,{capture:!0,passive:A}):a.addEventListener(c,v,!0):A!==void 0?a.addEventListener(c,v,{passive:A}):a.addEventListener(c,v,!1)}function zs(a,c,v,C,A){var D=C;if((c&1)===0&&(c&2)===0&&C!==null)e:for(;;){if(C===null)return;var X=C.tag;if(X===3||X===4){var pe=C.stateNode.containerInfo;if(pe===A||pe.nodeType===8&&pe.parentNode===A)break;if(X===4)for(X=C.return;X!==null;){var ve=X.tag;if((ve===3||ve===4)&&(ve=X.stateNode.containerInfo,ve===A||ve.nodeType===8&&ve.parentNode===A))return;X=X.return}for(;pe!==null;){if(X=To(pe),X===null)return;if(ve=X.tag,ve===5||ve===6){C=D=X;continue e}pe=pe.parentNode}}C=C.return}bn(function(){var Oe=D,rt=Ke(v),et=[];e:{var Ye=As.get(a);if(Ye!==void 0){var Tt=qu,Et=a;switch(a){case"keypress":if(fn(v)===0)break e;case"keydown":case"keyup":Tt=Hp;break;case"focusin":Et="focus",Tt=On;break;case"focusout":Et="blur",Tt=On;break;case"beforeblur":case"afterblur":Tt=On;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Tt=va;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Tt=tu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Tt=Wp;break;case cu:case wl:case hu:Tt=Gu;break;case Jc:Tt=Xp;break;case"scroll":Tt=Lc;break;case"wheel":Tt=np;break;case"copy":case"cut":case"paste":Tt=Dc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Tt=ml}var Lt=(c&4)!==0,hn=!Lt&&a==="scroll",ze=Lt?Ye!==null?Ye+"Capture":null:Ye;Lt=[];for(var Ce=Oe,Fe;Ce!==null;){Fe=Ce;var ut=Fe.stateNode;if(Fe.tag===5&&ut!==null&&(Fe=ut,ze!==null&&(ut=en(Ce,ze),ut!=null&&Lt.push(Ls(Ce,ut,Fe)))),hn)break;Ce=Ce.return}0<Lt.length&&(Ye=new Tt(Ye,Et,null,v,rt),et.push({event:Ye,listeners:Lt}))}}if((c&7)===0){e:{if(Ye=a==="mouseover"||a==="pointerover",Tt=a==="mouseout"||a==="pointerout",Ye&&v!==Ve&&(Et=v.relatedTarget||v.fromElement)&&(To(Et)||Et[Ha]))break e;if((Tt||Ye)&&(Ye=rt.window===rt?rt:(Ye=rt.ownerDocument)?Ye.defaultView||Ye.parentWindow:window,Tt?(Et=v.relatedTarget||v.toElement,Tt=Oe,Et=Et?To(Et):null,Et!==null&&(hn=Gt(Et),Et!==hn||Et.tag!==5&&Et.tag!==6)&&(Et=null)):(Tt=null,Et=Oe),Tt!==Et)){if(Lt=va,ut="onMouseLeave",ze="onMouseEnter",Ce="mouse",(a==="pointerout"||a==="pointerover")&&(Lt=ml,ut="onPointerLeave",ze="onPointerEnter",Ce="pointer"),hn=Tt==null?Ye:Rs(Tt),Fe=Et==null?Ye:Rs(Et),Ye=new Lt(ut,Ce+"leave",Tt,v,rt),Ye.target=hn,Ye.relatedTarget=Fe,ut=null,To(rt)===Oe&&(Lt=new Lt(ze,Ce+"enter",Et,v,rt),Lt.target=Fe,Lt.relatedTarget=hn,ut=Lt),hn=ut,Tt&&Et)t:{for(Lt=Tt,ze=Et,Ce=0,Fe=Lt;Fe;Fe=Ga(Fe))Ce++;for(Fe=0,ut=ze;ut;ut=Ga(ut))Fe++;for(;0<Ce-Fe;)Lt=Ga(Lt),Ce--;for(;0<Fe-Ce;)ze=Ga(ze),Fe--;for(;Ce--;){if(Lt===ze||ze!==null&&Lt===ze.alternate)break t;Lt=Ga(Lt),ze=Ga(ze)}Lt=null}else Lt=null;Tt!==null&&Pl(et,Ye,Tt,Lt,!1),Et!==null&&hn!==null&&Pl(et,hn,Et,Lt,!0)}}e:{if(Ye=Oe?Rs(Oe):window,Tt=Ye.nodeName&&Ye.nodeName.toLowerCase(),Tt==="select"||Tt==="input"&&Ye.type==="file")var It=Zc;else if(yl(Ye))if(Hc)It=Xc;else{It=Wc;var Vt=ap}else(Tt=Ye.nodeName)&&Tt.toLowerCase()==="input"&&(Ye.type==="checkbox"||Ye.type==="radio")&&(It=ks);if(It&&(It=It(a,Oe))){Gc(et,It,v,rt);break e}Vt&&Vt(a,Ye,Oe),a==="focusout"&&(Vt=Ye._wrapperState)&&Vt.controlled&&Ye.type==="number"&&ta(Ye,"number",Ye.value)}switch(Vt=Oe?Rs(Oe):window,a){case"focusin":(yl(Vt)||Vt.contentEditable==="true")&&(ns=Vt,go=Oe,yo=null);break;case"focusout":yo=go=ns=null;break;case"mousedown":is=!0;break;case"contextmenu":case"mouseup":case"dragend":is=!1,Oi(et,v,rt);break;case"selectionchange":if(Ju)break;case"keydown":case"keyup":Oi(et,v,rt)}var $t;if(jc)e:{switch(a){case"compositionstart":var Kt="onCompositionStart";break e;case"compositionend":Kt="onCompositionEnd";break e;case"compositionupdate":Kt="onCompositionUpdate";break e}Kt=void 0}else rs?$c(a,v)&&(Kt="onCompositionEnd"):a==="keydown"&&v.keyCode===229&&(Kt="onCompositionStart");Kt&&(Uc&&v.locale!=="ko"&&(rs||Kt!=="onCompositionStart"?Kt==="onCompositionEnd"&&rs&&($t=ia()):(_a=rt,pl="value"in _a?_a.value:_a.textContent,rs=!0)),Vt=fu(Oe,Kt),0<Vt.length&&(Kt=new rp(Kt,a,null,v,rt),et.push({event:Kt,listeners:Vt}),$t?Kt.data=$t:($t=ts(v),$t!==null&&(Kt.data=$t)))),($t=Oc?qc(a,v):au(a,v))&&(Oe=fu(Oe,"onBeforeInput"),0<Oe.length&&(rt=new rp("onBeforeInput","beforeinput",null,v,rt),et.push({event:rt,listeners:Oe}),rt.data=$t))}lp(et,c)})}function Ls(a,c,v){return{instance:a,listener:c,currentTarget:v}}function fu(a,c){for(var v=c+"Capture",C=[];a!==null;){var A=a,D=A.stateNode;A.tag===5&&D!==null&&(A=D,D=en(a,v),D!=null&&C.unshift(Ls(a,D,A)),D=en(a,c),D!=null&&C.push(Ls(a,D,A))),a=a.return}return C}function Ga(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Pl(a,c,v,C,A){for(var D=c._reactName,X=[];v!==null&&v!==C;){var pe=v,ve=pe.alternate,Oe=pe.stateNode;if(ve!==null&&ve===C)break;pe.tag===5&&Oe!==null&&(pe=Oe,A?(ve=en(v,D),ve!=null&&X.unshift(Ls(v,ve,pe))):A||(ve=en(v,D),ve!=null&&X.push(Ls(v,ve,pe)))),v=v.return}X.length!==0&&a.push({event:c,listeners:X})}var mu=/\r\n?/g,Qu=/\u0000|\uFFFD/g;function ec(a){return(typeof a=="string"?a:""+a).replace(mu,`
`).replace(Qu,"")}function Za(a,c,v){if(c=ec(c),ec(a)!==c&&v)throw Error(f(425))}function Ml(){}var kl=null,xo=null;function gu(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var tc=typeof setTimeout=="function"?setTimeout:void 0,up=typeof clearTimeout=="function"?clearTimeout:void 0,yu=typeof Promise=="function"?Promise:void 0,th=typeof queueMicrotask=="function"?queueMicrotask:typeof yu<"u"?function(a){return yu.resolve(null).then(a).catch(Qp)}:tc;function Qp(a){setTimeout(function(){throw a})}function _u(a,c){var v=c,C=0;do{var A=v.nextSibling;if(a.removeChild(v),A&&A.nodeType===8)if(v=A.data,v==="/$"){if(C===0){a.removeChild(A),ji(c);return}C--}else v!=="$"&&v!=="$?"&&v!=="$!"||C++;v=A}while(v);ji(c)}function Dr(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return a}function Sa(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var v=a.data;if(v==="$"||v==="$!"||v==="$?"){if(c===0)return a;c--}else v==="/$"&&c++}a=a.previousSibling}return null}var Hn=Math.random().toString(36).slice(2),Ui="__reactFiber$"+Hn,bo="__reactProps$"+Hn,Ha="__reactContainer$"+Hn,wo="__reactEvents$"+Hn,rc="__reactListeners$"+Hn,So="__reactHandles$"+Hn;function To(a){var c=a[Ui];if(c)return c;for(var v=a.parentNode;v;){if(c=v[Ha]||v[Ui]){if(v=c.alternate,c.child!==null||v!==null&&v.child!==null)for(a=Sa(a);a!==null;){if(v=a[Ui])return v;a=Sa(a)}return c}a=v,v=a.parentNode}return null}function El(a){return a=a[Ui]||a[Ha],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Rs(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(f(33))}function vu(a){return a[bo]||null}var nc=[],Ds=-1;function Un(a){return{current:a}}function Nr(a){0>Ds||(a.current=nc[Ds],nc[Ds]=null,Ds--)}function pr(a,c){Ds++,nc[Ds]=a.current,a.current=c}var Vi={},Vn=Un(Vi),hi=Un(!1),ls=Vi;function Ta(a,c){var v=a.type.contextTypes;if(!v)return Vi;var C=a.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===c)return C.__reactInternalMemoizedMaskedChildContext;var A={},D;for(D in v)A[D]=c[D];return C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=c,a.__reactInternalMemoizedMaskedChildContext=A),A}function ri(a){return a=a.childContextTypes,a!=null}function Co(){Nr(hi),Nr(Vn)}function rh(a,c,v){if(Vn.current!==Vi)throw Error(f(168));pr(Vn,c),pr(hi,v)}function pi(a,c,v){var C=a.stateNode;if(c=c.childContextTypes,typeof C.getChildContext!="function")return v;C=C.getChildContext();for(var A in C)if(!(A in c))throw Error(f(108,Ir(a)||"Unknown",A));return bt({},v,C)}function Mi(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Vi,ls=Vn.current,pr(Vn,a),pr(hi,hi.current),!0}function Ns(a,c,v){var C=a.stateNode;if(!C)throw Error(f(169));v?(a=pi(a,c,ls),C.__reactInternalMemoizedMergedChildContext=a,Nr(hi),Nr(Vn),pr(Vn,a)):Nr(hi),pr(hi,v)}var An=null,Po=!1,nh=!1;function Il(a){An===null?An=[a]:An.push(a)}function ed(a){Po=!0,Il(a)}function us(){if(!nh&&An!==null){nh=!0;var a=0,c=Pr;try{var v=An;for(Pr=1;a<v.length;a++){var C=v[a];do C=C(!0);while(C!==null)}An=null,Po=!1}catch(A){throw An!==null&&(An=An.slice(a+1)),co(ei,us),A}finally{Pr=c,nh=!1}}return null}var Wa=[],Xa=0,ki=null,mt=0,Ei=[],di=0,Mo=null,Ii=1,fi="";function Ka(a,c){Wa[Xa++]=mt,Wa[Xa++]=ki,ki=a,mt=c}function hr(a,c,v){Ei[di++]=Ii,Ei[di++]=fi,Ei[di++]=Mo,Mo=a;var C=Ii;a=fi;var A=32-ra(C)-1;C&=~(1<<A),v+=1;var D=32-ra(c)+A;if(30<D){var X=A-A%5;D=(C&(1<<X)-1).toString(32),C>>=X,A-=X,Ii=1<<32-ra(c)+A|v<<A|C,fi=D+a}else Ii=1<<D|v<<A|C,fi=a}function Al(a){a.return!==null&&(Ka(a,1),hr(a,1,0))}function ih(a){for(;a===ki;)ki=Wa[--Xa],Wa[Xa]=null,mt=Wa[--Xa],Wa[Xa]=null;for(;a===Mo;)Mo=Ei[--di],Ei[di]=null,fi=Ei[--di],Ei[di]=null,Ii=Ei[--di],Ei[di]=null}var ni=null,$i=null,tn=!1,qi=null;function ic(a,c){var v=Aa(5,null,null,0);v.elementType="DELETED",v.stateNode=c,v.return=a,c=a.deletions,c===null?(a.deletions=[v],a.flags|=16):c.push(v)}function ah(a,c){switch(a.tag){case 5:var v=a.type;return c=c.nodeType!==1||v.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(a.stateNode=c,ni=a,$i=Dr(c.firstChild),!0):!1;case 6:return c=a.pendingProps===""||c.nodeType!==3?null:c,c!==null?(a.stateNode=c,ni=a,$i=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(v=Mo!==null?{id:Ii,overflow:fi}:null,a.memoizedState={dehydrated:c,treeContext:v,retryLane:1073741824},v=Aa(18,null,null,0),v.stateNode=c,v.return=a,a.child=v,ni=a,$i=null,!0):!1;default:return!1}}function ac(a){return(a.mode&1)!==0&&(a.flags&128)===0}function xu(a){if(tn){var c=$i;if(c){var v=c;if(!ah(a,c)){if(ac(a))throw Error(f(418));c=Dr(v.nextSibling);var C=ni;c&&ah(a,c)?ic(C,v):(a.flags=a.flags&-4097|2,tn=!1,ni=a)}}else{if(ac(a))throw Error(f(418));a.flags=a.flags&-4097|2,tn=!1,ni=a}}}function oh(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;ni=a}function bu(a){if(a!==ni)return!1;if(!tn)return oh(a),tn=!0,!1;var c;if((c=a.tag!==3)&&!(c=a.tag!==5)&&(c=a.type,c=c!=="head"&&c!=="body"&&!gu(a.type,a.memoizedProps)),c&&(c=$i)){if(ac(a))throw aa(),Error(f(418));for(;c;)ic(a,c),c=Dr(c.nextSibling)}if(oh(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(f(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8){var v=a.data;if(v==="/$"){if(c===0){$i=Dr(a.nextSibling);break e}c--}else v!=="$"&&v!=="$!"&&v!=="$?"||c++}a=a.nextSibling}$i=null}}else $i=ni?Dr(a.stateNode.nextSibling):null;return!0}function aa(){for(var a=$i;a;)a=Dr(a.nextSibling)}function Fr(){$i=ni=null,tn=!1}function cs(a){qi===null?qi=[a]:qi.push(a)}var sh=Le.ReactCurrentBatchConfig;function zl(a,c,v){if(a=v.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(f(309));var C=v.stateNode}if(!C)throw Error(f(147,a));var A=C,D=""+a;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===D?c.ref:(c=function(X){var pe=A.refs;X===null?delete pe[D]:pe[D]=X},c._stringRef=D,c)}if(typeof a!="string")throw Error(f(284));if(!v._owner)throw Error(f(290,a))}return a}function Ll(a,c){throw a=Object.prototype.toString.call(c),Error(f(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a))}function oc(a){var c=a._init;return c(a._payload)}function lh(a){function c(ze,Ce){if(a){var Fe=ze.deletions;Fe===null?(ze.deletions=[Ce],ze.flags|=16):Fe.push(Ce)}}function v(ze,Ce){if(!a)return null;for(;Ce!==null;)c(ze,Ce),Ce=Ce.sibling;return null}function C(ze,Ce){for(ze=new Map;Ce!==null;)Ce.key!==null?ze.set(Ce.key,Ce):ze.set(Ce.index,Ce),Ce=Ce.sibling;return ze}function A(ze,Ce){return ze=$s(ze,Ce),ze.index=0,ze.sibling=null,ze}function D(ze,Ce,Fe){return ze.index=Fe,a?(Fe=ze.alternate,Fe!==null?(Fe=Fe.index,Fe<Ce?(ze.flags|=2,Ce):Fe):(ze.flags|=2,Ce)):(ze.flags|=1048576,Ce)}function X(ze){return a&&ze.alternate===null&&(ze.flags|=2),ze}function pe(ze,Ce,Fe,ut){return Ce===null||Ce.tag!==6?(Ce=Cd(Fe,ze.mode,ut),Ce.return=ze,Ce):(Ce=A(Ce,Fe),Ce.return=ze,Ce)}function ve(ze,Ce,Fe,ut){var It=Fe.type;return It===pt?rt(ze,Ce,Fe.props.children,ut,Fe.key):Ce!==null&&(Ce.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===qr&&oc(It)===Ce.type)?(ut=A(Ce,Fe.props),ut.ref=zl(ze,Ce,Fe),ut.return=ze,ut):(ut=bp(Fe.type,Fe.key,Fe.props,null,ze.mode,ut),ut.ref=zl(ze,Ce,Fe),ut.return=ze,ut)}function Oe(ze,Ce,Fe,ut){return Ce===null||Ce.tag!==4||Ce.stateNode.containerInfo!==Fe.containerInfo||Ce.stateNode.implementation!==Fe.implementation?(Ce=Pd(Fe,ze.mode,ut),Ce.return=ze,Ce):(Ce=A(Ce,Fe.children||[]),Ce.return=ze,Ce)}function rt(ze,Ce,Fe,ut,It){return Ce===null||Ce.tag!==7?(Ce=Lu(Fe,ze.mode,ut,It),Ce.return=ze,Ce):(Ce=A(Ce,Fe),Ce.return=ze,Ce)}function et(ze,Ce,Fe){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return Ce=Cd(""+Ce,ze.mode,Fe),Ce.return=ze,Ce;if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case Re:return Fe=bp(Ce.type,Ce.key,Ce.props,null,ze.mode,Fe),Fe.ref=zl(ze,null,Ce),Fe.return=ze,Fe;case Ue:return Ce=Pd(Ce,ze.mode,Fe),Ce.return=ze,Ce;case qr:var ut=Ce._init;return et(ze,ut(Ce._payload),Fe)}if(Na(Ce)||_t(Ce))return Ce=Lu(Ce,ze.mode,Fe,null),Ce.return=ze,Ce;Ll(ze,Ce)}return null}function Ye(ze,Ce,Fe,ut){var It=Ce!==null?Ce.key:null;if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return It!==null?null:pe(ze,Ce,""+Fe,ut);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case Re:return Fe.key===It?ve(ze,Ce,Fe,ut):null;case Ue:return Fe.key===It?Oe(ze,Ce,Fe,ut):null;case qr:return It=Fe._init,Ye(ze,Ce,It(Fe._payload),ut)}if(Na(Fe)||_t(Fe))return It!==null?null:rt(ze,Ce,Fe,ut,null);Ll(ze,Fe)}return null}function Tt(ze,Ce,Fe,ut,It){if(typeof ut=="string"&&ut!==""||typeof ut=="number")return ze=ze.get(Fe)||null,pe(Ce,ze,""+ut,It);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case Re:return ze=ze.get(ut.key===null?Fe:ut.key)||null,ve(Ce,ze,ut,It);case Ue:return ze=ze.get(ut.key===null?Fe:ut.key)||null,Oe(Ce,ze,ut,It);case qr:var Vt=ut._init;return Tt(ze,Ce,Fe,Vt(ut._payload),It)}if(Na(ut)||_t(ut))return ze=ze.get(Fe)||null,rt(Ce,ze,ut,It,null);Ll(Ce,ut)}return null}function Et(ze,Ce,Fe,ut){for(var It=null,Vt=null,$t=Ce,Kt=Ce=0,Yn=null;$t!==null&&Kt<Fe.length;Kt++){$t.index>Kt?(Yn=$t,$t=null):Yn=$t.sibling;var Mr=Ye(ze,$t,Fe[Kt],ut);if(Mr===null){$t===null&&($t=Yn);break}a&&$t&&Mr.alternate===null&&c(ze,$t),Ce=D(Mr,Ce,Kt),Vt===null?It=Mr:Vt.sibling=Mr,Vt=Mr,$t=Yn}if(Kt===Fe.length)return v(ze,$t),tn&&Ka(ze,Kt),It;if($t===null){for(;Kt<Fe.length;Kt++)$t=et(ze,Fe[Kt],ut),$t!==null&&(Ce=D($t,Ce,Kt),Vt===null?It=$t:Vt.sibling=$t,Vt=$t);return tn&&Ka(ze,Kt),It}for($t=C(ze,$t);Kt<Fe.length;Kt++)Yn=Tt($t,ze,Kt,Fe[Kt],ut),Yn!==null&&(a&&Yn.alternate!==null&&$t.delete(Yn.key===null?Kt:Yn.key),Ce=D(Yn,Ce,Kt),Vt===null?It=Yn:Vt.sibling=Yn,Vt=Yn);return a&&$t.forEach(function(Zs){return c(ze,Zs)}),tn&&Ka(ze,Kt),It}function Lt(ze,Ce,Fe,ut){var It=_t(Fe);if(typeof It!="function")throw Error(f(150));if(Fe=It.call(Fe),Fe==null)throw Error(f(151));for(var Vt=It=null,$t=Ce,Kt=Ce=0,Yn=null,Mr=Fe.next();$t!==null&&!Mr.done;Kt++,Mr=Fe.next()){$t.index>Kt?(Yn=$t,$t=null):Yn=$t.sibling;var Zs=Ye(ze,$t,Mr.value,ut);if(Zs===null){$t===null&&($t=Yn);break}a&&$t&&Zs.alternate===null&&c(ze,$t),Ce=D(Zs,Ce,Kt),Vt===null?It=Zs:Vt.sibling=Zs,Vt=Zs,$t=Yn}if(Mr.done)return v(ze,$t),tn&&Ka(ze,Kt),It;if($t===null){for(;!Mr.done;Kt++,Mr=Fe.next())Mr=et(ze,Mr.value,ut),Mr!==null&&(Ce=D(Mr,Ce,Kt),Vt===null?It=Mr:Vt.sibling=Mr,Vt=Mr);return tn&&Ka(ze,Kt),It}for($t=C(ze,$t);!Mr.done;Kt++,Mr=Fe.next())Mr=Tt($t,ze,Kt,Mr.value,ut),Mr!==null&&(a&&Mr.alternate!==null&&$t.delete(Mr.key===null?Kt:Mr.key),Ce=D(Mr,Ce,Kt),Vt===null?It=Mr:Vt.sibling=Mr,Vt=Mr);return a&&$t.forEach(function(Dm){return c(ze,Dm)}),tn&&Ka(ze,Kt),It}function hn(ze,Ce,Fe,ut){if(typeof Fe=="object"&&Fe!==null&&Fe.type===pt&&Fe.key===null&&(Fe=Fe.props.children),typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case Re:e:{for(var It=Fe.key,Vt=Ce;Vt!==null;){if(Vt.key===It){if(It=Fe.type,It===pt){if(Vt.tag===7){v(ze,Vt.sibling),Ce=A(Vt,Fe.props.children),Ce.return=ze,ze=Ce;break e}}else if(Vt.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===qr&&oc(It)===Vt.type){v(ze,Vt.sibling),Ce=A(Vt,Fe.props),Ce.ref=zl(ze,Vt,Fe),Ce.return=ze,ze=Ce;break e}v(ze,Vt);break}else c(ze,Vt);Vt=Vt.sibling}Fe.type===pt?(Ce=Lu(Fe.props.children,ze.mode,ut,Fe.key),Ce.return=ze,ze=Ce):(ut=bp(Fe.type,Fe.key,Fe.props,null,ze.mode,ut),ut.ref=zl(ze,Ce,Fe),ut.return=ze,ze=ut)}return X(ze);case Ue:e:{for(Vt=Fe.key;Ce!==null;){if(Ce.key===Vt)if(Ce.tag===4&&Ce.stateNode.containerInfo===Fe.containerInfo&&Ce.stateNode.implementation===Fe.implementation){v(ze,Ce.sibling),Ce=A(Ce,Fe.children||[]),Ce.return=ze,ze=Ce;break e}else{v(ze,Ce);break}else c(ze,Ce);Ce=Ce.sibling}Ce=Pd(Fe,ze.mode,ut),Ce.return=ze,ze=Ce}return X(ze);case qr:return Vt=Fe._init,hn(ze,Ce,Vt(Fe._payload),ut)}if(Na(Fe))return Et(ze,Ce,Fe,ut);if(_t(Fe))return Lt(ze,Ce,Fe,ut);Ll(ze,Fe)}return typeof Fe=="string"&&Fe!==""||typeof Fe=="number"?(Fe=""+Fe,Ce!==null&&Ce.tag===6?(v(ze,Ce.sibling),Ce=A(Ce,Fe),Ce.return=ze,ze=Ce):(v(ze,Ce),Ce=Cd(Fe,ze.mode,ut),Ce.return=ze,ze=Ce),X(ze)):v(ze,Ce)}return hn}var mi=lh(!0),wu=lh(!1),wt=Un(null),zt=null,ko=null,Ya=null;function Rl(){Ya=ko=zt=null}function Wn(a){var c=wt.current;Nr(wt),a._currentValue=c}function sc(a,c,v){for(;a!==null;){var C=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,C!==null&&(C.childLanes|=c)):C!==null&&(C.childLanes&c)!==c&&(C.childLanes|=c),a===v)break;a=a.return}}function Xn(a,c){zt=a,Ya=ko=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&c)!==0&&(ua=!0),a.firstContext=null)}function oa(a){var c=a._currentValue;if(Ya!==a)if(a={context:a,memoizedValue:c,next:null},ko===null){if(zt===null)throw Error(f(308));ko=a,zt.dependencies={lanes:0,firstContext:a}}else ko=ko.next=a;return c}var Ca=null;function Ar(a){Ca===null?Ca=[a]:Ca.push(a)}function on(a,c,v,C){var A=c.interleaved;return A===null?(v.next=v,Ar(c)):(v.next=A.next,A.next=v),c.interleaved=v,sa(a,C)}function sa(a,c){a.lanes|=c;var v=a.alternate;for(v!==null&&(v.lanes|=c),v=a,a=a.return;a!==null;)a.childLanes|=c,v=a.alternate,v!==null&&(v.childLanes|=c),v=a,a=a.return;return v.tag===3?v.stateNode:null}var Gi=!1;function hs(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lc(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Ai(a,c){return{eventTime:a,lane:c,tag:0,payload:null,callback:null,next:null}}function zi(a,c,v){var C=a.updateQueue;if(C===null)return null;if(C=C.shared,(vr&2)!==0){var A=C.pending;return A===null?c.next=c:(c.next=A.next,A.next=c),C.pending=c,sa(a,v)}return A=C.interleaved,A===null?(c.next=c,Ar(C)):(c.next=A.next,A.next=c),C.interleaved=c,sa(a,v)}function ps(a,c,v){if(c=c.updateQueue,c!==null&&(c=c.shared,(v&4194240)!==0)){var C=c.lanes;C&=a.pendingLanes,v|=C,c.lanes=v,Xo(a,v)}}function Su(a,c){var v=a.updateQueue,C=a.alternate;if(C!==null&&(C=C.updateQueue,v===C)){var A=null,D=null;if(v=v.firstBaseUpdate,v!==null){do{var X={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};D===null?A=D=X:D=D.next=X,v=v.next}while(v!==null);D===null?A=D=c:D=D.next=c}else A=D=c;v={baseState:C.baseState,firstBaseUpdate:A,lastBaseUpdate:D,shared:C.shared,effects:C.effects},a.updateQueue=v;return}a=v.lastBaseUpdate,a===null?v.firstBaseUpdate=c:a.next=c,v.lastBaseUpdate=c}function Ja(a,c,v,C){var A=a.updateQueue;Gi=!1;var D=A.firstBaseUpdate,X=A.lastBaseUpdate,pe=A.shared.pending;if(pe!==null){A.shared.pending=null;var ve=pe,Oe=ve.next;ve.next=null,X===null?D=Oe:X.next=Oe,X=ve;var rt=a.alternate;rt!==null&&(rt=rt.updateQueue,pe=rt.lastBaseUpdate,pe!==X&&(pe===null?rt.firstBaseUpdate=Oe:pe.next=Oe,rt.lastBaseUpdate=ve))}if(D!==null){var et=A.baseState;X=0,rt=Oe=ve=null,pe=D;do{var Ye=pe.lane,Tt=pe.eventTime;if((C&Ye)===Ye){rt!==null&&(rt=rt.next={eventTime:Tt,lane:0,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null});e:{var Et=a,Lt=pe;switch(Ye=c,Tt=v,Lt.tag){case 1:if(Et=Lt.payload,typeof Et=="function"){et=Et.call(Tt,et,Ye);break e}et=Et;break e;case 3:Et.flags=Et.flags&-65537|128;case 0:if(Et=Lt.payload,Ye=typeof Et=="function"?Et.call(Tt,et,Ye):Et,Ye==null)break e;et=bt({},et,Ye);break e;case 2:Gi=!0}}pe.callback!==null&&pe.lane!==0&&(a.flags|=64,Ye=A.effects,Ye===null?A.effects=[pe]:Ye.push(pe))}else Tt={eventTime:Tt,lane:Ye,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null},rt===null?(Oe=rt=Tt,ve=et):rt=rt.next=Tt,X|=Ye;if(pe=pe.next,pe===null){if(pe=A.shared.pending,pe===null)break;Ye=pe,pe=Ye.next,Ye.next=null,A.lastBaseUpdate=Ye,A.shared.pending=null}}while(!0);if(rt===null&&(ve=et),A.baseState=ve,A.firstBaseUpdate=Oe,A.lastBaseUpdate=rt,c=A.shared.interleaved,c!==null){A=c;do X|=A.lane,A=A.next;while(A!==c)}else D===null&&(A.shared.lanes=0);Fl|=X,a.lanes=X,a.memoizedState=et}}function uc(a,c,v){if(a=c.effects,c.effects=null,a!==null)for(c=0;c<a.length;c++){var C=a[c],A=C.callback;if(A!==null){if(C.callback=null,C=v,typeof A!="function")throw Error(f(191,A));A.call(C)}}}var Fs={},Zi=Un(Fs),Bs=Un(Fs),m=Un(Fs);function e(a){if(a===Fs)throw Error(f(174));return a}function i(a,c){switch(pr(m,c),pr(Bs,a),pr(Zi,Fs),a=c.nodeType,a){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:Ba(null,"");break;default:a=a===8?c.parentNode:c,c=a.namespaceURI||null,a=a.tagName,c=Ba(c,a)}Nr(Zi),pr(Zi,c)}function u(){Nr(Zi),Nr(Bs),Nr(m)}function p(a){e(m.current);var c=e(Zi.current),v=Ba(c,a.type);c!==v&&(pr(Bs,a),pr(Zi,v))}function g(a){Bs.current===a&&(Nr(Zi),Nr(Bs))}var x=Un(0);function M(a){for(var c=a;c!==null;){if(c.tag===13){var v=c.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var k=[];function z(){for(var a=0;a<k.length;a++)k[a]._workInProgressVersionPrimary=null;k.length=0}var R=Le.ReactCurrentDispatcher,j=Le.ReactCurrentBatchConfig,B=0,O=null,G=null,J=null,te=!1,re=!1,ne=0,ce=0;function ie(){throw Error(f(321))}function de(a,c){if(c===null)return!1;for(var v=0;v<c.length&&v<a.length;v++)if(!wa(a[v],c[v]))return!1;return!0}function me(a,c,v,C,A,D){if(B=D,O=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,R.current=a===null||a.memoizedState===null?Tn:Tu,a=v(C,A),re){D=0;do{if(re=!1,ne=0,25<=D)throw Error(f(301));D+=1,J=G=null,c.updateQueue=null,R.current=Dl,a=v(C,A)}while(re)}if(R.current=_i,c=G!==null&&G.next!==null,B=0,J=G=O=null,te=!1,c)throw Error(f(300));return a}function se(){var a=ne!==0;return ne=0,a}function _e(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return J===null?O.memoizedState=J=a:J=J.next=a,J}function Ee(){if(G===null){var a=O.alternate;a=a!==null?a.memoizedState:null}else a=G.next;var c=J===null?O.memoizedState:J.next;if(c!==null)J=c,G=a;else{if(a===null)throw Error(f(310));G=a,a={memoizedState:G.memoizedState,baseState:G.baseState,baseQueue:G.baseQueue,queue:G.queue,next:null},J===null?O.memoizedState=J=a:J=J.next=a}return J}function Me(a,c){return typeof c=="function"?c(a):c}function ke(a){var c=Ee(),v=c.queue;if(v===null)throw Error(f(311));v.lastRenderedReducer=a;var C=G,A=C.baseQueue,D=v.pending;if(D!==null){if(A!==null){var X=A.next;A.next=D.next,D.next=X}C.baseQueue=A=D,v.pending=null}if(A!==null){D=A.next,C=C.baseState;var pe=X=null,ve=null,Oe=D;do{var rt=Oe.lane;if((B&rt)===rt)ve!==null&&(ve=ve.next={lane:0,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),C=Oe.hasEagerState?Oe.eagerState:a(C,Oe.action);else{var et={lane:rt,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null};ve===null?(pe=ve=et,X=C):ve=ve.next=et,O.lanes|=rt,Fl|=rt}Oe=Oe.next}while(Oe!==null&&Oe!==D);ve===null?X=C:ve.next=pe,wa(C,c.memoizedState)||(ua=!0),c.memoizedState=C,c.baseState=X,c.baseQueue=ve,v.lastRenderedState=C}if(a=v.interleaved,a!==null){A=a;do D=A.lane,O.lanes|=D,Fl|=D,A=A.next;while(A!==a)}else A===null&&(v.lanes=0);return[c.memoizedState,v.dispatch]}function De(a){var c=Ee(),v=c.queue;if(v===null)throw Error(f(311));v.lastRenderedReducer=a;var C=v.dispatch,A=v.pending,D=c.memoizedState;if(A!==null){v.pending=null;var X=A=A.next;do D=a(D,X.action),X=X.next;while(X!==A);wa(D,c.memoizedState)||(ua=!0),c.memoizedState=D,c.baseQueue===null&&(c.baseState=D),v.lastRenderedState=D}return[D,C]}function tt(){}function it(a,c){var v=O,C=Ee(),A=c(),D=!wa(C.memoizedState,A);if(D&&(C.memoizedState=A,ua=!0),C=C.queue,yn(Jt.bind(null,v,C,a),[a]),C.getSnapshot!==c||D||J!==null&&J.memoizedState.tag&1){if(v.flags|=2048,Hr(9,St.bind(null,v,C,A,c),void 0,null),Rn===null)throw Error(f(349));(B&30)!==0||We(v,c,A)}return A}function We(a,c,v){a.flags|=16384,a={getSnapshot:c,value:v},c=O.updateQueue,c===null?(c={lastEffect:null,stores:null},O.updateQueue=c,c.stores=[a]):(v=c.stores,v===null?c.stores=[a]:v.push(a))}function St(a,c,v,C){c.value=v,c.getSnapshot=C,Sr(c)&&Br(a)}function Jt(a,c,v){return v(function(){Sr(c)&&Br(a)})}function Sr(a){var c=a.getSnapshot;a=a.value;try{var v=c();return!wa(a,v)}catch{return!0}}function Br(a){var c=sa(a,1);c!==null&&Ro(c,a,1,-1)}function zr(a){var c=_e();return typeof a=="function"&&(a=a()),c.memoizedState=c.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Me,lastRenderedState:a},c.queue=a,a=a.dispatch=yi.bind(null,O,a),[c.memoizedState,a]}function Hr(a,c,v,C){return a={tag:a,create:c,destroy:v,deps:C,next:null},c=O.updateQueue,c===null?(c={lastEffect:null,stores:null},O.updateQueue=c,c.lastEffect=a.next=a):(v=c.lastEffect,v===null?c.lastEffect=a.next=a:(C=v.next,v.next=a,a.next=C,c.lastEffect=a)),a}function rn(){return Ee().memoizedState}function Zt(a,c,v,C){var A=_e();O.flags|=a,A.memoizedState=Hr(1|c,v,void 0,C===void 0?null:C)}function Er(a,c,v,C){var A=Ee();C=C===void 0?null:C;var D=void 0;if(G!==null){var X=G.memoizedState;if(D=X.destroy,C!==null&&de(C,X.deps)){A.memoizedState=Hr(c,v,D,C);return}}O.flags|=a,A.memoizedState=Hr(1|c,v,D,C)}function gn(a,c){return Zt(8390656,8,a,c)}function yn(a,c){return Er(2048,8,a,c)}function zn(a,c){return Er(4,2,a,c)}function ii(a,c){return Er(4,4,a,c)}function la(a,c){if(typeof c=="function")return a=a(),c(a),function(){c(null)};if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function Eo(a,c,v){return v=v!=null?v.concat([a]):null,Er(4,4,la.bind(null,c,a),v)}function Qa(){}function js(a,c){var v=Ee();c=c===void 0?null:c;var C=v.memoizedState;return C!==null&&c!==null&&de(c,C[1])?C[0]:(v.memoizedState=[a,c],a)}function Os(a,c){var v=Ee();c=c===void 0?null:c;var C=v.memoizedState;return C!==null&&c!==null&&de(c,C[1])?C[0]:(a=a(),v.memoizedState=[a,c],a)}function ds(a,c,v){return(B&21)===0?(a.baseState&&(a.baseState=!1,ua=!0),a.memoizedState=v):(wa(v,c)||(v=Ss(),O.lanes|=v,Fl|=v,a.baseState=!0),c)}function Us(a,c){var v=Pr;Pr=v!==0&&4>v?v:4,a(!0);var C=j.transition;j.transition={};try{a(!1),c()}finally{Pr=v,j.transition=C}}function gi(){return Ee().memoizedState}function Pa(a,c,v){var C=gs(a);if(v={lane:C,action:v,hasEagerState:!1,eagerState:null,next:null},Io(a))_n(c,v);else if(v=on(a,c,v,C),v!==null){var A=Kn();Ro(v,a,C,A),Sn(v,c,C)}}function yi(a,c,v){var C=gs(a),A={lane:C,action:v,hasEagerState:!1,eagerState:null,next:null};if(Io(a))_n(c,A);else{var D=a.alternate;if(a.lanes===0&&(D===null||D.lanes===0)&&(D=c.lastRenderedReducer,D!==null))try{var X=c.lastRenderedState,pe=D(X,v);if(A.hasEagerState=!0,A.eagerState=pe,wa(pe,X)){var ve=c.interleaved;ve===null?(A.next=A,Ar(c)):(A.next=ve.next,ve.next=A),c.interleaved=A;return}}catch{}finally{}v=on(a,c,A,C),v!==null&&(A=Kn(),Ro(v,a,C,A),Sn(v,c,C))}}function Io(a){var c=a.alternate;return a===O||c!==null&&c===O}function _n(a,c){re=te=!0;var v=a.pending;v===null?c.next=c:(c.next=v.next,v.next=c),a.pending=c}function Sn(a,c,v){if((v&4194240)!==0){var C=c.lanes;C&=a.pendingLanes,v|=C,c.lanes=v,Xo(a,v)}}var _i={readContext:oa,useCallback:ie,useContext:ie,useEffect:ie,useImperativeHandle:ie,useInsertionEffect:ie,useLayoutEffect:ie,useMemo:ie,useReducer:ie,useRef:ie,useState:ie,useDebugValue:ie,useDeferredValue:ie,useTransition:ie,useMutableSource:ie,useSyncExternalStore:ie,useId:ie,unstable_isNewReconciler:!1},Tn={readContext:oa,useCallback:function(a,c){return _e().memoizedState=[a,c===void 0?null:c],a},useContext:oa,useEffect:gn,useImperativeHandle:function(a,c,v){return v=v!=null?v.concat([a]):null,Zt(4194308,4,la.bind(null,c,a),v)},useLayoutEffect:function(a,c){return Zt(4194308,4,a,c)},useInsertionEffect:function(a,c){return Zt(4,2,a,c)},useMemo:function(a,c){var v=_e();return c=c===void 0?null:c,a=a(),v.memoizedState=[a,c],a},useReducer:function(a,c,v){var C=_e();return c=v!==void 0?v(c):c,C.memoizedState=C.baseState=c,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:c},C.queue=a,a=a.dispatch=Pa.bind(null,O,a),[C.memoizedState,a]},useRef:function(a){var c=_e();return a={current:a},c.memoizedState=a},useState:zr,useDebugValue:Qa,useDeferredValue:function(a){return _e().memoizedState=a},useTransition:function(){var a=zr(!1),c=a[0];return a=Us.bind(null,a[1]),_e().memoizedState=a,[c,a]},useMutableSource:function(){},useSyncExternalStore:function(a,c,v){var C=O,A=_e();if(tn){if(v===void 0)throw Error(f(407));v=v()}else{if(v=c(),Rn===null)throw Error(f(349));(B&30)!==0||We(C,c,v)}A.memoizedState=v;var D={value:v,getSnapshot:c};return A.queue=D,gn(Jt.bind(null,C,D,a),[a]),C.flags|=2048,Hr(9,St.bind(null,C,D,v,c),void 0,null),v},useId:function(){var a=_e(),c=Rn.identifierPrefix;if(tn){var v=fi,C=Ii;v=(C&~(1<<32-ra(C)-1)).toString(32)+v,c=":"+c+"R"+v,v=ne++,0<v&&(c+="H"+v.toString(32)),c+=":"}else v=ce++,c=":"+c+"r"+v.toString(32)+":";return a.memoizedState=c},unstable_isNewReconciler:!1},Tu={readContext:oa,useCallback:js,useContext:oa,useEffect:yn,useImperativeHandle:Eo,useInsertionEffect:zn,useLayoutEffect:ii,useMemo:Os,useReducer:ke,useRef:rn,useState:function(){return ke(Me)},useDebugValue:Qa,useDeferredValue:function(a){var c=Ee();return ds(c,G.memoizedState,a)},useTransition:function(){var a=ke(Me)[0],c=Ee().memoizedState;return[a,c]},useMutableSource:tt,useSyncExternalStore:it,useId:gi,unstable_isNewReconciler:!1},Dl={readContext:oa,useCallback:js,useContext:oa,useEffect:yn,useImperativeHandle:Eo,useInsertionEffect:zn,useLayoutEffect:ii,useMemo:Os,useReducer:De,useRef:rn,useState:function(){return De(Me)},useDebugValue:Qa,useDeferredValue:function(a){var c=Ee();return G===null?c.memoizedState=a:ds(c,G.memoizedState,a)},useTransition:function(){var a=De(Me)[0],c=Ee().memoizedState;return[a,c]},useMutableSource:tt,useSyncExternalStore:it,useId:gi,unstable_isNewReconciler:!1};function Ln(a,c){if(a&&a.defaultProps){c=bt({},c),a=a.defaultProps;for(var v in a)c[v]===void 0&&(c[v]=a[v]);return c}return c}function Hi(a,c,v,C){c=a.memoizedState,v=v(C,c),v=v==null?c:bt({},c,v),a.memoizedState=v,a.lanes===0&&(a.updateQueue.baseState=v)}var Ma={isMounted:function(a){return(a=a._reactInternals)?Gt(a)===a:!1},enqueueSetState:function(a,c,v){a=a._reactInternals;var C=Kn(),A=gs(a),D=Ai(C,A);D.payload=c,v!=null&&(D.callback=v),c=zi(a,D,A),c!==null&&(Ro(c,a,A,C),ps(c,a,A))},enqueueReplaceState:function(a,c,v){a=a._reactInternals;var C=Kn(),A=gs(a),D=Ai(C,A);D.tag=1,D.payload=c,v!=null&&(D.callback=v),c=zi(a,D,A),c!==null&&(Ro(c,a,A,C),ps(c,a,A))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var v=Kn(),C=gs(a),A=Ai(v,C);A.tag=2,c!=null&&(A.callback=c),c=zi(a,A,C),c!==null&&(Ro(c,a,C,v),ps(c,a,C))}};function uh(a,c,v,C,A,D,X){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(C,D,X):c.prototype&&c.prototype.isPureReactComponent?!su(v,C)||!su(A,D):!0}function Li(a,c,v){var C=!1,A=Vi,D=c.contextType;return typeof D=="object"&&D!==null?D=oa(D):(A=ri(c)?ls:Vn.current,C=c.contextTypes,D=(C=C!=null)?Ta(a,A):Vi),c=new c(v,D),a.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Ma,a.stateNode=c,c._reactInternals=a,C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=A,a.__reactInternalMemoizedMaskedChildContext=D),c}function ch(a,c,v,C){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(v,C),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(v,C),c.state!==a&&Ma.enqueueReplaceState(c,c.state,null)}function Cu(a,c,v,C){var A=a.stateNode;A.props=v,A.state=a.memoizedState,A.refs={},hs(a);var D=c.contextType;typeof D=="object"&&D!==null?A.context=oa(D):(D=ri(c)?ls:Vn.current,A.context=Ta(a,D)),A.state=a.memoizedState,D=c.getDerivedStateFromProps,typeof D=="function"&&(Hi(a,c,D,v),A.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(c=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),c!==A.state&&Ma.enqueueReplaceState(A,A.state,null),Ja(a,v,A,C),A.state=a.memoizedState),typeof A.componentDidMount=="function"&&(a.flags|=4194308)}function Ao(a,c){try{var v="",C=c;do v+=mr(C),C=C.return;while(C);var A=v}catch(D){A=`
Error generating stack: `+D.message+`
`+D.stack}return{value:a,source:c,stack:A,digest:null}}function Nl(a,c,v){return{value:a,source:null,stack:v??null,digest:c??null}}function eo(a,c){try{console.error(c.value)}catch(v){setTimeout(function(){throw v})}}var zo=typeof WeakMap=="function"?WeakMap:Map;function td(a,c,v){v=Ai(-1,v),v.tag=3,v.payload={element:null};var C=c.value;return v.callback=function(){mp||(mp=!0,_d=C),eo(a,c)},v}function af(a,c,v){v=Ai(-1,v),v.tag=3;var C=a.type.getDerivedStateFromError;if(typeof C=="function"){var A=c.value;v.payload=function(){return C(A)},v.callback=function(){eo(a,c)}}var D=a.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(v.callback=function(){eo(a,c),typeof C!="function"&&(Ia===null?Ia=new Set([this]):Ia.add(this));var X=c.stack;this.componentDidCatch(c.value,{componentStack:X!==null?X:""})}),v}function cp(a,c,v){var C=a.pingCache;if(C===null){C=a.pingCache=new zo;var A=new Set;C.set(c,A)}else A=C.get(c),A===void 0&&(A=new Set,C.set(c,A));A.has(v)||(A.add(v),a=Mf.bind(null,a,c,v),c.then(a,a))}function rd(a){do{var c;if((c=a.tag===13)&&(c=a.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return a;a=a.return}while(a!==null);return null}function of(a,c,v,C,A){return(a.mode&1)===0?(a===c?a.flags|=65536:(a.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(c=Ai(-1,1),c.tag=2,zi(v,c,1))),v.lanes|=1),a):(a.flags|=65536,a.lanes=A,a)}var sf=Le.ReactCurrentOwner,ua=!1;function vi(a,c,v,C){c.child=a===null?wu(c,null,v,C):mi(c,a.child,v,C)}function lf(a,c,v,C,A){v=v.render;var D=c.ref;return Xn(c,A),C=me(a,c,v,C,D,A),v=se(),a!==null&&!ua?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~A,ka(a,c,A)):(tn&&v&&Al(c),c.flags|=1,vi(a,c,C,A),c.child)}function hp(a,c,v,C,A){if(a===null){var D=v.type;return typeof D=="function"&&!Mh(D)&&D.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(c.tag=15,c.type=D,nd(a,c,D,C,A)):(a=bp(v.type,null,C,c,c.mode,A),a.ref=c.ref,a.return=c,c.child=a)}if(D=a.child,(a.lanes&A)===0){var X=D.memoizedProps;if(v=v.compare,v=v!==null?v:su,v(X,C)&&a.ref===c.ref)return ka(a,c,A)}return c.flags|=1,a=$s(D,C),a.ref=c.ref,a.return=c,c.child=a}function nd(a,c,v,C,A){if(a!==null){var D=a.memoizedProps;if(su(D,C)&&a.ref===c.ref)if(ua=!1,c.pendingProps=C=D,(a.lanes&A)!==0)(a.flags&131072)!==0&&(ua=!0);else return c.lanes=a.lanes,ka(a,c,A)}return ad(a,c,v,C,A)}function id(a,c,v){var C=c.pendingProps,A=C.children,D=a!==null?a.memoizedState:null;if(C.mode==="hidden")if((c.mode&1)===0)c.memoizedState={baseLanes:0,cachePool:null,transitions:null},pr(Eu,Ea),Ea|=v;else{if((v&1073741824)===0)return a=D!==null?D.baseLanes|v:v,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:a,cachePool:null,transitions:null},c.updateQueue=null,pr(Eu,Ea),Ea|=a,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=D!==null?D.baseLanes:v,pr(Eu,Ea),Ea|=C}else D!==null?(C=D.baseLanes|v,c.memoizedState=null):C=v,pr(Eu,Ea),Ea|=C;return vi(a,c,A,v),c.child}function Pu(a,c){var v=c.ref;(a===null&&v!==null||a!==null&&a.ref!==v)&&(c.flags|=512,c.flags|=2097152)}function ad(a,c,v,C,A){var D=ri(v)?ls:Vn.current;return D=Ta(c,D),Xn(c,A),v=me(a,c,v,C,D,A),C=se(),a!==null&&!ua?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~A,ka(a,c,A)):(tn&&C&&Al(c),c.flags|=1,vi(a,c,v,A),c.child)}function cc(a,c,v,C,A){if(ri(v)){var D=!0;Mi(c)}else D=!1;if(Xn(c,A),c.stateNode===null)pc(a,c),Li(c,v,C),Cu(c,v,C,A),C=!0;else if(a===null){var X=c.stateNode,pe=c.memoizedProps;X.props=pe;var ve=X.context,Oe=v.contextType;typeof Oe=="object"&&Oe!==null?Oe=oa(Oe):(Oe=ri(v)?ls:Vn.current,Oe=Ta(c,Oe));var rt=v.getDerivedStateFromProps,et=typeof rt=="function"||typeof X.getSnapshotBeforeUpdate=="function";et||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(pe!==C||ve!==Oe)&&ch(c,X,C,Oe),Gi=!1;var Ye=c.memoizedState;X.state=Ye,Ja(c,C,X,A),ve=c.memoizedState,pe!==C||Ye!==ve||hi.current||Gi?(typeof rt=="function"&&(Hi(c,v,rt,C),ve=c.memoizedState),(pe=Gi||uh(c,v,pe,C,Ye,ve,Oe))?(et||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount()),typeof X.componentDidMount=="function"&&(c.flags|=4194308)):(typeof X.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=C,c.memoizedState=ve),X.props=C,X.state=ve,X.context=Oe,C=pe):(typeof X.componentDidMount=="function"&&(c.flags|=4194308),C=!1)}else{X=c.stateNode,lc(a,c),pe=c.memoizedProps,Oe=c.type===c.elementType?pe:Ln(c.type,pe),X.props=Oe,et=c.pendingProps,Ye=X.context,ve=v.contextType,typeof ve=="object"&&ve!==null?ve=oa(ve):(ve=ri(v)?ls:Vn.current,ve=Ta(c,ve));var Tt=v.getDerivedStateFromProps;(rt=typeof Tt=="function"||typeof X.getSnapshotBeforeUpdate=="function")||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(pe!==et||Ye!==ve)&&ch(c,X,C,ve),Gi=!1,Ye=c.memoizedState,X.state=Ye,Ja(c,C,X,A);var Et=c.memoizedState;pe!==et||Ye!==Et||hi.current||Gi?(typeof Tt=="function"&&(Hi(c,v,Tt,C),Et=c.memoizedState),(Oe=Gi||uh(c,v,Oe,C,Ye,Et,ve)||!1)?(rt||typeof X.UNSAFE_componentWillUpdate!="function"&&typeof X.componentWillUpdate!="function"||(typeof X.componentWillUpdate=="function"&&X.componentWillUpdate(C,Et,ve),typeof X.UNSAFE_componentWillUpdate=="function"&&X.UNSAFE_componentWillUpdate(C,Et,ve)),typeof X.componentDidUpdate=="function"&&(c.flags|=4),typeof X.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof X.componentDidUpdate!="function"||pe===a.memoizedProps&&Ye===a.memoizedState||(c.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||pe===a.memoizedProps&&Ye===a.memoizedState||(c.flags|=1024),c.memoizedProps=C,c.memoizedState=Et),X.props=C,X.state=Et,X.context=ve,C=Oe):(typeof X.componentDidUpdate!="function"||pe===a.memoizedProps&&Ye===a.memoizedState||(c.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||pe===a.memoizedProps&&Ye===a.memoizedState||(c.flags|=1024),C=!1)}return hc(a,c,v,C,D,A)}function hc(a,c,v,C,A,D){Pu(a,c);var X=(c.flags&128)!==0;if(!C&&!X)return A&&Ns(c,v,!1),ka(a,c,D);C=c.stateNode,sf.current=c;var pe=X&&typeof v.getDerivedStateFromError!="function"?null:C.render();return c.flags|=1,a!==null&&X?(c.child=mi(c,a.child,null,D),c.child=mi(c,null,pe,D)):vi(a,c,pe,D),c.memoizedState=C.state,A&&Ns(c,v,!0),c.child}function hh(a){var c=a.stateNode;c.pendingContext?rh(a,c.pendingContext,c.pendingContext!==c.context):c.context&&rh(a,c.context,!1),i(a,c.containerInfo)}function od(a,c,v,C,A){return Fr(),cs(A),c.flags|=256,vi(a,c,v,C),c.child}var pp={dehydrated:null,treeContext:null,retryLane:0};function sd(a){return{baseLanes:a,cachePool:null,transitions:null}}function uf(a,c,v){var C=c.pendingProps,A=x.current,D=!1,X=(c.flags&128)!==0,pe;if((pe=X)||(pe=a!==null&&a.memoizedState===null?!1:(A&2)!==0),pe?(D=!0,c.flags&=-129):(a===null||a.memoizedState!==null)&&(A|=1),pr(x,A&1),a===null)return xu(c),a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((c.mode&1)===0?c.lanes=1:a.data==="$!"?c.lanes=8:c.lanes=1073741824,null):(X=C.children,a=C.fallback,D?(C=c.mode,D=c.child,X={mode:"hidden",children:X},(C&1)===0&&D!==null?(D.childLanes=0,D.pendingProps=X):D=wp(X,C,0,null),a=Lu(a,C,v,null),D.return=c,a.return=c,D.sibling=a,c.child=D,c.child.memoizedState=sd(v),c.memoizedState=pp,a):dp(c,X));if(A=a.memoizedState,A!==null&&(pe=A.dehydrated,pe!==null))return cf(a,c,X,C,pe,A,v);if(D){D=C.fallback,X=c.mode,A=a.child,pe=A.sibling;var ve={mode:"hidden",children:C.children};return(X&1)===0&&c.child!==A?(C=c.child,C.childLanes=0,C.pendingProps=ve,c.deletions=null):(C=$s(A,ve),C.subtreeFlags=A.subtreeFlags&14680064),pe!==null?D=$s(pe,D):(D=Lu(D,X,v,null),D.flags|=2),D.return=c,C.return=c,C.sibling=D,c.child=C,C=D,D=c.child,X=a.child.memoizedState,X=X===null?sd(v):{baseLanes:X.baseLanes|v,cachePool:null,transitions:X.transitions},D.memoizedState=X,D.childLanes=a.childLanes&~v,c.memoizedState=pp,C}return D=a.child,a=D.sibling,C=$s(D,{mode:"visible",children:C.children}),(c.mode&1)===0&&(C.lanes=v),C.return=c,C.sibling=null,a!==null&&(v=c.deletions,v===null?(c.deletions=[a],c.flags|=16):v.push(a)),c.child=C,c.memoizedState=null,C}function dp(a,c){return c=wp({mode:"visible",children:c},a.mode,0,null),c.return=a,a.child=c}function ph(a,c,v,C){return C!==null&&cs(C),mi(c,a.child,null,v),a=dp(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function cf(a,c,v,C,A,D,X){if(v)return c.flags&256?(c.flags&=-257,C=Nl(Error(f(422))),ph(a,c,X,C)):c.memoizedState!==null?(c.child=a.child,c.flags|=128,null):(D=C.fallback,A=c.mode,C=wp({mode:"visible",children:C.children},A,0,null),D=Lu(D,A,X,null),D.flags|=2,C.return=c,D.return=c,C.sibling=D,c.child=C,(c.mode&1)!==0&&mi(c,a.child,null,X),c.child.memoizedState=sd(X),c.memoizedState=pp,D);if((c.mode&1)===0)return ph(a,c,X,null);if(A.data==="$!"){if(C=A.nextSibling&&A.nextSibling.dataset,C)var pe=C.dgst;return C=pe,D=Error(f(419)),C=Nl(D,C,void 0),ph(a,c,X,C)}if(pe=(X&a.childLanes)!==0,ua||pe){if(C=Rn,C!==null){switch(X&-X){case 4:A=2;break;case 16:A=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:A=32;break;case 536870912:A=268435456;break;default:A=0}A=(A&(C.suspendedLanes|X))!==0?0:A,A!==0&&A!==D.retryLane&&(D.retryLane=A,sa(a,A),Ro(C,a,A,-1))}return Sh(),C=Nl(Error(f(421))),ph(a,c,X,C)}return A.data==="$?"?(c.flags|=128,c.child=a.child,c=Am.bind(null,a),A._reactRetry=c,null):(a=D.treeContext,$i=Dr(A.nextSibling),ni=c,tn=!0,qi=null,a!==null&&(Ei[di++]=Ii,Ei[di++]=fi,Ei[di++]=Mo,Ii=a.id,fi=a.overflow,Mo=c),c=dp(c,C.children),c.flags|=4096,c)}function hf(a,c,v){a.lanes|=c;var C=a.alternate;C!==null&&(C.lanes|=c),sc(a.return,c,v)}function dh(a,c,v,C,A){var D=a.memoizedState;D===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:C,tail:v,tailMode:A}:(D.isBackwards=c,D.rendering=null,D.renderingStartTime=0,D.last=C,D.tail=v,D.tailMode=A)}function ld(a,c,v){var C=c.pendingProps,A=C.revealOrder,D=C.tail;if(vi(a,c,C.children,v),C=x.current,(C&2)!==0)C=C&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&hf(a,v,c);else if(a.tag===19)hf(a,v,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}C&=1}if(pr(x,C),(c.mode&1)===0)c.memoizedState=null;else switch(A){case"forwards":for(v=c.child,A=null;v!==null;)a=v.alternate,a!==null&&M(a)===null&&(A=v),v=v.sibling;v=A,v===null?(A=c.child,c.child=null):(A=v.sibling,v.sibling=null),dh(c,!1,A,v,D);break;case"backwards":for(v=null,A=c.child,c.child=null;A!==null;){if(a=A.alternate,a!==null&&M(a)===null){c.child=A;break}a=A.sibling,A.sibling=v,v=A,A=a}dh(c,!0,v,null,D);break;case"together":dh(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function pc(a,c){(c.mode&1)===0&&a!==null&&(a.alternate=null,c.alternate=null,c.flags|=2)}function ka(a,c,v){if(a!==null&&(c.dependencies=a.dependencies),Fl|=c.lanes,(v&c.childLanes)===0)return null;if(a!==null&&c.child!==a.child)throw Error(f(153));if(c.child!==null){for(a=c.child,v=$s(a,a.pendingProps),c.child=v,v.return=c;a.sibling!==null;)a=a.sibling,v=v.sibling=$s(a,a.pendingProps),v.return=c;v.sibling=null}return c.child}function Wi(a,c,v){switch(c.tag){case 3:hh(c),Fr();break;case 5:p(c);break;case 1:ri(c.type)&&Mi(c);break;case 4:i(c,c.stateNode.containerInfo);break;case 10:var C=c.type._context,A=c.memoizedProps.value;pr(wt,C._currentValue),C._currentValue=A;break;case 13:if(C=c.memoizedState,C!==null)return C.dehydrated!==null?(pr(x,x.current&1),c.flags|=128,null):(v&c.child.childLanes)!==0?uf(a,c,v):(pr(x,x.current&1),a=ka(a,c,v),a!==null?a.sibling:null);pr(x,x.current&1);break;case 19:if(C=(v&c.childLanes)!==0,(a.flags&128)!==0){if(C)return ld(a,c,v);c.flags|=128}if(A=c.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),pr(x,x.current),C)break;return null;case 22:case 23:return c.lanes=0,id(a,c,v)}return ka(a,c,v)}var ud,fh,pf,cd;ud=function(a,c){for(var v=c.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break;for(;v.sibling===null;){if(v.return===null||v.return===c)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},fh=function(){},pf=function(a,c,v,C){var A=a.memoizedProps;if(A!==C){a=c.stateNode,e(Zi.current);var D=null;switch(v){case"input":A=an(a,A),C=an(a,C),D=[];break;case"select":A=bt({},A,{value:void 0}),C=bt({},C,{value:void 0}),D=[];break;case"textarea":A=Fa(a,A),C=Fa(a,C),D=[];break;default:typeof A.onClick!="function"&&typeof C.onClick=="function"&&(a.onclick=Ml)}Ae(v,C);var X;v=null;for(Oe in A)if(!C.hasOwnProperty(Oe)&&A.hasOwnProperty(Oe)&&A[Oe]!=null)if(Oe==="style"){var pe=A[Oe];for(X in pe)pe.hasOwnProperty(X)&&(v||(v={}),v[X]="")}else Oe!=="dangerouslySetInnerHTML"&&Oe!=="children"&&Oe!=="suppressContentEditableWarning"&&Oe!=="suppressHydrationWarning"&&Oe!=="autoFocus"&&(T.hasOwnProperty(Oe)?D||(D=[]):(D=D||[]).push(Oe,null));for(Oe in C){var ve=C[Oe];if(pe=A?.[Oe],C.hasOwnProperty(Oe)&&ve!==pe&&(ve!=null||pe!=null))if(Oe==="style")if(pe){for(X in pe)!pe.hasOwnProperty(X)||ve&&ve.hasOwnProperty(X)||(v||(v={}),v[X]="");for(X in ve)ve.hasOwnProperty(X)&&pe[X]!==ve[X]&&(v||(v={}),v[X]=ve[X])}else v||(D||(D=[]),D.push(Oe,v)),v=ve;else Oe==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,pe=pe?pe.__html:void 0,ve!=null&&pe!==ve&&(D=D||[]).push(Oe,ve)):Oe==="children"?typeof ve!="string"&&typeof ve!="number"||(D=D||[]).push(Oe,""+ve):Oe!=="suppressContentEditableWarning"&&Oe!=="suppressHydrationWarning"&&(T.hasOwnProperty(Oe)?(ve!=null&&Oe==="onScroll"&&Yr("scroll",a),D||pe===ve||(D=[])):(D=D||[]).push(Oe,ve))}v&&(D=D||[]).push("style",v);var Oe=D;(c.updateQueue=Oe)&&(c.flags|=4)}},cd=function(a,c,v,C){v!==C&&(c.flags|=4)};function mh(a,c){if(!tn)switch(a.tailMode){case"hidden":c=a.tail;for(var v=null;c!==null;)c.alternate!==null&&(v=c),c=c.sibling;v===null?a.tail=null:v.sibling=null;break;case"collapsed":v=a.tail;for(var C=null;v!==null;)v.alternate!==null&&(C=v),v=v.sibling;C===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:C.sibling=null}}function Ri(a){var c=a.alternate!==null&&a.alternate.child===a.child,v=0,C=0;if(c)for(var A=a.child;A!==null;)v|=A.lanes|A.childLanes,C|=A.subtreeFlags&14680064,C|=A.flags&14680064,A.return=a,A=A.sibling;else for(A=a.child;A!==null;)v|=A.lanes|A.childLanes,C|=A.subtreeFlags,C|=A.flags,A.return=a,A=A.sibling;return a.subtreeFlags|=C,a.childLanes=v,c}function df(a,c,v){var C=c.pendingProps;switch(ih(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ri(c),null;case 1:return ri(c.type)&&Co(),Ri(c),null;case 3:return C=c.stateNode,u(),Nr(hi),Nr(Vn),z(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(a===null||a.child===null)&&(bu(c)?c.flags|=4:a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,qi!==null&&(xd(qi),qi=null))),fh(a,c),Ri(c),null;case 5:g(c);var A=e(m.current);if(v=c.type,a!==null&&c.stateNode!=null)pf(a,c,v,C,A),a.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!C){if(c.stateNode===null)throw Error(f(166));return Ri(c),null}if(a=e(Zi.current),bu(c)){C=c.stateNode,v=c.type;var D=c.memoizedProps;switch(C[Ui]=c,C[bo]=D,a=(c.mode&1)!==0,v){case"dialog":Yr("cancel",C),Yr("close",C);break;case"iframe":case"object":case"embed":Yr("load",C);break;case"video":case"audio":for(A=0;A<Sl.length;A++)Yr(Sl[A],C);break;case"source":Yr("error",C);break;case"img":case"image":case"link":Yr("error",C),Yr("load",C);break;case"details":Yr("toggle",C);break;case"input":ea(C,D),Yr("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!D.multiple},Yr("invalid",C);break;case"textarea":oo(C,D),Yr("invalid",C)}Ae(v,D),A=null;for(var X in D)if(D.hasOwnProperty(X)){var pe=D[X];X==="children"?typeof pe=="string"?C.textContent!==pe&&(D.suppressHydrationWarning!==!0&&Za(C.textContent,pe,a),A=["children",pe]):typeof pe=="number"&&C.textContent!==""+pe&&(D.suppressHydrationWarning!==!0&&Za(C.textContent,pe,a),A=["children",""+pe]):T.hasOwnProperty(X)&&pe!=null&&X==="onScroll"&&Yr("scroll",C)}switch(v){case"input":io(C),fa(C,D,!0);break;case"textarea":io(C),so(C);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(C.onclick=Ml)}C=A,c.updateQueue=C,C!==null&&(c.flags|=4)}else{X=A.nodeType===9?A:A.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=lo(v)),a==="http://www.w3.org/1999/xhtml"?v==="script"?(a=X.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof C.is=="string"?a=X.createElement(v,{is:C.is}):(a=X.createElement(v),v==="select"&&(X=a,C.multiple?X.multiple=!0:C.size&&(X.size=C.size))):a=X.createElementNS(a,v),a[Ui]=c,a[bo]=C,ud(a,c,!1,!1),c.stateNode=a;e:{switch(X=we(v,C),v){case"dialog":Yr("cancel",a),Yr("close",a),A=C;break;case"iframe":case"object":case"embed":Yr("load",a),A=C;break;case"video":case"audio":for(A=0;A<Sl.length;A++)Yr(Sl[A],a);A=C;break;case"source":Yr("error",a),A=C;break;case"img":case"image":case"link":Yr("error",a),Yr("load",a),A=C;break;case"details":Yr("toggle",a),A=C;break;case"input":ea(a,C),A=an(a,C),Yr("invalid",a);break;case"option":A=C;break;case"select":a._wrapperState={wasMultiple:!!C.multiple},A=bt({},C,{value:void 0}),Yr("invalid",a);break;case"textarea":oo(a,C),A=Fa(a,C),Yr("invalid",a);break;default:A=C}Ae(v,A),pe=A;for(D in pe)if(pe.hasOwnProperty(D)){var ve=pe[D];D==="style"?ye(a,ve):D==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,ve!=null&&xe(a,ve)):D==="children"?typeof ve=="string"?(v!=="textarea"||ve!=="")&&Z(a,ve):typeof ve=="number"&&Z(a,""+ve):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(T.hasOwnProperty(D)?ve!=null&&D==="onScroll"&&Yr("scroll",a):ve!=null&&nt(a,D,ve,X))}switch(v){case"input":io(a),fa(a,C,!1);break;case"textarea":io(a),so(a);break;case"option":C.value!=null&&a.setAttribute("value",""+cr(C.value));break;case"select":a.multiple=!!C.multiple,D=C.value,D!=null?Fi(a,!!C.multiple,D,!1):C.defaultValue!=null&&Fi(a,!!C.multiple,C.defaultValue,!0);break;default:typeof A.onClick=="function"&&(a.onclick=Ml)}switch(v){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Ri(c),null;case 6:if(a&&c.stateNode!=null)cd(a,c,a.memoizedProps,C);else{if(typeof C!="string"&&c.stateNode===null)throw Error(f(166));if(v=e(m.current),e(Zi.current),bu(c)){if(C=c.stateNode,v=c.memoizedProps,C[Ui]=c,(D=C.nodeValue!==v)&&(a=ni,a!==null))switch(a.tag){case 3:Za(C.nodeValue,v,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Za(C.nodeValue,v,(a.mode&1)!==0)}D&&(c.flags|=4)}else C=(v.nodeType===9?v:v.ownerDocument).createTextNode(C),C[Ui]=c,c.stateNode=C}return Ri(c),null;case 13:if(Nr(x),C=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(tn&&$i!==null&&(c.mode&1)!==0&&(c.flags&128)===0)aa(),Fr(),c.flags|=98560,D=!1;else if(D=bu(c),C!==null&&C.dehydrated!==null){if(a===null){if(!D)throw Error(f(318));if(D=c.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(f(317));D[Ui]=c}else Fr(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Ri(c),D=!1}else qi!==null&&(xd(qi),qi=null),D=!0;if(!D)return c.flags&65536?c:null}return(c.flags&128)!==0?(c.lanes=v,c):(C=C!==null,C!==(a!==null&&a.memoizedState!==null)&&C&&(c.child.flags|=8192,(c.mode&1)!==0&&(a===null||(x.current&1)!==0?ln===0&&(ln=3):Sh())),c.updateQueue!==null&&(c.flags|=4),Ri(c),null);case 4:return u(),fh(a,c),a===null&&ss(c.stateNode.containerInfo),Ri(c),null;case 10:return Wn(c.type._context),Ri(c),null;case 17:return ri(c.type)&&Co(),Ri(c),null;case 19:if(Nr(x),D=c.memoizedState,D===null)return Ri(c),null;if(C=(c.flags&128)!==0,X=D.rendering,X===null)if(C)mh(D,!1);else{if(ln!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(X=M(a),X!==null){for(c.flags|=128,mh(D,!1),C=X.updateQueue,C!==null&&(c.updateQueue=C,c.flags|=4),c.subtreeFlags=0,C=v,v=c.child;v!==null;)D=v,a=C,D.flags&=14680066,X=D.alternate,X===null?(D.childLanes=0,D.lanes=a,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=X.childLanes,D.lanes=X.lanes,D.child=X.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=X.memoizedProps,D.memoizedState=X.memoizedState,D.updateQueue=X.updateQueue,D.type=X.type,a=X.dependencies,D.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),v=v.sibling;return pr(x,x.current&1|2),c.child}a=a.sibling}D.tail!==null&&ir()>vc&&(c.flags|=128,C=!0,mh(D,!1),c.lanes=4194304)}else{if(!C)if(a=M(X),a!==null){if(c.flags|=128,C=!0,v=a.updateQueue,v!==null&&(c.updateQueue=v,c.flags|=4),mh(D,!0),D.tail===null&&D.tailMode==="hidden"&&!X.alternate&&!tn)return Ri(c),null}else 2*ir()-D.renderingStartTime>vc&&v!==1073741824&&(c.flags|=128,C=!0,mh(D,!1),c.lanes=4194304);D.isBackwards?(X.sibling=c.child,c.child=X):(v=D.last,v!==null?v.sibling=X:c.child=X,D.last=X)}return D.tail!==null?(c=D.tail,D.rendering=c,D.tail=c.sibling,D.renderingStartTime=ir(),c.sibling=null,v=x.current,pr(x,C?v&1|2:v&1),c):(Ri(c),null);case 22:case 23:return Sd(),C=c.memoizedState!==null,a!==null&&a.memoizedState!==null!==C&&(c.flags|=8192),C&&(c.mode&1)!==0?(Ea&1073741824)!==0&&(Ri(c),c.subtreeFlags&6&&(c.flags|=8192)):Ri(c),null;case 24:return null;case 25:return null}throw Error(f(156,c.tag))}function Em(a,c){switch(ih(c),c.tag){case 1:return ri(c.type)&&Co(),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return u(),Nr(hi),Nr(Vn),z(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 5:return g(c),null;case 13:if(Nr(x),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(f(340));Fr()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return Nr(x),null;case 4:return u(),null;case 10:return Wn(c.type._context),null;case 22:case 23:return Sd(),null;case 24:return null;default:return null}}var dc=!1,xi=!1,ff=typeof WeakSet=="function"?WeakSet:Set,kt=null;function fc(a,c){var v=a.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(C){Cn(a,c,C)}else v.current=null}function hd(a,c,v){try{v()}catch(C){Cn(a,c,C)}}var fp=!1;function pd(a,c){if(kl=ti,a=Yc(),bl(a)){if("selectionStart"in a)var v={start:a.selectionStart,end:a.selectionEnd};else e:{v=(v=a.ownerDocument)&&v.defaultView||window;var C=v.getSelection&&v.getSelection();if(C&&C.rangeCount!==0){v=C.anchorNode;var A=C.anchorOffset,D=C.focusNode;C=C.focusOffset;try{v.nodeType,D.nodeType}catch{v=null;break e}var X=0,pe=-1,ve=-1,Oe=0,rt=0,et=a,Ye=null;t:for(;;){for(var Tt;et!==v||A!==0&&et.nodeType!==3||(pe=X+A),et!==D||C!==0&&et.nodeType!==3||(ve=X+C),et.nodeType===3&&(X+=et.nodeValue.length),(Tt=et.firstChild)!==null;)Ye=et,et=Tt;for(;;){if(et===a)break t;if(Ye===v&&++Oe===A&&(pe=X),Ye===D&&++rt===C&&(ve=X),(Tt=et.nextSibling)!==null)break;et=Ye,Ye=et.parentNode}et=Tt}v=pe===-1||ve===-1?null:{start:pe,end:ve}}else v=null}v=v||{start:0,end:0}}else v=null;for(xo={focusedElem:a,selectionRange:v},ti=!1,kt=c;kt!==null;)if(c=kt,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,kt=a;else for(;kt!==null;){c=kt;try{var Et=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Et!==null){var Lt=Et.memoizedProps,hn=Et.memoizedState,ze=c.stateNode,Ce=ze.getSnapshotBeforeUpdate(c.elementType===c.type?Lt:Ln(c.type,Lt),hn);ze.__reactInternalSnapshotBeforeUpdate=Ce}break;case 3:var Fe=c.stateNode.containerInfo;Fe.nodeType===1?Fe.textContent="":Fe.nodeType===9&&Fe.documentElement&&Fe.removeChild(Fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(f(163))}}catch(ut){Cn(c,c.return,ut)}if(a=c.sibling,a!==null){a.return=c.return,kt=a;break}kt=c.return}return Et=fp,fp=!1,Et}function mc(a,c,v){var C=c.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var A=C=C.next;do{if((A.tag&a)===a){var D=A.destroy;A.destroy=void 0,D!==void 0&&hd(c,v,D)}A=A.next}while(A!==C)}}function fs(a,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var v=c=c.next;do{if((v.tag&a)===a){var C=v.create;v.destroy=C()}v=v.next}while(v!==c)}}function Mu(a){var c=a.ref;if(c!==null){var v=a.stateNode;switch(a.tag){case 5:a=v;break;default:a=v}typeof c=="function"?c(a):c.current=a}}function mf(a){var c=a.alternate;c!==null&&(a.alternate=null,mf(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&(delete c[Ui],delete c[bo],delete c[wo],delete c[rc],delete c[So])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function gf(a){return a.tag===5||a.tag===3||a.tag===4}function yf(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||gf(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function dd(a,c,v){var C=a.tag;if(C===5||C===6)a=a.stateNode,c?v.nodeType===8?v.parentNode.insertBefore(a,c):v.insertBefore(a,c):(v.nodeType===8?(c=v.parentNode,c.insertBefore(a,v)):(c=v,c.appendChild(a)),v=v._reactRootContainer,v!=null||c.onclick!==null||(c.onclick=Ml));else if(C!==4&&(a=a.child,a!==null))for(dd(a,c,v),a=a.sibling;a!==null;)dd(a,c,v),a=a.sibling}function fd(a,c,v){var C=a.tag;if(C===5||C===6)a=a.stateNode,c?v.insertBefore(a,c):v.appendChild(a);else if(C!==4&&(a=a.child,a!==null))for(fd(a,c,v),a=a.sibling;a!==null;)fd(a,c,v),a=a.sibling}var bi=null,Lo=!1;function ms(a,c,v){for(v=v.child;v!==null;)_f(a,c,v),v=v.sibling}function _f(a,c,v){if(Gn&&typeof Gn.onCommitFiberUnmount=="function")try{Gn.onCommitFiberUnmount(ma,v)}catch{}switch(v.tag){case 5:xi||fc(v,c);case 6:var C=bi,A=Lo;bi=null,ms(a,c,v),bi=C,Lo=A,bi!==null&&(Lo?(a=bi,v=v.stateNode,a.nodeType===8?a.parentNode.removeChild(v):a.removeChild(v)):bi.removeChild(v.stateNode));break;case 18:bi!==null&&(Lo?(a=bi,v=v.stateNode,a.nodeType===8?_u(a.parentNode,v):a.nodeType===1&&_u(a,v),ji(a)):_u(bi,v.stateNode));break;case 4:C=bi,A=Lo,bi=v.stateNode.containerInfo,Lo=!0,ms(a,c,v),bi=C,Lo=A;break;case 0:case 11:case 14:case 15:if(!xi&&(C=v.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){A=C=C.next;do{var D=A,X=D.destroy;D=D.tag,X!==void 0&&((D&2)!==0||(D&4)!==0)&&hd(v,c,X),A=A.next}while(A!==C)}ms(a,c,v);break;case 1:if(!xi&&(fc(v,c),C=v.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=v.memoizedProps,C.state=v.memoizedState,C.componentWillUnmount()}catch(pe){Cn(v,c,pe)}ms(a,c,v);break;case 21:ms(a,c,v);break;case 22:v.mode&1?(xi=(C=xi)||v.memoizedState!==null,ms(a,c,v),xi=C):ms(a,c,v);break;default:ms(a,c,v)}}function md(a){var c=a.updateQueue;if(c!==null){a.updateQueue=null;var v=a.stateNode;v===null&&(v=a.stateNode=new ff),c.forEach(function(C){var A=Ph.bind(null,a,C);v.has(C)||(v.add(C),C.then(A,A))})}}function Xi(a,c){var v=c.deletions;if(v!==null)for(var C=0;C<v.length;C++){var A=v[C];try{var D=a,X=c,pe=X;e:for(;pe!==null;){switch(pe.tag){case 5:bi=pe.stateNode,Lo=!1;break e;case 3:bi=pe.stateNode.containerInfo,Lo=!0;break e;case 4:bi=pe.stateNode.containerInfo,Lo=!0;break e}pe=pe.return}if(bi===null)throw Error(f(160));_f(D,X,A),bi=null,Lo=!1;var ve=A.alternate;ve!==null&&(ve.return=null),A.return=null}catch(Oe){Cn(A,c,Oe)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)vf(c,a),c=c.sibling}function vf(a,c){var v=a.alternate,C=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Xi(c,a),jr(a),C&4){try{mc(3,a,a.return),fs(3,a)}catch(Lt){Cn(a,a.return,Lt)}try{mc(5,a,a.return)}catch(Lt){Cn(a,a.return,Lt)}}break;case 1:Xi(c,a),jr(a),C&512&&v!==null&&fc(v,v.return);break;case 5:if(Xi(c,a),jr(a),C&512&&v!==null&&fc(v,v.return),a.flags&32){var A=a.stateNode;try{Z(A,"")}catch(Lt){Cn(a,a.return,Lt)}}if(C&4&&(A=a.stateNode,A!=null)){var D=a.memoizedProps,X=v!==null?v.memoizedProps:D,pe=a.type,ve=a.updateQueue;if(a.updateQueue=null,ve!==null)try{pe==="input"&&D.type==="radio"&&D.name!=null&&da(A,D),we(pe,X);var Oe=we(pe,D);for(X=0;X<ve.length;X+=2){var rt=ve[X],et=ve[X+1];rt==="style"?ye(A,et):rt==="dangerouslySetInnerHTML"?xe(A,et):rt==="children"?Z(A,et):nt(A,rt,et,Oe)}switch(pe){case"input":ao(A,D);break;case"textarea":Zo(A,D);break;case"select":var Ye=A._wrapperState.wasMultiple;A._wrapperState.wasMultiple=!!D.multiple;var Tt=D.value;Tt!=null?Fi(A,!!D.multiple,Tt,!1):Ye!==!!D.multiple&&(D.defaultValue!=null?Fi(A,!!D.multiple,D.defaultValue,!0):Fi(A,!!D.multiple,D.multiple?[]:"",!1))}A[bo]=D}catch(Lt){Cn(a,a.return,Lt)}}break;case 6:if(Xi(c,a),jr(a),C&4){if(a.stateNode===null)throw Error(f(162));A=a.stateNode,D=a.memoizedProps;try{A.nodeValue=D}catch(Lt){Cn(a,a.return,Lt)}}break;case 3:if(Xi(c,a),jr(a),C&4&&v!==null&&v.memoizedState.isDehydrated)try{ji(c.containerInfo)}catch(Lt){Cn(a,a.return,Lt)}break;case 4:Xi(c,a),jr(a);break;case 13:Xi(c,a),jr(a),A=a.child,A.flags&8192&&(D=A.memoizedState!==null,A.stateNode.isHidden=D,!D||A.alternate!==null&&A.alternate.memoizedState!==null||(yd=ir())),C&4&&md(a);break;case 22:if(rt=v!==null&&v.memoizedState!==null,a.mode&1?(xi=(Oe=xi)||rt,Xi(c,a),xi=Oe):Xi(c,a),jr(a),C&8192){if(Oe=a.memoizedState!==null,(a.stateNode.isHidden=Oe)&&!rt&&(a.mode&1)!==0)for(kt=a,rt=a.child;rt!==null;){for(et=kt=rt;kt!==null;){switch(Ye=kt,Tt=Ye.child,Ye.tag){case 0:case 11:case 14:case 15:mc(4,Ye,Ye.return);break;case 1:fc(Ye,Ye.return);var Et=Ye.stateNode;if(typeof Et.componentWillUnmount=="function"){C=Ye,v=Ye.return;try{c=C,Et.props=c.memoizedProps,Et.state=c.memoizedState,Et.componentWillUnmount()}catch(Lt){Cn(C,v,Lt)}}break;case 5:fc(Ye,Ye.return);break;case 22:if(Ye.memoizedState!==null){yh(et);continue}}Tt!==null?(Tt.return=Ye,kt=Tt):yh(et)}rt=rt.sibling}e:for(rt=null,et=a;;){if(et.tag===5){if(rt===null){rt=et;try{A=et.stateNode,Oe?(D=A.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(pe=et.stateNode,ve=et.memoizedProps.style,X=ve!=null&&ve.hasOwnProperty("display")?ve.display:null,pe.style.display=ue("display",X))}catch(Lt){Cn(a,a.return,Lt)}}}else if(et.tag===6){if(rt===null)try{et.stateNode.nodeValue=Oe?"":et.memoizedProps}catch(Lt){Cn(a,a.return,Lt)}}else if((et.tag!==22&&et.tag!==23||et.memoizedState===null||et===a)&&et.child!==null){et.child.return=et,et=et.child;continue}if(et===a)break e;for(;et.sibling===null;){if(et.return===null||et.return===a)break e;rt===et&&(rt=null),et=et.return}rt===et&&(rt=null),et.sibling.return=et.return,et=et.sibling}}break;case 19:Xi(c,a),jr(a),C&4&&md(a);break;case 21:break;default:Xi(c,a),jr(a)}}function jr(a){var c=a.flags;if(c&2){try{e:{for(var v=a.return;v!==null;){if(gf(v)){var C=v;break e}v=v.return}throw Error(f(160))}switch(C.tag){case 5:var A=C.stateNode;C.flags&32&&(Z(A,""),C.flags&=-33);var D=yf(a);fd(a,D,A);break;case 3:case 4:var X=C.stateNode.containerInfo,pe=yf(a);dd(a,pe,X);break;default:throw Error(f(161))}}catch(ve){Cn(a,a.return,ve)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function gc(a,c,v){kt=a,gd(a)}function gd(a,c,v){for(var C=(a.mode&1)!==0;kt!==null;){var A=kt,D=A.child;if(A.tag===22&&C){var X=A.memoizedState!==null||dc;if(!X){var pe=A.alternate,ve=pe!==null&&pe.memoizedState!==null||xi;pe=dc;var Oe=xi;if(dc=X,(xi=ve)&&!Oe)for(kt=A;kt!==null;)X=kt,ve=X.child,X.tag===22&&X.memoizedState!==null?yc(A):ve!==null?(ve.return=X,kt=ve):yc(A);for(;D!==null;)kt=D,gd(D),D=D.sibling;kt=A,dc=pe,xi=Oe}gh(a)}else(A.subtreeFlags&8772)!==0&&D!==null?(D.return=A,kt=D):gh(a)}}function gh(a){for(;kt!==null;){var c=kt;if((c.flags&8772)!==0){var v=c.alternate;try{if((c.flags&8772)!==0)switch(c.tag){case 0:case 11:case 15:xi||fs(5,c);break;case 1:var C=c.stateNode;if(c.flags&4&&!xi)if(v===null)C.componentDidMount();else{var A=c.elementType===c.type?v.memoizedProps:Ln(c.type,v.memoizedProps);C.componentDidUpdate(A,v.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var D=c.updateQueue;D!==null&&uc(c,D,C);break;case 3:var X=c.updateQueue;if(X!==null){if(v=null,c.child!==null)switch(c.child.tag){case 5:v=c.child.stateNode;break;case 1:v=c.child.stateNode}uc(c,X,v)}break;case 5:var pe=c.stateNode;if(v===null&&c.flags&4){v=pe;var ve=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":ve.autoFocus&&v.focus();break;case"img":ve.src&&(v.src=ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var Oe=c.alternate;if(Oe!==null){var rt=Oe.memoizedState;if(rt!==null){var et=rt.dehydrated;et!==null&&ji(et)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(f(163))}xi||c.flags&512&&Mu(c)}catch(Ye){Cn(c,c.return,Ye)}}if(c===a){kt=null;break}if(v=c.sibling,v!==null){v.return=c.return,kt=v;break}kt=c.return}}function yh(a){for(;kt!==null;){var c=kt;if(c===a){kt=null;break}var v=c.sibling;if(v!==null){v.return=c.return,kt=v;break}kt=c.return}}function yc(a){for(;kt!==null;){var c=kt;try{switch(c.tag){case 0:case 11:case 15:var v=c.return;try{fs(4,c)}catch(ve){Cn(c,v,ve)}break;case 1:var C=c.stateNode;if(typeof C.componentDidMount=="function"){var A=c.return;try{C.componentDidMount()}catch(ve){Cn(c,A,ve)}}var D=c.return;try{Mu(c)}catch(ve){Cn(c,D,ve)}break;case 5:var X=c.return;try{Mu(c)}catch(ve){Cn(c,X,ve)}}}catch(ve){Cn(c,c.return,ve)}if(c===a){kt=null;break}var pe=c.sibling;if(pe!==null){pe.return=c.return,kt=pe;break}kt=c.return}}var xf=Math.ceil,_h=Le.ReactCurrentDispatcher,ku=Le.ReactCurrentOwner,ca=Le.ReactCurrentBatchConfig,vr=0,Rn=null,sn=null,Dn=0,Ea=0,Eu=Un(0),ln=0,vh=null,Fl=0,Bl=0,xh=0,_c=null,Ki=null,yd=0,vc=1/0,Vs=null,mp=!1,_d=null,Ia=null,gp=!1,jl=null,bh=0,wh=0,yp=null,_p=-1,xc=0;function Kn(){return(vr&6)!==0?ir():_p!==-1?_p:_p=ir()}function gs(a){return(a.mode&1)===0?1:(vr&2)!==0&&Dn!==0?Dn&-Dn:sh.transition!==null?(xc===0&&(xc=Ss()),xc):(a=Pr,a!==0||(a=window.event,a=a===void 0?16:hl(a.type)),a)}function Ro(a,c,v,C){if(50<wh)throw wh=0,yp=null,Error(f(185));Ts(a,v,C),((vr&2)===0||a!==Rn)&&(a===Rn&&((vr&2)===0&&(Bl|=v),ln===4&&to(a,Dn)),ha(a,C),v===1&&vr===0&&(c.mode&1)===0&&(vc=ir()+500,Po&&us()))}function ha(a,c){var v=a.callbackNode;Ac(a,c);var C=sl(a,a===Rn?Dn:0);if(C===0)v!==null&&Wl(v),a.callbackNode=null,a.callbackPriority=0;else if(c=C&-C,a.callbackPriority!==c){if(v!=null&&Wl(v),c===1)a.tag===0?ed(bd.bind(null,a)):Il(bd.bind(null,a)),th(function(){(vr&6)===0&&us()}),v=null;else{switch(na(C)){case 1:v=ei;break;case 4:v=Vr;break;case 16:v=Xl;break;case 536870912:v=Uu;break;default:v=Xl}v=xp(v,vd.bind(null,a))}a.callbackPriority=c,a.callbackNode=v}}function vd(a,c){if(_p=-1,xc=0,(vr&6)!==0)throw Error(f(327));var v=a.callbackNode;if(bc()&&a.callbackNode!==v)return null;var C=sl(a,a===Rn?Dn:0);if(C===0)return null;if((C&30)!==0||(C&a.expiredLanes)!==0||c)c=Th(a,C);else{c=C;var A=vr;vr|=2;var D=Td();(Rn!==a||Dn!==c)&&(Vs=null,vc=ir()+500,Au(a,c));do try{Sf();break}catch(pe){bf(a,pe)}while(!0);Rl(),_h.current=D,vr=A,sn!==null?c=0:(Rn=null,Dn=0,c=ln)}if(c!==0){if(c===2&&(A=Jl(a),A!==0&&(C=A,c=vp(a,A))),c===1)throw v=vh,Au(a,0),to(a,C),ha(a,ir()),v;if(c===6)to(a,C);else{if(A=a.current.alternate,(C&30)===0&&!Im(A)&&(c=Th(a,C),c===2&&(D=Jl(a),D!==0&&(C=D,c=vp(a,D))),c===1))throw v=vh,Au(a,0),to(a,C),ha(a,ir()),v;switch(a.finishedWork=A,a.finishedLanes=C,c){case 0:case 1:throw Error(f(345));case 2:zu(a,Ki,Vs);break;case 3:if(to(a,C),(C&130023424)===C&&(c=yd+500-ir(),10<c)){if(sl(a,0)!==0)break;if(A=a.suspendedLanes,(A&C)!==C){Kn(),a.pingedLanes|=a.suspendedLanes&A;break}a.timeoutHandle=tc(zu.bind(null,a,Ki,Vs),c);break}zu(a,Ki,Vs);break;case 4:if(to(a,C),(C&4194240)===C)break;for(c=a.eventTimes,A=-1;0<C;){var X=31-ra(C);D=1<<X,X=c[X],X>A&&(A=X),C&=~D}if(C=A,C=ir()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*xf(C/1960))-C,10<C){a.timeoutHandle=tc(zu.bind(null,a,Ki,Vs),C);break}zu(a,Ki,Vs);break;case 5:zu(a,Ki,Vs);break;default:throw Error(f(329))}}}return ha(a,ir()),a.callbackNode===v?vd.bind(null,a):null}function vp(a,c){var v=_c;return a.current.memoizedState.isDehydrated&&(Au(a,c).flags|=256),a=Th(a,c),a!==2&&(c=Ki,Ki=v,c!==null&&xd(c)),a}function xd(a){Ki===null?Ki=a:Ki.push.apply(Ki,a)}function Im(a){for(var c=a;;){if(c.flags&16384){var v=c.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var C=0;C<v.length;C++){var A=v[C],D=A.getSnapshot;A=A.value;try{if(!wa(D(),A))return!1}catch{return!1}}}if(v=c.child,c.subtreeFlags&16384&&v!==null)v.return=c,c=v;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function to(a,c){for(c&=~xh,c&=~Bl,a.suspendedLanes|=c,a.pingedLanes&=~c,a=a.expirationTimes;0<c;){var v=31-ra(c),C=1<<v;a[v]=-1,c&=~C}}function bd(a){if((vr&6)!==0)throw Error(f(327));bc();var c=sl(a,0);if((c&1)===0)return ha(a,ir()),null;var v=Th(a,c);if(a.tag!==0&&v===2){var C=Jl(a);C!==0&&(c=C,v=vp(a,C))}if(v===1)throw v=vh,Au(a,0),to(a,c),ha(a,ir()),v;if(v===6)throw Error(f(345));return a.finishedWork=a.current.alternate,a.finishedLanes=c,zu(a,Ki,Vs),ha(a,ir()),null}function wd(a,c){var v=vr;vr|=1;try{return a(c)}finally{vr=v,vr===0&&(vc=ir()+500,Po&&us())}}function Iu(a){jl!==null&&jl.tag===0&&(vr&6)===0&&bc();var c=vr;vr|=1;var v=ca.transition,C=Pr;try{if(ca.transition=null,Pr=1,a)return a()}finally{Pr=C,ca.transition=v,vr=c,(vr&6)===0&&us()}}function Sd(){Ea=Eu.current,Nr(Eu)}function Au(a,c){a.finishedWork=null,a.finishedLanes=0;var v=a.timeoutHandle;if(v!==-1&&(a.timeoutHandle=-1,up(v)),sn!==null)for(v=sn.return;v!==null;){var C=v;switch(ih(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&Co();break;case 3:u(),Nr(hi),Nr(Vn),z();break;case 5:g(C);break;case 4:u();break;case 13:Nr(x);break;case 19:Nr(x);break;case 10:Wn(C.type._context);break;case 22:case 23:Sd()}v=v.return}if(Rn=a,sn=a=$s(a.current,null),Dn=Ea=c,ln=0,vh=null,xh=Bl=Fl=0,Ki=_c=null,Ca!==null){for(c=0;c<Ca.length;c++)if(v=Ca[c],C=v.interleaved,C!==null){v.interleaved=null;var A=C.next,D=v.pending;if(D!==null){var X=D.next;D.next=A,C.next=X}v.pending=C}Ca=null}return a}function bf(a,c){do{var v=sn;try{if(Rl(),R.current=_i,te){for(var C=O.memoizedState;C!==null;){var A=C.queue;A!==null&&(A.pending=null),C=C.next}te=!1}if(B=0,J=G=O=null,re=!1,ne=0,ku.current=null,v===null||v.return===null){ln=1,vh=c,sn=null;break}e:{var D=a,X=v.return,pe=v,ve=c;if(c=Dn,pe.flags|=32768,ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var Oe=ve,rt=pe,et=rt.tag;if((rt.mode&1)===0&&(et===0||et===11||et===15)){var Ye=rt.alternate;Ye?(rt.updateQueue=Ye.updateQueue,rt.memoizedState=Ye.memoizedState,rt.lanes=Ye.lanes):(rt.updateQueue=null,rt.memoizedState=null)}var Tt=rd(X);if(Tt!==null){Tt.flags&=-257,of(Tt,X,pe,D,c),Tt.mode&1&&cp(D,Oe,c),c=Tt,ve=Oe;var Et=c.updateQueue;if(Et===null){var Lt=new Set;Lt.add(ve),c.updateQueue=Lt}else Et.add(ve);break e}else{if((c&1)===0){cp(D,Oe,c),Sh();break e}ve=Error(f(426))}}else if(tn&&pe.mode&1){var hn=rd(X);if(hn!==null){(hn.flags&65536)===0&&(hn.flags|=256),of(hn,X,pe,D,c),cs(Ao(ve,pe));break e}}D=ve=Ao(ve,pe),ln!==4&&(ln=2),_c===null?_c=[D]:_c.push(D),D=X;do{switch(D.tag){case 3:D.flags|=65536,c&=-c,D.lanes|=c;var ze=td(D,ve,c);Su(D,ze);break e;case 1:pe=ve;var Ce=D.type,Fe=D.stateNode;if((D.flags&128)===0&&(typeof Ce.getDerivedStateFromError=="function"||Fe!==null&&typeof Fe.componentDidCatch=="function"&&(Ia===null||!Ia.has(Fe)))){D.flags|=65536,c&=-c,D.lanes|=c;var ut=af(D,pe,c);Su(D,ut);break e}}D=D.return}while(D!==null)}Ch(v)}catch(It){c=It,sn===v&&v!==null&&(sn=v=v.return);continue}break}while(!0)}function Td(){var a=_h.current;return _h.current=_i,a===null?_i:a}function Sh(){(ln===0||ln===3||ln===2)&&(ln=4),Rn===null||(Fl&268435455)===0&&(Bl&268435455)===0||to(Rn,Dn)}function Th(a,c){var v=vr;vr|=2;var C=Td();(Rn!==a||Dn!==c)&&(Vs=null,Au(a,c));do try{wf();break}catch(A){bf(a,A)}while(!0);if(Rl(),vr=v,_h.current=C,sn!==null)throw Error(f(261));return Rn=null,Dn=0,ln}function wf(){for(;sn!==null;)Tf(sn)}function Sf(){for(;sn!==null&&!Oa();)Tf(sn)}function Tf(a){var c=Nn(a.alternate,a,Ea);a.memoizedProps=a.pendingProps,c===null?Ch(a):sn=c,ku.current=null}function Ch(a){var c=a;do{var v=c.alternate;if(a=c.return,(c.flags&32768)===0){if(v=df(v,c,Ea),v!==null){sn=v;return}}else{if(v=Em(v,c),v!==null){v.flags&=32767,sn=v;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{ln=6,sn=null;return}}if(c=c.sibling,c!==null){sn=c;return}sn=c=a}while(c!==null);ln===0&&(ln=5)}function zu(a,c,v){var C=Pr,A=ca.transition;try{ca.transition=null,Pr=1,Cf(a,c,v,C)}finally{ca.transition=A,Pr=C}return null}function Cf(a,c,v,C){do bc();while(jl!==null);if((vr&6)!==0)throw Error(f(327));v=a.finishedWork;var A=a.finishedLanes;if(v===null)return null;if(a.finishedWork=null,a.finishedLanes=0,v===a.current)throw Error(f(177));a.callbackNode=null,a.callbackPriority=0;var D=v.lanes|v.childLanes;if(qp(a,D),a===Rn&&(sn=Rn=null,Dn=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||gp||(gp=!0,xp(Xl,function(){return bc(),null})),D=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||D){D=ca.transition,ca.transition=null;var X=Pr;Pr=1;var pe=vr;vr|=4,ku.current=null,pd(a,v),vf(v,a),Yu(xo),ti=!!kl,xo=kl=null,a.current=v,gc(v),al(),vr=pe,Pr=X,ca.transition=D}else a.current=v;if(gp&&(gp=!1,jl=a,bh=A),D=a.pendingLanes,D===0&&(Ia=null),Ic(v.stateNode),ha(a,ir()),c!==null)for(C=a.onRecoverableError,v=0;v<c.length;v++)A=c[v],C(A.value,{componentStack:A.stack,digest:A.digest});if(mp)throw mp=!1,a=_d,_d=null,a;return(bh&1)!==0&&a.tag!==0&&bc(),D=a.pendingLanes,(D&1)!==0?a===yp?wh++:(wh=0,yp=a):wh=0,us(),null}function bc(){if(jl!==null){var a=na(bh),c=ca.transition,v=Pr;try{if(ca.transition=null,Pr=16>a?16:a,jl===null)var C=!1;else{if(a=jl,jl=null,bh=0,(vr&6)!==0)throw Error(f(331));var A=vr;for(vr|=4,kt=a.current;kt!==null;){var D=kt,X=D.child;if((kt.flags&16)!==0){var pe=D.deletions;if(pe!==null){for(var ve=0;ve<pe.length;ve++){var Oe=pe[ve];for(kt=Oe;kt!==null;){var rt=kt;switch(rt.tag){case 0:case 11:case 15:mc(8,rt,D)}var et=rt.child;if(et!==null)et.return=rt,kt=et;else for(;kt!==null;){rt=kt;var Ye=rt.sibling,Tt=rt.return;if(mf(rt),rt===Oe){kt=null;break}if(Ye!==null){Ye.return=Tt,kt=Ye;break}kt=Tt}}}var Et=D.alternate;if(Et!==null){var Lt=Et.child;if(Lt!==null){Et.child=null;do{var hn=Lt.sibling;Lt.sibling=null,Lt=hn}while(Lt!==null)}}kt=D}}if((D.subtreeFlags&2064)!==0&&X!==null)X.return=D,kt=X;else e:for(;kt!==null;){if(D=kt,(D.flags&2048)!==0)switch(D.tag){case 0:case 11:case 15:mc(9,D,D.return)}var ze=D.sibling;if(ze!==null){ze.return=D.return,kt=ze;break e}kt=D.return}}var Ce=a.current;for(kt=Ce;kt!==null;){X=kt;var Fe=X.child;if((X.subtreeFlags&2064)!==0&&Fe!==null)Fe.return=X,kt=Fe;else e:for(X=Ce;kt!==null;){if(pe=kt,(pe.flags&2048)!==0)try{switch(pe.tag){case 0:case 11:case 15:fs(9,pe)}}catch(It){Cn(pe,pe.return,It)}if(pe===X){kt=null;break e}var ut=pe.sibling;if(ut!==null){ut.return=pe.return,kt=ut;break e}kt=pe.return}}if(vr=A,us(),Gn&&typeof Gn.onPostCommitFiberRoot=="function")try{Gn.onPostCommitFiberRoot(ma,a)}catch{}C=!0}return C}finally{Pr=v,ca.transition=c}}return!1}function Pf(a,c,v){c=Ao(v,c),c=td(a,c,1),a=zi(a,c,1),c=Kn(),a!==null&&(Ts(a,1,c),ha(a,c))}function Cn(a,c,v){if(a.tag===3)Pf(a,a,v);else for(;c!==null;){if(c.tag===3){Pf(c,a,v);break}else if(c.tag===1){var C=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Ia===null||!Ia.has(C))){a=Ao(v,a),a=af(c,a,1),c=zi(c,a,1),a=Kn(),c!==null&&(Ts(c,1,a),ha(c,a));break}}c=c.return}}function Mf(a,c,v){var C=a.pingCache;C!==null&&C.delete(c),c=Kn(),a.pingedLanes|=a.suspendedLanes&v,Rn===a&&(Dn&v)===v&&(ln===4||ln===3&&(Dn&130023424)===Dn&&500>ir()-yd?Au(a,0):xh|=v),ha(a,c)}function kf(a,c){c===0&&((a.mode&1)===0?c=1:(c=$u,$u<<=1,($u&130023424)===0&&($u=4194304)));var v=Kn();a=sa(a,c),a!==null&&(Ts(a,c,v),ha(a,v))}function Am(a){var c=a.memoizedState,v=0;c!==null&&(v=c.retryLane),kf(a,v)}function Ph(a,c){var v=0;switch(a.tag){case 13:var C=a.stateNode,A=a.memoizedState;A!==null&&(v=A.retryLane);break;case 19:C=a.stateNode;break;default:throw Error(f(314))}C!==null&&C.delete(c),kf(a,v)}var Nn;Nn=function(a,c,v){if(a!==null)if(a.memoizedProps!==c.pendingProps||hi.current)ua=!0;else{if((a.lanes&v)===0&&(c.flags&128)===0)return ua=!1,Wi(a,c,v);ua=(a.flags&131072)!==0}else ua=!1,tn&&(c.flags&1048576)!==0&&hr(c,mt,c.index);switch(c.lanes=0,c.tag){case 2:var C=c.type;pc(a,c),a=c.pendingProps;var A=Ta(c,Vn.current);Xn(c,v),A=me(null,c,C,a,A,v);var D=se();return c.flags|=1,typeof A=="object"&&A!==null&&typeof A.render=="function"&&A.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,ri(C)?(D=!0,Mi(c)):D=!1,c.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,hs(c),A.updater=Ma,c.stateNode=A,A._reactInternals=c,Cu(c,C,a,v),c=hc(null,c,C,!0,D,v)):(c.tag=0,tn&&D&&Al(c),vi(null,c,A,v),c=c.child),c;case 16:C=c.elementType;e:{switch(pc(a,c),a=c.pendingProps,A=C._init,C=A(C._payload),c.type=C,A=c.tag=wc(C),a=Ln(C,a),A){case 0:c=ad(null,c,C,a,v);break e;case 1:c=cc(null,c,C,a,v);break e;case 11:c=lf(null,c,C,a,v);break e;case 14:c=hp(null,c,C,Ln(C.type,a),v);break e}throw Error(f(306,C,""))}return c;case 0:return C=c.type,A=c.pendingProps,A=c.elementType===C?A:Ln(C,A),ad(a,c,C,A,v);case 1:return C=c.type,A=c.pendingProps,A=c.elementType===C?A:Ln(C,A),cc(a,c,C,A,v);case 3:e:{if(hh(c),a===null)throw Error(f(387));C=c.pendingProps,D=c.memoizedState,A=D.element,lc(a,c),Ja(c,C,null,v);var X=c.memoizedState;if(C=X.element,D.isDehydrated)if(D={element:C,isDehydrated:!1,cache:X.cache,pendingSuspenseBoundaries:X.pendingSuspenseBoundaries,transitions:X.transitions},c.updateQueue.baseState=D,c.memoizedState=D,c.flags&256){A=Ao(Error(f(423)),c),c=od(a,c,C,v,A);break e}else if(C!==A){A=Ao(Error(f(424)),c),c=od(a,c,C,v,A);break e}else for($i=Dr(c.stateNode.containerInfo.firstChild),ni=c,tn=!0,qi=null,v=wu(c,null,C,v),c.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Fr(),C===A){c=ka(a,c,v);break e}vi(a,c,C,v)}c=c.child}return c;case 5:return p(c),a===null&&xu(c),C=c.type,A=c.pendingProps,D=a!==null?a.memoizedProps:null,X=A.children,gu(C,A)?X=null:D!==null&&gu(C,D)&&(c.flags|=32),Pu(a,c),vi(a,c,X,v),c.child;case 6:return a===null&&xu(c),null;case 13:return uf(a,c,v);case 4:return i(c,c.stateNode.containerInfo),C=c.pendingProps,a===null?c.child=mi(c,null,C,v):vi(a,c,C,v),c.child;case 11:return C=c.type,A=c.pendingProps,A=c.elementType===C?A:Ln(C,A),lf(a,c,C,A,v);case 7:return vi(a,c,c.pendingProps,v),c.child;case 8:return vi(a,c,c.pendingProps.children,v),c.child;case 12:return vi(a,c,c.pendingProps.children,v),c.child;case 10:e:{if(C=c.type._context,A=c.pendingProps,D=c.memoizedProps,X=A.value,pr(wt,C._currentValue),C._currentValue=X,D!==null)if(wa(D.value,X)){if(D.children===A.children&&!hi.current){c=ka(a,c,v);break e}}else for(D=c.child,D!==null&&(D.return=c);D!==null;){var pe=D.dependencies;if(pe!==null){X=D.child;for(var ve=pe.firstContext;ve!==null;){if(ve.context===C){if(D.tag===1){ve=Ai(-1,v&-v),ve.tag=2;var Oe=D.updateQueue;if(Oe!==null){Oe=Oe.shared;var rt=Oe.pending;rt===null?ve.next=ve:(ve.next=rt.next,rt.next=ve),Oe.pending=ve}}D.lanes|=v,ve=D.alternate,ve!==null&&(ve.lanes|=v),sc(D.return,v,c),pe.lanes|=v;break}ve=ve.next}}else if(D.tag===10)X=D.type===c.type?null:D.child;else if(D.tag===18){if(X=D.return,X===null)throw Error(f(341));X.lanes|=v,pe=X.alternate,pe!==null&&(pe.lanes|=v),sc(X,v,c),X=D.sibling}else X=D.child;if(X!==null)X.return=D;else for(X=D;X!==null;){if(X===c){X=null;break}if(D=X.sibling,D!==null){D.return=X.return,X=D;break}X=X.return}D=X}vi(a,c,A.children,v),c=c.child}return c;case 9:return A=c.type,C=c.pendingProps.children,Xn(c,v),A=oa(A),C=C(A),c.flags|=1,vi(a,c,C,v),c.child;case 14:return C=c.type,A=Ln(C,c.pendingProps),A=Ln(C.type,A),hp(a,c,C,A,v);case 15:return nd(a,c,c.type,c.pendingProps,v);case 17:return C=c.type,A=c.pendingProps,A=c.elementType===C?A:Ln(C,A),pc(a,c),c.tag=1,ri(C)?(a=!0,Mi(c)):a=!1,Xn(c,v),Li(c,C,A),Cu(c,C,A,v),hc(null,c,C,!0,a,v);case 19:return ld(a,c,v);case 22:return id(a,c,v)}throw Error(f(156,c.tag))};function xp(a,c){return co(a,c)}function Ef(a,c,v,C){this.tag=a,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Aa(a,c,v,C){return new Ef(a,c,v,C)}function Mh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function wc(a){if(typeof a=="function")return Mh(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Cr)return 11;if(a===xn)return 14}return 2}function $s(a,c){var v=a.alternate;return v===null?(v=Aa(a.tag,c,a.key,a.mode),v.elementType=a.elementType,v.type=a.type,v.stateNode=a.stateNode,v.alternate=a,a.alternate=v):(v.pendingProps=c,v.type=a.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=a.flags&14680064,v.childLanes=a.childLanes,v.lanes=a.lanes,v.child=a.child,v.memoizedProps=a.memoizedProps,v.memoizedState=a.memoizedState,v.updateQueue=a.updateQueue,c=a.dependencies,v.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},v.sibling=a.sibling,v.index=a.index,v.ref=a.ref,v}function bp(a,c,v,C,A,D){var X=2;if(C=a,typeof a=="function")Mh(a)&&(X=1);else if(typeof a=="string")X=5;else e:switch(a){case pt:return Lu(v.children,A,D,c);case lt:X=8,A|=8;break;case Ft:return a=Aa(12,v,c,A|2),a.elementType=Ft,a.lanes=D,a;case yr:return a=Aa(13,v,c,A),a.elementType=yr,a.lanes=D,a;case fr:return a=Aa(19,v,c,A),a.elementType=fr,a.lanes=D,a;case Rr:return wp(v,A,D,c);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Pt:X=10;break e;case Ur:X=9;break e;case Cr:X=11;break e;case xn:X=14;break e;case qr:X=16,C=null;break e}throw Error(f(130,a==null?a:typeof a,""))}return c=Aa(X,v,c,A),c.elementType=a,c.type=C,c.lanes=D,c}function Lu(a,c,v,C){return a=Aa(7,a,C,c),a.lanes=v,a}function wp(a,c,v,C){return a=Aa(22,a,C,c),a.elementType=Rr,a.lanes=v,a.stateNode={isHidden:!1},a}function Cd(a,c,v){return a=Aa(6,a,null,c),a.lanes=v,a}function Pd(a,c,v){return c=Aa(4,a.children!==null?a.children:[],a.key,c),c.lanes=v,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}function zm(a,c,v,C,A){this.tag=c,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ql(0),this.expirationTimes=Ql(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ql(0),this.identifierPrefix=C,this.onRecoverableError=A,this.mutableSourceEagerHydrationData=null}function Md(a,c,v,C,A,D,X,pe,ve){return a=new zm(a,c,v,pe,ve),c===1?(c=1,D===!0&&(c|=8)):c=0,D=Aa(3,null,null,c),a.current=D,D.stateNode=a,D.memoizedState={element:C,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},hs(D),a}function Lm(a,c,v){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ue,key:C==null?null:""+C,children:a,containerInfo:c,implementation:v}}function If(a){if(!a)return Vi;a=a._reactInternals;e:{if(Gt(a)!==a||a.tag!==1)throw Error(f(170));var c=a;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(ri(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(f(171))}if(a.tag===1){var v=a.type;if(ri(v))return pi(a,v,c)}return c}function Af(a,c,v,C,A,D,X,pe,ve){return a=Md(v,C,!0,a,A,D,X,pe,ve),a.context=If(null),v=a.current,C=Kn(),A=gs(v),D=Ai(C,A),D.callback=c??null,zi(v,D,A),a.current.lanes=A,Ts(a,A,C),ha(a,C),a}function Sp(a,c,v,C){var A=c.current,D=Kn(),X=gs(A);return v=If(v),c.context===null?c.context=v:c.pendingContext=v,c=Ai(D,X),c.payload={element:a},C=C===void 0?null:C,C!==null&&(c.callback=C),a=zi(A,c,X),a!==null&&(Ro(a,A,X,D),ps(a,A,X)),X}function Tp(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function kd(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var v=a.retryLane;a.retryLane=v!==0&&v<c?v:c}}function kh(a,c){kd(a,c),(a=a.alternate)&&kd(a,c)}function zf(){return null}var qs=typeof reportError=="function"?reportError:function(a){console.error(a)};function Ru(a){this._internalRoot=a}Gs.prototype.render=Ru.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(f(409));Sp(a,c,null,null)},Gs.prototype.unmount=Ru.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;Iu(function(){Sp(null,a,null,null)}),c[Ha]=null}};function Gs(a){this._internalRoot=a}Gs.prototype.unstable_scheduleHydration=function(a){if(a){var c=Ua();a={blockedOn:null,target:a,priority:c};for(var v=0;v<Wr.length&&c!==0&&c<Wr[v].priority;v++);Wr.splice(v,0,a),v===0&&Zn(a)}};function Sc(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Du(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Lf(){}function Rm(a,c,v,C,A){if(A){if(typeof C=="function"){var D=C;C=function(){var Oe=Tp(X);D.call(Oe)}}var X=Af(c,C,a,0,null,!1,!1,"",Lf);return a._reactRootContainer=X,a[Ha]=X.current,ss(a.nodeType===8?a.parentNode:a),Iu(),X}for(;A=a.lastChild;)a.removeChild(A);if(typeof C=="function"){var pe=C;C=function(){var Oe=Tp(ve);pe.call(Oe)}}var ve=Md(a,0,!1,null,null,!1,!1,"",Lf);return a._reactRootContainer=ve,a[Ha]=ve.current,ss(a.nodeType===8?a.parentNode:a),Iu(function(){Sp(c,ve,v,C)}),ve}function Eh(a,c,v,C,A){var D=v._reactRootContainer;if(D){var X=D;if(typeof A=="function"){var pe=A;A=function(){var ve=Tp(X);pe.call(ve)}}Sp(c,X,a,A)}else X=Rm(v,c,a,A,C);return Tp(X)}ar=function(a){switch(a.tag){case 3:var c=a.stateNode;if(c.current.memoizedState.isDehydrated){var v=Yl(c.pendingLanes);v!==0&&(Xo(c,v|1),ha(c,ir()),(vr&6)===0&&(vc=ir()+500,us()))}break;case 13:Iu(function(){var C=sa(a,1);if(C!==null){var A=Kn();Ro(C,a,1,A)}}),kh(a,1)}},ho=function(a){if(a.tag===13){var c=sa(a,134217728);if(c!==null){var v=Kn();Ro(c,a,134217728,v)}kh(a,134217728)}},po=function(a){if(a.tag===13){var c=gs(a),v=sa(a,c);if(v!==null){var C=Kn();Ro(v,a,c,C)}kh(a,c)}},Ua=function(){return Pr},Ko=function(a,c){var v=Pr;try{return Pr=a,c()}finally{Pr=v}},$e=function(a,c,v){switch(c){case"input":if(ao(a,v),c=v.name,v.type==="radio"&&c!=null){for(v=a;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<v.length;c++){var C=v[c];if(C!==a&&C.form===a.form){var A=vu(C);if(!A)throw Error(f(90));Pi(C),ao(C,A)}}}break;case"textarea":Zo(a,v);break;case"select":c=v.value,c!=null&&Fi(a,!!v.multiple,c,!1)}},Xt=wd,Gr=Iu;var Rf={usingClientEntryPoint:!1,Events:[El,Rs,vu,rr,Mt,wd]},Ih={findFiberByHostInstance:To,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Df={bundleType:Ih.bundleType,version:Ih.version,rendererPackageName:Ih.rendererPackageName,rendererConfig:Ih.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Le.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Yt(a),a===null?null:a.stateNode},findFiberByHostInstance:Ih.findFiberByHostInstance||zf,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ah=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ah.isDisabled&&Ah.supportsFiber)try{ma=Ah.inject(Df),Gn=Ah}catch{}}return ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rf,ro.createPortal=function(a,c){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Sc(c))throw Error(f(200));return Lm(a,c,null,v)},ro.createRoot=function(a,c){if(!Sc(a))throw Error(f(299));var v=!1,C="",A=qs;return c!=null&&(c.unstable_strictMode===!0&&(v=!0),c.identifierPrefix!==void 0&&(C=c.identifierPrefix),c.onRecoverableError!==void 0&&(A=c.onRecoverableError)),c=Md(a,1,!1,null,null,v,!1,C,A),a[Ha]=c.current,ss(a.nodeType===8?a.parentNode:a),new Ru(c)},ro.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(f(188)):(a=Object.keys(a).join(","),Error(f(268,a)));return a=Yt(c),a=a===null?null:a.stateNode,a},ro.flushSync=function(a){return Iu(a)},ro.hydrate=function(a,c,v){if(!Du(c))throw Error(f(200));return Eh(null,a,c,!0,v)},ro.hydrateRoot=function(a,c,v){if(!Sc(a))throw Error(f(405));var C=v!=null&&v.hydratedSources||null,A=!1,D="",X=qs;if(v!=null&&(v.unstable_strictMode===!0&&(A=!0),v.identifierPrefix!==void 0&&(D=v.identifierPrefix),v.onRecoverableError!==void 0&&(X=v.onRecoverableError)),c=Af(c,null,a,1,v??null,A,!1,D,X),a[Ha]=c.current,ss(a),C)for(a=0;a<C.length;a++)v=C[a],A=v._getVersion,A=A(v._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[v,A]:c.mutableSourceEagerHydrationData.push(v,A);return new Gs(c)},ro.render=function(a,c,v){if(!Du(c))throw Error(f(200));return Eh(null,a,c,!1,v)},ro.unmountComponentAtNode=function(a){if(!Du(a))throw Error(f(40));return a._reactRootContainer?(Iu(function(){Eh(null,null,a,!1,function(){a._reactRootContainer=null,a[Ha]=null})}),!0):!1},ro.unstable_batchedUpdates=wd,ro.unstable_renderSubtreeIntoContainer=function(a,c,v,C){if(!Du(v))throw Error(f(200));if(a==null||a._reactInternals===void 0)throw Error(f(38));return Eh(a,c,v,!1,C)},ro.version="18.3.1-next-f1338f8080-20240426",ro}var Jy;function rx(){if(Jy)return Jm.exports;Jy=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(l){console.error(l)}}return d(),Jm.exports=tx(),Jm.exports}var Qy;function nx(){if(Qy)return Vf;Qy=1;var d=rx();return Vf.createRoot=d.createRoot,Vf.hydrateRoot=d.hydrateRoot,Vf}var ix=nx(),Lr=Fg();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ax=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ox=d=>d.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,f,S)=>S?S.toUpperCase():f.toLowerCase()),e_=d=>{const l=ox(d);return l.charAt(0).toUpperCase()+l.slice(1)},s0=(...d)=>d.filter((l,f,S)=>!!l&&l.trim()!==""&&S.indexOf(l)===f).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lx=Lr.forwardRef(({color:d="currentColor",size:l=24,strokeWidth:f=2,absoluteStrokeWidth:S,className:T="",children:E,iconNode:b,...s},N)=>Lr.createElement("svg",{ref:N,...sx,width:l,height:l,stroke:d,strokeWidth:S?Number(f)*24/Number(l):f,className:s0("lucide",T),...s},[...b.map(([V,K])=>Lr.createElement(V,K)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ci=(d,l)=>{const f=Lr.forwardRef(({className:S,...T},E)=>Lr.createElement(lx,{ref:E,iconNode:l,className:s0(`lucide-${ax(e_(d))}`,`lucide-${d}`,S),...T}));return f.displayName=e_(d),f};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ux=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],cx=Ci("book",ux);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hx=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],tg=Ci("bot",hx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const px=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dx=Ci("calendar",px);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fx=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],mx=Ci("chevron-left",fx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gx=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],yx=Ci("chevron-right",gx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _x=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],vx=Ci("circle-check-big",_x);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],bx=Ci("circle-x",xx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],Sx=Ci("image-plus",wx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Cx=Ci("info",Tx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Px=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Mx=Ci("loader",Px);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ex=Ci("map-pin",kx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ix=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],rg=Ci("map",Ix);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ax=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],zx=Ci("menu",Ax);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lx=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ng=Ci("message-square",Lx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rx=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Dx=Ci("rotate-ccw",Rx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nx=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Fx=Ci("send",Nx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bx=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],Kf=Ci("trophy",Bx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jx=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Ox=Ci("user",jx);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],l0=Ci("x",Ux);var Yf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var Vx=Yf.exports,t_;function $x(){return t_||(t_=1,(function(d,l){(function(f,S){d.exports=S()})(Vx,(function(){var f={},S={};function T(b,s,N){if(S[b]=N,b==="index"){var V="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",K={};return S.shared(K),S.index(f,K),typeof window<"u"&&f.setWorkerUrl(window.URL.createObjectURL(new Blob([V],{type:"text/javascript"}))),f}}T("shared",["exports"],(function(b){function s(n,t,r,o){return new(r||(r=Promise))((function(h,y){function _(I){try{P(o.next(I))}catch(L){y(L)}}function w(I){try{P(o.throw(I))}catch(L){y(L)}}function P(I){var L;I.done?h(I.value):(L=I.value,L instanceof r?L:new r((function(F){F(L)}))).then(_,w)}P((o=o.apply(n,t||[])).next())}))}function N(n,t){this.x=n,this.y=t}function V(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var K,oe;typeof SuppressedError=="function"&&SuppressedError,N.prototype={clone(){return new N(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){const t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const t=Math.cos(n),r=Math.sin(n),o=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=o,this},_rotateAround(n,t){const r=Math.cos(n),o=Math.sin(n),h=t.y+o*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-o*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:N},N.convert=function(n){if(n instanceof N)return n;if(Array.isArray(n))return new N(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new N(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var le=(function(){if(oe)return K;function n(t,r,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=h}return oe=1,K=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var y=this.sampleCurveX(o)-t;if(Math.abs(y)<r)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=y/_}var w=0,P=1;for(o=t,h=0;h<20&&(y=this.sampleCurveX(o),!(Math.abs(y-t)<r));h++)t>y?w=o:P=o,o=.5*(P-w)+w;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},K})(),Y=V(le);let Be,Ne;function Ze(){return Be==null&&(Be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Be}function He(){if(Ne==null&&(Ne=!1,Ze())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const h=4*o;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&r[o]!==o){Ne=!0;break}}}return Ne||!1}var Ge=1e-6,nt=typeof Float32Array<"u"?Float32Array:Array;function Le(){var n=new nt(9);return nt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Re(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ue(){var n=new nt(3);return nt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function pt(n){return Math.hypot(n[0],n[1],n[2])}function lt(n,t,r){var o=new nt(3);return o[0]=n,o[1]=t,o[2]=r,o}function Ft(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function Pt(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function Ur(n,t,r){var o=t[0],h=t[1],y=t[2],_=r[0],w=r[1],P=r[2];return n[0]=h*P-y*w,n[1]=y*_-o*P,n[2]=o*w-h*_,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Cr,yr=pt;function fr(n,t,r){var o=t[0],h=t[1],y=t[2],_=t[3];return n[0]=r[0]*o+r[4]*h+r[8]*y+r[12]*_,n[1]=r[1]*o+r[5]*h+r[9]*y+r[13]*_,n[2]=r[2]*o+r[6]*h+r[10]*y+r[14]*_,n[3]=r[3]*o+r[7]*h+r[11]*y+r[15]*_,n}function xn(){var n=new nt(4);return nt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function qr(n,t,r,o){var h=.5*Math.PI/180;t*=h,r*=h,o*=h;var y=Math.sin(t),_=Math.cos(t),w=Math.sin(r),P=Math.cos(r),I=Math.sin(o),L=Math.cos(o);return n[0]=y*P*L-_*w*I,n[1]=_*w*L+y*P*I,n[2]=_*P*I-y*w*L,n[3]=_*P*L+y*w*I,n}function Rr(){var n=new nt(2);return nt!=Float32Array&&(n[0]=0,n[1]=0),n}function yt(n,t){var r=new nt(2);return r[0]=n,r[1]=t,r}Ue(),Cr=new nt(4),nt!=Float32Array&&(Cr[0]=0,Cr[1]=0,Cr[2]=0,Cr[3]=0),Ue(),lt(1,0,0),lt(0,1,0),xn(),xn(),Le(),Rr();const _t=8192;function bt(n,t,r){return t*(_t/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function Pe(n,t){return(n%t+t)%t}function Je(n,t,r){return n*(1-r)+t*r}function Wt(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function er(n,t,r,o){const h=new Y(n,t,r,o);return y=>h.solve(y)}const mr=er(.25,.1,.25,1);function Qt(n,t,r){return Math.min(r,Math.max(t,n))}function Ir(n,t,r){const o=r-t,h=((n-t)%o+o)%o+t;return h===t?r:h}function cr(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}let wr=1;function Bn(n,t,r){const o={};for(const h in n)o[h]=t.call(this,n[h],h,n);return o}function io(n,t,r){const o={};for(const h in n)t.call(this,n[h],h,n)&&(o[h]=n[h]);return o}function Pi(n){return Array.isArray(n)?n.map(Pi):typeof n=="object"&&n?Bn(n,Pi):n}const Qr={};function an(n){Qr[n]||(typeof console<"u"&&console.warn(n),Qr[n]=!0)}function ea(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function da(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let ao=null;function fa(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const ta="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Na(n,t,r,o,h){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(n,{timestamp:0});try{const _=y?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const w=_.startsWith("BGR"),P=new Uint8ClampedArray(o*h*4);if(yield y.copyTo(P,(function(I,L,F,U,$){const q=4*Math.max(-L,0),H=(Math.max(0,F)-F)*U*4+q,ee=4*U,ae=Math.max(0,L),Se=Math.max(0,F);return{rect:{x:ae,y:Se,width:Math.min(I.width,L+U)-ae,height:Math.min(I.height,F+$)-Se},layout:[{offset:H,stride:ee}]}})(n,t,r,o,h)),w)for(let I=0;I<P.length;I+=4){const L=P[I];P[I]=P[I+2],P[I+2]=L}return P}finally{y.close()}}))}let Fi,Fa;function oo(n,t,r,o){return n.addEventListener(t,r,o),{unsubscribe:()=>{n.removeEventListener(t,r,o)}}}function Zo(n){return n*Math.PI/180}function so(n){return n/Math.PI*180}const lo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ba={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},uo="AbortError";function xe(){return new Error(uo)}const Z={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function W(n){return Z.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Q="global-dispatcher";class ue extends Error{constructor(t,r,o,h){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=h}}const ye=()=>da(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,be=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=W(n.url);if(o)return o(n,t);if(da(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Q},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(ye())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,h){return s(this,void 0,void 0,(function*(){const y=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:ye(),signal:h.signal});let _,w;o.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{_=yield fetch(y)}catch(I){throw new ue(0,I.message,o.url,new Blob)}if(!_.ok){const I=yield _.blob();throw new ue(_.status,_.statusText,o.url,I)}w=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const P=yield w;if(h.signal.aborted)throw xe();return{data:P,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(n,t);if(da(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Q},t)}var r;return(function(o,h){return new Promise(((y,_)=>{var w;const P=new XMLHttpRequest;P.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(P.responseType="arraybuffer");for(const I in o.headers)P.setRequestHeader(I,o.headers[I]);o.type==="json"&&(P.responseType="text",!((w=o.headers)===null||w===void 0)&&w.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=o.credentials==="include",P.onerror=()=>{_(new Error(P.statusText))},P.onload=()=>{if(!h.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let I=P.response;if(o.type==="json")try{I=JSON.parse(P.response)}catch(L){return void _(L)}y({data:I,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const I=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});_(new ue(P.status,P.statusText,o.url,I))}},h.signal.addEventListener("abort",(()=>{P.abort(),_(xe())})),P.send(o.body)}))})(n,t)};function Ae(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function we(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Ve(n,t,r){if(r&&r[n]){const o=r[n].indexOf(t);o!==-1&&r[n].splice(o,1)}}class Ke{constructor(t,r={}){cr(this,r),this.type=t}}class $e extends Ke{constructor(t,r={}){super("error",cr({error:t},r))}}class vt{on(t,r){return this._listeners=this._listeners||{},we(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return Ve(t,r,this._listeners),Ve(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},we(t,r,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,r){typeof t=="string"&&(t=new Ke(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const w of h)w.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const w of y)Ve(o,w,this._oneTimeListeners),w.call(this,t);const _=this._eventedParent;_&&(cr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof $e&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ot=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function rr(n,t){const r={};for(const o in n)o!=="ref"&&(r[o]=n[o]);return Ot.forEach((o=>{o in t&&(r[o]=t[o])})),r}function Mt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!Mt(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!Mt(n[r],t[r]))return!1;return!0}return n===t}function Xt(n,t){n.push(t)}function Gr(n,t,r){Xt(r,{command:"addSource",args:[n,t[n]]})}function dn(n,t,r){Xt(t,{command:"removeSource",args:[n]}),r[n]=!0}function bn(n,t,r,o){dn(n,r,o),Gr(n,t,r)}function en(n,t,r){let o;for(o in n[r])if(Object.prototype.hasOwnProperty.call(n[r],o)&&o!=="data"&&!Mt(n[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!Mt(n[r][o],t[r][o]))return!1;return!0}function nr(n,t,r,o,h,y){n=n||{},t=t||{};for(const _ in n)Object.prototype.hasOwnProperty.call(n,_)&&(Mt(n[_],t[_])||r.push({command:y,args:[o,_,t[_],h]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(n,_)&&(Mt(n[_],t[_])||r.push({command:y,args:[o,_,t[_],h]}))}function lr(n){return n.id}function wn(n,t){return n[t.id]=t,n}class Qe{constructor(t,r,o,h){this.message=(t?`${t}: `:"")+o,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function Mn(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}class Kr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class ja{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,h]of r)this.bindings[o]=h}concat(t){return new ja(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const il={kind:"null"},ft={kind:"number"},ur={kind:"string"},Gt={kind:"boolean"},jn={kind:"color"},Ho={kind:"projectionDefinition"},Wo={kind:"object"},Yt={kind:"value"},Hl={kind:"collator"},co={kind:"formatted"},Wl={kind:"padding"},Oa={kind:"colorArray"},al={kind:"numberArray"},ir={kind:"resolvedImage"},Ou={kind:"variableAnchorOffsetCollection"};function ei(n,t){return{kind:"array",itemType:n,N:t}}function Vr(n){if(n.kind==="array"){const t=Vr(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const Xl=[il,ft,ur,Gt,jn,Ho,co,Wo,ei(Yt),Wl,al,Oa,ir,Ou];function Kl(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Kl(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of Xl)if(!Kl(r,t))return null}}return`Expected ${Vr(n)} but found ${Vr(t)} instead.`}function Uu(n,t){return t.some((r=>r.kind===n.kind))}function ma(n,t){return t.some((r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n))}function Gn(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Ic=.96422,ra=.82521,Qh=4/29,ol=6/29,ep=3*ol*ol,Vu=ol*ol*ol,$u=Math.PI/180,Yl=180/Math.PI;function sl(n){return(n%=360)<0&&(n+=360),n}function ll([n,t,r,o]){let h,y;const _=Jl((.2225045*(n=Ac(n))+.7168786*(t=Ac(t))+.0606169*(r=Ac(r)))/1);n===t&&t===r?h=y=_:(h=Jl((.4360747*n+.3850649*t+.1430804*r)/Ic),y=Jl((.0139322*n+.0971045*t+.7141733*r)/ra));const w=116*_-16;return[w<0?0:w,500*(h-_),200*(_-y),o]}function Ac(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Jl(n){return n>Vu?Math.pow(n,1/3):n/ep+Qh}function Ss([n,t,r,o]){let h=(n+16)/116,y=isNaN(t)?h:h+t/500,_=isNaN(r)?h:h-r/200;return h=1*Ts(h),y=Ic*Ts(y),_=ra*Ts(_),[Ql(3.1338561*y-1.6168667*h-.4906146*_),Ql(-.9787684*y+1.9161415*h+.033454*_),Ql(.0719453*y-.2289914*h+1.4052427*_),o]}function Ql(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Ts(n){return n>ol?n*n*n:ep*(n-Qh)}const qp=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function Xo(n,t){return qp(n,t)?n[t]:void 0}function Pr(n){return parseInt(n.padEnd(2,n),16)/255}function na(n,t){return ar(t?n/100:n,0,1)}function ar(n,t,r){return Math.min(Math.max(t,n),r)}function ho(n){return!n.some(Number.isNaN)}const po={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ua(n,t,r){return n+r*(t-n)}function Ko(n,t,r){return n.map(((o,h)=>Ua(o,t[h],r)))}class tr{constructor(t,r,o,h=1,y=!0){this.r=t,this.g=r,this.b=o,this.a=h,y||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,r,o,h]))}static parse(t){if(t instanceof tr)return t;if(typeof t!="string")return;const r=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Xo(po,o);if(h){const[_,w,P]=h;return[_/255,w/255,P/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let w=1;return[Pr(o.slice(w,w+=_)),Pr(o.slice(w,w+=_)),Pr(o.slice(w,w+=_)),Pr(o.slice(w,w+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[w,P,I,L,F,U,$,q,H,ee,ae,Se]=_,he=[L||" ",$||" ",ee].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const fe=[I,U,H].join(""),Ie=fe==="%%%"?100:fe===""?255:0;if(Ie){const je=[ar(+P/Ie,0,1),ar(+F/Ie,0,1),ar(+q/Ie,0,1),ae?na(+ae,Se):1];if(ho(je))return je}}return}}const y=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[_,w,P,I,L,F,U,$,q]=y,H=[P||" ",L||" ",U].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const ee=[+w,ar(+I,0,100),ar(+F,0,100),$?na(+$,q):1];if(ho(ee))return(function([ae,Se,he,fe]){function Ie(je){const Xe=(je+ae/30)%12,dt=Se*Math.min(he,1-he);return he-dt*Math.max(-1,Math.min(Xe-3,9-Xe,1))}return ae=sl(ae),Se/=100,he/=100,[Ie(0),Ie(8),Ie(4),fe]})(ee)}}})(t);return r?new tr(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:h}=this,y=h||1/0;return this.overwriteGetter("rgb",[t/y,r/y,o/y,h])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,o,h,y]=ll(t),_=Math.sqrt(o*o+h*h);return[Math.round(1e4*_)?sl(Math.atan2(h,o)*Yl):NaN,_,r,y]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ll(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,h]=this.rgb;return`rgba(${[t,r,o].map((y=>Math.round(255*y))).join(",")},${h})`}static interpolate(t,r,o,h="rgb"){switch(h){case"rgb":{const[y,_,w,P]=Ko(t.rgb,r.rgb,o);return new tr(y,_,w,P,!1)}case"hcl":{const[y,_,w,P]=t.hcl,[I,L,F,U]=r.hcl;let $,q;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?$=NaN:($=I,w!==1&&w!==0||(q=L)):($=y,F!==1&&F!==0||(q=_));else{let he=I-y;I>y&&he>180?he-=360:I<y&&y-I>180&&(he+=360),$=y+o*he}const[H,ee,ae,Se]=(function([he,fe,Ie,je]){return he=isNaN(he)?0:he*$u,Ss([Ie,Math.cos(he)*fe,Math.sin(he)*fe,je])})([$,q??Ua(_,L,o),Ua(w,F,o),Ua(P,U,o)]);return new tr(H,ee,ae,Se,!1)}case"lab":{const[y,_,w,P]=Ss(Ko(t.lab,r.lab,o));return new tr(y,_,w,P,!1)}}}}tr.black=new tr(0,0,0,1),tr.white=new tr(1,1,1,1),tr.transparent=new tr(0,0,0,0),tr.red=new tr(1,0,0,1);class Va{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ga=["bottom","center","top"];class ya{constructor(t,r,o,h,y,_){this.text=t,this.image=r,this.scale=o,this.fontStack=h,this.textColor=y,this.verticalAlign=_}}class un{constructor(t){this.sections=t}static fromString(t){return new un([new ya(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof un?t:un.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class cn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof cn)return t;if(typeof t=="number")return new cn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new cn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new cn(Ko(t.values,r.values,o))}}class kn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kn)return t;if(typeof t=="number")return new kn([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new kn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new kn(Ko(t.values,r.values,o))}}class Wr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Wr)return t;if(typeof t=="string"){const o=tr.parse(t);return o?new Wr([o]):void 0}if(!Array.isArray(t))return;const r=[];for(const o of t){if(typeof o!="string")return;const h=tr.parse(o);if(!h)return;r.push(h)}return new Wr(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o,h="rgb"){const y=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)y.push(tr.interpolate(t.values[_],r.values[_],o,h));return new Wr(y)}}class Zr extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const zc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class En{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof En)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],h=t[r+1];if(typeof o!="string"||!zc.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new En(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){const h=t.values,y=r.values;if(h.length!==y.length)throw new Zr(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const _=[];for(let w=0;w<h.length;w+=2){if(h[w]!==y[w])throw new Zr(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${h[w]}, to[${w}]: ${y[w]}`);_.push(h[w]);const[P,I]=h[w+1],[L,F]=y[w+1];_.push([Ua(P,L,o),Ua(I,F,o)])}return new En(_)}}class Bi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Bi({name:t,available:!1}):null}}class Zn{constructor(t,r,o){this.from=t,this.to=r,this.transition=o}static interpolate(t,r,o){return new Zn(t,r,o)}static parse(t){return t instanceof Zn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Zn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Zn(t.from,t.to,t.transition):typeof t=="string"?new Zn(t,t,1):void 0}}function $r(n,t,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,t,r,o]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yo(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Zn||n instanceof tr||n instanceof Va||n instanceof un||n instanceof cn||n instanceof kn||n instanceof Wr||n instanceof En||n instanceof Bi)return!0;if(Array.isArray(n)){for(const t of n)if(!Yo(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Yo(n[t]))return!1;return!0}return!1}function Bt(n){if(n===null)return il;if(typeof n=="string")return ur;if(typeof n=="boolean")return Gt;if(typeof n=="number")return ft;if(n instanceof tr)return jn;if(n instanceof Zn)return Ho;if(n instanceof Va)return Hl;if(n instanceof un)return co;if(n instanceof cn)return Wl;if(n instanceof kn)return al;if(n instanceof Wr)return Oa;if(n instanceof En)return Ou;if(n instanceof Bi)return ir;if(Array.isArray(n)){const t=n.length;let r;for(const o of n){const h=Bt(o);if(r){if(r===h)continue;r=Yt;break}r=h}return ei(r||Yt,t)}return Wo}function Ut(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof tr||n instanceof Zn||n instanceof un||n instanceof cn||n instanceof kn||n instanceof Wr||n instanceof En||n instanceof Bi?n.toString():JSON.stringify(n)}class ji{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Yo(t[1]))return r.error("invalid value");const o=t[1];let h=Bt(o);const y=r.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new ji(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const or={string:ur,number:ft,boolean:Gt,object:Wo};class ti{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,h=1;const y=t[0];if(y==="array"){let w,P;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in or)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);w=or[I],h++}else w=Yt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);P=t[2],h++}o=ei(w,P)}else{if(!or[y])throw new Error(`Types doesn't contain name = ${y}`);o=or[y]}const _=[];for(;h<t.length;h++){const w=r.parse(t[h],h,Yt);if(!w)return null;_.push(w)}return new ti(o,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!Kl(this.type,Bt(o)))return o;if(r===this.args.length-1)throw new Zr(`Expected value to be of type ${Vr(this.type)}, but found ${Vr(Bt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const $a={"to-boolean":Gt,"to-color":jn,"to-number":ft,"to-string":ur};class qa{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!$a[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const h=$a[o],y=[];for(let _=1;_<t.length;_++){const w=r.parse(t[_],_,Yt);if(!w)return null;y.push(w)}return new qa(h,y)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const h of this.args){if(r=h.evaluate(t),o=null,r instanceof tr)return r;if(typeof r=="string"){const y=t.parseColor(r);if(y)return y}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:$r(r[0],r[1],r[2],r[3]),!o))return new tr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Zr(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const h=cn.parse(r);if(h)return h}throw new Zr(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(t);const h=kn.parse(r);if(h)return h}throw new Zr(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(t);const h=Wr.parse(r);if(h)return h}throw new Zr(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const h=En.parse(r);if(h)return h}throw new Zr(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new Zr(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return un.fromString(Ut(this.args[0].evaluate(t)));case"resolvedImage":return Bi.fromString(Ut(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Ut(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ul=["Unknown","Point","LineString","Polygon"];class cl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ul[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=tr.parse(t),this._parseColorCache.set(t,r)),r}}class Jo{constructor(t,r,o=[],h,y=new ja,_=[]){this.registry=t,this.path=o,this.key=o.map((w=>`[${w}]`)).join(""),this.scope=y,this.errors=_,this.expectedType=h,this._isConstant=r}parse(t,r,o,h,y={}){return r?this.concat(r,o,h)._parse(t,y):this._parse(t,y)}_parse(t,r){function o(h,y,_){return _==="assert"?new ti(y,[h]):_==="coerce"?new qa(y,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[h];if(y){let _=y.parse(t,this);if(!_)return null;if(this.expectedType){const w=this.expectedType,P=_.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||P.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(P.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(P.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(P.kind)||w.kind==="colorArray"&&["value","string","array"].includes(P.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(P.kind))_=o(_,w,r.typeAnnotation||"coerce");else if(this.checkSubtype(w,P))return null}else _=o(_,w,r.typeAnnotation||"assert")}if(!(_ instanceof ji)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const w=new cl;try{_=new ji(_.type,_.evaluate(w))}catch(P){return this.error(P.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const h=typeof t=="number"?this.path.concat(t):this.path,y=o?this.scope.concat(o):this.scope;return new Jo(this.registry,this._isConstant,h,r||null,y,this.errors)}error(t,...r){const o=`${this.key}${r.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Kr(o,t))}checkSubtype(t,r){const o=Kl(t,r);return o&&this.error(o),o}}class hl{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let y=1;y<t.length-1;y+=2){const _=t[y];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",y);const w=r.parse(t[y+1],y+1);if(!w)return null;o.push([_,w])}const h=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return h?new hl(o,h):null}outputDefined(){return this.result.outputDefined()}}class _a{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new _a(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class pl{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,ft),h=r.parse(t[2],2,ei(r.expectedType||Yt));return o&&h?new pl(h.type.itemType,o,h):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new Zr(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Zr(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Zr(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Cs{constructor(t,r){this.type=Gt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Yt),h=r.parse(t[2],2,Yt);return o&&h?Uu(o.type,[Gt,ur,ft,il,Yt])?new Cs(o,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!ma(r,["boolean","string","number","null"]))throw new Zr(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(Bt(r))} instead.`);if(!ma(o,["string","array"]))throw new Zr(`Expected second argument to be of type array or string, but found ${Vr(Bt(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ia{constructor(t,r,o){this.type=ft,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Yt),h=r.parse(t[2],2,Yt);if(!o||!h)return null;if(!Uu(o.type,[Gt,ur,ft,il,Yt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(o.type)} instead`);if(t.length===4){const y=r.parse(t[3],3,ft);return y?new ia(o,h,y):null}return new ia(o,h)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!ma(r,["boolean","string","number","null"]))throw new Zr(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(Bt(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),ma(o,["string"])){const y=o.indexOf(r,h);return y===-1?-1:[...o.slice(0,y)].length}if(ma(o,["array"]))return o.indexOf(r,h);throw new Zr(`Expected second argument to be of type array or string, but found ${Vr(Bt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class fn{constructor(t,r,o,h,y,_){this.inputType=t,this.type=r,this.input=o,this.cases=h,this.outputs=y,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const y={},_=[];for(let I=2;I<t.length-1;I+=2){let L=t[I];const F=t[I+1];Array.isArray(L)||(L=[L]);const U=r.concat(I);if(L.length===0)return U.error("Expected at least one branch label.");for(const q of L){if(typeof q!="number"&&typeof q!="string")return U.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return U.error("Numeric branch labels must be integer values.");if(o){if(U.checkSubtype(o,Bt(q)))return null}else o=Bt(q);if(y[String(q)]!==void 0)return U.error("Branch labels must be unique.");y[String(q)]=_.length}const $=r.parse(F,I,h);if(!$)return null;h=h||$.type,_.push($)}const w=r.parse(t[1],1,Yt);if(!w)return null;const P=r.parse(t[t.length-1],t.length-1,h);return P?w.type.kind!=="value"&&r.concat(1).checkSubtype(o,w.type)?null:new fn(o,h,w,y,_,P):null}evaluate(t){const r=this.input.evaluate(t);return(Bt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class fo{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const h=[];for(let _=1;_<t.length-1;_+=2){const w=r.parse(t[_],_,Gt);if(!w)return null;const P=r.parse(t[_+1],_+1,o);if(!P)return null;h.push([w,P]),o=o||P.type}const y=r.parse(t[t.length-1],t.length-1,o);if(!y)return null;if(!o)throw new Error("Can't infer output type");return new fo(o,h,y)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class dl{constructor(t,r,o,h){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Yt),h=r.parse(t[2],2,ft);if(!o||!h)return null;if(!Uu(o.type,[ei(Yt),ur,Yt]))return r.error(`Expected first argument to be of type array or string, but found ${Vr(o.type)} instead`);if(t.length===4){const y=r.parse(t[3],3,ft);return y?new dl(o.type,o,h,y):null}return new dl(o.type,o,h)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),ma(r,["string"]))return[...r].slice(o,h).join("");if(ma(r,["array"]))return r.slice(o,h);throw new Zr(`Expected first argument to be of type array or string, but found ${Vr(Bt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function In(n,t){const r=n.length-1;let o,h,y=0,_=r,w=0;for(;y<=_;)if(w=Math.floor((y+_)/2),o=n[w],h=n[w+1],o<=t){if(w===r||t<h)return w;y=w+1}else{if(!(o>t))throw new Zr("Input is not a number.");_=w-1}return 0}class Xr{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[h,y]of o)this.labels.push(h),this.outputs.push(y)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,ft);if(!o)return null;const h=[];let y=null;r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let _=1;_<t.length;_+=2){const w=_===1?-1/0:t[_],P=t[_+1],I=_,L=_+1;if(typeof w!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(h.length&&h[h.length-1][0]>=w)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const F=r.parse(P,L,y);if(!F)return null;y=y||F.type,h.push([w,F])}return new Xr(y,o,h)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return o[0].evaluate(t);const y=r.length;return h>=r[y-1]?o[y-1].evaluate(t):o[In(r,h)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function qu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mo,Lc,Rc=(function(){if(Lc)return mo;function n(t,r,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=h}return Lc=1,mo=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var y=this.sampleCurveX(o)-t;if(Math.abs(y)<r)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=y/_}var w=0,P=1;for(o=t,h=0;h<20&&(y=this.sampleCurveX(o),!(Math.abs(y-t)<r));h++)t>y?w=o:P=o,o=.5*(P-w)+w;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},mo})(),Qo=qu(Rc);class mn{constructor(t,r,o,h,y){this.type=t,this.operator=r,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[_,w]of y)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(t,r,o,h){let y=0;if(t.name==="exponential")y=es(r,t.base,o,h);else if(t.name==="linear")y=es(r,1,o,h);else if(t.name==="cubic-bezier"){const _=t.controlPoints;y=new Qo(_[0],_[1],_[2],_[3]).solve(es(r,1,o,h))}return y}static parse(t,r){let[o,h,y,..._]=t;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const I=h[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:I}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const I=h.slice(1);if(I.length!==4||I.some((L=>typeof L!="number"||L<0||L>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(y=r.parse(y,2,ft),!y)return null;const w=[];let P=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==Oa?r.expectedType&&r.expectedType.kind!=="value"&&(P=r.expectedType):P=jn;for(let I=0;I<_.length;I+=2){const L=_[I],F=_[I+1],U=I+3,$=I+4;if(typeof L!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(w.length&&w[w.length-1][0]>=L)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const q=r.parse(F,$,P);if(!q)return null;P=P||q.type,w.push([L,q])}return Gn(P,ft)||Gn(P,Ho)||Gn(P,jn)||Gn(P,Wl)||Gn(P,al)||Gn(P,Oa)||Gn(P,Ou)||Gn(P,ei(ft))?new mn(P,o,h,y,w):r.error(`Type ${Vr(P)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return o[0].evaluate(t);const y=r.length;if(h>=r[y-1])return o[y-1].evaluate(t);const _=In(r,h),w=mn.interpolationFactor(this.interpolation,h,r[_],r[_+1]),P=o[_].evaluate(t),I=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ua(P,I,w);case"color":return tr.interpolate(P,I,w);case"padding":return cn.interpolate(P,I,w);case"colorArray":return Wr.interpolate(P,I,w);case"numberArray":return kn.interpolate(P,I,w);case"variableAnchorOffsetCollection":return En.interpolate(P,I,w);case"array":return Ko(P,I,w);case"projectionDefinition":return Zn.interpolate(P,I,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return tr.interpolate(P,I,w,"hcl");case"colorArray":return Wr.interpolate(P,I,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return tr.interpolate(P,I,w,"lab");case"colorArray":return Wr.interpolate(P,I,w,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function es(n,t,r,o){const h=o-r,y=n-r;return h===0?0:t===1?y/h:(Math.pow(t,y)-1)/(Math.pow(t,h)-1)}const va={color:tr.interpolate,number:Ua,padding:cn.interpolate,numberArray:kn.interpolate,colorArray:Wr.interpolate,variableAnchorOffsetCollection:En.interpolate,array:Ko};class eu{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o=null;const h=r.expectedType;h&&h.kind!=="value"&&(o=h);const y=[];for(const w of t.slice(1)){const P=r.parse(w,1+y.length,o,void 0,{typeAnnotation:"omit"});if(!P)return null;o=o||P.type,y.push(P)}if(!o)throw new Error("No output type");const _=h&&y.some((w=>Kl(h,w.type)));return new eu(_?Yt:o,y)}evaluate(t){let r,o=null,h=0;for(const y of this.args)if(h++,o=y.evaluate(t),o&&o instanceof Bi&&!o.available&&(r||(r=o.name),o=null,h===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function tu(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ru(n,t,r,o){return o.compare(t,r)===0}function On(n,t,r){const o=n!=="=="&&n!=="!=";return class u0{constructor(y,_,w){this.type=Gt,this.lhs=y,this.rhs=_,this.collator=w,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const w=y[0];let P=_.parse(y[1],1,Yt);if(!P)return null;if(!tu(w,P.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${Vr(P.type)}'.`);let I=_.parse(y[2],2,Yt);if(!I)return null;if(!tu(w,I.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${Vr(I.type)}'.`);if(P.type.kind!==I.type.kind&&P.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${Vr(P.type)}' and '${Vr(I.type)}'.`);o&&(P.type.kind==="value"&&I.type.kind!=="value"?P=new ti(I.type,[P]):P.type.kind!=="value"&&I.type.kind==="value"&&(I=new ti(P.type,[I])));let L=null;if(y.length===4){if(P.type.kind!=="string"&&I.type.kind!=="string"&&P.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(L=_.parse(y[3],3,Hl),!L)return null}return new u0(P,I,L)}evaluate(y){const _=this.lhs.evaluate(y),w=this.rhs.evaluate(y);if(o&&this.hasUntypedArgument){const P=Bt(_),I=Bt(w);if(P.kind!==I.kind||P.kind!=="string"&&P.kind!=="number")throw new Zr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${P.kind}, ${I.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const P=Bt(_),I=Bt(w);if(P.kind!=="string"||I.kind!=="string")return t(y,_,w)}return this.collator?r(y,_,w,this.collator.evaluate(y)):t(y,_,w)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const tp=On("==",(function(n,t,r){return t===r}),ru),Gu=On("!=",(function(n,t,r){return t!==r}),(function(n,t,r,o){return!ru(0,t,r,o)})),Gp=On("<",(function(n,t,r){return t<r}),(function(n,t,r,o){return o.compare(t,r)<0})),Dc=On(">",(function(n,t,r){return t>r}),(function(n,t,r,o){return o.compare(t,r)>0})),Zp=On("<=",(function(n,t,r){return t<=r}),(function(n,t,r,o){return o.compare(t,r)<=0})),rp=On(">=",(function(n,t,r){return t>=r}),(function(n,t,r,o){return o.compare(t,r)>=0}));class Zu{constructor(t,r,o){this.type=Hl,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const h=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Gt);if(!h)return null;const y=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Gt);if(!y)return null;let _=null;return o.locale&&(_=r.parse(o.locale,1,ur),!_)?null:new Zu(h,y,_)}evaluate(t){return new Va(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Nc{constructor(t,r,o,h,y){this.type=ur,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=y}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,ft);if(!o)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let y=null;if(h.locale&&(y=r.parse(h.locale,1,ur),!y))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,ur),!_))return null;let w=null;if(h["min-fraction-digits"]&&(w=r.parse(h["min-fraction-digits"],1,ft),!w))return null;let P=null;return h["max-fraction-digits"]&&(P=r.parse(h["max-fraction-digits"],1,ft),!P)?null:new Nc(o,y,_,w,P)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ps{constructor(t){this.type=co,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const h=[];let y=!1;for(let _=1;_<=t.length-1;++_){const w=t[_];if(y&&typeof w=="object"&&!Array.isArray(w)){y=!1;let P=null;if(w["font-scale"]&&(P=r.parse(w["font-scale"],1,ft),!P))return null;let I=null;if(w["text-font"]&&(I=r.parse(w["text-font"],1,ei(ur)),!I))return null;let L=null;if(w["text-color"]&&(L=r.parse(w["text-color"],1,jn),!L))return null;let F=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!ga.includes(w["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(F=r.parse(w["vertical-align"],1,ur),!F)return null}const U=h[h.length-1];U.scale=P,U.font=I,U.textColor=L,U.verticalAlign=F}else{const P=r.parse(t[_],1,Yt);if(!P)return null;const I=P.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:P,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ps(h)}evaluate(t){return new un(this.sections.map((r=>{const o=r.content.evaluate(t);return Bt(o)===ir?new ya("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new ya(Ut(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Fc{constructor(t){this.type=ir,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,ur);return o?new Fc(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=Bi.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class fl{constructor(t){this.type=ft,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Vr(o.type)} instead.`):new fl(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Zr(`Expected value to be of type string or array, but found ${Vr(Bt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const xa=8192;function Hp(n,t){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(r*h*xa),Math.round(o*h*xa)]}function Hu(n,t){const r=Math.pow(2,t.z);return[(h=(n[0]/xa+t.x)/r,360*h-180),(o=(n[1]/xa+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function ml(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function nu(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Wp(n,t,r){const o=n[0]-t[0],h=n[1]-t[1],y=n[0]-r[0],_=n[1]-r[1];return o*_-y*h==0&&o*y<=0&&h*_<=0}function Wu(n,t,r,o){return(h=[o[0]-r[0],o[1]-r[1]])[0]*(y=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*y[0]!=0&&!(!gl(n,t,r,o)||!gl(r,o,n,t));var h,y}function Xp(n,t,r){for(const o of r)for(let h=0;h<o.length-1;++h)if(Wu(n,t,o[h],o[h+1]))return!0;return!1}function Ms(n,t,r=!1){let o=!1;for(const w of t)for(let P=0;P<w.length-1;P++){if(Wp(n,w[P],w[P+1]))return r;(y=w[P])[1]>(h=n)[1]!=(_=w[P+1])[1]>h[1]&&h[0]<(_[0]-y[0])*(h[1]-y[1])/(_[1]-y[1])+y[0]&&(o=!o)}var h,y,_;return o}function np(n,t){for(const r of t)if(Ms(n,r))return!0;return!1}function Bc(n,t){for(const r of n)if(!Ms(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Xp(n[r],n[r+1],t))return!1;return!0}function jc(n,t){for(const r of t)if(Bc(n,r))return!0;return!1}function gl(n,t,r,o){const h=o[0]-r[0],y=o[1]-r[1],_=(n[0]-r[0])*y-h*(n[1]-r[1]),w=(t[0]-r[0])*y-h*(t[1]-r[1]);return _>0&&w<0||_<0&&w>0}function Oc(n,t,r){const o=[];for(let h=0;h<n.length;h++){const y=[];for(let _=0;_<n[h].length;_++){const w=Hp(n[h][_],r);ml(t,w),y.push(w)}o.push(y)}return o}function Uc(n,t,r){const o=[];for(let h=0;h<n.length;h++){const y=Oc(n[h],t,r);o.push(y)}return o}function iu(n,t,r,o){if(n[0]<r[0]||n[0]>r[2]){const h=.5*o;let y=n[0]-r[0]>h?-o:r[0]-n[0]>h?o:0;y===0&&(y=n[0]-r[2]>h?-o:r[2]-n[0]>h?o:0),n[0]+=y}ml(t,n)}function Vc(n,t,r,o){const h=Math.pow(2,o.z)*xa,y=[o.x*xa,o.y*xa],_=[];for(const w of n)for(const P of w){const I=[P.x+y[0],P.y+y[1]];iu(I,t,r,h),_.push(I)}return _}function $c(n,t,r,o){const h=Math.pow(2,o.z)*xa,y=[o.x*xa,o.y*xa],_=[];for(const P of n){const I=[];for(const L of P){const F=[L.x+y[0],L.y+y[1]];ml(t,F),I.push(F)}_.push(I)}if(t[2]-t[0]<=h/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const P of _)for(const I of P)iu(I,t,r,h)}var w;return _}class ts{constructor(t,r){this.type=Gt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Yo(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const h=[];for(const y of o.features){const{type:_,coordinates:w}=y.geometry;_==="Polygon"&&h.push(w),_==="MultiPolygon"&&h.push(...w)}if(h.length)return new ts(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ts(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ts(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,o){const h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const w=Oc(o.coordinates,y,_),P=Vc(r.geometry(),h,y,_);if(!nu(h,y))return!1;for(const I of P)if(!Ms(I,w))return!1}if(o.type==="MultiPolygon"){const w=Uc(o.coordinates,y,_),P=Vc(r.geometry(),h,y,_);if(!nu(h,y))return!1;for(const I of P)if(!np(I,w))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,o){const h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const w=Oc(o.coordinates,y,_),P=$c(r.geometry(),h,y,_);if(!nu(h,y))return!1;for(const I of P)if(!Bc(I,w))return!1}if(o.type==="MultiPolygon"){const w=Uc(o.coordinates,y,_),P=$c(r.geometry(),h,y,_);if(!nu(h,y))return!1;for(const I of P)if(!jc(I,w))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rs=class{constructor(n=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,o=t[n];for(;n>0;){const h=n-1>>1,y=t[h];if(r(o,y)>=0)break;t[n]=y,n=h}t[n]=o}_down(n){const{data:t,compare:r}=this,o=this.length>>1,h=t[n];for(;n<o;){let y=1+(n<<1);const _=y+1;if(_<this.length&&r(t[_],t[y])<0&&(y=_),r(t[y],h)>=0)break;t[n]=t[y],n=y}t[n]=h}};function qc(n,t,r=0,o=n.length-1,h=Kp){for(;o>r;){if(o-r>600){const P=o-r+1,I=t-r+1,L=Math.log(P),F=.5*Math.exp(2*L/3),U=.5*Math.sqrt(L*F*(P-F)/P)*(I-P/2<0?-1:1);qc(n,t,Math.max(r,Math.floor(t-I*F/P+U)),Math.min(o,Math.floor(t+(P-I)*F/P+U)),h)}const y=n[t];let _=r,w=o;for(au(n,r,t),h(n[o],y)>0&&au(n,r,o);_<w;){for(au(n,_,w),_++,w--;h(n[_],y)<0;)_++;for(;h(n[w],y)>0;)w--}h(n[r],y)===0?au(n,r,w):(w++,au(n,w,o)),w<=t&&(r=w+1),t<=w&&(o=w-1)}}function au(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function Kp(n,t){return n<t?-1:n>t?1:0}function yl(n,t){if(n.length<=1)return[n];const r=[];let o,h;for(const y of n){const _=ou(y);_!==0&&(y.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(o&&r.push(o),o=[y]):o.push(y))}if(o&&r.push(o),t>1)for(let y=0;y<r.length;y++)r[y].length<=t||(qc(r[y],t,1,r[y].length-1,Gc),r[y]=r[y].slice(0,t));return r}function Gc(n,t){return t.area-n.area}function ou(n){let t=0;for(let r,o,h=0,y=n.length,_=y-1;h<y;_=h++)r=n[h],o=n[_],t+=(o.x-r.x)*(r.y+o.y);return t}const _l=1/298.257223563,ip=_l*(2-_l),vl=Math.PI/180;class Zc{constructor(t){const r=6378.137*vl*1e3,o=Math.cos(t*vl),h=1/(1-ip*(1-o*o)),y=Math.sqrt(h);this.kx=r*y*o,this.ky=r*y*h*(1-ip)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,h=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(t,r){let o,h,y,_,w=1/0;for(let P=0;P<t.length-1;P++){let I=t[P][0],L=t[P][1],F=this.wrap(t[P+1][0]-I)*this.kx,U=(t[P+1][1]-L)*this.ky,$=0;F===0&&U===0||($=(this.wrap(r[0]-I)*this.kx*F+(r[1]-L)*this.ky*U)/(F*F+U*U),$>1?(I=t[P+1][0],L=t[P+1][1]):$>0&&(I+=F/this.kx*$,L+=U/this.ky*$)),F=this.wrap(r[0]-I)*this.kx,U=(r[1]-L)*this.ky;const q=F*F+U*U;q<w&&(w=q,o=I,h=L,y=P,_=$)}return{point:[o,h],index:y,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Hc(n,t){return t[0]-n[0]}function xl(n){return n[1]-n[0]+1}function ba(n,t){return n[1]>=n[0]&&n[1]<t}function br(n,t){if(n[0]>n[1])return[null,null];const r=xl(n);if(t){if(r===2)return[n,null];const h=Math.floor(r/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function Xu(n,t){if(!ba(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)ml(r,n[o]);return r}function Ku(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const o of r)ml(t,o);return t}function ap(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Wc(n,t,r){if(!ap(n)||!ap(t))return NaN;let o=0,h=0;return n[2]<t[0]&&(o=t[0]-n[2]),n[0]>t[2]&&(o=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),r.distance([0,0],[o,h])}function ks(n,t,r){const o=r.pointOnLine(t,n);return r.distance(n,o.point)}function Xc(n,t,r,o,h){const y=Math.min(ks(n,[r,o],h),ks(t,[r,o],h)),_=Math.min(ks(r,[n,t],h),ks(o,[n,t],h));return Math.min(y,_)}function Yp(n,t,r,o,h){if(!ba(t,n.length)||!ba(o,r.length))return 1/0;let y=1/0;for(let _=t[0];_<t[1];++_){const w=n[_],P=n[_+1];for(let I=o[0];I<o[1];++I){const L=r[I],F=r[I+1];if(Wu(w,P,L,F))return 0;y=Math.min(y,Xc(w,P,L,F,h))}}return y}function wa(n,t,r,o,h){if(!ba(t,n.length)||!ba(o,r.length))return NaN;let y=1/0;for(let _=t[0];_<=t[1];++_)for(let w=o[0];w<=o[1];++w)if(y=Math.min(y,h.distance(n[_],r[w])),y===0)return y;return y}function su(n,t,r){if(Ms(n,t,!0))return 0;let o=1/0;for(const h of t){const y=h[0],_=h[h.length-1];if(y!==_&&(o=Math.min(o,ks(n,[_,y],r)),o===0))return o;const w=r.pointOnLine(h,n);if(o=Math.min(o,r.distance(n,w.point)),o===0)return o}return o}function op(n,t,r,o){if(!ba(t,n.length))return NaN;for(let y=t[0];y<=t[1];++y)if(Ms(n[y],r,!0))return 0;let h=1/0;for(let y=t[0];y<t[1];++y){const _=n[y],w=n[y+1];for(const P of r)for(let I=0,L=P.length,F=L-1;I<L;F=I++){const U=P[F],$=P[I];if(Wu(_,w,U,$))return 0;h=Math.min(h,Xc(_,w,U,$,o))}}return h}function Kc(n,t){for(const r of n)for(const o of r)if(Ms(o,t,!0))return!0;return!1}function sp(n,t,r,o=1/0){const h=Ku(n),y=Ku(t);if(o!==1/0&&Wc(h,y,r)>=o)return o;if(nu(h,y)){if(Kc(n,t))return 0}else if(Kc(t,n))return 0;let _=1/0;for(const w of n)for(let P=0,I=w.length,L=I-1;P<I;L=P++){const F=w[L],U=w[P];for(const $ of t)for(let q=0,H=$.length,ee=H-1;q<H;ee=q++){const ae=$[ee],Se=$[q];if(Wu(F,U,ae,Se))return 0;_=Math.min(_,Xc(F,U,ae,Se,r))}}return _}function Yc(n,t,r,o,h,y){if(!y)return;const _=Wc(Xu(o,y),h,r);_<t&&n.push([_,y,[0,0]])}function bl(n,t,r,o,h,y,_){if(!y||!_)return;const w=Wc(Xu(o,y),Xu(h,_),r);w<t&&n.push([w,y,_])}function Yu(n,t,r,o,h=1/0){let y=Math.min(o.distance(n[0],r[0][0]),h);if(y===0)return y;const _=new rs([[0,[0,n.length-1],[0,0]]],Hc),w=Ku(r);for(;_.length>0;){const P=_.pop();if(P[0]>=y)continue;const I=P[1],L=t?50:100;if(xl(I)<=L){if(!ba(I,n.length))return NaN;if(t){const F=op(n,I,r,o);if(isNaN(F)||F===0)return F;y=Math.min(y,F)}else for(let F=I[0];F<=I[1];++F){const U=su(n[F],r,o);if(y=Math.min(y,U),y===0)return 0}}else{const F=br(I,t);Yc(_,y,o,n,w,F[0]),Yc(_,y,o,n,w,F[1])}}return y}function Ju(n,t,r,o,h,y=1/0){let _=Math.min(y,h.distance(n[0],r[0]));if(_===0)return _;const w=new rs([[0,[0,n.length-1],[0,r.length-1]]],Hc);for(;w.length>0;){const P=w.pop();if(P[0]>=_)continue;const I=P[1],L=P[2],F=t?50:100,U=o?50:100;if(xl(I)<=F&&xl(L)<=U){if(!ba(I,n.length)&&ba(L,r.length))return NaN;let $;if(t&&o)$=Yp(n,I,r,L,h),_=Math.min(_,$);else if(t&&!o){const q=n.slice(I[0],I[1]+1);for(let H=L[0];H<=L[1];++H)if($=ks(r[H],q,h),_=Math.min(_,$),_===0)return _}else if(!t&&o){const q=r.slice(L[0],L[1]+1);for(let H=I[0];H<=I[1];++H)if($=ks(n[H],q,h),_=Math.min(_,$),_===0)return _}else $=wa(n,I,r,L,h),_=Math.min(_,$)}else{const $=br(I,t),q=br(L,o);bl(w,_,h,n,r,$[0],q[0]),bl(w,_,h,n,r,$[0],q[1]),bl(w,_,h,n,r,$[1],q[0]),bl(w,_,h,n,r,$[1],q[1])}}return _}function ns(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class go{constructor(t,r){this.type=ft,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Yo(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new go(o,o.features.map((h=>ns(h.geometry))).flat());if(o.type==="Feature")return new go(o,ns(o.geometry));if("type"in o&&"coordinates"in o)return new go(o,ns(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,o){const h=r.geometry(),y=h.flat().map((P=>Hu([P.x,P.y],r.canonical)));if(h.length===0)return NaN;const _=new Zc(y[0][1]);let w=1/0;for(const P of o){switch(P.type){case"Point":w=Math.min(w,Ju(y,!1,[P.coordinates],!1,_,w));break;case"LineString":w=Math.min(w,Ju(y,!1,P.coordinates,!0,_,w));break;case"Polygon":w=Math.min(w,Yu(y,!1,P.coordinates,_,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,o){const h=r.geometry(),y=h.flat().map((P=>Hu([P.x,P.y],r.canonical)));if(h.length===0)return NaN;const _=new Zc(y[0][1]);let w=1/0;for(const P of o){switch(P.type){case"Point":w=Math.min(w,Ju(y,!0,[P.coordinates],!1,_,w));break;case"LineString":w=Math.min(w,Ju(y,!0,P.coordinates,!0,_,w));break;case"Polygon":w=Math.min(w,Yu(y,!0,P.coordinates,_,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,o){const h=r.geometry();if(h.length===0||h[0].length===0)return NaN;const y=yl(h,0).map((P=>P.map((I=>I.map((L=>Hu([L.x,L.y],r.canonical))))))),_=new Zc(y[0][0][0][1]);let w=1/0;for(const P of o)for(const I of y){switch(P.type){case"Point":w=Math.min(w,Yu([P.coordinates],!1,I,_,w));break;case"LineString":w=Math.min(w,Yu(P.coordinates,!0,I,_,w));break;case"Polygon":w=Math.min(w,sp(I,P.coordinates,_,w))}if(w===0)return w}return w})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class yo{constructor(t){this.type=Yt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new yo(o)}evaluate(t){var r;const o=(r=t.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?Xo(o,this.key):null}eachChild(){}outputDefined(){return!1}}const is={"==":tp,"!=":Gu,">":Dc,"<":Gp,">=":rp,"<=":Zp,array:ti,at:pl,boolean:ti,case:fo,coalesce:eu,collator:Zu,format:Ps,image:Fc,in:Cs,"index-of":ia,interpolate:mn,"interpolate-hcl":mn,"interpolate-lab":mn,length:fl,let:hl,literal:ji,match:fn,number:ti,"number-format":Nc,object:ti,slice:dl,step:Xr,string:ti,"to-boolean":qa,"to-color":qa,"to-number":qa,"to-string":qa,var:_a,within:ts,distance:go,"global-state":yo};class Oi{constructor(t,r,o,h){this.name=t,this.type=r,this._evaluate=o,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],h=Oi.definitions[o];if(!h)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=_.filter((([I])=>!Array.isArray(I)||I.length===t.length-1));let P=null;for(const[I,L]of w){P=new Jo(r.registry,Is,r.path,null,r.scope);const F=[];let U=!1;for(let $=1;$<t.length;$++){const q=t[$],H=Array.isArray(I)?I[$-1]:I.type,ee=P.parse(q,1+F.length,H);if(!ee){U=!0;break}F.push(ee)}if(!U)if(Array.isArray(I)&&I.length!==F.length)P.error(`Expected ${I.length} arguments, but found ${F.length} instead.`);else{for(let $=0;$<F.length;$++){const q=Array.isArray(I)?I[$]:I.type,H=F[$];P.concat($+1).checkSubtype(q,H.type)}if(P.errors.length===0)return new Oi(o,y,L,F)}}if(w.length===1)r.errors.push(...P.errors);else{const I=(w.length?w:_).map((([F])=>{return U=F,Array.isArray(U)?`(${U.map(Vr).join(", ")})`:`(${Vr(U.type)}...)`;var U})).join(" | "),L=[];for(let F=1;F<t.length;F++){const U=r.parse(t[F],1+L.length);if(!U)return null;L.push(Vr(U.type))}r.error(`Expected arguments of type ${I}, but found (${L.join(", ")}) instead.`)}return null}static register(t,r){Oi.definitions=r;for(const o in r)t[o]=Oi}}function lu(n,[t,r,o,h]){t=t.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const y=h?h.evaluate(n):1,_=$r(t,r,o,y);if(_)throw new Zr(_);return new tr(t/255,r/255,o/255,y,!1)}function Es(n,t){return n in t}function uu(n,t){const r=t[n];return r===void 0?null:r}function as(n){return{type:n}}function Is(n){if(n instanceof _a)return Is(n.boundExpression);if(n instanceof Oi&&n.name==="error"||n instanceof Zu||n instanceof ts||n instanceof go||n instanceof yo)return!1;const t=n instanceof qa||n instanceof ti;let r=!0;return n.eachChild((o=>{r=t?r&&Is(o):r&&o instanceof ji})),!!r&&cu(n)&&hu(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function cu(n){if(n instanceof Oi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ts||n instanceof go)return!1;let t=!0;return n.eachChild((r=>{t&&!cu(r)&&(t=!1)})),t}function wl(n){if(n instanceof Oi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((r=>{t&&!wl(r)&&(t=!1)})),t}function hu(n,t){if(n instanceof Oi&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild((o=>{r&&!hu(o,t)&&(r=!1)})),r}function Jc(n){return{result:"success",value:n}}function As(n){return{result:"error",value:n}}function _o(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function vo(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function pu(n){return!!n.expression&&n.expression.interpolated}function sr(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function du(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Bt(n)===Wo}function Jp(n){return n}function Sl(n,t){const r=n.stops&&typeof n.stops[0][0]=="object",o=r||!(r||n.property!==void 0),h=n.type||(pu(t)?"exponential":"interval"),y=(function(L){switch(L.type){case"color":return tr.parse;case"padding":return cn.parse;case"numberArray":return kn.parse;case"colorArray":return Wr.parse;default:return null}})(t);if(y&&((n=Mn({},n)).stops&&(n.stops=n.stops.map((L=>[L[0],y(L[1])]))),n.default=y(n.default?n.default:t.default)),n.colorSpace&&(_=n.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var _;const w=(function(L){switch(L){case"exponential":return Yr;case"interval":return lp;case"categorical":return Qc;case"identity":return eh;default:throw new Error(`Unknown function type "${L}"`)}})(h);let P,I;if(h==="categorical"){P=Object.create(null);for(const L of n.stops)P[L[0]]=L[1];I=typeof n.stops[0][0]}if(r){const L={},F=[];for(let q=0;q<n.stops.length;q++){const H=n.stops[q],ee=H[0].zoom;L[ee]===void 0&&(L[ee]={zoom:ee,type:n.type,property:n.property,default:n.default,stops:[]},F.push(ee)),L[ee].stops.push([H[0].value,H[1]])}const U=[];for(const q of F)U.push([L[q].zoom,Sl(L[q],t)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:mn.interpolationFactor.bind(void 0,$),zoomStops:U.map((q=>q[0])),evaluate:({zoom:q},H)=>Yr({stops:U,base:n.base},t,q).evaluate(q,H)}}if(o){const L=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:mn.interpolationFactor.bind(void 0,L),zoomStops:n.stops.map((F=>F[0])),evaluate:({zoom:F})=>w(n,t,F,P,I)}}return{kind:"source",evaluate(L,F){const U=F&&F.properties?F.properties[n.property]:void 0;return U===void 0?os(n.default,t.default):w(n,t,U,P,I)}}}function os(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Qc(n,t,r,o,h){return os(typeof r===h?o[r]:void 0,n.default,t.default)}function lp(n,t,r){if(sr(r)!=="number")return os(n.default,t.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const h=In(n.stops.map((y=>y[0])),r);return n.stops[h][1]}function Yr(n,t,r){const o=n.base!==void 0?n.base:1;if(sr(r)!=="number")return os(n.default,t.default);const h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const y=In(n.stops.map((L=>L[0])),r),_=(function(L,F,U,$){const q=$-U,H=L-U;return q===0?0:F===1?H/q:(Math.pow(F,H)-1)/(Math.pow(F,q)-1)})(r,o,n.stops[y][0],n.stops[y+1][0]),w=n.stops[y][1],P=n.stops[y+1][1],I=va[t.type]||Jp;return typeof w.evaluate=="function"?{evaluate(...L){const F=w.evaluate.apply(void 0,L),U=P.evaluate.apply(void 0,L);if(F!==void 0&&U!==void 0)return I(F,U,_,n.colorSpace)}}:I(w,P,_,n.colorSpace)}function eh(n,t,r){switch(t.type){case"color":r=tr.parse(r);break;case"formatted":r=un.fromString(r.toString());break;case"resolvedImage":r=Bi.fromString(r.toString());break;case"padding":r=cn.parse(r);break;case"colorArray":r=Wr.parse(r);break;case"numberArray":r=kn.parse(r);break;default:sr(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return os(r,n.default,t.default)}Oi.register(is,{error:[{kind:"error"},[ur],(n,[t])=>{throw new Zr(t.evaluate(n))}],typeof:[ur,[Yt],(n,[t])=>Vr(Bt(t.evaluate(n)))],"to-rgba":[ei(ft,4),[jn],(n,[t])=>{const[r,o,h,y]=t.evaluate(n).rgb;return[255*r,255*o,255*h,y]}],rgb:[jn,[ft,ft,ft],lu],rgba:[jn,[ft,ft,ft,ft],lu],has:{type:Gt,overloads:[[[ur],(n,[t])=>Es(t.evaluate(n),n.properties())],[[ur,Wo],(n,[t,r])=>Es(t.evaluate(n),r.evaluate(n))]]},get:{type:Yt,overloads:[[[ur],(n,[t])=>uu(t.evaluate(n),n.properties())],[[ur,Wo],(n,[t,r])=>uu(t.evaluate(n),r.evaluate(n))]]},"feature-state":[Yt,[ur],(n,[t])=>uu(t.evaluate(n),n.featureState||{})],properties:[Wo,[],n=>n.properties()],"geometry-type":[ur,[],n=>n.geometryType()],id:[Yt,[],n=>n.id()],zoom:[ft,[],n=>n.globals.zoom],"heatmap-density":[ft,[],n=>n.globals.heatmapDensity||0],elevation:[ft,[],n=>n.globals.elevation||0],"line-progress":[ft,[],n=>n.globals.lineProgress||0],accumulated:[Yt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ft,as(ft),(n,t)=>{let r=0;for(const o of t)r+=o.evaluate(n);return r}],"*":[ft,as(ft),(n,t)=>{let r=1;for(const o of t)r*=o.evaluate(n);return r}],"-":{type:ft,overloads:[[[ft,ft],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[ft],(n,[t])=>-t.evaluate(n)]]},"/":[ft,[ft,ft],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[ft,[ft,ft],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[ft,[ft],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[ft,[ft],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[ft,[ft],(n,[t])=>Math.log(t.evaluate(n))],log2:[ft,[ft],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[ft,[ft],(n,[t])=>Math.sin(t.evaluate(n))],cos:[ft,[ft],(n,[t])=>Math.cos(t.evaluate(n))],tan:[ft,[ft],(n,[t])=>Math.tan(t.evaluate(n))],asin:[ft,[ft],(n,[t])=>Math.asin(t.evaluate(n))],acos:[ft,[ft],(n,[t])=>Math.acos(t.evaluate(n))],atan:[ft,[ft],(n,[t])=>Math.atan(t.evaluate(n))],min:[ft,as(ft),(n,t)=>Math.min(...t.map((r=>r.evaluate(n))))],max:[ft,as(ft),(n,t)=>Math.max(...t.map((r=>r.evaluate(n))))],abs:[ft,[ft],(n,[t])=>Math.abs(t.evaluate(n))],round:[ft,[ft],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[ft,[ft],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[ft,[ft],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Gt,[ur,Yt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Gt,[Yt],(n,[t])=>n.id()===t.value],"filter-type-==":[Gt,[ur],(n,[t])=>n.geometryType()===t.value],"filter-<":[Gt,[ur,Yt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o<h}],"filter-id-<":[Gt,[Yt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Gt,[ur,Yt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o>h}],"filter-id->":[Gt,[Yt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Gt,[ur,Yt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[Gt,[Yt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Gt,[ur,Yt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[Gt,[Yt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Gt,[Yt],(n,[t])=>t.value in n.properties()],"filter-has-id":[Gt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Gt,[ei(ur)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Gt,[ei(Yt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Gt,[ur,ei(Yt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Gt,[ur,ei(Yt)],(n,[t,r])=>(function(o,h,y,_){for(;y<=_;){const w=y+_>>1;if(h[w]===o)return!0;h[w]>o?_=w-1:y=w+1}return!1})(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[as(Gt),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[as(Gt),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Gt,[Gt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Gt,[ur],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[ur,[ur],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[ur,[ur],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[ur,as(Yt),(n,t)=>t.map((r=>Ut(r.evaluate(n)))).join("")],"resolved-locale":[ur,[Hl],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Tl{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new cl,this._defaultValue=r?(function(o){if(o.type==="color"&&du(o.default))return new tr(0,0,0,0);switch(o.type){case"color":return tr.parse(o.default)||null;case"padding":return cn.parse(o.default)||null;case"numberArray":return kn.parse(o.default)||null;case"colorArray":return Wr.parse(o.default)||null;case"variableAnchorOffsetCollection":return En.parse(o.default)||null;case"projectionDefinition":return Zn.parse(o.default)||null;default:return o.default===void 0?null:o.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,h,y,_){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,h,y,_){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Zr(`Expected value to be one of ${Object.keys(this._enumValues).map((P=>JSON.stringify(P))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function ss(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in is}function Cl(n,t){const r=new Jo(is,Is,[],t?(function(h){const y={color:jn,string:ur,number:ft,enum:ur,boolean:Gt,formatted:co,padding:Wl,numberArray:al,colorArray:Oa,projectionDefinition:Ho,resolvedImage:ir,variableAnchorOffsetCollection:Ou};return h.type==="array"?ei(y[h.value]||Yt,h.length):y[h.type]})(t):void 0),o=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Jc(new Tl(o,t)):As(r.errors)}class zs{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!wl(r.expression),this.globalStateRefs=mu(r.expression)}evaluateWithoutErrorHandling(t,r,o,h,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,h,y,_)}evaluate(t,r,o,h,y,_){return this._styleExpression.evaluate(t,r,o,h,y,_)}}class Ls{constructor(t,r,o,h){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!wl(r.expression),this.globalStateRefs=mu(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,r,o,h,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,h,y,_)}evaluate(t,r,o,h,y,_){return this._styleExpression.evaluate(t,r,o,h,y,_)}interpolationFactor(t,r,o){return this.interpolationType?mn.interpolationFactor(this.interpolationType,t,r,o):0}}function fu(n,t){const r=Cl(n,t);if(r.result==="error")return r;const o=r.value.expression,h=cu(o);if(!h&&!_o(t))return As([new Kr("","data expressions not supported")]);const y=hu(o,["zoom"]);if(!y&&!vo(t))return As([new Kr("","zoom expressions not supported")]);const _=Pl(o);return _||y?_ instanceof Kr?As([_]):_ instanceof mn&&!pu(t)?As([new Kr("",'"interpolate" expressions cannot be used with this property')]):Jc(_?new Ls(h?"camera":"composite",r.value,_.labels,_ instanceof mn?_.interpolation:void 0):new zs(h?"constant":"source",r.value)):As([new Kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ga{constructor(t,r){this._parameters=t,this._specification=r,Mn(this,Sl(this._parameters,this._specification))}static deserialize(t){return new Ga(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Pl(n){let t=null;if(n instanceof hl)t=Pl(n.result);else if(n instanceof eu){for(const r of n.args)if(t=Pl(r),t)break}else(n instanceof Xr||n instanceof mn)&&n.input instanceof Oi&&n.input.name==="zoom"&&(t=n);return t instanceof Kr||n.eachChild((r=>{const o=Pl(r);o instanceof Kr?t=o:!t&&o?t=new Kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Kr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function mu(n,t=new Set){return n instanceof yo&&t.add(n.key),n.eachChild((r=>{mu(r,t)})),t}function Qu(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Qu(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ec={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Za(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Qu(n)||(n=xo(n));const t=Cl(n,ec);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,o,h)=>t.value.evaluate(r,o,{},h),needGeometry:kl(n),getGlobalStateRefs:()=>mu(t.value.expression)}}function Ml(n,t){return n<t?-1:n>t?1:0}function kl(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(kl(n[t]))return!0;return!1}function xo(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?gu(n[1],n[2],"=="):t==="!="?yu(gu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?gu(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(xo))):t==="all"?["all"].concat(n.slice(1).map(xo)):t==="none"?["all"].concat(n.slice(1).map(xo).map(yu)):t==="in"?tc(n[1],n.slice(2)):t==="!in"?yu(tc(n[1],n.slice(2))):t==="has"?up(n[1]):t!=="!has"||yu(up(n[1]));var r}function gu(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function tc(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(Ml)]]:["filter-in-small",n,["literal",t]]}}function up(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function yu(n){return["!",n]}function th(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const y of n)h+=`${th(y)},`;return`${h}]`}const r=Object.keys(n).sort();let o="{";for(let h=0;h<r.length;h++)o+=`${JSON.stringify(r[h])}:${th(n[r[h]])},`;return`${o}}`}function Qp(n){let t="";for(const r of Ot)t+=`/${th(n[r])}`;return t}function _u(n){const t=n.value;return t?[new Qe(n.key,t,"constants have been deprecated as of v8")]:[]}function Dr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Sa(n){if(Array.isArray(n))return n.map(Sa);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Sa(n[r]);return t}return Dr(n)}function Hn(n){const t=n.key,r=n.value,o=n.valueSpec||{},h=n.objectElementValidators||{},y=n.style,_=n.styleSpec,w=n.validateSpec;let P=[];const I=sr(r);if(I!=="object")return[new Qe(t,r,`object expected, ${I} found`)];for(const L in r){const F=L.split(".")[0],U=Xo(o,F)||o["*"];let $;if(Xo(h,F))$=h[F];else if(Xo(o,F))$=w;else if(h["*"])$=h["*"];else{if(!o["*"]){P.push(new Qe(t,r[L],`unknown property "${L}"`));continue}$=w}P=P.concat($({key:(t&&`${t}.`)+L,value:r[L],valueSpec:U,style:y,styleSpec:_,object:r,objectKey:L,validateSpec:w},r))}for(const L in o)h[L]||o[L].required&&o[L].default===void 0&&r[L]===void 0&&P.push(new Qe(t,r,`missing required property "${L}"`));return P}function Ui(n){const t=n.value,r=n.valueSpec,o=n.style,h=n.styleSpec,y=n.key,_=n.arrayElementValidator||n.validateSpec;if(sr(t)!=="array")return[new Qe(y,t,`array expected, ${sr(t)} found`)];if(r.length&&t.length!==r.length)return[new Qe(y,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Qe(y,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let w={type:r.value,values:r.values};h.$version<7&&(w.function=r.function),sr(r.value)==="object"&&(w=r.value);let P=[];for(let I=0;I<t.length;I++)P=P.concat(_({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:n.validateSpec,style:o,styleSpec:h,key:`${y}[${I}]`}));return P}function bo(n){const t=n.key,r=n.value,o=n.valueSpec;let h=sr(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new Qe(t,r,`number expected, ${h} found`)]:"minimum"in o&&r<o.minimum?[new Qe(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Qe(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Ha(n){const t=n.valueSpec,r=Dr(n.value.type);let o,h,y,_={};const w=r!=="categorical"&&n.value.property===void 0,P=!w,I=sr(n.value.stops)==="array"&&sr(n.value.stops[0])==="array"&&sr(n.value.stops[0][0])==="object",L=Hn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function($){if(r==="identity")return[new Qe($.key,$.value,'identity function may not have a "stops" property')];let q=[];const H=$.value;return q=q.concat(Ui({key:$.key,value:H,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:F})),sr(H)==="array"&&H.length===0&&q.push(new Qe($.key,H,"array must have at least one stop")),q},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return r==="identity"&&w&&L.push(new Qe(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||L.push(new Qe(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!pu(n.valueSpec)&&L.push(new Qe(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(P&&!_o(n.valueSpec)?L.push(new Qe(n.key,n.value,"property functions not supported")):w&&!vo(n.valueSpec)&&L.push(new Qe(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!I||n.value.property!==void 0||L.push(new Qe(n.key,n.value,'"property" property is required')),L;function F($){let q=[];const H=$.value,ee=$.key;if(sr(H)!=="array")return[new Qe(ee,H,`array expected, ${sr(H)} found`)];if(H.length!==2)return[new Qe(ee,H,`array length 2 expected, length ${H.length} found`)];if(I){if(sr(H[0])!=="object")return[new Qe(ee,H,`object expected, ${sr(H[0])} found`)];if(H[0].zoom===void 0)return[new Qe(ee,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Qe(ee,H,"object stop key must have value")];if(y&&y>Dr(H[0].zoom))return[new Qe(ee,H[0].zoom,"stop zoom values must appear in ascending order")];Dr(H[0].zoom)!==y&&(y=Dr(H[0].zoom),h=void 0,_={}),q=q.concat(Hn({key:`${ee}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:bo,value:U}}))}else q=q.concat(U({key:`${ee}[0]`,value:H[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},H));return ss(Sa(H[1]))?q.concat([new Qe(`${ee}[1]`,H[1],"expressions are not allowed in function stops.")]):q.concat($.validateSpec({key:`${ee}[1]`,value:H[1],valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function U($,q){const H=sr($.value),ee=Dr($.value),ae=$.value!==null?$.value:q;if(o){if(H!==o)return[new Qe($.key,ae,`${H} stop domain type must match previous stop domain type ${o}`)]}else o=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Qe($.key,ae,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&r!=="categorical"){let Se=`number expected, ${H} found`;return _o(t)&&r===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe($.key,ae,Se)]}return r!=="categorical"||H!=="number"||isFinite(ee)&&Math.floor(ee)===ee?r!=="categorical"&&H==="number"&&h!==void 0&&ee<h?[new Qe($.key,ae,"stop domain values must appear in ascending order")]:(h=ee,r==="categorical"&&ee in _?[new Qe($.key,ae,"stop domain values must be unique")]:(_[ee]=!0,[])):[new Qe($.key,ae,`integer expected, found ${ee}`)]}}function wo(n){const t=(n.expressionContext==="property"?fu:Cl)(Sa(n.value),n.valueSpec);if(t.result==="error")return t.value.map((o=>new Qe(`${n.key}${o.key}`,n.value,o.message)));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Qe(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!wl(r))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!wl(r))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!hu(r,["zoom","feature-state"]))return[new Qe(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!cu(r))return[new Qe(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rc(n){const t=n.key,r=n.value,o=sr(r);return o!=="string"?[new Qe(t,r,`color expected, ${o} found`)]:tr.parse(String(r))?[]:[new Qe(t,r,`color expected, "${r}" found`)]}function So(n){const t=n.key,r=n.value,o=n.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(Dr(r))===-1&&h.push(new Qe(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Dr(r))===-1&&h.push(new Qe(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function To(n){return Qu(Sa(n.value))?wo(Mn({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):El(n)}function El(n){const t=n.value,r=n.key;if(sr(t)!=="array")return[new Qe(r,t,`array expected, ${sr(t)} found`)];const o=n.styleSpec;let h,y=[];if(t.length<1)return[new Qe(r,t,"filter array must have at least 1 element")];switch(y=y.concat(So({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Dr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Dr(t[1])==="$type"&&y.push(new Qe(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new Qe(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=sr(t[1]),h!=="string"&&y.push(new Qe(`${r}[1]`,t[1],`string expected, ${h} found`)));for(let _=2;_<t.length;_++)h=sr(t[_]),Dr(t[1])==="$type"?y=y.concat(So({key:`${r}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&y.push(new Qe(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)y=y.concat(El({key:`${r}[${_}]`,value:t[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=sr(t[1]),t.length!==2?y.push(new Qe(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&y.push(new Qe(`${r}[1]`,t[1],`string expected, ${h} found`))}return y}function Rs(n,t){const r=n.key,o=n.validateSpec,h=n.style,y=n.styleSpec,_=n.value,w=n.objectKey,P=y[`${t}_${n.layerType}`];if(!P)return[];const I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&P[I[1]]&&P[I[1]].transition)return o({key:r,value:_,valueSpec:y.transition,style:h,styleSpec:y});const L=n.valueSpec||P[w];if(!L)return[new Qe(r,_,`unknown property "${w}"`)];let F;if(sr(_)==="string"&&_o(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(_)))return[new Qe(r,_,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const U=[];return n.layerType==="symbol"&&(w==="text-field"&&h&&!h.glyphs&&U.push(new Qe(r,_,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&du(Sa(_))&&Dr(_.type)==="identity"&&U.push(new Qe(r,_,'"text-font" does not support identity functions'))),U.concat(o({key:n.key,value:_,valueSpec:L,style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:w}))}function vu(n){return Rs(n,"paint")}function nc(n){return Rs(n,"layout")}function Ds(n){let t=[];const r=n.value,o=n.key,h=n.style,y=n.styleSpec;if(sr(r)!=="object")return[new Qe(o,r,`object expected, ${sr(r)} found`)];r.type||r.ref||t.push(new Qe(o,r,'either "type" or "ref" is required'));let _=Dr(r.type);const w=Dr(r.ref);if(r.id){const P=Dr(r.id);for(let I=0;I<n.arrayIndex;I++){const L=h.layers[I];Dr(L.id)===P&&t.push(new Qe(o,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let P;["type","source","source-layer","filter","layout"].forEach((I=>{I in r&&t.push(new Qe(o,r[I],`"${I}" is prohibited for ref layers`))})),h.layers.forEach((I=>{Dr(I.id)===w&&(P=I)})),P?P.ref?t.push(new Qe(o,r.ref,"ref cannot reference another ref layer")):_=Dr(P.type):t.push(new Qe(o,r.ref,`ref layer "${w}" not found`))}else if(_!=="background")if(r.source){const P=h.sources&&h.sources[r.source],I=P&&Dr(P.type);P?I==="vector"&&_==="raster"?t.push(new Qe(o,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"||I!=="raster-dem"&&_==="color-relief"?t.push(new Qe(o,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?t.push(new Qe(o,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new Qe(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&P.lineMetrics||t.push(new Qe(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Qe(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Qe(o,r.source,`source "${r.source}" not found`))}else t.push(new Qe(o,r,'missing required property "source"'));return t=t.concat(Hn({key:o,value:r,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:To,layout:P=>Hn({layer:r,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":I=>nc(Mn({layerType:_},I))}}),paint:P=>Hn({layer:r,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":I=>vu(Mn({layerType:_},I))}})}})),t}function Un(n){const t=n.value,r=n.key,o=sr(t);return o!=="string"?[new Qe(r,t,`string expected, ${o} found`)]:[]}const Nr={promoteId:function({key:n,value:t}){if(sr(t)==="string")return Un({key:n,value:t});{const r=[];for(const o in t)r.push(...Un({key:`${n}.${o}`,value:t[o]}));return r}}};function pr(n){const t=n.value,r=n.key,o=n.styleSpec,h=n.style,y=n.validateSpec;if(!t.type)return[new Qe(r,t,'"type" is required')];const _=Dr(t.type);let w;switch(_){case"vector":case"raster":return w=Hn({key:r,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Nr,validateSpec:y}),w;case"raster-dem":return w=(function(P){var I;const L=(I=P.sourceName)!==null&&I!==void 0?I:"",F=P.value,U=P.styleSpec,$=U.source_raster_dem,q=P.style;let H=[];const ee=sr(F);if(F===void 0)return H;if(ee!=="object")return H.push(new Qe("source_raster_dem",F,`object expected, ${ee} found`)),H;const ae=Dr(F.encoding)==="custom",Se=["redFactor","greenFactor","blueFactor","baseShift"],he=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const fe in F)!ae&&Se.includes(fe)?H.push(new Qe(fe,F[fe],`In "${L}": "${fe}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):$[fe]?H=H.concat(P.validateSpec({key:fe,value:F[fe],valueSpec:$[fe],validateSpec:P.validateSpec,style:q,styleSpec:U})):H.push(new Qe(fe,F[fe],`unknown property "${fe}"`));return H})({sourceName:r,value:t,style:n.style,styleSpec:o,validateSpec:y}),w;case"geojson":if(w=Hn({key:r,value:t,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:y,objectElementValidators:Nr}),t.cluster)for(const P in t.clusterProperties){const[I,L]=t.clusterProperties[P],F=typeof I=="string"?[I,["accumulated"],["get",P]]:I;w.push(...wo({key:`${r}.${P}.map`,value:L,expressionContext:"cluster-map"})),w.push(...wo({key:`${r}.${P}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return w;case"video":return Hn({key:r,value:t,valueSpec:o.source_video,style:h,validateSpec:y,styleSpec:o});case"image":return Hn({key:r,value:t,valueSpec:o.source_image,style:h,validateSpec:y,styleSpec:o});case"canvas":return[new Qe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return So({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Vi(n){const t=n.value,r=n.styleSpec,o=r.light,h=n.style;let y=[];const _=sr(t);if(t===void 0)return y;if(_!=="object")return y=y.concat([new Qe("light",t,`object expected, ${_} found`)]),y;for(const w in t){const P=w.match(/^(.*)-transition$/);y=y.concat(P&&o[P[1]]&&o[P[1]].transition?n.validateSpec({key:w,value:t[w],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):o[w]?n.validateSpec({key:w,value:t[w],valueSpec:o[w],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Qe(w,t[w],`unknown property "${w}"`)])}return y}function Vn(n){const t=n.value,r=n.styleSpec,o=r.sky,h=n.style,y=sr(t);if(t===void 0)return[];if(y!=="object")return[new Qe("sky",t,`object expected, ${y} found`)];let _=[];for(const w in t)_=_.concat(o[w]?n.validateSpec({key:w,value:t[w],valueSpec:o[w],style:h,styleSpec:r}):[new Qe(w,t[w],`unknown property "${w}"`)]);return _}function hi(n){const t=n.value,r=n.styleSpec,o=r.terrain,h=n.style;let y=[];const _=sr(t);if(t===void 0)return y;if(_!=="object")return y=y.concat([new Qe("terrain",t,`object expected, ${_} found`)]),y;for(const w in t)y=y.concat(o[w]?n.validateSpec({key:w,value:t[w],valueSpec:o[w],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Qe(w,t[w],`unknown property "${w}"`)]);return y}function ls(n){let t=[];const r=n.value,o=n.key;if(Array.isArray(r)){const h=[],y=[];for(const _ in r)r[_].id&&h.includes(r[_].id)&&t.push(new Qe(o,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),h.push(r[_].id),r[_].url&&y.includes(r[_].url)&&t.push(new Qe(o,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),y.push(r[_].url),t=t.concat(Hn({key:`${o}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Un({key:o,value:r})}function Ta(n){return t=n.value,t&&t.constructor===Object?[]:[new Qe(n.key,n.value,`object expected, ${sr(n.value)} found`)];var t}const ri={"*":()=>[],array:Ui,boolean:function(n){const t=n.value,r=n.key,o=sr(t);return o!=="boolean"?[new Qe(r,t,`boolean expected, ${o} found`)]:[]},number:bo,color:rc,constants:_u,enum:So,filter:To,function:Ha,layer:Ds,object:Hn,source:pr,light:Vi,sky:Vn,terrain:hi,projection:function(n){const t=n.value,r=n.styleSpec,o=r.projection,h=n.style,y=sr(t);if(t===void 0)return[];if(y!=="object")return[new Qe("projection",t,`object expected, ${y} found`)];let _=[];for(const w in t)_=_.concat(o[w]?n.validateSpec({key:w,value:t[w],valueSpec:o[w],style:h,styleSpec:r}):[new Qe(w,t[w],`unknown property "${w}"`)]);return _},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const o=sr(r);return o!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(r)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(r)?["array","string"].includes(o)?[]:[new Qe(t,r,`projection expected, invalid type "${o}" found`)]:[new Qe(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Un,formatted:function(n){return Un(n).length===0?[]:wo(n)},resolvedImage:function(n){return Un(n).length===0?[]:wo(n)},padding:function(n){const t=n.key,r=n.value;if(sr(r)==="array"){if(r.length<1||r.length>4)return[new Qe(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let h=[];for(let y=0;y<r.length;y++)h=h.concat(n.validateSpec({key:`${t}[${y}]`,value:r[y],validateSpec:n.validateSpec,valueSpec:o}));return h}return bo({key:t,value:r,valueSpec:{}})},numberArray:function(n){const t=n.key,r=n.value;if(sr(r)==="array"){const o={type:"number"};if(r.length<1)return[new Qe(t,r,"array length at least 1 expected, length 0 found")];let h=[];for(let y=0;y<r.length;y++)h=h.concat(n.validateSpec({key:`${t}[${y}]`,value:r[y],validateSpec:n.validateSpec,valueSpec:o}));return h}return bo({key:t,value:r,valueSpec:{}})},colorArray:function(n){const t=n.key,r=n.value;if(sr(r)==="array"){if(r.length<1)return[new Qe(t,r,"array length at least 1 expected, length 0 found")];let o=[];for(let h=0;h<r.length;h++)o=o.concat(rc({key:`${t}[${h}]`,value:r[h]}));return o}return rc({key:t,value:r})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,o=sr(r),h=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Qe(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let _=0;_<r.length;_+=2)y=y.concat(So({key:`${t}[${_}]`,value:r[_],valueSpec:h.layout_symbol["text-anchor"]})),y=y.concat(Ui({key:`${t}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return y},sprite:ls,state:Ta};function Co(n){const t=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=Co,r.expression&&du(Dr(t))?Ha(n):r.expression&&ss(Sa(t))?wo(n):r.type&&ri[r.type]?ri[r.type](n):Hn(Mn({},n,{valueSpec:r.type?o[r.type]:r}))}function rh(n){const t=n.value,r=n.key,o=Un(n);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Qe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Qe(r,t,'"glyphs" url must include a "{range}" token'))),o}function pi(n,t=Te){let r=[];return r=r.concat(Co({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Co,objectElementValidators:{glyphs:rh,"*":()=>[]}})),n.constants&&(r=r.concat(_u({key:"constants",value:n.constants}))),Ns(r)}function Mi(n){return function(t){return n({...t,validateSpec:Co})}}function Ns(n){return[].concat(n).sort(((t,r)=>t.line-r.line))}function An(n){return function(...t){return Ns(n.apply(this,t))}}pi.source=An(Mi(pr)),pi.sprite=An(Mi(ls)),pi.glyphs=An(Mi(rh)),pi.light=An(Mi(Vi)),pi.sky=An(Mi(Vn)),pi.terrain=An(Mi(hi)),pi.state=An(Mi(Ta)),pi.layer=An(Mi(Ds)),pi.filter=An(Mi(To)),pi.paintProperty=An(Mi(vu)),pi.layoutProperty=An(Mi(nc));const Po=pi,nh=Po.light,Il=Po.sky,ed=Po.paintProperty,us=Po.layoutProperty;function Wa(n,t){let r=!1;if(t&&t.length)for(const o of t)n.fire(new $e(new Error(o.message))),r=!0;return r}class Xa{constructor(t,r,o){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(r=_[1])+2*(o=_[2]);for(let P=0;P<this.d*this.d;P++){const I=_[3+P],L=_[3+P+1];h.push(I===L?null:_.subarray(I,L))}const w=_[3+h.length+1];this.keys=_.subarray(_[3+h.length],w),this.bboxes=_.subarray(w),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let _=0;_<this.d*this.d;_++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const y=o/r*t;this.min=-y,this.max=t+y}insert(t,r,o,h,y){this._forEachCell(r,o,h,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,h,y,_){this.cells[y].push(_)}query(t,r,o,h,y){const _=this.min,w=this.max;if(t<=_&&r<=_&&w<=o&&w<=h&&!y)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(t,r,o,h,this._queryCell,P,{},y),P}}_queryCell(t,r,o,h,y,_,w,P){const I=this.cells[y];if(I!==null){const L=this.keys,F=this.bboxes;for(let U=0;U<I.length;U++){const $=I[U];if(w[$]===void 0){const q=4*$;(P?P(F[q+0],F[q+1],F[q+2],F[q+3]):t<=F[q+2]&&r<=F[q+3]&&o>=F[q+0]&&h>=F[q+1])?(w[$]=!0,_.push(L[$])):w[$]=!1}}}}_forEachCell(t,r,o,h,y,_,w,P){const I=this._convertToCellCoord(t),L=this._convertToCellCoord(r),F=this._convertToCellCoord(o),U=this._convertToCellCoord(h);for(let $=I;$<=F;$++)for(let q=L;q<=U;q++){const H=this.d*q+$;if((!P||P(this._convertFromCellCoord($),this._convertFromCellCoord(q),this._convertFromCellCoord($+1),this._convertFromCellCoord(q+1)))&&y.call(this,t,r,o,h,H,_,w,P))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const h=new Int32Array(r+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let y=r;for(let _=0;_<t.length;_++){const w=t[_];h[3+_]=y,h.set(w,y),y+=w.length}return h[3+t.length]=y,h.set(this.keys,y),y+=this.keys.length,h[3+t.length+1]=y,h.set(this.bboxes,y),y+=this.bboxes.length,h.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new Xa(t.buffer)}}const ki={};function mt(n,t,r={}){if(ki[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),ki[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}mt("Object",Object),mt("Set",Set),mt("TransferableGridIndex",Xa),mt("Color",tr),mt("Error",Error),mt("AJAXError",ue),mt("ResolvedImage",Bi),mt("StylePropertyFunction",Ga),mt("StyleExpression",Tl,{omit:["_evaluator"]}),mt("ZoomDependentExpression",Ls),mt("ZoomConstantExpression",zs),mt("CompoundExpression",Oi,{omit:["_evaluate"]});for(const n in is)is[n]._classRegistryKey||mt(`Expression_${n}`,is[n]);function Ei(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function di(n){return n.$name||n.constructor._classRegistryKey}function Mo(n){return!(function(t){if(t===null||typeof t!="object")return!1;const r=di(t);return!(!r||r==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ei(n)||fa(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Ii(n,t){if(Mo(n))return(Ei(n)||fa(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const y=[];for(const _ of n)y.push(Ii(_,t));return y}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=di(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!ki[r])throw new Error(`${r} is not registered.`);const{klass:o}=ki[r],h=o.serialize?o.serialize(n,t):{};if(o.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in n){if(!n.hasOwnProperty(y)||ki[r].omit.indexOf(y)>=0)continue;const _=n[y];h[y]=ki[r].shallow.indexOf(y)>=0?_:Ii(_,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function fi(n){if(Mo(n))return n;if(Array.isArray(n))return n.map(fi);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=di(n)||"Object";if(!ki[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=ki[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const y=n[h];o[h]=ki[t].shallow.indexOf(h)>=0?y:fi(y)}return o}class Ka{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const hr={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Al(n){for(const t of n)if(ic(t.charCodeAt(0)))return!0;return!1}function ih(n){for(const t of n)if(!tn(t.charCodeAt(0)))return!1;return!0}function ni(n){const t=n.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const $i=ni(["Arab","Dupl","Mong","Ougr","Syrc"]);function tn(n){return!$i.test(String.fromCodePoint(n))}const qi=ni(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ic(n){return!(n!==746&&n!==747&&(n<4352||!(hr["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||hr["CJK Compatibility"](n)||hr["CJK Strokes"](n)||!(!hr["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||hr["Enclosed CJK Letters and Months"](n)||hr["Ideographic Description Characters"](n)||hr.Kanbun(n)||hr.Katakana(n)&&n!==12540||!(!hr["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!hr["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||hr["Vertical Forms"](n)||hr["Yijing Hexagram Symbols"](n)||/\p{sc=Cans}/u.test(String.fromCodePoint(n))||/\p{sc=Hang}/u.test(String.fromCodePoint(n))||qi.test(String.fromCodePoint(n)))))}function ah(n){return!(ic(n)||(function(t){return!!(hr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||hr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||hr["Letterlike Symbols"](t)||hr["Number Forms"](t)||hr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||hr["Control Pictures"](t)&&t!==9251||hr["Optical Character Recognition"](t)||hr["Enclosed Alphanumerics"](t)||hr["Geometric Shapes"](t)||hr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||hr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||hr["CJK Symbols and Punctuation"](t)||hr.Katakana(t)||hr["Private Use Area"](t)||hr["CJK Compatibility Forms"](t)||hr["Small Form Variants"](t)||hr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}const ac=ni(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xu(n){return ac.test(String.fromCodePoint(n))}function oh(n,t){return!(!t&&xu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||hr.Khmer(n))}function bu(n){for(const t of n)if(xu(t.charCodeAt(0)))return!0;return!1}const aa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(aa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,o=new Promise((y=>{this.loadScriptResolve=y}));t(r);const h=new Promise((y=>setTimeout((()=>y()),this.TIMEOUT)));if(yield Promise.race([o,h]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:r};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Fr{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new Ka,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ka,this.transition={},this.globalState={})}isSupportedScript(t){return(function(r,o){for(const h of r)if(!oh(h.charCodeAt(0),o))return!1;return!0})(t,aa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class cs{constructor(t,r){this.property=t,this.value=r,this.expression=(function(o,h){if(du(o))return new Ga(o,h);if(ss(o)){const y=fu(o,h);if(y.result==="error")throw new Error(y.value.map((_=>`${_.key}: ${_.message}`)).join(", "));return y.value}{let y=o;return h.type==="color"&&typeof o=="string"?y=tr.parse(o):h.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?h.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?h.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?y=En.parse(o):h.type==="projectionDefinition"&&typeof o=="string"&&(y=Zn.parse(o)):y=Wr.parse(o):y=kn.parse(o):y=cn.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>y}}})(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class sh{constructor(t){this.property=t,this.value=new cs(t,void 0)}transitioned(t,r){return new Ll(this.property,this.value,r,cr({},t.transition,this.transition),t.now)}untransitioned(){return new Ll(this.property,this.value,null,{},0)}}class zl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Pi(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new sh(this._values[t].property)),this._values[t].value=new cs(this._values[t].property,r===null?void 0:Pi(r))}getTransition(t){return Pi(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new sh(this._values[t].property)),this._values[t].transition=Pi(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const h=this.getTransition(r);h!==void 0&&(t[`${r}-transition`]=h)}return t}transitioned(t,r){const o=new oc(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(t,r._values[h]);return o}untransitioned(){const t=new oc(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Ll{constructor(t,r,o,h,y){this.property=t,this.value=r,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const h=t.now||0,y=this.value.possiblyEvaluate(t,r,o),_=this.prior;if(_){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return _.possiblyEvaluate(t,r,o);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,o),y,Wt(w))}}return y}}class oc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const h=new wu(this._properties);for(const y of Object.keys(this._values))h._values[y]=this._values[y].possiblyEvaluate(t,r,o);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class lh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Pi(this._values[t].value)}setValue(t,r){this._values[t]=new cs(this._values[t].property,r===null?void 0:Pi(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const h=new wu(this._properties);for(const y of Object.keys(this._values))h._values[y]=this._values[y].possiblyEvaluate(t,r,o);return h}}class mi{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,h){return this.property.evaluate(this.value,this.parameters,t,r,o,h)}}class wu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class wt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const h=va[this.specification.type];return h?h(t,r,o):t}}class zt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,h){return new mi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,h)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new mi(this,{kind:"constant",value:void 0},t.parameters);const h=va[this.specification.type];if(h){const y=h(t.value.value,r.value.value,o);return new mi(this,{kind:"constant",value:y},t.parameters)}return t}evaluate(t,r,o,h,y,_){return t.kind==="constant"?t.value:t.evaluate(r,o,h,y,_)}}class ko extends zt{possiblyEvaluate(t,r,o,h){if(t.value===void 0)return new mi(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const y=t.expression.evaluate(r,null,{},o,h),_=t.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,w=this._calculate(_,_,_,r);return new mi(this,{kind:"constant",value:w},r)}if(t.expression.kind==="camera"){const y=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new mi(this,{kind:"constant",value:y},r)}return new mi(this,t.expression,r)}evaluate(t,r,o,h,y,_){if(t.kind==="source"){const w=t.evaluate(r,o,h,y,_);return this._calculate(w,w,w,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,h),t.evaluate({zoom:Math.floor(r.zoom)},o,h),t.evaluate({zoom:Math.floor(r.zoom)+1},o,h),r):t.value}_calculate(t,r,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Ya{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const y=t.expression.evaluate(r,null,{},o,h);return this._calculate(y,y,y,r)}return this._calculate(t.expression.evaluate(new Fr(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Fr(Math.floor(r.zoom),r)),t.expression.evaluate(new Fr(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Rl{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,h){return!!t.expression.evaluate(r,null,{},o,h)}interpolate(){return!1}}class Wn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new cs(o,void 0),y=this.defaultTransitionablePropertyValues[r]=new sh(o);this.defaultTransitioningPropertyValues[r]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}mt("DataDrivenProperty",zt),mt("DataConstantProperty",wt),mt("CrossFadedDataDrivenProperty",ko),mt("CrossFadedProperty",Ya),mt("ColorRampProperty",Rl);const sc="-transition";class Xn extends vt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Za(t.filter)),r.layout&&(this._unevaluatedLayout=new lh(r.layout)),r.paint)){this._transitionablePaint=new zl(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wu(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=Za(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const h of o.getGlobalStateRefs())t.add(h)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,o={}){r!=null&&this._validate(us,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(sc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(ed,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(sc))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[t],y=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),w=h.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const P=this._transitionablePaint._values[t].value;return P.isDataDriven()||_||y||this._handleOverridablePaintPropertyUpdate(t,w,P)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),io(t,((r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length)))}_validate(t,r,o,h,y={}){return(!y||y.validate!==!1)&&Wa(this,t.call(Po,{key:r,layerType:this.type,objectKey:o,value:h,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof mi&&_o(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const oa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ca{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ar{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(n,t=1){let r=0,o=0;return{members:n.map((h=>{const y=oa[h.type].BYTES_PER_ELEMENT,_=r=sa(r,Math.max(t,y)),w=h.components||1;return o=Math.max(o,y),r+=y*w,{name:h.name,type:h.type,components:w,offset:_}})),size:sa(r,Math.max(o,t)),alignment:t}}function sa(n,t){return Math.ceil(n/t)*t}class Gi extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const h=2*t;return this.int16[h+0]=r,this.int16[h+1]=o,t}}Gi.prototype.bytesPerElement=4,mt("StructArrayLayout2i4",Gi);class hs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const y=3*t;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=h,t}}hs.prototype.bytesPerElement=6,mt("StructArrayLayout3i6",hs);class lc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,o,h)}emplace(t,r,o,h,y){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=h,this.int16[_+3]=y,t}}lc.prototype.bytesPerElement=8,mt("StructArrayLayout4i8",lc);class Ai extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,o,h,y,_)}emplace(t,r,o,h,y,_,w){const P=6*t;return this.int16[P+0]=r,this.int16[P+1]=o,this.int16[P+2]=h,this.int16[P+3]=y,this.int16[P+4]=_,this.int16[P+5]=w,t}}Ai.prototype.bytesPerElement=12,mt("StructArrayLayout2i4i12",Ai);class zi extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,o,h,y,_)}emplace(t,r,o,h,y,_,w){const P=4*t,I=8*t;return this.int16[P+0]=r,this.int16[P+1]=o,this.uint8[I+4]=h,this.uint8[I+5]=y,this.uint8[I+6]=_,this.uint8[I+7]=w,t}}zi.prototype.bytesPerElement=8,mt("StructArrayLayout2i4ub8",zi);class ps extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const h=2*t;return this.float32[h+0]=r,this.float32[h+1]=o,t}}ps.prototype.bytesPerElement=8,mt("StructArrayLayout2f8",ps);class Su extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_,w,P,I,L){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,o,h,y,_,w,P,I,L)}emplace(t,r,o,h,y,_,w,P,I,L,F){const U=10*t;return this.uint16[U+0]=r,this.uint16[U+1]=o,this.uint16[U+2]=h,this.uint16[U+3]=y,this.uint16[U+4]=_,this.uint16[U+5]=w,this.uint16[U+6]=P,this.uint16[U+7]=I,this.uint16[U+8]=L,this.uint16[U+9]=F,t}}Su.prototype.bytesPerElement=20,mt("StructArrayLayout10ui20",Su);class Ja extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_,w,P,I,L,F,U){const $=this.length;return this.resize($+1),this.emplace($,t,r,o,h,y,_,w,P,I,L,F,U)}emplace(t,r,o,h,y,_,w,P,I,L,F,U,$){const q=12*t;return this.int16[q+0]=r,this.int16[q+1]=o,this.int16[q+2]=h,this.int16[q+3]=y,this.uint16[q+4]=_,this.uint16[q+5]=w,this.uint16[q+6]=P,this.uint16[q+7]=I,this.int16[q+8]=L,this.int16[q+9]=F,this.int16[q+10]=U,this.int16[q+11]=$,t}}Ja.prototype.bytesPerElement=24,mt("StructArrayLayout4i4ui4i24",Ja);class uc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const y=3*t;return this.float32[y+0]=r,this.float32[y+1]=o,this.float32[y+2]=h,t}}uc.prototype.bytesPerElement=12,mt("StructArrayLayout3f12",uc);class Fs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Fs.prototype.bytesPerElement=4,mt("StructArrayLayout1ul4",Fs);class Zi extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_,w,P,I){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,o,h,y,_,w,P,I)}emplace(t,r,o,h,y,_,w,P,I,L){const F=10*t,U=5*t;return this.int16[F+0]=r,this.int16[F+1]=o,this.int16[F+2]=h,this.int16[F+3]=y,this.int16[F+4]=_,this.int16[F+5]=w,this.uint32[U+3]=P,this.uint16[F+8]=I,this.uint16[F+9]=L,t}}Zi.prototype.bytesPerElement=20,mt("StructArrayLayout6i1ul2ui20",Zi);class Bs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,o,h,y,_)}emplace(t,r,o,h,y,_,w){const P=6*t;return this.int16[P+0]=r,this.int16[P+1]=o,this.int16[P+2]=h,this.int16[P+3]=y,this.int16[P+4]=_,this.int16[P+5]=w,t}}Bs.prototype.bytesPerElement=12,mt("StructArrayLayout2i2i2i12",Bs);class m extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,h,y)}emplace(t,r,o,h,y,_){const w=4*t,P=8*t;return this.float32[w+0]=r,this.float32[w+1]=o,this.float32[w+2]=h,this.int16[P+6]=y,this.int16[P+7]=_,t}}m.prototype.bytesPerElement=16,mt("StructArrayLayout2f1f2i16",m);class e extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,o,h,y,_)}emplace(t,r,o,h,y,_,w){const P=16*t,I=4*t,L=8*t;return this.uint8[P+0]=r,this.uint8[P+1]=o,this.float32[I+1]=h,this.float32[I+2]=y,this.int16[L+6]=_,this.int16[L+7]=w,t}}e.prototype.bytesPerElement=16,mt("StructArrayLayout2ub2f2i16",e);class i extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const y=3*t;return this.uint16[y+0]=r,this.uint16[y+1]=o,this.uint16[y+2]=h,t}}i.prototype.bytesPerElement=6,mt("StructArrayLayout3ui6",i);class u extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae){const Se=this.length;return this.resize(Se+1),this.emplace(Se,t,r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae)}emplace(t,r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae,Se){const he=24*t,fe=12*t,Ie=48*t;return this.int16[he+0]=r,this.int16[he+1]=o,this.uint16[he+2]=h,this.uint16[he+3]=y,this.uint32[fe+2]=_,this.uint32[fe+3]=w,this.uint32[fe+4]=P,this.uint16[he+10]=I,this.uint16[he+11]=L,this.uint16[he+12]=F,this.float32[fe+7]=U,this.float32[fe+8]=$,this.uint8[Ie+36]=q,this.uint8[Ie+37]=H,this.uint8[Ie+38]=ee,this.uint32[fe+10]=ae,this.int16[he+22]=Se,t}}u.prototype.bytesPerElement=48,mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",u);class p extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae,Se,he,fe,Ie,je,Xe,dt,at,ct,At,ot){const ht=this.length;return this.resize(ht+1),this.emplace(ht,t,r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae,Se,he,fe,Ie,je,Xe,dt,at,ct,At,ot)}emplace(t,r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae,Se,he,fe,Ie,je,Xe,dt,at,ct,At,ot,ht){const qe=32*t,jt=16*t;return this.int16[qe+0]=r,this.int16[qe+1]=o,this.int16[qe+2]=h,this.int16[qe+3]=y,this.int16[qe+4]=_,this.int16[qe+5]=w,this.int16[qe+6]=P,this.int16[qe+7]=I,this.uint16[qe+8]=L,this.uint16[qe+9]=F,this.uint16[qe+10]=U,this.uint16[qe+11]=$,this.uint16[qe+12]=q,this.uint16[qe+13]=H,this.uint16[qe+14]=ee,this.uint16[qe+15]=ae,this.uint16[qe+16]=Se,this.uint16[qe+17]=he,this.uint16[qe+18]=fe,this.uint16[qe+19]=Ie,this.uint16[qe+20]=je,this.uint16[qe+21]=Xe,this.uint16[qe+22]=dt,this.uint32[jt+12]=at,this.float32[jt+13]=ct,this.float32[jt+14]=At,this.uint16[qe+30]=ot,this.uint16[qe+31]=ht,t}}p.prototype.bytesPerElement=64,mt("StructArrayLayout8i15ui1ul2f2ui64",p);class g extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}g.prototype.bytesPerElement=4,mt("StructArrayLayout1f4",g);class x extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const y=3*t;return this.uint16[6*t+0]=r,this.float32[y+1]=o,this.float32[y+2]=h,t}}x.prototype.bytesPerElement=12,mt("StructArrayLayout1ui2f12",x);class M extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const y=4*t;return this.uint32[2*t+0]=r,this.uint16[y+2]=o,this.uint16[y+3]=h,t}}M.prototype.bytesPerElement=8,mt("StructArrayLayout1ul2ui8",M);class k extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const h=2*t;return this.uint16[h+0]=r,this.uint16[h+1]=o,t}}k.prototype.bytesPerElement=4,mt("StructArrayLayout2ui4",k);class z extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}z.prototype.bytesPerElement=2,mt("StructArrayLayout1ui2",z);class R extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,h){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,o,h)}emplace(t,r,o,h,y){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=h,this.float32[_+3]=y,t}}R.prototype.bytesPerElement=16,mt("StructArrayLayout4f16",R);class j extends Ca{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}j.prototype.size=20;class B extends Zi{get(t){return new j(this,t)}}mt("CollisionBoxArray",B);class O extends Ca{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}O.prototype.size=48;class G extends u{get(t){return new O(this,t)}}mt("PlacedSymbolArray",G);class J extends Ca{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}J.prototype.size=64;class te extends p{get(t){return new J(this,t)}}mt("SymbolInstanceArray",te);class re extends g{getoffsetX(t){return this.float32[1*t+0]}}mt("GlyphOffsetArray",re);class ne extends hs{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}mt("SymbolLineVertexArray",ne);class ce extends Ca{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ce.prototype.size=12;class ie extends x{get(t){return new ce(this,t)}}mt("TextAnchorOffsetArray",ie);class de extends Ca{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}de.prototype.size=8;class me extends M{get(t){return new de(this,t)}}mt("FeatureIndexArray",me);class se extends Gi{}class _e extends Gi{}class Ee extends Gi{}class Me extends Ai{}class ke extends zi{}class De extends ps{}class tt extends Su{}class it extends Ja{}class We extends uc{}class St extends Fs{}class Jt extends Bs{}class Sr extends e{}class Br extends i{}class zr extends k{}const Hr=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:rn}=Hr;class Zt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,o,h){const y=this.segments[this.segments.length-1];return t>Zt.MAX_VERTEX_ARRAY_LENGTH&&an(`Max vertices per segment is ${Zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Zt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+t>Zt.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h?this.createNewSegment(r,o,h):y}createNewSegment(t,r,o){const h={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,r,o){return this.prepareSegment(0,t,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,h){return new Zt([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Er(n,t){return 256*(n=Qt(Math.floor(n),0,255))+Qt(Math.floor(t),0,255)}Zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt("SegmentVector",Zt);const gn=on([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var yn,zn,ii,la={exports:{}},Eo={exports:{}},Qa={exports:{}},js=(function(){if(ii)return la.exports;ii=1;var n=(yn||(yn=1,Eo.exports=function(r,o){var h,y,_,w,P,I,L,F;for(y=r.length-(h=3&r.length),_=o,P=3432918353,I=461845907,F=0;F<y;)L=255&r.charCodeAt(F)|(255&r.charCodeAt(++F))<<8|(255&r.charCodeAt(++F))<<16|(255&r.charCodeAt(++F))<<24,++F,_=27492+(65535&(w=5*(65535&(_=(_^=L=(65535&(L=(L=(65535&L)*P+(((L>>>16)*P&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(L=0,h){case 3:L^=(255&r.charCodeAt(F+2))<<16;case 2:L^=(255&r.charCodeAt(F+1))<<8;case 1:_^=L=(65535&(L=(L=(65535&(L^=255&r.charCodeAt(F)))*P+(((L>>>16)*P&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Eo.exports),t=(zn||(zn=1,Qa.exports=function(r,o){for(var h,y=r.length,_=o^y,w=0;y>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++w;switch(y){case 3:_^=(255&r.charCodeAt(w+2))<<16;case 2:_^=(255&r.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Qa.exports);return la.exports=n,la.exports.murmur3=n,la.exports.murmur2=t,la.exports})(),Os=V(js);class ds{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,h){this.ids.push(Us(t)),this.positions.push(r,o,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Us(t);let o=0,h=this.ids.length-1;for(;o<h;){const _=o+h>>1;this.ids[_]>=r?h=_:o=_+1}const y=[];for(;this.ids[o]===r;)y.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return y}static serialize(t,r){const o=new Float64Array(t.ids),h=new Uint32Array(t.positions);return gi(o,h,0,o.length-1),r&&r.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(t){const r=new ds;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Us(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Os(String(n))}function gi(n,t,r,o){for(;r<o;){const h=n[r+o>>1];let y=r-1,_=o+1;for(;;){do y++;while(n[y]<h);do _--;while(n[_]>h);if(y>=_)break;Pa(n,y,_),Pa(t,3*y,3*_),Pa(t,3*y+1,3*_+1),Pa(t,3*y+2,3*_+2)}_-r<o-_?(gi(n,t,r,_),r=_+1):(gi(n,t,_+1,o),o=_)}}function Pa(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}mt("FeaturePositionMap",ds);class yi{constructor(t,r){this.gl=t.gl,this.location=r}}class Io extends yi{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class _n extends yi{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Sn extends yi{constructor(t,r){super(t,r),this.current=tr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const _i=new Float32Array(16);function Tn(n){return[Er(255*n.r,255*n.g),Er(255*n.b,255*n.a)]}class Tu{constructor(t,r,o){this.value=t,this.uniformNames=r.map((h=>`u_${h}`)),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new Sn(t,r):new Io(t,r)}}class Dl{constructor(t,r){this.uniformNames=r.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,h){const y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new _n(t,r):new Io(t,r)}}class Ln{constructor(t,r,o,h){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(t,r,o,h,y){const _=this.paintVertexArray.length,w=this.expression.evaluate(new Fr(0),r,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(_,t,w)}updatePaintArray(t,r,o,h){const y=this.expression.evaluate({zoom:0},o,h);this._setPaintValue(t,r,y)}_setPaintValue(t,r,o){if(this.type==="color"){const h=Tn(o);for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,h[0],h[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hi{constructor(t,r,o,h,y,_){this.expression=t,this.uniformNames=r.map((w=>`u_${w}_t`)),this.type=o,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=r.map((w=>({name:`a_${w}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,r,o,h,y){const _=this.expression.evaluate(new Fr(this.zoom),r,{},h,[],y),w=this.expression.evaluate(new Fr(this.zoom+1),r,{},h,[],y),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,_,w)}updatePaintArray(t,r,o,h){const y=this.expression.evaluate({zoom:this.zoom},o,h),_=this.expression.evaluate({zoom:this.zoom+1},o,h);this._setPaintValue(t,r,y,_)}_setPaintValue(t,r,o,h){if(this.type==="color"){const y=Tn(o),_=Tn(h);for(let w=t;w<r;w++)this.paintVertexArray.emplace(w,y[0],y[1],_[0],_[1])}else{for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Qt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,r,o){return new Io(t,r)}}class Ma{constructor(t,r,o,h,y,_){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,r,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,h,y){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],y)}_setPaintValues(t,r,o,h){if(!h||!o)return;const{min:y,mid:_,max:w}=o,P=h[y],I=h[_],L=h[w];if(P&&I&&L)for(let F=t;F<r;F++)this.zoomInPaintVertexArray.emplace(F,I.tl[0],I.tl[1],I.br[0],I.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],I.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,I.tl[0],I.tl[1],I.br[0],I.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],I.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,gn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,gn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class uh{constructor(t,r,o){this.binders={},this._buffers=[];const h=[];for(const y in t.paint._values){if(!o(y))continue;const _=t.paint.get(y);if(!(_ instanceof mi&&_o(_.property.specification)))continue;const w=ch(y,t.type),P=_.value,I=_.property.specification.type,L=_.property.useIntegerZoom,F=_.property.specification["property-type"],U=F==="cross-faded"||F==="cross-faded-data-driven";if(P.kind==="constant")this.binders[y]=U?new Dl(P.value,w):new Tu(P.value,w,I),h.push(`/u_${y}`);else if(P.kind==="source"||U){const $=Cu(y,I,"source");this.binders[y]=U?new Ma(P,I,L,r,$,t.id):new Ln(P,w,I,$),h.push(`/a_${y}`)}else{const $=Cu(y,I,"composite");this.binders[y]=new Hi(P,w,I,L,r,$),h.push(`/z_${y}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Ln||r instanceof Hi?r.maxValue:0}populatePaintArrays(t,r,o,h,y){for(const _ in this.binders){const w=this.binders[_];(w instanceof Ln||w instanceof Hi||w instanceof Ma)&&w.populatePaintArray(t,r,o,h,y)}}setConstantPatternPositions(t,r){for(const o in this.binders){const h=this.binders[o];h instanceof Dl&&h.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,h,y){let _=!1;for(const w in t){const P=r.getPositions(w);for(const I of P){const L=o.feature(I.index);for(const F in this.binders){const U=this.binders[F];if((U instanceof Ln||U instanceof Hi||U instanceof Ma)&&U.expression.isStateDependent===!0){const $=h.paint.get(F);U.expression=$.value,U.updatePaintArray(I.start,I.end,L,t[w],y),_=!0}}}}return _}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Tu||o instanceof Dl)&&t.push(...o.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ln||o instanceof Hi)for(let h=0;h<o.paintVertexAttributes.length;h++)t.push(o.paintVertexAttributes[h].name);else if(o instanceof Ma)for(let h=0;h<gn.members.length;h++)t.push(gn.members[h].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Tu||o instanceof Dl||o instanceof Hi)for(const h of o.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const h in this.binders){const y=this.binders[h];if(y instanceof Tu||y instanceof Dl||y instanceof Hi){for(const _ of y.uniformNames)if(r[_]){const w=y.getBinding(t,r[_],_);o.push({name:_,property:h,binding:w})}}}return o}setUniforms(t,r,o,h){for(const{name:y,property:_,binding:w}of r)this.binders[_].setUniform(w,h,o.get(_),y)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof Ma){const h=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof Ln||o instanceof Hi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof Ln||o instanceof Hi||o instanceof Ma)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Ln||r instanceof Hi||r instanceof Ma)&&r.destroy()}}}class Li{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new uh(h,r,o);this.needsUpload=!1,this._featureMap=new ds,this._bufferOffset=0}populatePaintArrays(t,r,o,h,y,_){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,r,h,y,_);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,h){for(const y of o)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,r,y,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ch(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Cu(n,t,r){const o={color:{source:ps,composite:R},number:{source:g,composite:ps}},h=(function(y){return{"line-pattern":{source:tt,composite:tt},"fill-pattern":{source:tt,composite:tt},"fill-extrusion-pattern":{source:tt,composite:tt}}[y]})(n);return h&&h[r]||o[t][r]}mt("ConstantBinder",Tu),mt("CrossFadedConstantBinder",Dl),mt("SourceExpressionBinder",Ln),mt("CrossFadedCompositeBinder",Ma),mt("CompositeExpressionBinder",Hi),mt("ProgramConfiguration",uh,{omit:["_buffers"]}),mt("ProgramConfigurationSet",Li);const Ao=Math.pow(2,14)-1,Nl=-Ao-1;function eo(n){const t=_t/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){const h=r[o];for(let y=0;y<h.length;y++){const _=h[y],w=Math.round(_.x*t),P=Math.round(_.y*t);_.x=Qt(w,Nl,Ao),_.y=Qt(P,Nl,Ao),(w<_.x||w>_.x+1||P<_.y||P>_.y+1)&&an("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function zo(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?eo(n):[]}}const td=-32768;function af(n,t,r,o,h){n.emplaceBack(td+8*t+o,td+8*r+h)}class cp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.indexArray=new Br,this.segments=new Zt,this.programConfigurations=new Li(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){const h=this.layers[0],y=[];let _=null,w=!1,P=h.type==="heatmap";if(h.type==="circle"){const L=h;_=L.layout.get("circle-sort-key"),w=!_.isConstant(),P=P||L.paint.get("circle-pitch-alignment")==="map"}const I=P?r.subdivisionGranularity.circle:1;for(const{feature:L,id:F,index:U,sourceLayerIndex:$}of t){const q=this.layers[0]._featureFilter.needGeometry,H=zo(L,q);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{globalState:this.globalState}),H,o))continue;const ee=w?_.evaluate(H,{},o):void 0,ae={id:F,properties:L.properties,type:L.type,sourceLayerIndex:$,index:U,geometry:q?H.geometry:eo(L),patterns:{},sortKey:ee};y.push(ae)}w&&y.sort(((L,F)=>L.sortKey-F.sortKey));for(const L of y){const{geometry:F,index:U,sourceLayerIndex:$}=L,q=t[U].feature;this.addFeature(L,F,U,o,I),r.featureIndex.insert(q,F,U,$,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,h,y=1){let _;switch(y){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const w=_.length;for(const P of r)for(const I of P){const L=I.x,F=I.y;if(L<0||L>=_t||F<0||F>=_t)continue;const U=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,t.sortKey),$=U.vertexLength;for(let q=0;q<w;q++)for(let H=0;H<w;H++)af(this.layoutVertexArray,L,F,_[H],_[q]);for(let q=0;q<w-1;q++)for(let H=0;H<w-1;H++){const ee=$+q*w+H,ae=$+(q+1)*w+H;this.indexArray.emplaceBack(ee,ae+1,ee+1),this.indexArray.emplaceBack(ee,ae,ae+1)}U.vertexLength+=w*w,U.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},h)}}function rd(n,t){for(let r=0;r<n.length;r++)if(Pu(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Pu(n,t[r]))return!0;return!!vi(n,t)}function of(n,t,r){return!!Pu(n,t)||!!hp(t,n,r)}function sf(n,t){if(n.length===1)return id(t,n[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let h=0;h<o.length;h++)if(Pu(n,o[h]))return!0}for(let r=0;r<n.length;r++)if(id(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(vi(n,t[r]))return!0;return!1}function ua(n,t,r){if(n.length>1){if(vi(n,t))return!0;for(let o=0;o<t.length;o++)if(hp(t[o],n,r))return!0}for(let o=0;o<n.length;o++)if(hp(n[o],t,r))return!0;return!1}function vi(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],h=n[r+1];for(let y=0;y<t.length-1;y++)if(lf(o,h,t[y],t[y+1]))return!0}return!1}function lf(n,t,r,o){return ea(n,r,o)!==ea(t,r,o)&&ea(n,t,r)!==ea(n,t,o)}function hp(n,t,r){const o=r*r;if(t.length===1)return n.distSqr(t[0])<o;for(let h=1;h<t.length;h++)if(nd(n,t[h-1],t[h])<o)return!0;return!1}function nd(n,t,r){const o=t.distSqr(r);if(o===0)return n.distSqr(t);const h=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/o;return n.distSqr(h<0?t:h>1?r:r.sub(t)._mult(h)._add(t))}function id(n,t){let r,o,h,y=!1;for(let _=0;_<n.length;_++){r=n[_];for(let w=0,P=r.length-1;w<r.length;P=w++)o=r[w],h=r[P],o.y>t.y!=h.y>t.y&&t.x<(h.x-o.x)*(t.y-o.y)/(h.y-o.y)+o.x&&(y=!y)}return y}function Pu(n,t){let r=!1;for(let o=0,h=n.length-1;o<n.length;h=o++){const y=n[o],_=n[h];y.y>t.y!=_.y>t.y&&t.x<(_.x-y.x)*(t.y-y.y)/(_.y-y.y)+y.x&&(r=!r)}return r}function ad(n,t,r){const o=r[0],h=r[2];if(n.x<o.x&&t.x<o.x||n.x>h.x&&t.x>h.x||n.y<o.y&&t.y<o.y||n.y>h.y&&t.y>h.y)return!1;const y=ea(n,t,r[0]);return y!==ea(n,t,r[1])||y!==ea(n,t,r[2])||y!==ea(n,t,r[3])}function cc(n,t,r){const o=t.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(n)}function hc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function hh(n,t,r,o,h){if(!t[0]&&!t[1])return n;const y=N.convert(t)._mult(h);r==="viewport"&&y._rotate(-o);const _=[];for(let w=0;w<n.length;w++)_.push(n[w].sub(y));return _}let od,pp;mt("CircleBucket",cp,{omit:["layers"]});var sd={get paint(){return pp=pp||new Wn({"circle-radius":new zt(Te.paint_circle["circle-radius"]),"circle-color":new zt(Te.paint_circle["circle-color"]),"circle-blur":new zt(Te.paint_circle["circle-blur"]),"circle-opacity":new zt(Te.paint_circle["circle-opacity"]),"circle-translate":new wt(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return od=od||new Wn({"circle-sort-key":new zt(Te.layout_circle["circle-sort-key"])})}};class uf extends Xn{constructor(t){super(t,sd)}createBucket(t){return new cp(t)}queryRadius(t){const r=t;return cc("circle-radius",this,r)+cc("circle-stroke-width",this,r)+hc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:y,pixelsToTileUnits:_,unwrappedTileID:w,getElevation:P}){const I=hh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,_),L=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),F=this.paint.get("circle-pitch-alignment")==="map",U=F?I:(function(q,H,ee,ae){return q.map((Se=>dp(Se,H,ee,ae)))})(I,y,w,P),$=F?L*_:L;for(const q of h)for(const H of q){const ee=F?H:dp(H,y,w,P);let ae=$;const Se=y.projectTileCoordinates(H.x,H.y,w,P).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ae*=Se/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ae*=y.cameraToCenterDistance/Se),of(U,ee,ae))return!0}return!1}}function dp(n,t,r,o){const h=t.projectTileCoordinates(n.x,n.y,r,o).point;return new N((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}class ph extends cp{}let cf;mt("HeatmapBucket",ph,{omit:["layers"]});var hf={get paint(){return cf=cf||new Wn({"heatmap-radius":new zt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rl(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Te.paint_heatmap["heatmap-opacity"])})}};function dh(n,{width:t,height:r},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*r*o}`)}else h=new Uint8Array(t*r*o);return n.width=t,n.height=r,n.data=h,n}function ld(n,{width:t,height:r},o){if(t===n.width&&r===n.height)return;const h=dh({},{width:t,height:r},o);pc(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},o),n.width=t,n.height=r,n.data=h.data}function pc(n,t,r,o,h,y){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||o.x>t.width-h.width||o.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,w=t.data;if(_===w)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<h.height;P++){const I=((r.y+P)*n.width+r.x)*y,L=((o.y+P)*t.width+o.x)*y;for(let F=0;F<h.width*y;F++)w[L+F]=_[I+F]}return t}class ka{constructor(t,r){dh(this,t,1,r)}resize(t){ld(this,t,1)}clone(){return new ka({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,h,y){pc(t,r,o,h,y,1)}}class Wi{constructor(t,r){dh(this,t,4,r)}resize(t){ld(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Wi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,h,y){pc(t,r,o,h,y,4)}setPixel(t,r,o){const h=4*(t*this.width+r);this.data[h+0]=Math.round(255*o.r/o.a),this.data[h+1]=Math.round(255*o.g/o.a),this.data[h+2]=Math.round(255*o.b/o.a),this.data[h+3]=Math.round(255*o.a)}}function ud(n){const t={},r=n.resolution||256,o=n.clips?n.clips.length:1,h=n.image||new Wi({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const y=(_,w,P)=>{t[n.evaluationKey]=P;const I=n.expression.evaluate(t);h.setPixel(_/4/r,w/4,I)};if(n.clips)for(let _=0,w=0;_<o;++_,w+=4*r)for(let P=0,I=0;P<r;P++,I+=4){const L=P/(r-1),{start:F,end:U}=n.clips[_];y(w,I,F*(1-L)+U*L)}else for(let _=0,w=0;_<r;_++,w+=4)y(0,w,_/(r-1));return h}mt("AlphaImage",ka),mt("RGBAImage",Wi);const fh="big-fb";class pf extends Xn{createBucket(t){return new ph(t)}constructor(t){super(t,hf),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ud({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(fh)&&this.heatmapFbos.delete(fh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let cd;var mh={get paint(){return cd=cd||new Wn({"hillshade-illumination-direction":new wt(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new wt(Te.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new wt(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new wt(Te.paint_hillshade["hillshade-method"])})}};class Ri extends Xn{constructor(t){super(t,mh),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const y=Math.max(t.length,r.length,o.length,h.length);t=t.concat(Array(y-t.length).fill(t.at(-1))),r=r.concat(Array(y-r.length).fill(r.at(-1))),o=o.concat(Array(y-o.length).fill(o.at(-1))),h=h.concat(Array(y-h.length).fill(h.at(-1)));const _=r.map(Zo);return{directionRadians:t.map(Zo),altitudeRadians:_,shadowColor:h,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let df;var Em={get paint(){return df=df||new Wn({"color-relief-opacity":new wt(Te["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Rl(Te["paint_color-relief"]["color-relief-color"])})}};class dc{constructor(t,r,o,h){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(r,h)}update(t,r,o){const{width:h,height:y}=t,_=!(this.size&&this.size[0]===h&&this.size[1]===y||o),{context:w}=this,{gl:P}=w;if(this.useMipmap=!!(r&&r.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[h,y],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||fa(t)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,h,y,0,this.format,P.UNSIGNED_BYTE,t.data);else{const{x:I,y:L}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||fa(t)?P.texSubImage2D(P.TEXTURE_2D,0,I,L,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,I,L,h,y,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,o){const{context:h}=this,{gl:y}=h;y.bindTexture(y.TEXTURE_2D,this.texture),o!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=y.LINEAR),t!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,t),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,o||t),this.filter=t),r!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class xi{constructor(t,r,o,h=1,y=1,_=1,w=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void an(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const P=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=y,this.blueFactor=_,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<P;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(P,I)]=this.data[this._idx(P-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,P)]=this.data[this._idx(I,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<P;I++)for(let L=0;L<P;L++){const F=this.get(I,L);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(t,r){const o=new Uint8Array(this.data.buffer),h=4*this._idx(t,r);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return ff(t,this.getUnpackVector())}getPixels(){return new Wi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,y=r*this.dim+this.dim,_=o*this.dim,w=o*this.dim+this.dim;switch(r){case-1:h=y-1;break;case 1:y=h+1}switch(o){case-1:_=w-1;break;case 1:w=_+1}const P=-r*this.dim,I=-o*this.dim;for(let L=_;L<w;L++)for(let F=h;F<y;F++)this.data[this._idx(F,L)]=t.data[this._idx(F+P,L+I)]}}function ff(n,t){const r=t[0],o=t[1],h=t[2],y=t[3],_=Math.min(r,o,h),w=Math.round((n+y)/_);return{r:Math.floor(w*_/r)%256,g:Math.floor(w*_/o)%256,b:Math.floor(w*_/h)%256}}mt("DEMData",xi);class kt extends Xn{constructor(t){super(t,Em)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof zs&&o._styleExpression.expression instanceof mn){this.colorRampExpression=o;const _=o._styleExpression.expression;r.elevationStops=_.labels,r.colorStops=[];for(const w of r.elevationStops)r.colorStops.push(_.evaluate({globals:{elevation:w}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[tr.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const h={elevationStops:[],colorStops:[]},y=(r.elevationStops.length-1)/(t-1);for(let _=0;_<r.elevationStops.length-.5;_+=y)h.elevationStops.push(r.elevationStops[Math.round(_)]),h.colorStops.push(r.colorStops[Math.round(_)]);return an(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(r),y=new Wi({width:h.colorStops.length,height:1}),_=new Wi({width:h.colorStops.length,height:1});for(let w=0;w<h.elevationStops.length;w++){const P=ff(h.elevationStops[w],o);_.setPixel(0,w,new tr(P.r/255,P.g/255,P.b/255,1)),y.setPixel(0,w,h.colorStops[w])}return this.colorRampTextures={elevationTexture:new dc(t,_,t.gl.RGBA),colorTexture:new dc(t,y,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const fc=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:hd}=fc;function fp(n,t,r){const o=r.patternDependencies;let h=!1;for(const y of t){const _=y.paint.get(`${n}-pattern`);_.isConstant()||(h=!0);const w=_.constantOr(null);w&&(h=!0,o[w.to]=!0,o[w.from]=!0)}return h}function pd(n,t,r,o,h){const y=h.patternDependencies;for(const _ of t){const w=_.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let P=w.evaluate({zoom:o-1},r,{},h.availableImages),I=w.evaluate({zoom:o},r,{},h.availableImages),L=w.evaluate({zoom:o+1},r,{},h.availableImages);P=P&&P.name?P.name:P,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,y[P]=!0,y[I]=!0,y[L]=!0,r.patterns[_.id]={min:P,mid:I,max:L}}}return r}function mc(n,t,r,o,h){let y;if(h===(function(_,w,P,I){let L=0;for(let F=w,U=P-I;F<P;F+=I)L+=(_[U]-_[F])*(_[F+1]+_[U+1]),U=F;return L})(n,t,r,o)>0)for(let _=t;_<r;_+=o)y=_h(_/o|0,n[_],n[_+1],y);else for(let _=r-o;_>=t;_-=o)y=_h(_/o|0,n[_],n[_+1],y);return y&&gc(y,y.next)&&(ku(y),y=y.next),y}function fs(n,t){if(!n)return n;t||(t=n);let r,o=n;do if(r=!1,o.steiner||!gc(o,o.next)&&jr(o.prev,o,o.next)!==0)o=o.next;else{if(ku(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function Mu(n,t,r,o,h,y,_){if(!n)return;!_&&y&&(function(P,I,L,F){let U=P;do U.z===0&&(U.z=ms(U.x,U.y,I,L,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==P);U.prevZ.nextZ=null,U.prevZ=null,(function($){let q,H=1;do{let ee,ae=$;$=null;let Se=null;for(q=0;ae;){q++;let he=ae,fe=0;for(let je=0;je<H&&(fe++,he=he.nextZ,he);je++);let Ie=H;for(;fe>0||Ie>0&&he;)fe!==0&&(Ie===0||!he||ae.z<=he.z)?(ee=ae,ae=ae.nextZ,fe--):(ee=he,he=he.nextZ,Ie--),Se?Se.nextZ=ee:$=ee,ee.prevZ=Se,Se=ee;ae=he}Se.nextZ=null,H*=2}while(q>1)})(U)})(n,o,h,y);let w=n;for(;n.prev!==n.next;){const P=n.prev,I=n.next;if(y?gf(n,o,h,y):mf(n))t.push(P.i,n.i,I.i),ku(n),n=I.next,w=I.next;else if((n=I)===w){_?_===1?Mu(n=yf(fs(n),t),t,r,o,h,y,2):_===2&&dd(n,t,r,o,h,y):Mu(fs(n),t,r,o,h,y,1);break}}}function mf(n){const t=n.prev,r=n,o=n.next;if(jr(t,r,o)>=0)return!1;const h=t.x,y=r.x,_=o.x,w=t.y,P=r.y,I=o.y,L=Math.min(h,y,_),F=Math.min(w,P,I),U=Math.max(h,y,_),$=Math.max(w,P,I);let q=o.next;for(;q!==t;){if(q.x>=L&&q.x<=U&&q.y>=F&&q.y<=$&&Xi(h,w,y,P,_,I,q.x,q.y)&&jr(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function gf(n,t,r,o){const h=n.prev,y=n,_=n.next;if(jr(h,y,_)>=0)return!1;const w=h.x,P=y.x,I=_.x,L=h.y,F=y.y,U=_.y,$=Math.min(w,P,I),q=Math.min(L,F,U),H=Math.max(w,P,I),ee=Math.max(L,F,U),ae=ms($,q,t,r,o),Se=ms(H,ee,t,r,o);let he=n.prevZ,fe=n.nextZ;for(;he&&he.z>=ae&&fe&&fe.z<=Se;){if(he.x>=$&&he.x<=H&&he.y>=q&&he.y<=ee&&he!==h&&he!==_&&Xi(w,L,P,F,I,U,he.x,he.y)&&jr(he.prev,he,he.next)>=0||(he=he.prevZ,fe.x>=$&&fe.x<=H&&fe.y>=q&&fe.y<=ee&&fe!==h&&fe!==_&&Xi(w,L,P,F,I,U,fe.x,fe.y)&&jr(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;he&&he.z>=ae;){if(he.x>=$&&he.x<=H&&he.y>=q&&he.y<=ee&&he!==h&&he!==_&&Xi(w,L,P,F,I,U,he.x,he.y)&&jr(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;fe&&fe.z<=Se;){if(fe.x>=$&&fe.x<=H&&fe.y>=q&&fe.y<=ee&&fe!==h&&fe!==_&&Xi(w,L,P,F,I,U,fe.x,fe.y)&&jr(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function yf(n,t){let r=n;do{const o=r.prev,h=r.next.next;!gc(o,h)&&gd(o,r,r.next,h)&&yc(o,h)&&yc(h,o)&&(t.push(o.i,r.i,h.i),ku(r),ku(r.next),r=n=h),r=r.next}while(r!==n);return fs(r)}function dd(n,t,r,o,h,y){let _=n;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&vf(_,w)){let P=xf(_,w);return _=fs(_,_.next),P=fs(P,P.next),Mu(_,t,r,o,h,y,0),void Mu(P,t,r,o,h,y,0)}w=w.next}_=_.next}while(_!==n)}function fd(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function bi(n,t){const r=(function(h,y){let _=y;const w=h.x,P=h.y;let I,L=-1/0;if(gc(h,_))return _;do{if(gc(h,_.next))return _.next;if(P<=_.y&&P>=_.next.y&&_.next.y!==_.y){const H=_.x+(P-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(H<=w&&H>L&&(L=H,I=_.x<_.next.x?_:_.next,H===w))return I}_=_.next}while(_!==y);if(!I)return null;const F=I,U=I.x,$=I.y;let q=1/0;_=I;do{if(w>=_.x&&_.x>=U&&w!==_.x&&md(P<$?w:L,P,U,$,P<$?L:w,P,_.x,_.y)){const H=Math.abs(P-_.y)/(w-_.x);yc(_,h)&&(H<q||H===q&&(_.x>I.x||_.x===I.x&&Lo(I,_)))&&(I=_,q=H)}_=_.next}while(_!==F);return I})(n,t);if(!r)return t;const o=xf(r,n);return fs(o,o.next),fs(r,r.next)}function Lo(n,t){return jr(n.prev,n,t.prev)<0&&jr(t.next,n,n.next)<0}function ms(n,t,r,o,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _f(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function md(n,t,r,o,h,y,_,w){return(h-_)*(t-w)>=(n-_)*(y-w)&&(n-_)*(o-w)>=(r-_)*(t-w)&&(r-_)*(y-w)>=(h-_)*(o-w)}function Xi(n,t,r,o,h,y,_,w){return!(n===_&&t===w)&&md(n,t,r,o,h,y,_,w)}function vf(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(r,o){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==o.i&&h.next.i!==o.i&&gd(h,h.next,r,o))return!0;h=h.next}while(h!==r);return!1})(n,t)&&(yc(n,t)&&yc(t,n)&&(function(r,o){let h=r,y=!1;const _=(r.x+o.x)/2,w=(r.y+o.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&_<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(y=!y),h=h.next;while(h!==r);return y})(n,t)&&(jr(n.prev,n,t.prev)||jr(n,t.prev,t))||gc(n,t)&&jr(n.prev,n,n.next)>0&&jr(t.prev,t,t.next)>0)}function jr(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function gc(n,t){return n.x===t.x&&n.y===t.y}function gd(n,t,r,o){const h=yh(jr(n,t,r)),y=yh(jr(n,t,o)),_=yh(jr(r,o,n)),w=yh(jr(r,o,t));return h!==y&&_!==w||!(h!==0||!gh(n,r,t))||!(y!==0||!gh(n,o,t))||!(_!==0||!gh(r,n,o))||!(w!==0||!gh(r,t,o))}function gh(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function yh(n){return n>0?1:n<0?-1:0}function yc(n,t){return jr(n.prev,n,n.next)<0?jr(n,t,n.next)>=0&&jr(n,n.prev,t)>=0:jr(n,t,n.prev)<0||jr(n,n.next,t)<0}function xf(n,t){const r=ca(n.i,n.x,n.y),o=ca(t.i,t.x,t.y),h=n.next,y=t.prev;return n.next=t,t.prev=n,r.next=h,h.prev=r,o.next=r,r.prev=o,y.next=o,o.prev=y,o}function _h(n,t,r,o){const h=ca(n,t,r);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function ku(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ca(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class vr{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Rn{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Rn.noSubdivision=new Rn({fill:new vr(0,0),line:new vr(0,0),tile:new vr(0,0),stencil:new vr(0,0),circle:1}),mt("SubdivisionGranularityExpression",vr),mt("SubdivisionGranularitySetting",Rn);const sn=-32768,Dn=32767;class Ea{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=_t/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),h=0|Math.round(r),y=this._getKey(o,h);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,_),this._vertexBuffer.push(o,h),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(h,y){const _=[];for(let w=0;w<y.length;w+=3){const P=y[w],I=y[w+1],L=y[w+2],F=h[2*P],U=h[2*P+1];(h[2*I]-F)*(h[2*L+1]-U)-(h[2*I+1]-U)*(h[2*L]-F)>0?(_.push(P),_.push(L),_.push(I)):(_.push(P),_.push(I),_.push(L))}return _})(this._vertexBuffer,t);const r=[],o=t.length;for(let h=0;h<o;h+=3){const y=[t[h+0],t[h+1],t[h+2]],_=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let w=1/0,P=1/0,I=-1/0,L=-1/0;for(let H=0;H<3;H++){const ee=_[2*H],ae=_[2*H+1];w=Math.min(w,ee),I=Math.max(I,ee),P=Math.min(P,ae),L=Math.max(L,ae)}if(w===I||P===L)continue;const F=Math.floor(w/this._granularityCellSize),U=Math.ceil(I/this._granularityCellSize),$=Math.floor(P/this._granularityCellSize),q=Math.ceil(L/this._granularityCellSize);if(F!==U||$!==q)for(let H=$;H<q;H++){const ee=this._scanlineGenerateVertexRingForCellRow(H,_,y);vh(this._vertexBuffer,ee,r)}else r.push(...y)}return r}_scanlineGenerateVertexRingForCellRow(t,r,o){const h=t*this._granularityCellSize,y=h+this._granularityCellSize,_=[];for(let w=0;w<3;w++){const P=r[2*w],I=r[2*w+1],L=r[2*(w+1)%6],F=r[(2*(w+1)+1)%6],U=r[2*(w+2)%6],$=r[(2*(w+2)+1)%6],q=L-P,H=F-I,ee=q===0,ae=H===0,Se=(h-I)/H,he=(y-I)/H,fe=Math.min(Se,he),Ie=Math.max(Se,he);if(!ae&&(fe>=1||Ie<=0)||ae&&(I<h||I>y)){F>=h&&F<=y&&_.push(o[(w+1)%3]);continue}!ae&&fe>0&&_.push(this._vertexToIndex(P+q*fe,I+H*fe));const je=P+q*Math.max(fe,0),Xe=P+q*Math.min(Ie,1);ee||this._generateIntraEdgeVertices(_,P,I,L,F,je,Xe),!ae&&Ie<1&&_.push(this._vertexToIndex(P+q*Ie,I+H*Ie)),(ae||F>=h&&F<=y)&&_.push(o[(w+1)%3]),!ae&&(F<=h||F>=y)&&this._generateInterEdgeVertices(_,P,I,L,F,U,$,Xe,h,y)}return _}_generateIntraEdgeVertices(t,r,o,h,y,_,w){const P=h-r,I=y-o,L=I===0,F=L?Math.min(r,h):Math.min(_,w),U=L?Math.max(r,h):Math.max(_,w),$=Math.floor(F/this._granularityCellSize)+1,q=Math.ceil(U/this._granularityCellSize)-1;if(L?r<h:_<w)for(let H=$;H<=q;H++){const ee=H*this._granularityCellSize;t.push(this._vertexToIndex(ee,o+I*(ee-r)/P))}else for(let H=q;H>=$;H--){const ee=H*this._granularityCellSize;t.push(this._vertexToIndex(ee,o+I*(ee-r)/P))}}_generateInterEdgeVertices(t,r,o,h,y,_,w,P,I,L){const F=y-o,U=_-h,$=w-y,q=(I-y)/$,H=(L-y)/$,ee=Math.min(q,H),ae=Math.max(q,H),Se=h+U*ee;let he=Math.floor(Math.min(Se,P)/this._granularityCellSize)+1,fe=Math.ceil(Math.max(Se,P)/this._granularityCellSize)-1,Ie=P<Se;const je=$===0;if(je&&(w===I||w===L))return;if(je||ee>=1||ae<=0){const dt=o-w,at=_+(r-_)*Math.min((I-w)/dt,(L-w)/dt);he=Math.floor(Math.min(at,P)/this._granularityCellSize)+1,fe=Math.ceil(Math.max(at,P)/this._granularityCellSize)-1,Ie=P<at}const Xe=F>0?L:I;if(Ie)for(let dt=he;dt<=fe;dt++)t.push(this._vertexToIndex(dt*this._granularityCellSize,Xe));else for(let dt=fe;dt>=he;dt--)t.push(this._vertexToIndex(dt*this._granularityCellSize,Xe))}_generateOutline(t){const r=[];for(const o of t){const h=ln(o,this._granularity,!0),y=this._pointArrayToIndices(h),_=[];for(let w=1;w<y.length;w++)_.push(y[w-1]),_.push(y[w]);r.push(_)}return r}_handlePoles(t){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(t,r,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const o=t[r+1];o===sn&&(t[r+1]=-32767),o===Dn&&(t[r+1]=32766)}}_generatePoleQuad(t,r,o,h,y,_){h>y!=(_===sn)?(t.push(r),t.push(o),t.push(this._vertexToIndex(h,_)),t.push(o),t.push(this._vertexToIndex(y,_)),t.push(this._vertexToIndex(h,_))):(t.push(o),t.push(r),t.push(this._vertexToIndex(h,_)),t.push(this._vertexToIndex(y,_)),t.push(o),t.push(this._vertexToIndex(h,_)))}_fillPoles(t,r,o){const h=this._vertexBuffer,y=_t,_=t.length;for(let w=2;w<_;w+=3){const P=t[w-2],I=t[w-1],L=t[w],F=h[2*P],U=h[2*P+1],$=h[2*I],q=h[2*I+1],H=h[2*L],ee=h[2*L+1];r&&(U===0&&q===0&&this._generatePoleQuad(t,P,I,F,$,sn),q===0&&ee===0&&this._generatePoleQuad(t,I,L,$,H,sn),ee===0&&U===0&&this._generatePoleQuad(t,L,P,H,F,sn)),o&&(U===y&&q===y&&this._generatePoleQuad(t,P,I,F,$,Dn),q===y&&ee===y&&this._generatePoleQuad(t,I,L,$,H,Dn),ee===y&&U===y&&this._generatePoleQuad(t,L,P,H,F,Dn))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=(function(w){const P=[],I=[];for(const L of w)if(L.length!==0){L!==w[0]&&P.push(I.length/2);for(let F=0;F<L.length;F++)I.push(L[F].x),I.push(L[F].y)}return{flattened:I,holeIndices:P}})(t);let y;this._initializeVertices(o);try{const w=(function(I,L,F=2){const U=L&&L.length,$=U?L[0]*F:I.length;let q=mc(I,0,$,F,!0);const H=[];if(!q||q.next===q.prev)return H;let ee,ae,Se;if(U&&(q=(function(he,fe,Ie,je){const Xe=[];for(let dt=0,at=fe.length;dt<at;dt++){const ct=mc(he,fe[dt]*je,dt<at-1?fe[dt+1]*je:he.length,je,!1);ct===ct.next&&(ct.steiner=!0),Xe.push(_f(ct))}Xe.sort(fd);for(let dt=0;dt<Xe.length;dt++)Ie=bi(Xe[dt],Ie);return Ie})(I,L,q,F)),I.length>80*F){ee=I[0],ae=I[1];let he=ee,fe=ae;for(let Ie=F;Ie<$;Ie+=F){const je=I[Ie],Xe=I[Ie+1];je<ee&&(ee=je),Xe<ae&&(ae=Xe),je>he&&(he=je),Xe>fe&&(fe=Xe)}Se=Math.max(he-ee,fe-ae),Se=Se!==0?32767/Se:0}return Mu(q,H,F,ee,ae,Se,0),H})(o,h),P=this._convertIndices(o,w);y=this._subdivideTrianglesScanline(P)}catch(w){console.error(w)}let _=[];return r&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:_}}_convertIndices(t,r){const o=[];for(let h=0;h<r.length;h++)o.push(this._vertexToIndex(t[2*r[h]],t[2*r[h]+1]));return o}_pointArrayToIndices(t){const r=[];for(let o=0;o<t.length;o++){const h=t[o];r.push(this._vertexToIndex(h.x,h.y))}return r}}function Eu(n,t,r,o=!0){return new Ea(r,t).subdividePolygonInternal(n,o)}function ln(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],h=n[n.length-1],y=r&&(o.x!==h.x||o.y!==h.y);if(t<2)return y?[...n,n[0]]:[...n];const _=Math.floor(_t/t),w=[];w.push(new N(n[0].x,n[0].y));const P=n.length,I=y?P:P-1;for(let L=0;L<I;L++){const F=n[L],U=L<P-1?n[L+1]:n[0],$=F.x,q=F.y,H=U.x,ee=U.y,ae=$!==H,Se=q!==ee;if(!ae&&!Se)continue;const he=H-$,fe=ee-q,Ie=Math.abs(he),je=Math.abs(fe);let Xe=$,dt=q;for(;;){const ct=he>0?(Math.floor(Xe/_)+1)*_:(Math.ceil(Xe/_)-1)*_,At=fe>0?(Math.floor(dt/_)+1)*_:(Math.ceil(dt/_)-1)*_,ot=Math.abs(Xe-ct),ht=Math.abs(dt-At),qe=Math.abs(Xe-H),jt=Math.abs(dt-ee),Ht=ae?ot/Ie:Number.POSITIVE_INFINITY,Rt=Se?ht/je:Number.POSITIVE_INFINITY;if((qe<=ot||!ae)&&(jt<=ht||!Se))break;if(Ht<Rt&&ae||!Se){Xe=ct,dt+=fe*Ht;const Ct=new N(Xe,Math.round(dt));w[w.length-1].x===Ct.x&&w[w.length-1].y===Ct.y||w.push(Ct)}else{Xe+=he*Rt,dt=At;const Ct=new N(Math.round(Xe),dt);w[w.length-1].x===Ct.x&&w[w.length-1].y===Ct.y||w.push(Ct)}}const at=new N(H,ee);w[w.length-1].x===at.x&&w[w.length-1].y===at.y||w.push(at)}return w}function vh(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=n[2*t[0]];for(let P=1;P<t.length;P++){const I=n[2*t[P]];I<h&&(h=I,o=P)}const y=t.length;let _=o,w=(_+1)%y;for(;;){const P=_-1>=0?_-1:y-1,I=(w+1)%y,L=n[2*t[P]],F=n[2*t[I]],U=n[2*t[_]],$=n[2*t[_]+1],q=n[2*t[w]+1];let H=!1;if(L<F)H=!0;else if(L>F)H=!1;else{const ee=q-$,ae=-(n[2*t[w]]-U),Se=$<q?1:-1;((L-U)*ee+(n[2*t[P]+1]-$)*ae)*Se>((F-U)*ee+(n[2*t[I]+1]-$)*ae)*Se&&(H=!0)}if(H){const ee=t[P],ae=t[_],Se=t[w];ee!==ae&&ee!==Se&&ae!==Se&&r.push(Se,ae,ee),_--,_<0&&(_=y-1)}else{const ee=t[I],ae=t[_],Se=t[w];ee!==ae&&ee!==Se&&ae!==Se&&r.push(Se,ae,ee),w++,w>=y&&(w=0)}if(P===I)break}}function Fl(n,t,r,o,h,y,_,w,P){const I=h.length/2,L=_&&w&&P;if(I<Zt.MAX_VERTEX_ARRAY_LENGTH){const F=t.prepareSegment(I,r,o),U=F.vertexLength;for(let H=0;H<y.length;H+=3)o.emplaceBack(U+y[H],U+y[H+1],U+y[H+2]);let $,q;F.vertexLength+=I,F.primitiveLength+=y.length/3,L&&(q=_.prepareSegment(I,r,w),$=q.vertexLength,q.vertexLength+=I);for(let H=0;H<h.length;H+=2)n(h[H],h[H+1]);if(L)for(let H=0;H<P.length;H++){const ee=P[H];for(let ae=1;ae<ee.length;ae+=2)w.emplaceBack($+ee[ae-1],$+ee[ae]);q.primitiveLength+=ee.length/2}}else(function(F,U,$,q,H,ee){const ae=[];for(let je=0;je<q.length/2;je++)ae.push(-1);const Se={count:0};let he=0,fe=F.getOrCreateLatestSegment(U,$),Ie=fe.vertexLength;for(let je=2;je<H.length;je+=3){const Xe=H[je-2],dt=H[je-1],at=H[je];let ct=ae[Xe]<he,At=ae[dt]<he,ot=ae[at]<he;fe.vertexLength+((ct?1:0)+(At?1:0)+(ot?1:0))>Zt.MAX_VERTEX_ARRAY_LENGTH&&(fe=F.createNewSegment(U,$),he=Se.count,ct=!0,At=!0,ot=!0,Ie=0);const ht=Bl(ae,q,ee,Se,Xe,ct,fe),qe=Bl(ae,q,ee,Se,dt,At,fe),jt=Bl(ae,q,ee,Se,at,ot,fe);$.emplaceBack(Ie+ht-he,Ie+qe-he,Ie+jt-he),fe.primitiveLength++}})(t,r,o,h,y,n),L&&(function(F,U,$,q,H,ee){const ae=[];for(let je=0;je<q.length/2;je++)ae.push(-1);const Se={count:0};let he=0,fe=F.getOrCreateLatestSegment(U,$),Ie=fe.vertexLength;for(let je=0;je<H.length;je++){const Xe=H[je];for(let dt=1;dt<H[je].length;dt+=2){const at=Xe[dt-1],ct=Xe[dt];let At=ae[at]<he,ot=ae[ct]<he;fe.vertexLength+((At?1:0)+(ot?1:0))>Zt.MAX_VERTEX_ARRAY_LENGTH&&(fe=F.createNewSegment(U,$),he=Se.count,At=!0,ot=!0,Ie=0);const ht=Bl(ae,q,ee,Se,at,At,fe),qe=Bl(ae,q,ee,Se,ct,ot,fe);$.emplaceBack(Ie+ht-he,Ie+qe-he),fe.primitiveLength++}}})(_,r,w,h,P,n),t.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function Bl(n,t,r,o,h,y,_){if(y){const w=o.count;return r(t[2*h],t[2*h+1]),n[h]=o.count,o.count++,_.vertexLength++,w}return n[h]}class xh{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ee,this.indexArray=new Br,this.indexArray2=new zr,this.programConfigurations=new Li(t.layers,t.zoom),this.segments=new Zt,this.segments2=new Zt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){this.hasPattern=fp("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),y=!h.isConstant(),_=[];for(const{feature:w,id:P,index:I,sourceLayerIndex:L}of t){const F=this.layers[0]._featureFilter.needGeometry,U=zo(w,F);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{globalState:this.globalState}),U,o))continue;const $=y?h.evaluate(U,{},o,r.availableImages):void 0,q={id:P,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:F?U.geometry:eo(w),patterns:{},sortKey:$};_.push(q)}y&&_.sort(((w,P)=>w.sortKey-P.sortKey));for(const w of _){const{geometry:P,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const F=pd("fill",this.layers,w,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(w,P,I,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,P,I,L,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,h,y,_){for(const w of yl(r,500)){const P=Eu(w,h,_.fill.getGranularityForZoomLevel(h.z)),I=this.layoutVertexArray;Fl(((L,F)=>{I.emplaceBack(L,F)}),this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles,this.segments2,this.indexArray2,P.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,y,h)}}let _c,Ki;mt("FillBucket",xh,{omit:["layers","patternFeatures"]});var yd={get paint(){return Ki=Ki||new Wn({"fill-antialias":new wt(Te.paint_fill["fill-antialias"]),"fill-opacity":new zt(Te.paint_fill["fill-opacity"]),"fill-color":new zt(Te.paint_fill["fill-color"]),"fill-outline-color":new zt(Te.paint_fill["fill-outline-color"]),"fill-translate":new wt(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new ko(Te.paint_fill["fill-pattern"])})},get layout(){return _c=_c||new Wn({"fill-sort-key":new zt(Te.layout_fill["fill-sort-key"])})}};class vc extends Xn{constructor(t){super(t,yd)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new xh(t)}queryRadius(){return hc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:o,pixelsToTileUnits:h}){return sf(hh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),r)}isTileClipped(){return!0}}const Vs=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),mp=on([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_d}=Vs;class Ia{constructor(t,r,o,h,y){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(gp,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,o=[];let h,y=1,_=0,w=0,P=0;for(;t.pos<r;){if(_<=0){const I=t.readVarint();y=7&I,_=I>>3}if(_--,y===1||y===2)w+=t.readSVarint(),P+=t.readSVarint(),y===1&&(h&&o.push(h),h=[]),h&&h.push(new N(w,P));else{if(y!==7)throw new Error(`unknown command ${y}`);h&&h.push(h[0].clone())}}return h&&o.push(h),o}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let o=1,h=0,y=0,_=0,w=1/0,P=-1/0,I=1/0,L=-1/0;for(;t.pos<r;){if(h<=0){const F=t.readVarint();o=7&F,h=F>>3}if(h--,o===1||o===2)y+=t.readSVarint(),_+=t.readSVarint(),y<w&&(w=y),y>P&&(P=y),_<I&&(I=_),_>L&&(L=_);else if(o!==7)throw new Error(`unknown command ${o}`)}return[w,I,P,L]}toGeoJSON(t,r,o){const h=this.extent*Math.pow(2,o),y=this.extent*t,_=this.extent*r,w=this.loadGeometry();function P(U){return[360*(U.x+y)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+_)/h)*Math.PI))-90]}function I(U){return U.map(P)}let L;if(this.type===1){const U=[];for(const q of w)U.push(q[0]);const $=I(U);L=U.length===1?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$}}else if(this.type===2){const U=w.map(I);L=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=(function(q){const H=q.length;if(H<=1)return[q];const ee=[];let ae,Se;for(let he=0;he<H;he++){const fe=jl(q[he]);fe!==0&&(Se===void 0&&(Se=fe<0),Se===fe<0?(ae&&ee.push(ae),ae=[q[he]]):ae&&ae.push(q[he]))}return ae&&ee.push(ae),ee})(w),$=[];for(const q of U)$.push(q.map(I));L=$.length===1?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$}}}const F={type:"Feature",geometry:L,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function gp(n,t,r){n===1?t.id=r.readVarint():n===2?(function(o,h){const y=o.readVarint()+o.pos;for(;o.pos<y;){const _=h._keys[o.readVarint()],w=h._values[o.readVarint()];h.properties[_]=w}})(r,t):n===3?t.type=r.readVarint():n===4&&(t._geometry=r.pos)}function jl(n){let t=0;for(let r,o,h=0,y=n.length,_=y-1;h<y;_=h++)r=n[h],o=n[_],t+=(o.x-r.x)*(r.y+o.y);return t}Ia.types=["Unknown","Point","LineString","Polygon"];class bh{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(wh,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new Ia(this._pbf,r,this.extent,this._keys,this._values)}}function wh(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push((function(o){let h=null;const y=o.readVarint()+o.pos;for(;o.pos<y;){const _=o.readVarint()>>3;h=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(r))}class yp{constructor(t,r){this.layers=t.readFields(_p,{},r)}}function _p(n,t,r){if(n===3){const o=new bh(r,r.readVarint()+r.pos);o.length&&(t[o.name]=o)}}const xc=Math.pow(2,13);function Kn(n,t,r,o,h,y,_,w){n.emplaceBack(t,r,2*Math.floor(o*xc)+_,h*xc*2,y*xc*2,Math.round(w))}class gs{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new se,this.indexArray=new Br,this.programConfigurations=new Li(t.layers,t.zoom),this.segments=new Zt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){this.features=[],this.hasPattern=fp("fill-extrusion",this.layers,r);for(const{feature:h,id:y,index:_,sourceLayerIndex:w}of t){const P=this.layers[0]._featureFilter.needGeometry,I=zo(h,P);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{globalState:this.globalState}),I,o))continue;const L={id:y,sourceLayerIndex:w,index:_,geometry:P?I.geometry:eo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(pd("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,_,o,{},r.subdivisionGranularity),r.featureIndex.insert(h,L.geometry,_,w,this.index,!0)}}addFeatures(t,r,o){for(const h of this.features){const{geometry:y}=h;this.addFeature(h,y,h.index,r,o,t.subdivisionGranularity)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_d),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,mp.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,h,y,_){for(const w of yl(r,500)){const P={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(P,h,t,w,_);const L=this.layoutVertexArray.length-I,F=Math.floor(P.x/P.sampleCount),U=Math.floor(P.y/P.sampleCount);for(let $=0;$<L;$++)this.centroidVertexArray.emplaceBack(F,U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,y,h)}processPolygon(t,r,o,h,y){if(h.length<1||vd(h[0]))return;for(const F of h)F.length!==0&&Ro(t,F);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=y.fill.getGranularityForZoomLevel(r.z),P=Ia.types[o.type]==="Polygon";for(const F of h){if(F.length===0||vd(F))continue;const U=ln(F,w,P);this._generateSideFaces(U,_)}if(!P)return;const I=Eu(h,r,w,!1),L=this.layoutVertexArray;Fl(((F,U)=>{Kn(L,F,U,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(t,r){let o=0;for(let h=1;h<t.length;h++){const y=t[h],_=t[h-1];if(ha(y,_))continue;r.segment.vertexLength+4>Zt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=y.sub(_)._perp()._unit(),P=_.dist(y);o+P>32768&&(o=0),Kn(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,0,o),Kn(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,1,o),o+=P,Kn(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,0,o),Kn(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,1,o);const I=r.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Ro(n,t){for(let r=0;r<t.length;r++){const o=t[r];r===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function ha(n,t){return n.x===t.x&&(n.x<0||n.x>_t)||n.y===t.y&&(n.y<0||n.y>_t)}function vd(n){return n.every((t=>t.x<0))||n.every((t=>t.x>_t))||n.every((t=>t.y<0))||n.every((t=>t.y>_t))}let vp;mt("FillExtrusionBucket",gs,{omit:["layers","features"]});var xd={get paint(){return vp=vp||new Wn({"fill-extrusion-opacity":new wt(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ko(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Im extends Xn{constructor(t){super(t,xd)}createBucket(t){return new gs(t)}queryRadius(){return hc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:y,pixelsToTileUnits:_,pixelPosMatrix:w}){const P=hh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,_),I=this.paint.get("fill-extrusion-height").evaluate(r,o),L=this.paint.get("fill-extrusion-base").evaluate(r,o),F=(function($,q){const H=[];for(const ee of $){const ae=[ee.x,ee.y,0,1];fr(ae,ae,q),H.push(new N(ae[0]/ae[3],ae[1]/ae[3]))}return H})(P,w),U=(function($,q,H,ee){const ae=[],Se=[],he=ee[8]*q,fe=ee[9]*q,Ie=ee[10]*q,je=ee[11]*q,Xe=ee[8]*H,dt=ee[9]*H,at=ee[10]*H,ct=ee[11]*H;for(const At of $){const ot=[],ht=[];for(const qe of At){const jt=qe.x,Ht=qe.y,Rt=ee[0]*jt+ee[4]*Ht+ee[12],Ct=ee[1]*jt+ee[5]*Ht+ee[13],_r=ee[2]*jt+ee[6]*Ht+ee[14],vn=ee[3]*jt+ee[7]*Ht+ee[15],Jn=_r+Ie,Ni=vn+je,No=Rt+Xe,za=Ct+dt,wi=_r+at,pn=vn+ct,ai=new N((Rt+he)/Ni,(Ct+fe)/Ni);ai.z=Jn/Ni,ot.push(ai);const Si=new N(No/pn,za/pn);Si.z=wi/pn,ht.push(Si)}ae.push(ot),Se.push(ht)}return[ae,Se]})(h,L,I,w);return(function($,q,H){let ee=1/0;sf(H,q)&&(ee=bd(H,q[0]));for(let ae=0;ae<q.length;ae++){const Se=q[ae],he=$[ae];for(let fe=0;fe<Se.length-1;fe++){const Ie=Se[fe],je=[Ie,Se[fe+1],he[fe+1],he[fe],Ie];rd(H,je)&&(ee=Math.min(ee,bd(H,je)))}}return ee!==1/0&&ee})(U[0],U[1],F)}}function to(n,t){return n.x*t.x+n.y*t.y}function bd(n,t){if(n.length===1){let r=0;const o=t[r++];let h;for(;!h||o.equals(h);)if(h=t[r++],!h)return 1/0;for(;r<t.length;r++){const y=t[r],_=n[0],w=h.sub(o),P=y.sub(o),I=_.sub(o),L=to(w,w),F=to(w,P),U=to(P,P),$=to(I,w),q=to(I,P),H=L*U-F*F,ee=(U*$-F*q)/H,ae=(L*q-F*$)/H,Se=o.z*(1-ee-ae)+h.z*ee+y.z*ae;if(isFinite(Se))return Se}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const wd=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Iu}=wd,Sd=on([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Au}=Sd,bf=Math.cos(Math.PI/180*37.5),Td=Math.pow(2,14)/.5;class Sh{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new ke,this.layoutVertexArray2=new De,this.indexArray=new Br,this.programConfigurations=new Li(t.layers,t.zoom),this.segments=new Zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){this.hasPattern=fp("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),y=!h.isConstant(),_=[];for(const{feature:w,id:P,index:I,sourceLayerIndex:L}of t){const F=this.layers[0]._featureFilter.needGeometry,U=zo(w,F);if(!this.layers[0]._featureFilter.filter(new Fr(this.zoom,{globalState:this.globalState}),U,o))continue;const $=y?h.evaluate(U,{},o):void 0,q={id:P,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:F?U.geometry:eo(w),patterns:{},sortKey:$};_.push(q)}y&&_.sort(((w,P)=>w.sortKey-P.sortKey));for(const w of _){const{geometry:P,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const F=pd("line",this.layers,w,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(w,P,I,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,P,I,L,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Au)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Iu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,h,y,_){const w=this.layers[0].layout,P=w.get("line-join").evaluate(t,{}),I=w.get("line-cap"),L=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const U of r)this.addLine(U,t,P,I,L,F,h,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,y,h)}addLine(t,r,o,h,y,_,w,P){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ln(t,w?P.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Ia.types[r.type]==="Polygon";let L=t.length;for(;L>=2&&t[L-1].equals(t[L-2]);)L--;let F=0;for(;F<L-1&&t[F].equals(t[F+1]);)F++;if(L<(I?3:2))return;o==="bevel"&&(y=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let q,H,ee,ae,Se;this.e1=this.e2=-1,I&&(q=t[L-2],Se=t[F].sub(q)._unit()._perp());for(let he=F;he<L;he++){if(ee=he===L-1?I?t[F+1]:void 0:t[he+1],ee&&t[he].equals(ee))continue;Se&&(ae=Se),q&&(H=q),q=t[he],Se=ee?ee.sub(q)._unit()._perp():ae,ae=ae||Se;let fe=ae.add(Se);fe.x===0&&fe.y===0||fe._unit();const Ie=ae.x*Se.x+ae.y*Se.y,je=fe.x*Se.x+fe.y*Se.y,Xe=je!==0?1/je:1/0,dt=2*Math.sqrt(2-2*je),at=je<bf&&H&&ee,ct=ae.x*Se.y-ae.y*Se.x>0;if(at&&he>F){const ht=q.dist(H);if(ht>2*U){const qe=q.sub(q.sub(H)._mult(U/ht)._round());this.updateDistance(H,qe),this.addCurrentVertex(qe,ae,0,0,$),H=qe}}const At=H&&ee;let ot=At?o:I?"butt":h;if(At&&ot==="round"&&(Xe<_?ot="miter":Xe<=2&&(ot="fakeround")),ot==="miter"&&Xe>y&&(ot="bevel"),ot==="bevel"&&(Xe>2&&(ot="flipbevel"),Xe<y&&(ot="miter")),H&&this.updateDistance(H,q),ot==="miter")fe._mult(Xe),this.addCurrentVertex(q,fe,0,0,$);else if(ot==="flipbevel"){if(Xe>100)fe=Se.mult(-1);else{const ht=Xe*ae.add(Se).mag()/ae.sub(Se).mag();fe._perp()._mult(ht*(ct?-1:1))}this.addCurrentVertex(q,fe,0,0,$),this.addCurrentVertex(q,fe.mult(-1),0,0,$)}else if(ot==="bevel"||ot==="fakeround"){const ht=-Math.sqrt(Xe*Xe-1),qe=ct?ht:0,jt=ct?0:ht;if(H&&this.addCurrentVertex(q,ae,qe,jt,$),ot==="fakeround"){const Ht=Math.round(180*dt/Math.PI/20);for(let Rt=1;Rt<Ht;Rt++){let Ct=Rt/Ht;if(Ct!==.5){const vn=Ct-.5;Ct+=Ct*vn*(Ct-1)*((1.0904+Ie*(Ie*(3.55645-1.43519*Ie)-3.2452))*vn*vn+(.848013+Ie*(.215638*Ie-1.06021)))}const _r=Se.sub(ae)._mult(Ct)._add(ae)._unit()._mult(ct?-1:1);this.addHalfVertex(q,_r.x,_r.y,!1,ct,0,$)}}ee&&this.addCurrentVertex(q,Se,-qe,-jt,$)}else if(ot==="butt")this.addCurrentVertex(q,fe,0,0,$);else if(ot==="square"){const ht=H?1:-1;this.addCurrentVertex(q,fe,ht,ht,$)}else ot==="round"&&(H&&(this.addCurrentVertex(q,ae,0,0,$),this.addCurrentVertex(q,ae,1,1,$,!0)),ee&&(this.addCurrentVertex(q,Se,-1,-1,$,!0),this.addCurrentVertex(q,Se,0,0,$)));if(at&&he<L-1){const ht=q.dist(ee);if(ht>2*U){const qe=q.add(ee.sub(q)._mult(U/ht)._round());this.updateDistance(q,qe),this.addCurrentVertex(qe,Se,0,0,$),q=qe}}}}addCurrentVertex(t,r,o,h,y,_=!1){const w=r.y*h-r.x,P=-r.y-r.x*h;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,_,!1,o,y),this.addHalfVertex(t,w,P,_,!0,-h,y),this.distance>Td/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,h,y,_))}addHalfVertex({x:t,y:r},o,h,y,_,w,P){const I=.5*(this.lineClips?this.scaledDistance*(Td-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(r<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,L,this.e2),P.primitiveLength++),_?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Th,wf;mt("LineBucket",Sh,{omit:["layers","patternFeatures"]});var Sf={get paint(){return wf=wf||new Wn({"line-opacity":new zt(Te.paint_line["line-opacity"]),"line-color":new zt(Te.paint_line["line-color"]),"line-translate":new wt(Te.paint_line["line-translate"]),"line-translate-anchor":new wt(Te.paint_line["line-translate-anchor"]),"line-width":new zt(Te.paint_line["line-width"]),"line-gap-width":new zt(Te.paint_line["line-gap-width"]),"line-offset":new zt(Te.paint_line["line-offset"]),"line-blur":new zt(Te.paint_line["line-blur"]),"line-dasharray":new Ya(Te.paint_line["line-dasharray"]),"line-pattern":new ko(Te.paint_line["line-pattern"]),"line-gradient":new Rl(Te.paint_line["line-gradient"])})},get layout(){return Th=Th||new Wn({"line-cap":new wt(Te.layout_line["line-cap"]),"line-join":new zt(Te.layout_line["line-join"]),"line-miter-limit":new wt(Te.layout_line["line-miter-limit"]),"line-round-limit":new wt(Te.layout_line["line-round-limit"]),"line-sort-key":new zt(Te.layout_line["line-sort-key"])})}};class Tf extends zt{possiblyEvaluate(t,r){return r=new Fr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,h){return r=cr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,h)}}let Ch;class zu extends Xn{constructor(t){super(t,Sf),this.gradientVersion=0,Ch||(Ch=new Tf(Sf.paint.properties["line-width"].specification),Ch.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof Xr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ch.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Sh(t)}queryRadius(t){const r=t,o=Cf(cc("line-width",this,r),cc("line-gap-width",this,r)),h=cc("line-offset",this,r);return o/2+Math.abs(h)+hc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:y,pixelsToTileUnits:_}){const w=hh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,_),P=_/2*Cf(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),I=this.paint.get("line-offset").evaluate(r,o);return I&&(h=(function(L,F){const U=[];for(let $=0;$<L.length;$++){const q=L[$],H=[];for(let ee=0;ee<q.length;ee++){const ae=q[ee-1],Se=q[ee],he=q[ee+1],fe=ee===0?new N(0,0):Se.sub(ae)._unit()._perp(),Ie=ee===q.length-1?new N(0,0):he.sub(Se)._unit()._perp(),je=fe._add(Ie)._unit(),Xe=je.x*Ie.x+je.y*Ie.y;Xe!==0&&je._mult(1/Xe),H.push(je._mult(F)._add(Se))}U.push(H)}return U})(h,I*_)),(function(L,F,U){for(let $=0;$<F.length;$++){const q=F[$];if(L.length>=3){for(let H=0;H<q.length;H++)if(Pu(L,q[H]))return!0}if(ua(L,q,U))return!0}return!1})(w,h,P)}isTileClipped(){return!0}}function Cf(n,t){return t>0?t+2*n:n}const bc=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pf=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cn=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);on([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Mf=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kf=on([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Am(n,t,r){return n.sections.forEach((o=>{o.text=(function(h,y,_){const w=y.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),aa.applyArabicShaping&&(h=aa.applyArabicShaping(h)),h})(o.text,t,r)})),n}on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),on([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ph={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Nn=24;const xp=4294967296,Ef=1/xp,Aa=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Mh{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,o=this.length){for(;this.pos<o;){const h=this.readVarint(),y=h>>3,_=this.pos;this.type=7&h,t(y,r,this),this.pos===_&&this.skip(h)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*xp;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*xp;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const r=this.buf;let o,h;return h=r[this.pos++],o=127&h,h<128?o:(h=r[this.pos++],o|=(127&h)<<7,h<128?o:(h=r[this.pos++],o|=(127&h)<<14,h<128?o:(h=r[this.pos++],o|=(127&h)<<21,h<128?o:(h=r[this.pos],o|=(15&h)<<28,(function(y,_,w){const P=w.buf;let I,L;if(L=P[w.pos++],I=(112&L)>>4,L<128||(L=P[w.pos++],I|=(127&L)<<3,L<128)||(L=P[w.pos++],I|=(127&L)<<10,L<128)||(L=P[w.pos++],I|=(127&L)<<17,L<128)||(L=P[w.pos++],I|=(127&L)<<24,L<128)||(L=P[w.pos++],I|=(1&L)<<31,L<128))return wc(y,I,_);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&Aa?Aa.decode(this.buf.subarray(r,t)):(function(o,h,y){let _="",w=h;for(;w<y;){const P=o[w];let I,L,F,U=null,$=P>239?4:P>223?3:P>191?2:1;if(w+$>y)break;$===1?P<128&&(U=P):$===2?(I=o[w+1],(192&I)==128&&(U=(31&P)<<6|63&I,U<=127&&(U=null))):$===3?(I=o[w+1],L=o[w+2],(192&I)==128&&(192&L)==128&&(U=(15&P)<<12|(63&I)<<6|63&L,(U<=2047||U>=55296&&U<=57343)&&(U=null))):$===4&&(I=o[w+1],L=o[w+2],F=o[w+3],(192&I)==128&&(192&L)==128&&(192&F)==128&&(U=(15&P)<<18|(63&I)<<12|(63&L)<<6|63&F,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,$=1):U>65535&&(U-=65536,_+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),_+=String.fromCharCode(U),w+=$}return _})(this.buf,r,t)}readBytes(){const t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const r=7&t;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){const o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Ef),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Ef),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(r,o){let h,y;if(r>=0?(h=r%4294967296|0,y=r/4294967296|0):(h=~(-r%4294967296),y=~(-r/4294967296),4294967295^h?h=h+1|0:(h=0,y=y+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(_,w,P){P.buf[P.pos++]=127&_|128,_>>>=7,P.buf[P.pos++]=127&_|128,_>>>=7,P.buf[P.pos++]=127&_|128,_>>>=7,P.buf[P.pos++]=127&_|128,P.buf[P.pos]=127&(_>>>=7)})(h,0,o),(function(_,w){const P=(7&_)<<4;w.buf[w.pos++]|=P|((_>>>=3)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_)))))})(y,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const r=this.pos;this.pos=(function(h,y,_){for(let w,P,I=0;I<y.length;I++){if(w=y.charCodeAt(I),w>55295&&w<57344){if(!P){w>56319||I+1===y.length?(h[_++]=239,h[_++]=191,h[_++]=189):P=w;continue}if(w<56320){h[_++]=239,h[_++]=191,h[_++]=189,P=w;continue}w=P-55296<<10|w-56320|65536,P=null}else P&&(h[_++]=239,h[_++]=191,h[_++]=189,P=null);w<128?h[_++]=w:(w<2048?h[_++]=w>>6|192:(w<65536?h[_++]=w>>12|224:(h[_++]=w>>18|240,h[_++]=w>>12&63|128),h[_++]=w>>6&63|128),h[_++]=63&w|128)}return _})(this.buf,t,this.pos);const o=this.pos-r;o>=128&&$s(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const r=t.length;this.writeVarint(r),this.realloc(r);for(let o=0;o<r;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,r){this.pos++;const o=this.pos;t(r,this);const h=this.pos-o;h>=128&&$s(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeMessage(t,r,o){this.writeTag(t,2),this.writeRawMessage(r,o)}writePackedVarint(t,r){r.length&&this.writeMessage(t,bp,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,Lu,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,Pd,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,wp,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,Cd,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,zm,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,Md,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,Lm,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,If,r)}writeBytesField(t,r){this.writeTag(t,2),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,5),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,5),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,1),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,1),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,0),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,0),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,2),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,5),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,1),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}}function wc(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function $s(n,t,r){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(o);for(let h=r.pos-1;h>=n;h--)r.buf[h+o]=r.buf[h]}function bp(n,t){for(let r=0;r<n.length;r++)t.writeVarint(n[r])}function Lu(n,t){for(let r=0;r<n.length;r++)t.writeSVarint(n[r])}function wp(n,t){for(let r=0;r<n.length;r++)t.writeFloat(n[r])}function Cd(n,t){for(let r=0;r<n.length;r++)t.writeDouble(n[r])}function Pd(n,t){for(let r=0;r<n.length;r++)t.writeBoolean(n[r])}function zm(n,t){for(let r=0;r<n.length;r++)t.writeFixed32(n[r])}function Md(n,t){for(let r=0;r<n.length;r++)t.writeSFixed32(n[r])}function Lm(n,t){for(let r=0;r<n.length;r++)t.writeFixed64(n[r])}function If(n,t){for(let r=0;r<n.length;r++)t.writeSFixed64(n[r])}function Af(n,t,r){n===1&&r.readMessage(Sp,t)}function Sp(n,t,r){if(n===3){const{id:o,bitmap:h,width:y,height:_,left:w,top:P,advance:I}=r.readMessage(Tp,{});t.push({id:o,bitmap:new ka({width:y+6,height:_+6},h),metrics:{width:y,height:_,left:w,top:P,advance:I}})}}function Tp(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}function kd(n){let t=0,r=0;for(const _ of n)t+=_.w*_.h,r=Math.max(r,_.w);n.sort(((_,w)=>w.h-_.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let h=0,y=0;for(const _ of n)for(let w=o.length-1;w>=0;w--){const P=o[w];if(!(_.w>P.w||_.h>P.h)){if(_.x=P.x,_.y=P.y,y=Math.max(y,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===P.w&&_.h===P.h){const I=o.pop();I&&w<o.length&&(o[w]=I)}else _.h===P.h?(P.x+=_.w,P.w-=_.w):_.w===P.w?(P.y+=_.h,P.h-=_.h):(o.push({x:P.x+_.w,y:P.y,w:P.w-_.w,h:_.h}),P.y+=_.h,P.h-=_.h);break}}return{w:h,h:y,fill:t/(h*y)||0}}class kh{constructor(t,{pixelRatio:r,version:o,stretchX:h,stretchY:y,content:_,textFitWidth:w,textFitHeight:P}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=h,this.stretchY=y,this.content=_,this.version=o,this.textFitWidth=w,this.textFitHeight=P}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zf{constructor(t,r){const o={},h={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,o,y),this.addImages(r,h,y);const{w:_,h:w}=kd(y),P=new Wi({width:_||1,height:w||1});for(const I in t){const L=t[I],F=o[I].paddedRect;Wi.copy(L.data,P,{x:0,y:0},{x:F.x+1,y:F.y+1},L.data)}for(const I in r){const L=r[I],F=h[I].paddedRect,U=F.x+1,$=F.y+1,q=L.data.width,H=L.data.height;Wi.copy(L.data,P,{x:0,y:0},{x:U,y:$},L.data),Wi.copy(L.data,P,{x:0,y:H-1},{x:U,y:$-1},{width:q,height:1}),Wi.copy(L.data,P,{x:0,y:0},{x:U,y:$+H},{width:q,height:1}),Wi.copy(L.data,P,{x:q-1,y:0},{x:U-1,y:$},{width:1,height:H}),Wi.copy(L.data,P,{x:0,y:0},{x:U+q,y:$},{width:1,height:H})}this.image=P,this.iconPositions=o,this.patternPositions=h}addImages(t,r,o){for(const h in t){const y=t[h],_={x:0,y:0,w:y.data.width+2,h:y.data.height+2};o.push(_),r[h]=new kh(_,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[h,y]=t.tl;o.update(r.data,void 0,{x:h,y})}}var qs;mt("ImagePosition",kh),mt("ImageAtlas",zf),b.ao=void 0,(qs=b.ao||(b.ao={}))[qs.none=0]="none",qs[qs.horizontal=1]="horizontal",qs[qs.vertical=2]="vertical",qs[qs.horizontalOnly=3]="horizontalOnly";class Ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,o){const h=new Ru;return h.scale=t||1,h.fontStack=r,h.verticalAlign=o||"bottom",h}static forImage(t,r){const o=new Ru;return o.imageName=t,o.verticalAlign=r||"bottom",o}}class Gs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new Gs;for(let h=0;h<t.sections.length;h++){const y=t.sections[h];y.image?o.addImageSection(y):o.addTextSection(y,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let o=0;o<t.length;o++){const h=t.charCodeAt(o+1)||null,y=t.charCodeAt(o-1)||null;r+=h&&ah(h)&&!Ph[t[o+1]]||y&&ah(y)&&!Ph[t[o-1]]||!Ph[t[o]]?t[o]:Ph[t[o]]}return r})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Du[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Du[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new Gs;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}getMaxImageSize(t){let r=0,o=0;for(let h=0;h<this.length();h++){const y=this.getSection(h);if(y.imageName){const _=t[y.imageName];if(!_)continue;const w=_.displaySize;r=Math.max(r,w[0]),o=Math.max(o,w[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(t,r){this.text+=t.text,this.sections.push(Ru.forText(t.scale,t.fontStack||r,t.verticalAlign));const o=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void an("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ru.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):an("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sc(n,t,r,o,h,y,_,w,P,I,L,F,U,$,q){const H=Gs.fromFeature(n,h);let ee;F===b.ao.vertical&&H.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:Se}=aa;if(ae&&H.sections.length===1){ee=[];const Ie=ae(H.toString(),a(H,I,y,t,o,$));for(const je of Ie){const Xe=new Gs;Xe.text=je,Xe.sections=H.sections;for(let dt=0;dt<je.length;dt++)Xe.sectionIndex.push(0);ee.push(Xe)}}else if(Se){ee=[];const Ie=Se(H.text,H.sectionIndex,a(H,I,y,t,o,$));for(const je of Ie){const Xe=new Gs;Xe.text=je[0],Xe.sectionIndex=je[1],Xe.sections=H.sections,ee.push(Xe)}}else ee=(function(Ie,je){const Xe=[],dt=Ie.text;let at=0;for(const ct of je)Xe.push(Ie.substring(at,ct)),at=ct;return at<dt.length&&Xe.push(Ie.substring(at,dt.length)),Xe})(H,a(H,I,y,t,o,$));const he=[],fe={positionedLines:he,text:H.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1};return(function(Ie,je,Xe,dt,at,ct,At,ot,ht,qe,jt,Ht){let Rt=0,Ct=0,_r=0,vn=0;const Jn=ot==="right"?1:ot==="left"?0:.5,Ni=Nn/Ht;let No=0;for(const pn of at){pn.trim();const ai=pn.getMaxScale(),Si={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[No]=Si;const Ti=Si.positionedGlyphs;let pa=0;if(!pn.length()){Ct+=ct,++No;continue}const Fo=v(dt,pn,Ni);for(let La=0;La<pn.length();La++){const Qn=pn.getSection(La),si=pn.getSectionIndex(La),li=pn.getCharCode(La),$n=A(ht,jt,li);let nn;if(Qn.imageName){if(Ie.iconsInText=!0,Qn.scale=Qn.scale*Ni,nn=X(Qn,$n,ai,Fo,dt),!nn)continue;pa=Math.max(pa,nn.imageOffset)}else if(nn=D(Qn,li,$n,Fo,je,Xe),!nn)continue;const{rect:Hs,metrics:Mp,baselineOffset:Ws}=nn;Ti.push({glyph:li,imageName:Qn.imageName,x:Rt,y:Ct+Ws+-17,vertical:$n,scale:Qn.scale,fontStack:Qn.fontStack,sectionIndex:si,metrics:Mp,rect:Hs}),$n?(Ie.verticalizable=!0,Rt+=(Qn.imageName?Mp.advance:Nn)*Qn.scale+qe):Rt+=Mp.advance*Qn.scale+qe}Ti.length!==0&&(_r=Math.max(Rt-qe,_r),pe(Ti,0,Ti.length-1,Jn)),Rt=0,Si.lineOffset=Math.max(pa,(ai-1)*Nn);const oi=ct*ai+pa;Ct+=oi,vn=Math.max(oi,vn),++No}const{horizontalAlign:za,verticalAlign:wi}=c(At);(function(pn,ai,Si,Ti,pa,Fo,oi,La,Qn){const si=(ai-Si)*pa;let li=0;li=Fo!==oi?-La*Ti- -17:-Ti*Qn*oi+.5*oi;for(const $n of pn)for(const nn of $n.positionedGlyphs)nn.x+=si,nn.y+=li})(Ie.positionedLines,Jn,za,wi,_r,vn,ct,Ct,at.length),Ie.top+=-wi*Ct,Ie.bottom=Ie.top+Ct,Ie.left+=-za*_r,Ie.right=Ie.left+_r})(fe,t,r,o,ee,_,w,P,F,I,U,q),!(function(Ie){for(const je of Ie)if(je.positionedGlyphs.length!==0)return!1;return!0})(he)&&fe}const Du={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Rm={40:!0};function Eh(n,t,r,o,h,y){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*Nn/y+h:0}{const _=r[t.fontStack],w=_&&_[n];return w?w.metrics.advance*t.scale+h:0}}function Rf(n,t,r,o){const h=Math.pow(n-t,2);return o?n<t?h/2:2*h:h+Math.abs(r)*r}function Ih(n,t,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Df(n,t,r,o,h,y){let _=null,w=Rf(t,r,h,y);for(const P of o){const I=Rf(t-P.x,r,h,y)+P.badness;I<=w&&(_=P,w=I)}return{index:n,x:t,priorBreak:_,badness:w}}function Ah(n){return n?Ah(n.priorBreak).concat(n.index):[]}function a(n,t,r,o,h,y){if(!n)return[];const _=[],w=(function(F,U,$,q,H,ee){let ae=0;for(let Se=0;Se<F.length();Se++){const he=F.getSection(Se);ae+=Eh(F.getCharCode(Se),he,q,H,U,ee)}return ae/Math.max(1,Math.ceil(ae/$))})(n,t,r,o,h,y),P=n.text.indexOf("")>=0;let I=0;for(let F=0;F<n.length();F++){const U=n.getSection(F),$=n.getCharCode(F);if(Du[$]||(I+=Eh($,U,o,h,t,y)),F<n.length()-1){const q=!((L=$)<11904)&&(!!hr["CJK Compatibility Forms"](L)||!!hr["CJK Compatibility"](L)||!!hr["CJK Strokes"](L)||!!hr["CJK Symbols and Punctuation"](L)||!!hr["Enclosed CJK Letters and Months"](L)||!!hr["Halfwidth and Fullwidth Forms"](L)||!!hr["Ideographic Description Characters"](L)||!!hr["Vertical Forms"](L)||qi.test(String.fromCodePoint(L)));(Lf[$]||q||U.imageName||F!==n.length()-2&&Rm[n.getCharCode(F+1)])&&_.push(Df(F+1,I,w,_,Ih($,n.getCharCode(F+1),q&&P),!1))}}var L;return Ah(Df(n.length(),I,w,_,0,!0))}function c(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function v(n,t,r){const o=t.getMaxScale()*Nn,{maxImageWidth:h,maxImageHeight:y}=t.getMaxImageSize(n),_=Math.max(o,y*r);return{verticalLineContentWidth:Math.max(o,h*r),horizontalLineContentHeight:_}}function C(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function A(n,t,r){return!(n===b.ao.horizontal||!t&&!ic(r)||t&&(Du[r]||(o=r,/\p{sc=Arab}/u.test(String.fromCodePoint(o)))));var o}function D(n,t,r,o,h,y){const _=y[n.fontStack],w=(function(I,L,F,U){if(I&&I.rect)return I;const $=L[F.fontStack],q=$&&$[U];return q?{rect:null,metrics:q.metrics}:null})(_&&_[t],h,n,t);if(w===null)return null;let P;if(r)P=o.verticalLineContentWidth-n.scale*Nn;else{const I=C(n.verticalAlign);P=(o.horizontalLineContentHeight-n.scale*Nn)*I}return{rect:w.rect,metrics:w.metrics,baselineOffset:P}}function X(n,t,r,o,h){const y=h[n.imageName];if(!y)return null;const _=y.paddedRect,w=y.displaySize,P={width:w[0],height:w[1],left:1,top:-3,advance:t?w[1]:w[0]};let I;if(t)I=o.verticalLineContentWidth-w[1]*n.scale;else{const L=C(n.verticalAlign);I=(o.horizontalLineContentHeight-w[1]*n.scale)*L}return{rect:_,metrics:P,baselineOffset:I,imageOffset:(t?w[0]:w[1])*n.scale-Nn*r}}function pe(n,t,r,o){if(o===0)return;const h=n[r],y=(n[r].x+h.metrics.advance*h.scale)*o;for(let _=t;_<=r;_++)n[_].x-=y}function ve(n,t,r){const{horizontalAlign:o,verticalAlign:h}=c(r),y=t[0]-n.displaySize[0]*o,_=t[1]-n.displaySize[1]*h;return{image:n,top:_,bottom:_+n.displaySize[1],left:y,right:y+n.displaySize[0]}}function Oe(n){var t,r;let o=n.left,h=n.top,y=n.right-o,_=n.bottom-h;const w=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",P=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(P==="proportional"){if(w==="stretchOnly"&&y/_<I||w==="proportional"){const L=Math.ceil(_*I);o*=L/y,y=L}}else if(w==="proportional"&&P==="stretchOnly"&&I!==0&&y/_>I){const L=Math.ceil(y/I);h*=L/_,_=L}return{x1:o,y1:h,x2:o+y,y2:h+_}}function rt(n,t,r,o,h,y){const _=n.image;let w;if(_.content){const ee=_.content,ae=_.pixelRatio||1;w=[ee[0]/ae,ee[1]/ae,_.displaySize[0]-ee[2]/ae,_.displaySize[1]-ee[3]/ae]}const P=t.left*y,I=t.right*y;let L,F,U,$;r==="width"||r==="both"?($=h[0]+P-o[3],F=h[0]+I+o[1]):($=h[0]+(P+I-_.displaySize[0])/2,F=$+_.displaySize[0]);const q=t.top*y,H=t.bottom*y;return r==="height"||r==="both"?(L=h[1]+q-o[0],U=h[1]+H+o[2]):(L=h[1]+(q+H-_.displaySize[1])/2,U=L+_.displaySize[1]),{image:_,top:L,right:F,bottom:U,left:$,collisionPadding:w}}const et=128,Ye=32640;function Tt(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Fr(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=r;let y=0;for(;y<o.length&&o[y]<=n;)y++;y=Math.max(0,y-1);let _=y;for(;_<o.length&&o[_]<n+1;)_++;_=Math.min(o.length-1,_);const w=o[y],P=o[_];return r.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:P,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:P,minSize:r.evaluate(new Fr(w)),maxSize:r.evaluate(new Fr(P)),interpolationType:h}}}function Et(n,t,r){let o="never";const h=n.get(t);return h?o=h:n.get(r)&&(o="always"),o}const Lt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hn(n,t,r,o,h,y,_,w,P,I,L,F,U){const $=w?Math.min(Ye,Math.round(w[0])):0,q=w?Math.min(Ye,Math.round(w[1])):0;n.emplaceBack(t,r,Math.round(32*o),Math.round(32*h),y,_,($<<1)+(P?1:0),q,16*I,16*L,256*F,256*U)}function ze(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function Ce(n){for(const t of n.sections)if(bu(t.text))return!0;return!1}class Fe{constructor(t){this.layoutVertexArray=new it,this.indexArray=new Br,this.programConfigurations=t,this.segments=new Zt,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new St,this.hasVisibleVertices=!1,this.placedSymbolArray=new G}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Pf.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Lt,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mt("SymbolBuffers",Fe);class ut{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Zt,this.collisionVertexArray=new Sr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Cn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mt("CollisionBuffers",ut);class It{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tt(this.zoom,r["text-size"]),this.iconSizeData=Tt(this.zoom,r["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),y=o.get("symbol-z-order");this.canOverlap=Et(o,"text-overlap","text-allow-overlap")!=="never"||Et(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((_=>b.ao[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Fe(new Li(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Fe(new Li(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new re,this.lineVertexArray=new ne,this.symbolInstances=new te,this.textAnchorOffsets=new ie}calculateGlyphDependencies(t,r,o,h,y){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,(o||h)&&y){const w=Ph[t.charAt(_)];w&&(r[w.charCodeAt(0)]=!0)}}populate(t,r,o){const h=this.layers[0],y=h.layout,_=y.get("text-font"),w=y.get("text-field"),P=y.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof un&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),L=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,F=y.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const U=r.iconDependencies,$=r.glyphDependencies,q=r.availableImages,H=new Fr(this.zoom,{globalState:this.globalState});for(const{feature:ee,id:ae,index:Se,sourceLayerIndex:he}of t){const fe=h._featureFilter.needGeometry,Ie=zo(ee,fe);if(!h._featureFilter.filter(H,Ie,o))continue;let je,Xe;if(fe||(Ie.geometry=eo(ee)),I){const at=h.getValueAndResolveTokens("text-field",Ie,o,q),ct=un.factory(at),At=this.hasRTLText=this.hasRTLText||Ce(ct);(!At||aa.getRTLTextPluginStatus()==="unavailable"||At&&aa.isParsed())&&(je=Am(ct,h,Ie))}if(L){const at=h.getValueAndResolveTokens("icon-image",Ie,o,q);Xe=at instanceof Bi?at:Bi.fromString(at)}if(!je&&!Xe)continue;const dt=this.sortFeaturesByKey?F.evaluate(Ie,{},o):void 0;if(this.features.push({id:ae,text:je,icon:Xe,index:Se,sourceLayerIndex:he,geometry:Ie.geometry,properties:ee.properties,type:Ia.types[ee.type],sortKey:dt}),Xe&&(U[Xe.name]=!0),je){const at=_.evaluate(Ie,{},o).join(","),ct=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.ao.vertical)>=0;for(const At of je.sections)if(At.image)U[At.image.name]=!0;else{const ot=Al(je.toString()),ht=At.fontStack||at,qe=$[ht]=$[ht]||{};this.calculateGlyphDependencies(At.text,qe,ct,this.allowVerticalPlacement,ot)}}}y.get("symbol-placement")==="line"&&(this.features=(function(ee){const ae={},Se={},he=[];let fe=0;function Ie(at){he.push(ee[at]),fe++}function je(at,ct,At){const ot=Se[at];return delete Se[at],Se[ct]=ot,he[ot].geometry[0].pop(),he[ot].geometry[0]=he[ot].geometry[0].concat(At[0]),ot}function Xe(at,ct,At){const ot=ae[ct];return delete ae[ct],ae[at]=ot,he[ot].geometry[0].shift(),he[ot].geometry[0]=At[0].concat(he[ot].geometry[0]),ot}function dt(at,ct,At){const ot=At?ct[0][ct[0].length-1]:ct[0][0];return`${at}:${ot.x}:${ot.y}`}for(let at=0;at<ee.length;at++){const ct=ee[at],At=ct.geometry,ot=ct.text?ct.text.toString():null;if(!ot){Ie(at);continue}const ht=dt(ot,At),qe=dt(ot,At,!0);if(ht in Se&&qe in ae&&Se[ht]!==ae[qe]){const jt=Xe(ht,qe,At),Ht=je(ht,qe,he[jt].geometry);delete ae[ht],delete Se[qe],Se[dt(ot,he[Ht].geometry,!0)]=Ht,he[jt].geometry=null}else ht in Se?je(ht,qe,At):qe in ae?Xe(ht,qe,At):(Ie(at),ae[ht]=fe-1,Se[qe]=fe-1)}return he.filter((at=>at.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ee,ae)=>ee.sortKey-ae.sortKey))}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(r[t.segment+1]),y=t.dist(r[t.segment]);const _={};for(let w=t.segment+1;w<r.length;w++)_[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:h},w<r.length-1&&(h+=r[w+1].dist(r[w]));for(let w=t.segment||0;w>=0;w--)_[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:y},w>0&&(y+=r[w-1].dist(r[w]));for(let w=0;w<r.length;w++){const P=_[w];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,h,y,_,w,P,I,L,F,U){const $=t.indexArray,q=t.layoutVertexArray,H=t.segments.prepareSegment(4*r.length,q,$,this.canOverlap?_.sortKey:void 0),ee=this.glyphOffsetArray.length,ae=H.vertexLength,Se=this.allowVerticalPlacement&&w===b.ao.vertical?Math.PI/2:0,he=_.text&&_.text.sections;for(let fe=0;fe<r.length;fe++){const{tl:Ie,tr:je,bl:Xe,br:dt,tex:at,pixelOffsetTL:ct,pixelOffsetBR:At,minFontScaleX:ot,minFontScaleY:ht,glyphOffset:qe,isSDF:jt,sectionIndex:Ht}=r[fe],Rt=H.vertexLength,Ct=qe[1];hn(q,P.x,P.y,Ie.x,Ct+Ie.y,at.x,at.y,o,jt,ct.x,ct.y,ot,ht),hn(q,P.x,P.y,je.x,Ct+je.y,at.x+at.w,at.y,o,jt,At.x,ct.y,ot,ht),hn(q,P.x,P.y,Xe.x,Ct+Xe.y,at.x,at.y+at.h,o,jt,ct.x,At.y,ot,ht),hn(q,P.x,P.y,dt.x,Ct+dt.y,at.x+at.w,at.y+at.h,o,jt,At.x,At.y,ot,ht),ze(t.dynamicLayoutVertexArray,P,Se),$.emplaceBack(Rt,Rt+2,Rt+1),$.emplaceBack(Rt+1,Rt+2,Rt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qe[0]),fe!==r.length-1&&Ht===r[fe+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,_,_.index,{},U,he&&he[Ht])}t.placedSymbolArray.emplaceBack(P.x,P.y,ee,this.glyphOffsetArray.length-ee,ae,I,L,P.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],w,0,!1,0,F)}_addCollisionDebugVertex(t,r,o,h,y,_){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,h,y,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,r,o,h,y,_,w){const P=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=P.vertexLength,L=y.layoutVertexArray,F=y.collisionVertexArray,U=w.anchorX,$=w.anchorY;this._addCollisionDebugVertex(L,F,_,U,$,new N(t,r)),this._addCollisionDebugVertex(L,F,_,U,$,new N(o,r)),this._addCollisionDebugVertex(L,F,_,U,$,new N(o,h)),this._addCollisionDebugVertex(L,F,_,U,$,new N(t,h)),P.vertexLength+=4;const q=y.indexArray;q.emplaceBack(I,I+1),q.emplaceBack(I+1,I+2),q.emplaceBack(I+2,I+3),q.emplaceBack(I+3,I),P.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,h){for(let y=t;y<r;y++){const _=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ut(Jt,Mf.members,zr),this.iconCollisionBox=new ut(Jt,Mf.members,zr);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,h,y,_,w,P,I){const L={};for(let F=r;F<o;F++){const U=t.get(F);L.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},L.textFeatureIndex=U.featureIndex;break}for(let F=h;F<y;F++){const U=t.get(F);L.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},L.verticalTextFeatureIndex=U.featureIndex;break}for(let F=_;F<w;F++){const U=t.get(F);L.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},L.iconFeatureIndex=U.featureIndex;break}for(let F=P;F<I;F++){const U=t.get(F);L.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},L.verticalIconFeatureIndex=U.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),h=o.vertexStartIndex+4*o.numGlyphs;for(let y=o.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+2,y+1),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),h=[],y=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const P=this.symbolInstances.get(w);h.push(0|Math.round(r*P.anchorX+o*P.anchorY)),y.push(P.featureIndex)}return _.sort(((w,P)=>h[w]-h[P]||y[P]-y[w])),_}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((h,y,_)=>{h>=0&&_.indexOf(h)===y&&this.addIndicesForPlacedSymbol(this.text,h)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Vt,$t;mt("SymbolBucket",It,{omit:["layers","collisionBoxArray","features","compareText"]}),It.MAX_GLYPHS=65535,It.addDynamicAttributes=ze;var Kt={get paint(){return $t=$t||new Wn({"icon-opacity":new zt(Te.paint_symbol["icon-opacity"]),"icon-color":new zt(Te.paint_symbol["icon-color"]),"icon-halo-color":new zt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(Te.paint_symbol["text-opacity"]),"text-color":new zt(Te.paint_symbol["text-color"],{runtimeType:jn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new zt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new zt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(Te.paint_symbol["text-halo-blur"]),"text-translate":new wt(Te.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Te.paint_symbol["text-translate-anchor"])})},get layout(){return Vt=Vt||new Wn({"symbol-placement":new wt(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new wt(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new wt(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(Te.layout_symbol["icon-size"]),"icon-text-fit":new wt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(Te.layout_symbol["icon-image"]),"icon-rotate":new zt(Te.layout_symbol["icon-rotate"]),"icon-padding":new zt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(Te.layout_symbol["icon-offset"]),"icon-anchor":new zt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Te.layout_symbol["text-rotation-alignment"]),"text-field":new zt(Te.layout_symbol["text-field"]),"text-font":new zt(Te.layout_symbol["text-font"]),"text-size":new zt(Te.layout_symbol["text-size"]),"text-max-width":new zt(Te.layout_symbol["text-max-width"]),"text-line-height":new wt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new zt(Te.layout_symbol["text-justify"]),"text-radial-offset":new zt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zt(Te.layout_symbol["text-anchor"]),"text-max-angle":new wt(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Te.layout_symbol["text-writing-mode"]),"text-rotate":new zt(Te.layout_symbol["text-rotate"]),"text-padding":new wt(Te.layout_symbol["text-padding"]),"text-keep-upright":new wt(Te.layout_symbol["text-keep-upright"]),"text-transform":new zt(Te.layout_symbol["text-transform"]),"text-offset":new zt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new wt(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new wt(Te.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Te.layout_symbol["text-optional"])})}};class Yn{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:il,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt("FormatSectionOverride",Yn,{omit:["defaultValue"]});class Mr extends Xn{constructor(t){super(t,Kt)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const y of o)h.indexOf(y)<0&&h.push(y);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,h){const y=this.layout.get(t).evaluate(r,{},o,h),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||ss(_.value)||!y?y:(function(w,P){return P.replace(/{([^{}]+)}/g,((I,L)=>w&&L in w?String(w[L]):""))})(r.properties,y)}createBucket(t){return new It(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Kt.paint.overridableProperties){if(!Mr.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new Yn(r),h=new Tl(o,r.property.specification);let y=null;y=r.value.kind==="constant"||r.value.kind==="source"?new zs("source",h):new Ls("composite",h,r.value.zoomStops),this.paint._values[t]=new mi(r.property,y,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Mr.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),h=Kt.paint.properties[r];let y=!1;const _=w=>{for(const P of w)if(h.overrides&&h.overrides.hasOverride(P))return void(y=!0)};if(o.value.kind==="constant"&&o.value.value instanceof un)_(o.value.value.sections);else if(o.value.kind==="source"){const w=I=>{y||(I instanceof ji&&Bt(I.value)===co?_(I.value.sections):I instanceof Ps?_(I.sections):I.eachChild(w))},P=o.value;P._styleExpression&&w(P._styleExpression.expression)}return y}}let Zs;var Dm={get paint(){return Zs=Zs||new Wn({"background-color":new wt(Te.paint_background["background-color"]),"background-pattern":new Ya(Te.paint_background["background-pattern"]),"background-opacity":new wt(Te.paint_background["background-opacity"])})}};class Sv extends Xn{constructor(t){super(t,Dm)}}let cy;var Tv={get paint(){return cy=cy||new Wn({"raster-opacity":new wt(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Te.paint_raster["raster-saturation"]),"raster-contrast":new wt(Te.paint_raster["raster-contrast"]),"raster-resampling":new wt(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Te.paint_raster["raster-fade-duration"])})}};class Cv extends Xn{constructor(t){super(t,Tv)}}class Pv extends Xn{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Mv{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const kv={once:!0},Nm=63710088e-1;class Tc{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tc(Ir(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,h=t.lat*r,y=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((t.lng-this.lng)*r);return Nm*Math.acos(Math.min(y,1))}static convert(t){if(t instanceof Tc)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Tc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Tc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const hy=2*Math.PI*Nm;function py(n){return hy*Math.cos(n*Math.PI/180)}function dy(n){return(180+n)/360}function fy(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function my(n,t){return n/py(t)}function Fm(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function gy(n,t){return n*py(Fm(t))}class Ed{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=Tc.convert(t);return new Ed(dy(o.lng),fy(o.lat),my(r,o.lat))}toLngLat(){return new Tc(360*this.x-180,Fm(this.y))}toAltitude(){return gy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hy*(t=Fm(this.y),1/Math.cos(t*Math.PI/180));var t}}function yy(n,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Bm{constructor(t,r,o){if(!(function(h,y,_){return!(h<0||h>25||_<0||_>=Math.pow(2,h)||y<0||y>=Math.pow(2,h))})(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Cp(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const h=(_=this.y,w=this.z,P=yy(256*(y=this.x),256*(_=Math.pow(2,w)-_-1),w),I=yy(256*(y+1),256*(_+1),w),P[0]+","+P[1]+","+I[0]+","+I[1]);var y,_,w,P,I;const L=(function(F,U,$){let q,H="";for(let ee=F;ee>0;ee--)q=1<<ee-1,H+=(U&q?1:0)+($&q?2:0);return H})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new N((t.x*r-this.x)*_t,(t.y*r-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _y{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Cp(t,r.z,r.z,r.x,r.y)}}class Do{constructor(t,r,o,h,y){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Bm(o,+h,+y),this.key=Cp(r,t,o,h,y)}clone(){return new Do(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Do(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Do(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Cp(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Cp(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Do(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new Do(r,this.wrap,r,o,h),new Do(r,this.wrap,r,o+1,h),new Do(r,this.wrap,r,o,h+1),new Do(r,this.wrap,r,o+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Do(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Do(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _y(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ed(t.x-this.wrap,t.y))}}function Cp(n,t,r,o,h){(n*=2)<0&&(n=-1*n-1);const y=1<<r;return(y*y*n+y*h+o).toString(36)+r.toString(36)+t.toString(36)}function Id(n,t){return t?n.properties[t]:n.id}mt("CanonicalTileID",Bm),mt("OverscaledTileID",Do,{omit:["terrainRttPosMatrix32f"]});class zh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new zh;return r.extend(t(new N(this.minX,this.minY))),r.extend(t(new N(this.maxX,this.minY))),r.extend(t(new N(this.minX,this.maxY))),r.extend(t(new N(this.maxX,this.maxY))),r}static fromPoints(t){const r=new zh;for(const o of t)r.extend(o);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class vy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class xy{constructor(t,r,o,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=h,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class by{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Xa(_t,16,0),this.grid3D=new Xa(_t,16,0),this.featureIndexArray=new me,this.promoteId=r}insert(t,r,o,h,y,_){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,y);const P=_?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const L=r[I],F=[1/0,1/0,-1/0,-1/0];for(let U=0;U<L.length;U++){const $=L[U];F[0]=Math.min(F[0],$.x),F[1]=Math.min(F[1],$.y),F[2]=Math.max(F[2],$.x),F[3]=Math.max(F[3],$.y)}F[0]<_t&&F[1]<_t&&F[2]>=0&&F[3]>=0&&P.insert(w,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yp(new Mh(this.rawTileData)).layers,this.sourceLayerCoder=new vy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,h){this.loadVTLayers();const y=t.params,_=_t/t.tileSize/t.scale,w=Za(y.filter),P=t.queryGeometry,I=t.queryPadding*_,L=zh.fromPoints(P),F=this.grid.query(L.minX-I,L.minY-I,L.maxX+I,L.maxY+I),U=zh.fromPoints(t.cameraQueryGeometry).expandBy(I),$=this.grid3D.query(U.minX,U.minY,U.maxX,U.maxY,((ee,ae,Se,he)=>(function(fe,Ie,je,Xe,dt){for(const ct of fe)if(Ie<=ct.x&&je<=ct.y&&Xe>=ct.x&&dt>=ct.y)return!0;const at=[new N(Ie,je),new N(Ie,dt),new N(Xe,dt),new N(Xe,je)];if(fe.length>2){for(const ct of at)if(Pu(fe,ct))return!0}for(let ct=0;ct<fe.length-1;ct++)if(ad(fe[ct],fe[ct+1],at))return!0;return!1})(t.cameraQueryGeometry,ee-I,ae-I,Se+I,he+I)));for(const ee of $)F.push(ee);F.sort(Ev);const q={};let H;for(let ee=0;ee<F.length;ee++){const ae=F[ee];if(ae===H)continue;H=ae;const Se=this.featureIndexArray.get(ae);let he=null;this.loadMatchingFeature(q,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,w,y.layers,y.availableImages,r,o,h,((fe,Ie,je)=>(he||(he=eo(fe)),Ie.queryIntersectsFeature({queryGeometry:P,feature:fe,featureState:je,geometry:he,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return q}loadMatchingFeature(t,r,o,h,y,_,w,P,I,L,F){const U=this.bucketLayerIDs[r];if(_&&!U.some((ee=>_.has(ee))))return;const $=this.sourceLayerCoder.decode(o),q=this.vtLayers[$].feature(h);if(y.needGeometry){const ee=zo(q,!0);if(!y.filter(new Fr(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!y.filter(new Fr(this.tileID.overscaledZ),q))return;const H=this.getId(q,$);for(let ee=0;ee<U.length;ee++){const ae=U[ee];if(_&&!_.has(ae))continue;const Se=P[ae];if(!Se)continue;let he={};H&&L&&(he=L.getState(Se.sourceLayer||"_geojsonTileLayer",H));const fe=cr({},I[ae]);fe.paint=wy(fe.paint,Se.paint,q,he,w),fe.layout=wy(fe.layout,Se.layout,q,he,w);const Ie=!F||F(q,Se,he);if(!Ie)continue;const je=new xy(q,this.z,this.x,this.y,H);je.layer=fe;let Xe=t[ae];Xe===void 0&&(Xe=t[ae]=[]),Xe.push({featureIndex:h,feature:je,intersectionZ:Ie})}}lookupSymbolFeatures(t,r,o,h,y,_,w,P){const I={};this.loadVTLayers();const L=Za(y);for(const F of t)this.loadMatchingFeature(I,o,h,F,L,_,w,P,r);return I}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){var o;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function wy(n,t,r,o,h){return Bn(n,((y,_)=>{const w=t instanceof wu?t.get(_):null;return w&&w.evaluate?w.evaluate(r,o,h):w}))}function Ev(n,t){return t-n}function Sy(n,t,r,o,h){const y=[];for(let _=0;_<n.length;_++){const w=n[_];let P;for(let I=0;I<w.length-1;I++){let L=w[I],F=w[I+1];L.x<t&&F.x<t||(L.x<t?L=new N(t,L.y+(t-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<t&&(F=new N(t,L.y+(t-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<r&&F.y<r||(L.y<r?L=new N(L.x+(r-L.y)/(F.y-L.y)*(F.x-L.x),r)._round():F.y<r&&(F=new N(L.x+(r-L.y)/(F.y-L.y)*(F.x-L.x),r)._round()),L.x>=o&&F.x>=o||(L.x>=o?L=new N(o,L.y+(o-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=o&&(F=new N(o,L.y+(o-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=h&&F.y>=h||(L.y>=h?L=new N(L.x+(h-L.y)/(F.y-L.y)*(F.x-L.x),h)._round():F.y>=h&&(F=new N(L.x+(h-L.y)/(F.y-L.y)*(F.x-L.x),h)._round()),P&&L.equals(P[P.length-1])||(P=[L],y.push(P)),P.push(F)))))}}return y}mt("FeatureIndex",by,{omit:["rawTileData","sourceLayerCoder"]});class Cc extends N{constructor(t,r,o,h){super(t,r),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new Cc(this.x,this.y,this.angle,this.segment)}}function Ty(n,t,r,o,h){if(t.segment===void 0||r===0)return!0;let y=t,_=t.segment+1,w=0;for(;w>-r/2;){if(_--,_<0)return!1;w-=n[_].dist(y),y=n[_]}w+=n[_].dist(n[_+1]),_++;const P=[];let I=0;for(;w<r/2;){const L=n[_],F=n[_+1];if(!F)return!1;let U=n[_-1].angleTo(L)-L.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:w,angleDelta:U}),I+=U;w-P[0].distance>o;)I-=P.shift().angleDelta;if(I>h)return!1;_++,w+=L.dist(F)}return!0}function Cy(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function Py(n,t,r){return n?.6*t*r:0}function My(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Iv(n,t,r,o,h,y){const _=Py(r,h,y),w=My(r,o)*y;let P=0;const I=Cy(n)/2;for(let L=0;L<n.length-1;L++){const F=n[L],U=n[L+1],$=F.dist(U);if(P+$>I){const q=(I-P)/$,H=va.number(F.x,U.x,q),ee=va.number(F.y,U.y,q),ae=new Cc(H,ee,U.angleTo(F),L);return ae._round(),!_||Ty(n,ae,w,_,t)?ae:void 0}P+=$}}function Av(n,t,r,o,h,y,_,w,P){const I=Py(o,y,_),L=My(o,h),F=L*_,U=n[0].x===0||n[0].x===P||n[0].y===0||n[0].y===P;return t-F<t/4&&(t=F+t/4),ky(n,U?t/2*w%t:(L/2+2*y)*_*w%t,t,I,r,F,U,!1,P)}function ky(n,t,r,o,h,y,_,w,P){const I=y/2,L=Cy(n);let F=0,U=t-r,$=[];for(let q=0;q<n.length-1;q++){const H=n[q],ee=n[q+1],ae=H.dist(ee),Se=ee.angleTo(H);for(;U+r<F+ae;){U+=r;const he=(U-F)/ae,fe=va.number(H.x,ee.x,he),Ie=va.number(H.y,ee.y,he);if(fe>=0&&fe<P&&Ie>=0&&Ie<P&&U-I>=0&&U+I<=L){const je=new Cc(fe,Ie,Se,q);je._round(),o&&!Ty(n,je,y,o,h)||$.push(je)}}F+=ae}return w||$.length||_||($=ky(n,F/2,r,o,h,y,_,!0,P)),$}function Ey(n,t,r,o){const h=[],y=n.image,_=y.pixelRatio,w=y.paddedRect.w-2,P=y.paddedRect.h-2;let I={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const L=y.stretchX||[[0,w]],F=y.stretchY||[[0,P]],U=(qe,jt)=>qe+jt[1]-jt[0],$=L.reduce(U,0),q=F.reduce(U,0),H=w-$,ee=P-q;let ae=0,Se=$,he=0,fe=q,Ie=0,je=H,Xe=0,dt=ee;if(y.content&&o){const qe=y.content,jt=qe[2]-qe[0],Ht=qe[3]-qe[1];(y.textFitWidth||y.textFitHeight)&&(I=Oe(n)),ae=Nf(L,0,qe[0]),he=Nf(F,0,qe[1]),Se=Nf(L,qe[0],qe[2]),fe=Nf(F,qe[1],qe[3]),Ie=qe[0]-ae,Xe=qe[1]-he,je=jt-Se,dt=Ht-fe}const at=I.x1,ct=I.y1,At=I.x2-at,ot=I.y2-ct,ht=(qe,jt,Ht,Rt)=>{const Ct=Ff(qe.stretch-ae,Se,At,at),_r=Bf(qe.fixed-Ie,je,qe.stretch,$),vn=Ff(jt.stretch-he,fe,ot,ct),Jn=Bf(jt.fixed-Xe,dt,jt.stretch,q),Ni=Ff(Ht.stretch-ae,Se,At,at),No=Bf(Ht.fixed-Ie,je,Ht.stretch,$),za=Ff(Rt.stretch-he,fe,ot,ct),wi=Bf(Rt.fixed-Xe,dt,Rt.stretch,q),pn=new N(Ct,vn),ai=new N(Ni,vn),Si=new N(Ni,za),Ti=new N(Ct,za),pa=new N(_r/_,Jn/_),Fo=new N(No/_,wi/_),oi=t*Math.PI/180;if(oi){const si=Math.sin(oi),li=Math.cos(oi),$n=[li,-si,si,li];pn._matMult($n),ai._matMult($n),Ti._matMult($n),Si._matMult($n)}const La=qe.stretch+qe.fixed,Qn=jt.stretch+jt.fixed;return{tl:pn,tr:ai,bl:Ti,br:Si,tex:{x:y.paddedRect.x+1+La,y:y.paddedRect.y+1+Qn,w:Ht.stretch+Ht.fixed-La,h:Rt.stretch+Rt.fixed-Qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pa,pixelOffsetBR:Fo,minFontScaleX:je/_/At,minFontScaleY:dt/_/ot,isSDF:r}};if(o&&(y.stretchX||y.stretchY)){const qe=Iy(L,H,$),jt=Iy(F,ee,q);for(let Ht=0;Ht<qe.length-1;Ht++){const Rt=qe[Ht],Ct=qe[Ht+1];for(let _r=0;_r<jt.length-1;_r++)h.push(ht(Rt,jt[_r],Ct,jt[_r+1]))}}else h.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:P+1}));return h}function Nf(n,t,r){let o=0;for(const h of n)o+=Math.max(t,Math.min(r,h[1]))-Math.max(t,Math.min(r,h[0]));return o}function Iy(n,t,r){const o=[{fixed:-1,stretch:0}];for(const[h,y]of n){const _=o[o.length-1];o.push({fixed:h-_.stretch,stretch:_.stretch}),o.push({fixed:h-_.stretch,stretch:_.stretch+(y-h)})}return o.push({fixed:t+1,stretch:r}),o}function Ff(n,t,r,o){return n/t*r+o}function Bf(n,t,r,o){return n-t*r/o}mt("Anchor",Cc);class jf{constructor(t,r,o,h,y,_,w,P,I,L){var F;if(this.boxStartIndex=t.length,I){let U=_.top,$=_.bottom;const q=_.collisionPadding;q&&(U-=q[1],$+=q[3]);let H=$-U;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const U=!((F=_.image)===null||F===void 0)&&F.content&&(_.image.textFitWidth||_.image.textFitHeight)?Oe(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};U.y1=U.y1*w-P[0],U.y2=U.y2*w+P[2],U.x1=U.x1*w-P[3],U.x2=U.x2*w+P[1];const $=_.collisionPadding;if($&&(U.x1-=$[0]*w,U.y1-=$[1]*w,U.x2+=$[2]*w,U.y2+=$[3]*w),L){const q=new N(U.x1,U.y1),H=new N(U.x2,U.y1),ee=new N(U.x1,U.y2),ae=new N(U.x2,U.y2),Se=L*Math.PI/180;q._rotate(Se),H._rotate(Se),ee._rotate(Se),ae._rotate(Se),U.x1=Math.min(q.x,H.x,ee.x,ae.x),U.x2=Math.max(q.x,H.x,ee.x,ae.x),U.y1=Math.min(q.y,H.y,ee.y,ae.y),U.y2=Math.max(q.y,H.y,ee.y,ae.y)}t.emplaceBack(r.x,r.y,U.x1,U.y1,U.x2,U.y2,o,h,y)}this.boxEndIndex=t.length}}class zv{constructor(t=[],r=(o,h)=>o<h?-1:o>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,h=r[t];for(;t>0;){const y=t-1>>1,_=r[y];if(o(h,_)>=0)break;r[t]=_,t=y}r[t]=h}_down(t){const{data:r,compare:o}=this,h=this.length>>1,y=r[t];for(;t<h;){let _=1+(t<<1);const w=_+1;if(w<this.length&&o(r[w],r[_])<0&&(_=w),o(r[_],y)>=0)break;r[t]=r[_],t=_}r[t]=y}}function Lv(n,t=1,r=!1){const o=zh.fromPoints(n[0]),h=Math.min(o.width(),o.height());let y=h/2;const _=new zv([],Rv),{minX:w,minY:P,maxX:I,maxY:L}=o;if(h===0)return new N(w,P);for(let $=w;$<I;$+=h)for(let q=P;q<L;q+=h)_.push(new Pp($+y,q+y,y,n));let F=(function($){let q=0,H=0,ee=0;const ae=$[0];for(let Se=0,he=ae.length,fe=he-1;Se<he;fe=Se++){const Ie=ae[Se],je=ae[fe],Xe=Ie.x*je.y-je.x*Ie.y;H+=(Ie.x+je.x)*Xe,ee+=(Ie.y+je.y)*Xe,q+=3*Xe}return new Pp(H/q,ee/q,0,$)})(n),U=_.length;for(;_.length;){const $=_.pop();($.d>F.d||!F.d)&&(F=$,r&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,U)),$.max-F.d<=t||(y=$.h/2,_.push(new Pp($.p.x-y,$.p.y-y,y,n)),_.push(new Pp($.p.x+y,$.p.y-y,y,n)),_.push(new Pp($.p.x-y,$.p.y+y,y,n)),_.push(new Pp($.p.x+y,$.p.y+y,y,n)),U+=4)}return r&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function Rv(n,t){return t.max-n.max}function Pp(n,t,r,o){this.p=new N(n,t),this.h=r,this.d=(function(h,y){let _=!1,w=1/0;for(let P=0;P<y.length;P++){const I=y[P];for(let L=0,F=I.length,U=F-1;L<F;U=L++){const $=I[L],q=I[U];$.y>h.y!=q.y>h.y&&h.x<(q.x-$.x)*(h.y-$.y)/(q.y-$.y)+$.x&&(_=!_),w=Math.min(w,nd(h,$,q))}}return(_?1:-1)*Math.sqrt(w)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Di;b.aE=void 0,(Di=b.aE||(b.aE={}))[Di.center=1]="center",Di[Di.left=2]="left",Di[Di.right=3]="right",Di[Di.top=4]="top",Di[Di.bottom=5]="bottom",Di[Di["top-left"]=6]="top-left",Di[Di["top-right"]=7]="top-right",Di[Di["bottom-left"]=8]="bottom-left",Di[Di["bottom-right"]=9]="bottom-right";const jm=Number.POSITIVE_INFINITY;function Ay(n,t){return t[1]!==jm?(function(r,o,h){let y=0,_=0;switch(o=Math.abs(o),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(r){case"top-right":case"bottom-right":case"right":y=-o;break;case"top-left":case"bottom-left":case"left":y=o}return[y,_]})(n,t[0],t[1]):(function(r,o){let h=0,y=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(r){case"top-right":case"top-left":y=_-7;break;case"bottom-right":case"bottom-left":y=7-_;break;case"bottom":y=7-o;break;case"top":y=o-7}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=o;break;case"right":h=-o}return[h,y]})(n,t[0])}function zy(n,t,r){var o;const h=n.layout,y=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(y){const w=y.values,P=[];for(let I=0;I<w.length;I+=2){const L=P[I]=w[I],F=w[I+1].map((U=>U*Nn));L.startsWith("top")?F[1]-=7:L.startsWith("bottom")&&(F[1]+=7),P[I+1]=F}return new En(P)}const _=h.get("text-variable-anchor");if(_){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},r)*Nn,jm]:h.get("text-offset").evaluate(t,{},r).map((I=>I*Nn));const P=[];for(const I of _)P.push(I,Ay(I,w));return new En(P)}return null}function Om(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dv(n,t,r,o,h,y,_,w,P,I,L,F){let U=y.textMaxSize.evaluate(t,{});U===void 0&&(U=_);const $=n.layers[0].layout,q=$.get("icon-offset").evaluate(t,{},L),H=Ry(r.horizontal),ee=_/24,ae=n.tilePixelRatio*ee,Se=n.tilePixelRatio*U/24,he=n.tilePixelRatio*w,fe=n.tilePixelRatio*$.get("symbol-spacing"),Ie=$.get("text-padding")*n.tilePixelRatio,je=(function(Ht,Rt,Ct,_r=1){const vn=Ht.get("icon-padding").evaluate(Rt,{},Ct),Jn=vn&&vn.values;return[Jn[0]*_r,Jn[1]*_r,Jn[2]*_r,Jn[3]*_r]})($,t,L,n.tilePixelRatio),Xe=$.get("text-max-angle")/180*Math.PI,dt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",at=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",ct=$.get("symbol-placement"),At=fe/2,ot=$.get("icon-text-fit");let ht;o&&ot!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(ht=rt(o,r.vertical,ot,$.get("icon-text-fit-padding"),q,ee)),H&&(o=rt(o,H,ot,$.get("icon-text-fit-padding"),q,ee)));const qe=L?F.line.getGranularityForZoomLevel(L.z):1,jt=(Ht,Rt)=>{Rt.x<0||Rt.x>=_t||Rt.y<0||Rt.y>=_t||(function(Ct,_r,vn,Jn,Ni,No,za,wi,pn,ai,Si,Ti,pa,Fo,oi,La,Qn,si,li,$n,nn,Hs,Mp,Ws,Bv){const kp=Ct.addToLineVertexArray(_r,vn);let Lh,Ep,Ip,Ap,By=0,jy=0,Oy=0,Uy=0,Wm=-1,Xm=-1;const Nu={};let Vy=Os("");if(Ct.allowVerticalPlacement&&Jn.vertical){const Yi=wi.layout.get("text-rotate").evaluate(nn,{},Ws)+90;Ip=new jf(pn,_r,ai,Si,Ti,Jn.vertical,pa,Fo,oi,Yi),za&&(Ap=new jf(pn,_r,ai,Si,Ti,za,Qn,si,oi,Yi))}if(Ni){const Yi=wi.layout.get("icon-rotate").evaluate(nn,{}),Bo=wi.layout.get("icon-text-fit")!=="none",Rh=Ey(Ni,Yi,Mp,Bo),Ks=za?Ey(za,Yi,Mp,Bo):void 0;Ep=new jf(pn,_r,ai,Si,Ti,Ni,Qn,si,!1,Yi),By=4*Rh.length;const Dh=Ct.iconSizeData;let Ol=null;Dh.kind==="source"?(Ol=[et*wi.layout.get("icon-size").evaluate(nn,{})],Ol[0]>Ye&&an(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Dh.kind==="composite"&&(Ol=[et*Hs.compositeIconSizes[0].evaluate(nn,{},Ws),et*Hs.compositeIconSizes[1].evaluate(nn,{},Ws)],(Ol[0]>Ye||Ol[1]>Ye)&&an(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,Rh,Ol,$n,li,nn,b.ao.none,_r,kp.lineStartIndex,kp.lineLength,-1,Ws),Wm=Ct.icon.placedSymbolArray.length-1,Ks&&(jy=4*Ks.length,Ct.addSymbols(Ct.icon,Ks,Ol,$n,li,nn,b.ao.vertical,_r,kp.lineStartIndex,kp.lineLength,-1,Ws),Xm=Ct.icon.placedSymbolArray.length-1)}const $y=Object.keys(Jn.horizontal);for(const Yi of $y){const Bo=Jn.horizontal[Yi];if(!Lh){Vy=Os(Bo.text);const Ks=wi.layout.get("text-rotate").evaluate(nn,{},Ws);Lh=new jf(pn,_r,ai,Si,Ti,Bo,pa,Fo,oi,Ks)}const Rh=Bo.positionedLines.length===1;if(Oy+=Ly(Ct,_r,Bo,No,wi,oi,nn,La,kp,Jn.vertical?b.ao.horizontal:b.ao.horizontalOnly,Rh?$y:[Yi],Nu,Wm,Hs,Ws),Rh)break}Jn.vertical&&(Uy+=Ly(Ct,_r,Jn.vertical,No,wi,oi,nn,La,kp,b.ao.vertical,["vertical"],Nu,Xm,Hs,Ws));const jv=Lh?Lh.boxStartIndex:Ct.collisionBoxArray.length,Ov=Lh?Lh.boxEndIndex:Ct.collisionBoxArray.length,Uv=Ip?Ip.boxStartIndex:Ct.collisionBoxArray.length,Vv=Ip?Ip.boxEndIndex:Ct.collisionBoxArray.length,$v=Ep?Ep.boxStartIndex:Ct.collisionBoxArray.length,qv=Ep?Ep.boxEndIndex:Ct.collisionBoxArray.length,Gv=Ap?Ap.boxStartIndex:Ct.collisionBoxArray.length,Zv=Ap?Ap.boxEndIndex:Ct.collisionBoxArray.length;let Xs=-1;const Uf=(Yi,Bo)=>Yi&&Yi.circleDiameter?Math.max(Yi.circleDiameter,Bo):Bo;Xs=Uf(Lh,Xs),Xs=Uf(Ip,Xs),Xs=Uf(Ep,Xs),Xs=Uf(Ap,Xs);const qy=Xs>-1?1:0;qy&&(Xs*=Bv/Nn),Ct.glyphOffsetArray.length>=It.MAX_GLYPHS&&an("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),nn.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,nn.sortKey);const Hv=zy(wi,nn,Ws),[Wv,Xv]=(function(Yi,Bo){const Rh=Yi.length,Ks=Bo?.values;if(Ks?.length>0)for(let Dh=0;Dh<Ks.length;Dh+=2){const Ol=Ks[Dh+1];Yi.emplaceBack(b.aE[Ks[Dh]],Ol[0],Ol[1])}return[Rh,Yi.length]})(Ct.textAnchorOffsets,Hv);Ct.symbolInstances.emplaceBack(_r.x,_r.y,Nu.right>=0?Nu.right:-1,Nu.center>=0?Nu.center:-1,Nu.left>=0?Nu.left:-1,Nu.vertical||-1,Wm,Xm,Vy,jv,Ov,Uv,Vv,$v,qv,Gv,Zv,ai,Oy,Uy,By,jy,qy,0,pa,Xs,Wv,Xv)})(n,Rt,Ht,r,o,h,ht,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ae,[Ie,Ie,Ie,Ie],dt,P,he,je,at,q,t,y,I,L,_)};if(ct==="line")for(const Ht of Sy(t.geometry,0,0,_t,_t)){const Rt=ln(Ht,qe),Ct=Av(Rt,fe,Xe,r.vertical||H,o,24,Se,n.overscaling,_t);for(const _r of Ct)H&&Nv(n,H.text,At,_r)||jt(Rt,_r)}else if(ct==="line-center"){for(const Ht of t.geometry)if(Ht.length>1){const Rt=ln(Ht,qe),Ct=Iv(Rt,Xe,r.vertical||H,o,24,Se);Ct&&jt(Rt,Ct)}}else if(t.type==="Polygon")for(const Ht of yl(t.geometry,0)){const Rt=Lv(Ht,16);jt(ln(Ht[0],qe,!0),new Cc(Rt.x,Rt.y,0))}else if(t.type==="LineString")for(const Ht of t.geometry){const Rt=ln(Ht,qe);jt(Rt,new Cc(Rt[0].x,Rt[0].y,0))}else if(t.type==="Point")for(const Ht of t.geometry)for(const Rt of Ht)jt([Rt],new Cc(Rt.x,Rt.y,0))}function Ly(n,t,r,o,h,y,_,w,P,I,L,F,U,$,q){const H=(function(Se,he,fe,Ie,je,Xe,dt,at){const ct=Ie.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,At=[];for(const ot of he.positionedLines)for(const ht of ot.positionedGlyphs){if(!ht.rect)continue;const qe=ht.rect||{};let jt=4,Ht=!0,Rt=1,Ct=0;const _r=(je||at)&&ht.vertical,vn=ht.metrics.advance*ht.scale/2;if(at&&he.verticalizable&&(Ct=ot.lineOffset/2-(ht.imageName?-(Nn-ht.metrics.width*ht.scale)/2:(ht.scale-1)*Nn)),ht.imageName){const si=dt[ht.imageName];Ht=si.sdf,Rt=si.pixelRatio,jt=1/Rt}const Jn=je?[ht.x+vn,ht.y]:[0,0];let Ni=je?[0,0]:[ht.x+vn+fe[0],ht.y+fe[1]-Ct],No=[0,0];_r&&(No=Ni,Ni=[0,0]);const za=ht.metrics.isDoubleResolution?2:1,wi=(ht.metrics.left-jt)*ht.scale-vn+Ni[0],pn=(-ht.metrics.top-jt)*ht.scale+Ni[1],ai=wi+qe.w/za*ht.scale/Rt,Si=pn+qe.h/za*ht.scale/Rt,Ti=new N(wi,pn),pa=new N(ai,pn),Fo=new N(wi,Si),oi=new N(ai,Si);if(_r){const si=new N(-vn,vn- -17),li=-Math.PI/2,$n=12-vn,nn=new N(22-$n,-(ht.imageName?$n:0)),Hs=new N(...No);Ti._rotateAround(li,si)._add(nn)._add(Hs),pa._rotateAround(li,si)._add(nn)._add(Hs),Fo._rotateAround(li,si)._add(nn)._add(Hs),oi._rotateAround(li,si)._add(nn)._add(Hs)}if(ct){const si=Math.sin(ct),li=Math.cos(ct),$n=[li,-si,si,li];Ti._matMult($n),pa._matMult($n),Fo._matMult($n),oi._matMult($n)}const La=new N(0,0),Qn=new N(0,0);At.push({tl:Ti,tr:pa,bl:Fo,br:oi,tex:qe,writingMode:he.writingMode,glyphOffset:Jn,sectionIndex:ht.sectionIndex,isSDF:Ht,pixelOffsetTL:La,pixelOffsetBR:Qn,minFontScaleX:0,minFontScaleY:0})}return At})(0,r,w,h,y,_,o,n.allowVerticalPlacement),ee=n.textSizeData;let ae=null;ee.kind==="source"?(ae=[et*h.layout.get("text-size").evaluate(_,{})],ae[0]>Ye&&an(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(ae=[et*$.compositeTextSizes[0].evaluate(_,{},q),et*$.compositeTextSizes[1].evaluate(_,{},q)],(ae[0]>Ye||ae[1]>Ye)&&an(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,H,ae,w,y,_,I,t,P.lineStartIndex,P.lineLength,U,q);for(const Se of L)F[Se]=n.text.placedSymbolArray.length-1;return 4*H.length}function Ry(n){for(const t in n)return n[t];return null}function Nv(n,t,r,o){const h=n.compareText;if(t in h){const y=h[t];for(let _=y.length-1;_>=0;_--)if(o.dist(y[_])<r)return!0}else h[t]=[];return h[t].push(o),!1}const Dy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Um{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const y=Dy[15&o];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new Um(w,_,y,t)}constructor(t,r=64,o=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const y=Dy.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-w%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+P,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+P),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+P,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Vm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:w}=this,P=[0,y.length-1,0],I=[];for(;P.length;){const L=P.pop()||0,F=P.pop()||0,U=P.pop()||0;if(F-U<=w){for(let ee=U;ee<=F;ee++){const ae=_[2*ee],Se=_[2*ee+1];ae>=t&&ae<=o&&Se>=r&&Se<=h&&I.push(y[ee])}continue}const $=U+F>>1,q=_[2*$],H=_[2*$+1];q>=t&&q<=o&&H>=r&&H<=h&&I.push(y[$]),(L===0?t<=q:r<=H)&&(P.push(U),P.push($-1),P.push(1-L)),(L===0?o>=q:h>=H)&&(P.push($+1),P.push(F),P.push(1-L))}return I}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:y,nodeSize:_}=this,w=[0,h.length-1,0],P=[],I=o*o;for(;w.length;){const L=w.pop()||0,F=w.pop()||0,U=w.pop()||0;if(F-U<=_){for(let ee=U;ee<=F;ee++)Fy(y[2*ee],y[2*ee+1],t,r)<=I&&P.push(h[ee]);continue}const $=U+F>>1,q=y[2*$],H=y[2*$+1];Fy(q,H,t,r)<=I&&P.push(h[$]),(L===0?t-o<=q:r-o<=H)&&(w.push(U),w.push($-1),w.push(1-L)),(L===0?t+o>=q:r+o>=H)&&(w.push($+1),w.push(F),w.push(1-L))}return P}}function Vm(n,t,r,o,h,y){if(h-o<=r)return;const _=o+h>>1;Ny(n,t,_,o,h,y),Vm(n,t,r,o,_-1,1-y),Vm(n,t,r,_+1,h,1-y)}function Ny(n,t,r,o,h,y){for(;h>o;){if(h-o>600){const I=h-o+1,L=r-o+1,F=Math.log(I),U=.5*Math.exp(2*F/3),$=.5*Math.sqrt(F*U*(I-U)/I)*(L-I/2<0?-1:1);Ny(n,t,r,Math.max(o,Math.floor(r-L*U/I+$)),Math.min(h,Math.floor(r+(I-L)*U/I+$)),y)}const _=t[2*r+y];let w=o,P=h;for(Ad(n,t,o,r),t[2*h+y]>_&&Ad(n,t,o,h);w<P;){for(Ad(n,t,w,P),w++,P--;t[2*w+y]<_;)w++;for(;t[2*P+y]>_;)P--}t[2*o+y]===_?Ad(n,t,o,P):(P++,Ad(n,t,P,h)),P<=r&&(o=P+1),r<=P&&(h=P-1)}}function Ad(n,t,r,o){$m(n,r,o),$m(t,2*r,2*o),$m(t,2*r+1,2*o+1)}function $m(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function Fy(n,t,r,o){const h=n-r,y=t-o;return h*h+y*y}var qm;b.cx=void 0,(qm=b.cx||(b.cx={})).create="create",qm.load="load",qm.fullLoad="fullLoad";let Of=null,zd=[];const Gm=1e3/60,Zm="loadTime",Hm="fullLoadTime",Fv={mark(n){performance.mark(n)},frame(n){const t=n;Of!=null&&zd.push(t-Of),Of=t},clearMetrics(){Of=null,zd=[],performance.clearMeasures(Zm),performance.clearMeasures(Hm);for(const n in b.cx)performance.clearMarks(b.cx[n])},getPerformanceMetrics(){performance.measure(Zm,b.cx.create,b.cx.load),performance.measure(Hm,b.cx.create,b.cx.fullLoad);const n=performance.getEntriesByName(Zm)[0].duration,t=performance.getEntriesByName(Hm)[0].duration,r=zd.length,o=1/(zd.reduce(((y,_)=>y+_),0)/r/1e3),h=zd.filter((y=>y>Gm)).reduce(((y,_)=>y+(_-Gm)/Gm),0);return{loadTime:n,fullLoadTime:t,fps:o,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};b.$=_t,b.A=nt,b.B=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},b.C=va,b.D=wt,b.E=vt,b.F=Fr,b.G=Il,b.H=function(n){if(ao==null){const t=n.navigator?n.navigator.userAgent:null;ao=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ao},b.I=kh,b.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Mv((()=>this.process())),this.subscription=oo(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=da(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((r,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=t?oo(t.signal,"abort",(()=>{y?.unsubscribe(),delete this.resolveRejects[h];const P={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(P)}),kv):null;this.resolveRejects[h]={resolve:P=>{y?.unsubscribe(),r(P)},reject:P=>{y?.unsubscribe(),o(P)}};const _=[],w=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Ii(n.data,_)});this.target.postMessage(w,{transfer:_})}))}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(da(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return s(this,void 0,void 0,(function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(fi(t.error)):h.resolve(fi(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=fi(t.data),o=new AbortController;this.abortControllers[n]=o;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}}))}completeTask(n,t,r){const o=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ii(t):null,data:Ii(r,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.K=Q,b.L=function(){var n=new nt(16);return nt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},b.M=function(n,t,r){var o,h,y,_,w,P,I,L,F,U,$,q,H=r[0],ee=r[1],ae=r[2];return t===n?(n[12]=t[0]*H+t[4]*ee+t[8]*ae+t[12],n[13]=t[1]*H+t[5]*ee+t[9]*ae+t[13],n[14]=t[2]*H+t[6]*ee+t[10]*ae+t[14],n[15]=t[3]*H+t[7]*ee+t[11]*ae+t[15]):(h=t[1],y=t[2],_=t[3],w=t[4],P=t[5],I=t[6],L=t[7],F=t[8],U=t[9],$=t[10],q=t[11],n[0]=o=t[0],n[1]=h,n[2]=y,n[3]=_,n[4]=w,n[5]=P,n[6]=I,n[7]=L,n[8]=F,n[9]=U,n[10]=$,n[11]=q,n[12]=o*H+w*ee+F*ae+t[12],n[13]=h*H+P*ee+U*ae+t[13],n[14]=y*H+I*ee+$*ae+t[14],n[15]=_*H+L*ee+q*ae+t[15]),n},b.N=function(n,t,r){var o=r[0],h=r[1],y=r[2];return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*y,n[9]=t[9]*y,n[10]=t[10]*y,n[11]=t[11]*y,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},b.O=function(n,t,r){var o=t[0],h=t[1],y=t[2],_=t[3],w=t[4],P=t[5],I=t[6],L=t[7],F=t[8],U=t[9],$=t[10],q=t[11],H=t[12],ee=t[13],ae=t[14],Se=t[15],he=r[0],fe=r[1],Ie=r[2],je=r[3];return n[0]=he*o+fe*w+Ie*F+je*H,n[1]=he*h+fe*P+Ie*U+je*ee,n[2]=he*y+fe*I+Ie*$+je*ae,n[3]=he*_+fe*L+Ie*q+je*Se,n[4]=(he=r[4])*o+(fe=r[5])*w+(Ie=r[6])*F+(je=r[7])*H,n[5]=he*h+fe*P+Ie*U+je*ee,n[6]=he*y+fe*I+Ie*$+je*ae,n[7]=he*_+fe*L+Ie*q+je*Se,n[8]=(he=r[8])*o+(fe=r[9])*w+(Ie=r[10])*F+(je=r[11])*H,n[9]=he*h+fe*P+Ie*U+je*ee,n[10]=he*y+fe*I+Ie*$+je*ae,n[11]=he*_+fe*L+Ie*q+je*Se,n[12]=(he=r[12])*o+(fe=r[13])*w+(Ie=r[14])*F+(je=r[15])*H,n[13]=he*h+fe*P+Ie*U+je*ee,n[14]=he*y+fe*I+Ie*$+je*ae,n[15]=he*_+fe*L+Ie*q+je*Se,n},b.P=N,b.Q=function(n,t){const r={};for(let o=0;o<t.length;o++){const h=t[o];h in n&&(r[h]=n[h])}return r},b.R=Wi,b.S=Tc,b.T=dc,b.U=fy,b.V=dy,b.W=Ze,b.X=He,b.Y=Na,b.Z=Do,b._=s,b.a=Z,b.a$=yr,b.a0=function(n,t){var r,o,h,y;if(!n)return t??{};if(!t)return n;const _=Object.assign({},n);if(t.removeAll&&(_.removeAll=!0),t.remove){const w=new Set(_.remove?_.remove.concat(t.remove):t.remove);_.remove=Array.from(w.values())}if(t.add){const w=_.add?_.add.concat(t.add):t.add,P=new Map(w.map((I=>[I.id,I])));_.add=Array.from(P.values())}if(t.update){const w=new Map((r=_.update)===null||r===void 0?void 0:r.map((P=>[P.id,P])));for(const P of t.update){const I=(o=w.get(P.id))!==null&&o!==void 0?o:{id:P.id};P.newGeometry&&(I.newGeometry=P.newGeometry),P.addOrUpdateProperties&&(I.addOrUpdateProperties=((h=I.addOrUpdateProperties)!==null&&h!==void 0?h:[]).concat(P.addOrUpdateProperties)),P.removeProperties&&(I.removeProperties=((y=I.removeProperties)!==null&&y!==void 0?y:[]).concat(P.removeProperties)),P.removeAllProperties&&(I.removeAllProperties=!0),w.set(P.id,I)}_.update=Array.from(w.values())}return _},b.a1=Ed,b.a2=zh,b.a3=25,b.a4=Bm,b.a5=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const o of n){const h=window.document.createElement("source");Ae(o)||(t.crossOrigin="Anonymous"),h.src=o,t.appendChild(h)}}))},b.a6=Qe,b.a7=function(){return wr++},b.a8=B,b.a9=It,b.aA=function(n){let t=1/0,r=1/0,o=-1/0,h=-1/0;for(const y of n)t=Math.min(t,y.x),r=Math.min(r,y.y),o=Math.max(o,y.x),h=Math.max(h,y.y);return[t,r,o,h]},b.aB=Nn,b.aC=bt,b.aD=function(n,t,r,o,h=!1){if(!r[0]&&!r[1])return[0,0];const y=h?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(y){const _=Math.sin(y),w=Math.cos(y);r=[r[0]*w-r[1]*_,r[0]*_+r[1]*w]}return[h?r[0]:bt(t,r[0],n.zoom),h?r[1]:bt(t,r[1],n.zoom)]},b.aF=Et,b.aG=Om,b.aH=c,b.aI=Um,b.aJ=on,b.aK=Rn,b.aL=se,b.aM=Zt,b.aN=Br,b.aO=Ir,b.aP=so,b.aQ=gy,b.aR=Pt,b.aS=Ft,b.aT=function(n){var t=new nt(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},b.aU=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},b.aV=function(n,t){var r=t[0],o=t[1],h=t[2],y=r*r+o*o+h*h;return y>0&&(y=1/Math.sqrt(y)),n[0]=t[0]*y,n[1]=t[1]*y,n[2]=t[2]*y,n},b.aW=Ur,b.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},b.aY=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},b.aZ=pt,b.a_=function(n,t,r){const o=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return o===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/o},b.aa=Za,b.ab=zo,b.ac=xy,b.ad=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,o,h,y)=>{const _=h||y;return t[o]=!_||_.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},b.ae=Zo,b.af=function(n){return Math.pow(2,n)},b.ag=Re,b.ah=Qt,b.ai=85.051129,b.aj=my,b.ak=function(n){return Math.log(n)/Math.LN2},b.al=function(n){var t=n[0],r=n[1];return t*t+r*r},b.am=function(n,t){const r=[];for(const o in n)o in t||r.push(o);return r},b.an=function(n,t){let r=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:y,maxZoom:_}=n,w=h?Qt(mn.interpolationFactor(h,t,y,_),0,1):0;n.kind==="camera"?o=va.number(n.minSize,n.maxSize,w):r=w}return{uSizeT:r,uSize:o}},b.ap=function(n,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:h}){return n.kind==="source"?o/et:n.kind==="composite"?va.number(o/et,h/et,r):t},b.aq=function(n,t){var r=t[0],o=t[1],h=t[2],y=t[3],_=t[4],w=t[5],P=t[6],I=t[7],L=t[8],F=t[9],U=t[10],$=t[11],q=t[12],H=t[13],ee=t[14],ae=t[15],Se=r*w-o*_,he=r*P-h*_,fe=r*I-y*_,Ie=o*P-h*w,je=o*I-y*w,Xe=h*I-y*P,dt=L*H-F*q,at=L*ee-U*q,ct=L*ae-$*q,At=F*ee-U*H,ot=F*ae-$*H,ht=U*ae-$*ee,qe=Se*ht-he*ot+fe*At+Ie*ct-je*at+Xe*dt;return qe?(n[0]=(w*ht-P*ot+I*At)*(qe=1/qe),n[1]=(h*ot-o*ht-y*At)*qe,n[2]=(H*Xe-ee*je+ae*Ie)*qe,n[3]=(U*je-F*Xe-$*Ie)*qe,n[4]=(P*ct-_*ht-I*at)*qe,n[5]=(r*ht-h*ct+y*at)*qe,n[6]=(ee*fe-q*Xe-ae*he)*qe,n[7]=(L*Xe-U*fe+$*he)*qe,n[8]=(_*ot-w*ct+I*dt)*qe,n[9]=(o*ct-r*ot-y*dt)*qe,n[10]=(q*je-H*fe+ae*Se)*qe,n[11]=(F*fe-L*je-$*Se)*qe,n[12]=(w*at-_*At-P*dt)*qe,n[13]=(r*At-o*at+h*dt)*qe,n[14]=(H*he-q*Ie-ee*Se)*qe,n[15]=(L*Ie-F*he+U*Se)*qe,n):null},b.ar=Rr,b.as=function(n){return Math.hypot(n[0],n[1])},b.at=function(n){return n[0]=0,n[1]=0,n},b.au=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},b.av=ze,b.aw=fr,b.ax=function(n,t,r,o){const h=t.y-n.y,y=t.x-n.x,_=o.y-r.y,w=o.x-r.x,P=_*y-w*h;if(P===0)return null;const I=(w*(n.y-r.y)-_*(n.x-r.x))/P;return new N(n.x+I*y,n.y+I*h)},b.ay=Sy,b.az=rd,b.b=fa,b.b$=class extends m{},b.b0=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},b.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},b.b2=_y,b.b3=Cp,b.b4=function(n,t,r,o,h){var y,_=1/Math.tan(t/2);return n[0]=_/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+o)*(y=1/(o-h)),n[14]=2*h*o*y):(n[10]=-1,n[14]=-2*o),n},b.b5=function(n){var t=new nt(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},b.b6=function(n,t,r){var o=Math.sin(r),h=Math.cos(r),y=t[0],_=t[1],w=t[2],P=t[3],I=t[4],L=t[5],F=t[6],U=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=y*h+I*o,n[1]=_*h+L*o,n[2]=w*h+F*o,n[3]=P*h+U*o,n[4]=I*h-y*o,n[5]=L*h-_*o,n[6]=F*h-w*o,n[7]=U*h-P*o,n},b.b7=function(n,t,r){var o=Math.sin(r),h=Math.cos(r),y=t[4],_=t[5],w=t[6],P=t[7],I=t[8],L=t[9],F=t[10],U=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=y*h+I*o,n[5]=_*h+L*o,n[6]=w*h+F*o,n[7]=P*h+U*o,n[8]=I*h-y*o,n[9]=L*h-_*o,n[10]=F*h-w*o,n[11]=U*h-P*o,n},b.b8=function(){const n=new Float32Array(16);return Re(n),n},b.b9=function(){const n=new Float64Array(16);return Re(n),n},b.bA=function(n,t){const r=Pe(n,360),o=Pe(t,360),h=o-r,y=o>r?h-360:h+360;return Math.abs(h)<Math.abs(y)?h:y},b.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},b.bC=function(n,t,r,o){const h=Math.sqrt(n*n+t*t),y=Math.sqrt(r*r+o*o);n/=h,t/=h,r/=y,o/=y;const _=Math.acos(n*r+t*o);return-t*r+n*o>0?_:-_},b.bD=function(n,t){const r=Pe(n,2*Math.PI),o=Pe(t,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},b.bE=function(){const n={},t=Te.$version;for(const r in Te.$root){const o=Te.$root[r];if(o.required){let h=null;h=r==="version"?t:o.type==="array"?[]:{},h!=null&&(n[r]=h)}}return n},b.bF=Ka,b.bG=ye,b.bH=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!n(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!n(t[o],r[o]))return!1;return!0}return t===r},b.bI=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=rr(n[r],t[n[r].ref]));return n},b.bJ=function(n){if(n.type==="custom")return new Pv(n);switch(n.type){case"background":return new Sv(n);case"circle":return new uf(n);case"color-relief":return new kt(n);case"fill":return new vc(n);case"fill-extrusion":return new Im(n);case"heatmap":return new pf(n);case"hillshade":return new Ri(n);case"line":return new zu(n);case"raster":return new Cv(n);case"symbol":return new Mr(n)}},b.bK=Pi,b.bL=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Mt(n.version,t.version))return[{command:"setStyle",args:[t]}];Mt(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Mt(n.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),Mt(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Mt(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Mt(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Mt(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Mt(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),Mt(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Mt(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Mt(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Mt(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),Mt(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Mt(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Mt(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},h=[];(function(_,w,P,I){let L;for(L in w=w||{},_=_||{})Object.prototype.hasOwnProperty.call(_,L)&&(Object.prototype.hasOwnProperty.call(w,L)||dn(L,P,I));for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(_,L)?Mt(_[L],w[L])||(_[L].type==="geojson"&&w[L].type==="geojson"&&en(_,w,L)?Xt(P,{command:"setGeoJSONSourceData",args:[L,w[L].data]}):bn(L,w,P,I)):Gr(L,w,P))})(n.sources,t.sources,h,o);const y=[];n.layers&&n.layers.forEach((_=>{"source"in _&&o[_.source]?r.push({command:"removeLayer",args:[_.id]}):y.push(_)})),r=r.concat(h),(function(_,w,P){w=w||[];const I=(_=_||[]).map(lr),L=w.map(lr),F=_.reduce(wn,{}),U=w.reduce(wn,{}),$=I.slice(),q=Object.create(null);let H,ee,ae,Se,he;for(let fe=0,Ie=0;fe<I.length;fe++)H=I[fe],Object.prototype.hasOwnProperty.call(U,H)?Ie++:(Xt(P,{command:"removeLayer",args:[H]}),$.splice($.indexOf(H,Ie),1));for(let fe=0,Ie=0;fe<L.length;fe++)H=L[L.length-1-fe],$[$.length-1-fe]!==H&&(Object.prototype.hasOwnProperty.call(F,H)?(Xt(P,{command:"removeLayer",args:[H]}),$.splice($.lastIndexOf(H,$.length-Ie),1)):Ie++,Se=$[$.length-fe],Xt(P,{command:"addLayer",args:[U[H],Se]}),$.splice($.length-fe,0,H),q[H]=!0);for(let fe=0;fe<L.length;fe++)if(H=L[fe],ee=F[H],ae=U[H],!q[H]&&!Mt(ee,ae))if(Mt(ee.source,ae.source)&&Mt(ee["source-layer"],ae["source-layer"])&&Mt(ee.type,ae.type)){for(he in nr(ee.layout,ae.layout,P,H,null,"setLayoutProperty"),nr(ee.paint,ae.paint,P,H,null,"setPaintProperty"),Mt(ee.filter,ae.filter)||Xt(P,{command:"setFilter",args:[H,ae.filter]}),Mt(ee.minzoom,ae.minzoom)&&Mt(ee.maxzoom,ae.maxzoom)||Xt(P,{command:"setLayerZoomRange",args:[H,ae.minzoom,ae.maxzoom]}),ee)Object.prototype.hasOwnProperty.call(ee,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?nr(ee[he],ae[he],P,H,he.slice(6),"setPaintProperty"):Mt(ee[he],ae[he])||Xt(P,{command:"setLayerProperty",args:[H,he,ae[he]]}));for(he in ae)Object.prototype.hasOwnProperty.call(ae,he)&&!Object.prototype.hasOwnProperty.call(ee,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?nr(ee[he],ae[he],P,H,he.slice(6),"setPaintProperty"):Mt(ee[he],ae[he])||Xt(P,{command:"setLayerProperty",args:[H,he,ae[he]]}))}else Xt(P,{command:"removeLayer",args:[H]}),Se=$[$.lastIndexOf(H)+1],Xt(P,{command:"addLayer",args:[ae,Se]})})(y,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},b.bM=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},b.bN=Bn,b.bO=io,b.bP=class extends yi{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},b.bQ=Sn,b.bR=class extends yi{constructor(n,t){super(n,t),this.current=_i}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},b.bS=_n,b.bT=class extends yi{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},b.bU=class extends yi{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},b.bV=Le,b.bW=function(n,t){var r=Math.sin(t),o=Math.cos(t);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},b.bX=function(n,t,r){var o=t[0],h=t[1],y=t[2];return n[0]=o*r[0]+h*r[3]+y*r[6],n[1]=o*r[1]+h*r[4]+y*r[7],n[2]=o*r[2]+h*r[5]+y*r[8],n},b.bY=function(n,t,r,o,h,y,_){var w=1/(t-r),P=1/(o-h),I=1/(y-_);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*P,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+r)*w,n[13]=(h+o)*P,n[14]=(_+y)*I,n[15]=1,n},b.bZ=class extends yi{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)t[4*r]=n[r].r,t[4*r+1]=n[r].g,t[4*r+2]=n[r].b,t[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,t)}}},b.b_=class extends yi{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},b.ba=function(){return new Float64Array(16)},b.bb=function(n,t,r){const o=new Float64Array(4);return qr(o,n,t-90,r),o},b.bc=function(n,t,r,o){var h,y,_,w,P,I=t[0],L=t[1],F=t[2],U=t[3],$=r[0],q=r[1],H=r[2],ee=r[3];return(y=I*$+L*q+F*H+U*ee)<0&&(y=-y,$=-$,q=-q,H=-H,ee=-ee),1-y>Ge?(h=Math.acos(y),_=Math.sin(h),w=Math.sin((1-o)*h)/_,P=Math.sin(o*h)/_):(w=1-o,P=o),n[0]=w*I+P*$,n[1]=w*L+P*q,n[2]=w*F+P*H,n[3]=w*U+P*ee,n},b.bd=function(n){const t=new Float64Array(9);var r,o,h,y,_,w,P,I,L,F,U,$,q,H,ee,ae,Se,he;F=(h=(o=n)[0])*(P=h+h),U=(y=o[1])*P,q=(_=o[2])*P,H=_*(I=y+y),ae=(w=o[3])*P,Se=w*I,he=w*(L=_+_),(r=t)[0]=1-($=y*I)-(ee=_*L),r[3]=U-he,r[6]=q+Se,r[1]=U+he,r[4]=1-F-ee,r[7]=H-ae,r[2]=q-Se,r[5]=H+ae,r[8]=1-F-$;const fe=so(-Math.asin(Qt(t[2],-1,1)));let Ie,je;return Math.hypot(t[5],t[8])<.001?(Ie=0,je=-so(Math.atan2(t[3],t[4]))):(Ie=so(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),je=so(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Ie,pitch:fe+90,bearing:je}},b.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},b.bf=tr,b.bg=Io,b.bh=sn,b.bi=Dn,b.bj=vr,b.bk=Je,b.bl=Wt,b.bm=Zn,b.bn=function(n,t,r,o,h){return Je(o,h,Qt((n-t)/(r-t),0,1))},b.bo=Pe,b.bp=function(){return new Float64Array(3)},b.bq=function(n,t,r,o){return n[0]=t[0]+r[0]*o,n[1]=t[1]+r[1]*o,n[2]=t[2]+r[2]*o,n},b.br=qr,b.bs=function(n,t,r){var o=r[0],h=r[1],y=r[2],_=t[0],w=t[1],P=t[2],I=h*P-y*w,L=y*_-o*P,F=o*w-h*_,U=h*F-y*L,$=y*I-o*F,q=o*L-h*I,H=2*r[3];return L*=H,F*=H,$*=2,q*=2,n[0]=_+(I*=H)+(U*=2),n[1]=w+L+$,n[2]=P+F+q,n},b.bt=function(n,t,r){const o=(h=[n[0],n[1],n[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((L=h[8])*(_=h[4])-(w=h[5])*(I=h[7]))+h[1]*(-L*(y=h[3])+w*(P=h[6]))+h[2]*(I*y-_*P);var h,y,_,w,P,I,L;if(o===0)return null;const F=Ur([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),U=Ur([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),$=Ur([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),q=Pt([],F,-n[3]);return Ft(q,q,Pt([],U,-t[3])),Ft(q,q,Pt([],$,-r[3])),Pt(q,q,1/o),q},b.bu=Nm,b.bv=function(){return new Float64Array(4)},b.bw=function(n,t,r,o){var h=[],y=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],y[0]=h[0]*Math.cos(o)-h[1]*Math.sin(o),y[1]=h[0]*Math.sin(o)+h[1]*Math.cos(o),y[2]=h[2],n[0]=y[0]+r[0],n[1]=y[1]+r[1],n[2]=y[2]+r[2],n},b.bx=function(n,t,r,o){var h=[],y=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],y[0]=h[0],y[1]=h[1]*Math.cos(o)-h[2]*Math.sin(o),y[2]=h[1]*Math.sin(o)+h[2]*Math.cos(o),n[0]=y[0]+r[0],n[1]=y[1]+r[1],n[2]=y[2]+r[2],n},b.by=function(n,t,r,o){var h=[],y=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],y[0]=h[2]*Math.sin(o)+h[0]*Math.cos(o),y[1]=h[1],y[2]=h[2]*Math.cos(o)-h[0]*Math.sin(o),n[0]=y[0]+r[0],n[1]=y[1]+r[1],n[2]=y[2]+r[2],n},b.bz=function(n,t,r){var o=Math.sin(r),h=Math.cos(r),y=t[0],_=t[1],w=t[2],P=t[3],I=t[8],L=t[9],F=t[10],U=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=y*h-I*o,n[1]=_*h-L*o,n[2]=w*h-F*o,n[3]=P*h-U*o,n[8]=y*o+I*h,n[9]=_*o+L*h,n[10]=w*o+F*h,n[11]=P*o+U*h,n},b.c=xe,b.c0=kf,b.c1=class extends i{},b.c2=fh,b.c3=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},b.c4=ud,b.c5=function(n,t,r){var o=t[0],h=t[1],y=t[2],_=r[3]*o+r[7]*h+r[11]*y+r[15];return n[0]=(r[0]*o+r[4]*h+r[8]*y+r[12])/(_=_||1),n[1]=(r[1]*o+r[5]*h+r[9]*y+r[13])/_,n[2]=(r[2]*o+r[6]*h+r[10]*y+r[14])/_,n},b.c6=class extends lc{},b.c7=class extends z{},b.c8=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},b.c9=function(n,t){var r=n[0],o=n[1],h=n[2],y=n[3],_=n[4],w=n[5],P=n[6],I=n[7],L=n[8],F=n[9],U=n[10],$=n[11],q=n[12],H=n[13],ee=n[14],ae=n[15],Se=t[0],he=t[1],fe=t[2],Ie=t[3],je=t[4],Xe=t[5],dt=t[6],at=t[7],ct=t[8],At=t[9],ot=t[10],ht=t[11],qe=t[12],jt=t[13],Ht=t[14],Rt=t[15];return Math.abs(r-Se)<=Ge*Math.max(1,Math.abs(r),Math.abs(Se))&&Math.abs(o-he)<=Ge*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(h-fe)<=Ge*Math.max(1,Math.abs(h),Math.abs(fe))&&Math.abs(y-Ie)<=Ge*Math.max(1,Math.abs(y),Math.abs(Ie))&&Math.abs(_-je)<=Ge*Math.max(1,Math.abs(_),Math.abs(je))&&Math.abs(w-Xe)<=Ge*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(P-dt)<=Ge*Math.max(1,Math.abs(P),Math.abs(dt))&&Math.abs(I-at)<=Ge*Math.max(1,Math.abs(I),Math.abs(at))&&Math.abs(L-ct)<=Ge*Math.max(1,Math.abs(L),Math.abs(ct))&&Math.abs(F-At)<=Ge*Math.max(1,Math.abs(F),Math.abs(At))&&Math.abs(U-ot)<=Ge*Math.max(1,Math.abs(U),Math.abs(ot))&&Math.abs($-ht)<=Ge*Math.max(1,Math.abs($),Math.abs(ht))&&Math.abs(q-qe)<=Ge*Math.max(1,Math.abs(q),Math.abs(qe))&&Math.abs(H-jt)<=Ge*Math.max(1,Math.abs(H),Math.abs(jt))&&Math.abs(ee-Ht)<=Ge*Math.max(1,Math.abs(ee),Math.abs(Ht))&&Math.abs(ae-Rt)<=Ge*Math.max(1,Math.abs(ae),Math.abs(Rt))},b.cA=function(n,t){Z.REGISTERED_PROTOCOLS[n]=t},b.cB=function(n){delete Z.REGISTERED_PROTOCOLS[n]},b.cC=function(n,t){const r={};for(let h=0;h<n.length;h++){const y=t&&t[n[h].id]||Qp(n[h]);t&&(t[n[h].id]=y);let _=r[y];_||(_=r[y]=[]),_.push(n[h])}const o=[];for(const h in r)o.push(r[h]);return o},b.cD=mt,b.cE=vy,b.cF=by,b.cG=zf,b.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=_t/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new Fr(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Fr(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Fr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Fr(I),n.canonical),o["text-size"].possiblyEvaluate(new Fr(L),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Fr(I),n.canonical),o["icon-size"].possiblyEvaluate(new Fr(L),n.canonical)]}const y=r.get("text-line-height")*Nn,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",w=r.get("text-keep-upright"),P=r.get("text-size");for(const I of n.bucket.features){const L=r.get("text-font").evaluate(I,{},n.canonical).join(","),F=P.evaluate(I,{},n.canonical),U=h.layoutTextSize.evaluate(I,{},n.canonical),$=h.layoutIconSize.evaluate(I,{},n.canonical),q={horizontal:{},vertical:void 0},H=I.text;let ee,ae=[0,0];if(H){const fe=H.toString(),Ie=r.get("text-letter-spacing").evaluate(I,{},n.canonical)*Nn,je=ih(fe)?Ie:0,Xe=r.get("text-anchor").evaluate(I,{},n.canonical),dt=zy(t,I,n.canonical);if(!dt){const ot=r.get("text-radial-offset").evaluate(I,{},n.canonical);ae=ot?Ay(Xe,[ot*Nn,jm]):r.get("text-offset").evaluate(I,{},n.canonical).map((ht=>ht*Nn))}let at=_?"center":r.get("text-justify").evaluate(I,{},n.canonical);const ct=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(I,{},n.canonical)*Nn:1/0,At=()=>{n.bucket.allowVerticalPlacement&&Al(fe)&&(q.vertical=Sc(H,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,y,Xe,"left",je,ae,b.ao.vertical,!0,U,F))};if(!_&&dt){const ot=new Set;if(at==="auto")for(let qe=0;qe<dt.values.length;qe+=2)ot.add(Om(dt.values[qe]));else ot.add(at);let ht=!1;for(const qe of ot)if(!q.horizontal[qe])if(ht)q.horizontal[qe]=q.horizontal[0];else{const jt=Sc(H,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,y,"center",qe,je,ae,b.ao.horizontal,!1,U,F);jt&&(q.horizontal[qe]=jt,ht=jt.positionedLines.length===1)}At()}else{at==="auto"&&(at=Om(Xe));const ot=Sc(H,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,y,Xe,at,je,ae,b.ao.horizontal,!1,U,F);ot&&(q.horizontal[at]=ot),At(),Al(fe)&&_&&w&&(q.vertical=Sc(H,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,y,Xe,at,je,ae,b.ao.vertical,!1,U,F))}}let Se=!1;if(I.icon&&I.icon.name){const fe=n.imageMap[I.icon.name];fe&&(ee=ve(n.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},n.canonical),r.get("icon-anchor").evaluate(I,{},n.canonical)),Se=!!fe.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Se:n.bucket.sdfIcons!==Se&&an("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fe.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const he=Ry(q.horizontal)||q.vertical;n.bucket.iconsInText=!!he&&he.iconsInText,(he||ee)&&Dv(n.bucket,I,q,ee,n.imageMap,h,U,$,ae,Se,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},b.cI=Sh,b.cJ=xh,b.cK=gs,b.cL=yp,b.cM=Mh,b.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},b.cO=function(n,t,r,o,h){return s(this,void 0,void 0,(function*(){if(He())try{return yield Na(n,t,r,o,h)}catch{}return(function(y,_,w,P,I){const L=y.width,F=y.height;Fi&&Fa||(Fi=new OffscreenCanvas(L,F),Fa=Fi.getContext("2d",{willReadFrequently:!0})),Fi.width=L,Fi.height=F,Fa.drawImage(y,0,0,L,F);const U=Fa.getImageData(_,w,P,I);return Fa.clearRect(0,0,L,F),U.data})(n,t,r,o,h)}))},b.cP=xi,b.cQ=V,b.cR=bh,b.cS=Ia,b.cT=Cl,b.cU=function(n,t){const r=new Map;if(n!=null)if(n.type==="Feature")r.set(Id(n,t),n);else for(const o of n.features)r.set(Id(o,t),o);return r},b.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return Id(n,t)!=null;if(n.type==="FeatureCollection"){const r=new Set;for(const o of n.features){const h=Id(o,t);if(h==null||r.has(h))return!1;r.add(h)}return!0}return!1},b.cW=function(n,t,r){var o,h,y,_;if(t.removeAll&&n.clear(),t.remove)for(const w of t.remove)n.delete(w);if(t.add)for(const w of t.add){const P=Id(w,r);P!=null&&n.set(P,w)}if(t.update)for(const w of t.update){let P=n.get(w.id);if(P==null)continue;const I=!w.removeAllProperties&&(((o=w.removeProperties)===null||o===void 0?void 0:o.length)>0||((h=w.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0);if((w.newGeometry||w.removeAllProperties||I)&&(P=Object.assign({},P),n.set(w.id,P),I&&(P.properties=Object.assign({},P.properties))),w.newGeometry&&(P.geometry=w.newGeometry),w.removeAllProperties)P.properties={};else if(((y=w.removeProperties)===null||y===void 0?void 0:y.length)>0)for(const L of w.removeProperties)Object.prototype.hasOwnProperty.call(P.properties,L)&&delete P.properties[L];if(((_=w.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(const{key:L,value:F}of w.addOrUpdateProperties)P.properties[L]=F}},b.cX=aa,b.ca=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},b.cb=n=>n.type==="symbol",b.cc=n=>n.type==="circle",b.cd=n=>n.type==="heatmap",b.ce=n=>n.type==="line",b.cf=n=>n.type==="fill",b.cg=n=>n.type==="fill-extrusion",b.ch=n=>n.type==="hillshade",b.ci=n=>n.type==="color-relief",b.cj=n=>n.type==="raster",b.ck=n=>n.type==="background",b.cl=n=>n.type==="custom",b.cm=er,b.cn=function(n,t,r){const o=yt(t.x-r.x,t.y-r.y),h=yt(n.x-r.x,n.y-r.y);var y,_;return so(Math.atan2(o[0]*h[1]-o[1]*h[0],(y=o)[0]*(_=h)[0]+y[1]*_[1]))},b.co=mr,b.cp=function(n,t){return Ba[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},b.cq=function(n,t){return lo[t]&&"touches"in n},b.cr=function(n){return lo[n]||Ba[n]},b.cs=function(n,t,r){var o=t[0],h=t[1];return n[0]=r[0]*o+r[4]*h+r[12],n[1]=r[1]*o+r[5]*h+r[13],n},b.ct=function(n,t){const{x:r,y:o}=Ed.fromLngLat(t);return!(n<0||n>25||o<0||o>=1||r<0||r>=1)},b.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},b.cv=class extends hs{},b.cw=Fv,b.cy=function(n){return n.message===uo},b.cz=ue,b.d=Ae,b.e=cr,b.f=n=>s(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),b.g=W,b.h=n=>new Promise(((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ta}))},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(h):ta})),b.i=da,b.j=(n,t)=>be(cr(n,{type:"json"}),t),b.k=$e,b.l=Ke,b.m=be,b.n=(n,t)=>be(cr(n,{type:"arrayBuffer"}),t),b.o=function(n){return new Mh(n).readFields(Af,[])},b.p=kd,b.q=ka,b.r=Wn,b.s=oo,b.t=zl,b.u=hr,b.v=Te,b.w=an,b.x=nh,b.y=Wa,b.z=Po})),T("worker",["./shared"],(function(b){class s{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,W){for(const ue of Z){this._layerConfigs[ue.id]=ue;const ye=this._layers[ue.id]=b.bJ(ue);ye._featureFilter=b.aa(ye.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of W)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const Q=b.cC(Object.values(this._layerConfigs),this.keyCache);for(const ue of Q){const ye=ue.map(($e=>this._layers[$e.id])),be=ye[0];if(be.visibility==="none")continue;const Ae=be.source||"";let we=this.familiesBySource[Ae];we||(we=this.familiesBySource[Ae]={});const Ve=be.sourceLayer||"_geojsonTileLayer";let Ke=we[Ve];Ke||(Ke=we[Ve]=[]),Ke.push(ye)}}}class N{constructor(Z){const W={},Q=[];for(const Ae in Z){const we=Z[Ae],Ve=W[Ae]={};for(const Ke in we){const $e=we[+Ke];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const vt={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};Q.push(vt),Ve[Ke]={rect:vt,metrics:$e.metrics}}}const{w:ue,h:ye}=b.p(Q),be=new b.q({width:ue||1,height:ye||1});for(const Ae in Z){const we=Z[Ae];for(const Ve in we){const Ke=we[+Ve];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const $e=W[Ae][Ve].rect;b.q.copy(Ke.bitmap,be,{x:0,y:0},{x:$e.x+1,y:$e.y+1},Ke.bitmap)}}this.image=be,this.positions=W}}b.cD("GlyphAtlas",N);class V{constructor(Z){this.tileID=new b.Z(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[],this.globalState=Z.globalState}parse(Z,W,Q,ue,ye){return b._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new b.a8;const be=new b.cE(Object.keys(Z.layers).sort()),Ae=new b.cF(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];const we={},Ve={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q,subdivisionGranularity:ye},Ke=W.familiesBySource[this.source];for(const nr in Ke){const lr=Z.layers[nr];if(!lr)continue;lr.version===1&&b.w(`Vector tile source "${this.source}" layer "${nr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wn=be.encode(nr),Qe=[];for(let Mn=0;Mn<lr.length;Mn++){const Kr=lr.feature(Mn),ja=Ae.getId(Kr,nr);Qe.push({feature:Kr,id:ja,index:Mn,sourceLayerIndex:wn})}for(const Mn of Ke[nr]){const Kr=Mn[0];Kr.source!==this.source&&b.w(`layer.source = ${Kr.source} does not equal this.source = ${this.source}`),Kr.minzoom&&this.zoom<Math.floor(Kr.minzoom)||Kr.maxzoom&&this.zoom>=Kr.maxzoom||Kr.visibility!=="none"&&(K(Mn,this.zoom,Q),(we[Kr.id]=Kr.createBucket({index:Ae.bucketLayerIDs.length,layers:Mn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wn,sourceID:this.source,globalState:this.globalState})).populate(Qe,Ve,this.tileID.canonical),Ae.bucketLayerIDs.push(Mn.map((ja=>ja.id))))}}const $e=b.bN(Ve.glyphDependencies,(nr=>Object.keys(nr).map(Number)));this.inFlightDependencies.forEach((nr=>nr?.abort())),this.inFlightDependencies=[];let vt=Promise.resolve({});if(Object.keys($e).length){const nr=new AbortController;this.inFlightDependencies.push(nr),vt=ue.sendAsync({type:"GG",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},nr)}const Te=Object.keys(Ve.iconDependencies);let Ot=Promise.resolve({});if(Te.length){const nr=new AbortController;this.inFlightDependencies.push(nr),Ot=ue.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},nr)}const rr=Object.keys(Ve.patternDependencies);let Mt=Promise.resolve({});if(rr.length){const nr=new AbortController;this.inFlightDependencies.push(nr),Mt=ue.sendAsync({type:"GI",data:{icons:rr,source:this.source,tileID:this.tileID,type:"patterns"}},nr)}const[Xt,Gr,dn]=yield Promise.all([vt,Ot,Mt]),bn=new N(Xt),en=new b.cG(Gr,dn);for(const nr in we){const lr=we[nr];lr instanceof b.a9?(K(lr.layers,this.zoom,Q),b.cH({bucket:lr,glyphMap:Xt,glyphPositions:bn.positions,imageMap:Gr,imagePositions:en.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ve.subdivisionGranularity})):lr.hasPattern&&(lr instanceof b.cI||lr instanceof b.cJ||lr instanceof b.cK)&&(K(lr.layers,this.zoom,Q),lr.addFeatures(Ve,this.tileID.canonical,en.patternPositions))}return this.status="done",{buckets:Object.values(we).filter((nr=>!nr.isEmpty())),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bn.image,imageAtlas:en,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?Gr:null,glyphPositions:this.returnDependencies?bn.positions:null}}))}}function K(xe,Z,W){const Q=new b.F(Z);for(const ue of xe)ue.recalculate(Q,W)}class oe{constructor(Z,W,Q){this.actor=Z,this.layerIndex=W,this.availableImages=Q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,W){return b._(this,void 0,void 0,(function*(){const Q=yield b.n(Z.request,W);try{return{vectorTile:new b.cL(new b.cM(Q.data)),rawData:Q.data,cacheControl:Q.cacheControl,expires:Q.expires}}catch(ue){const ye=new Uint8Array(Q.data);let be=`Unable to parse the tile at ${Z.request.url}, `;throw be+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(be)}}))}loadTile(Z){return b._(this,void 0,void 0,(function*(){const W=Z.uid,Q=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new b.cN(Z.request),ue=new V(Z);this.loading[W]=ue;const ye=new AbortController;ue.abort=ye;try{const be=yield this.loadVectorTile(Z,ye);if(delete this.loading[W],!be)return null;const Ae=be.rawData,we={};be.expires&&(we.expires=be.expires),be.cacheControl&&(we.cacheControl=be.cacheControl);const Ve={};if(Q){const $e=Q.finish();$e&&(Ve.resourceTiming=JSON.parse(JSON.stringify($e)))}ue.vectorTile=be.vectorTile;const Ke=ue.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);this.loaded[W]=ue,this.fetching[W]={rawTileData:Ae,cacheControl:we,resourceTiming:Ve};try{const $e=yield Ke;return b.e({rawTileData:Ae.slice(0)},$e,we,Ve)}finally{delete this.fetching[W]}}catch(be){throw delete this.loading[W],ue.status="done",this.loaded[W]=ue,be}}))}reloadTile(Z){return b._(this,void 0,void 0,(function*(){const W=Z.uid;if(!this.loaded||!this.loaded[W])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Q=this.loaded[W];if(Q.showCollisionBoxes=Z.showCollisionBoxes,Q.globalState=Z.globalState,Q.status==="parsing"){const ue=yield Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);let ye;if(this.fetching[W]){const{rawTileData:be,cacheControl:Ae,resourceTiming:we}=this.fetching[W];delete this.fetching[W],ye=b.e({rawTileData:be.slice(0)},ue,Ae,we)}else ye=ue;return ye}if(Q.status==="done"&&Q.vectorTile)return Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity)}))}abortTile(Z){return b._(this,void 0,void 0,(function*(){const W=this.loading,Q=Z.uid;W&&W[Q]&&W[Q].abort&&(W[Q].abort.abort(),delete W[Q])}))}removeTile(Z){return b._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]}))}}class le{constructor(){this.loaded={}}loadTile(Z){return b._(this,void 0,void 0,(function*(){const{uid:W,encoding:Q,rawImageData:ue,redFactor:ye,greenFactor:be,blueFactor:Ae,baseShift:we}=Z,Ve=ue.width+2,Ke=ue.height+2,$e=b.b(ue)?new b.R({width:Ve,height:Ke},yield b.cO(ue,-1,-1,Ve,Ke)):ue,vt=new b.cP(W,$e,Q,ye,be,Ae,we);return this.loaded=this.loaded||{},this.loaded[W]=vt,vt}))}removeTile(Z){const W=this.loaded,Q=Z.uid;W&&W[Q]&&delete W[Q]}}var Y,Be,Ne=(function(){if(Be)return Y;function xe(W,Q){if(W.length!==0){Z(W[0],Q);for(var ue=1;ue<W.length;ue++)Z(W[ue],!Q)}}function Z(W,Q){for(var ue=0,ye=0,be=0,Ae=W.length,we=Ae-1;be<Ae;we=be++){var Ve=(W[be][0]-W[we][0])*(W[we][1]+W[be][1]),Ke=ue+Ve;ye+=Math.abs(ue)>=Math.abs(Ve)?ue-Ke+Ve:Ve-Ke+ue,ue=Ke}ue+ye>=0!=!!Q&&W.reverse()}return Be=1,Y=function W(Q,ue){var ye,be=Q&&Q.type;if(be==="FeatureCollection")for(ye=0;ye<Q.features.length;ye++)W(Q.features[ye],ue);else if(be==="GeometryCollection")for(ye=0;ye<Q.geometries.length;ye++)W(Q.geometries[ye],ue);else if(be==="Feature")W(Q.geometry,ue);else if(be==="Polygon")xe(Q.coordinates,ue);else if(be==="MultiPolygon")for(ye=0;ye<Q.coordinates.length;ye++)xe(Q.coordinates[ye],ue);return Q}})(),Ze=b.cQ(Ne);class He extends b.cS{constructor(Z,W){super(new b.cM,0,W,[],[]),this.feature=Z,this.type=Z.type,this.properties=Z.tags?Z.tags:{},"id"in Z&&(typeof Z.id=="string"?this.id=parseInt(Z.id,10):typeof Z.id!="number"||isNaN(Z.id)||(this.id=Z.id))}loadGeometry(){const Z=[],W=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const Q of W){const ue=[];for(const ye of Q)ue.push(new b.P(ye[0],ye[1]));Z.push(ue)}return Z}}class Ge extends b.cR{constructor(Z,W){super(new b.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=W?W.version:1,this.extent=W?W.extent:4096,this.length=Z.length,this.features=Z}feature(Z){return new He(this.features[Z],this.extent)}}function nt(xe,Z){Z.writeVarintField(15,xe.version||1),Z.writeStringField(1,xe.name||""),Z.writeVarintField(5,xe.extent||4096);const W={keys:[],values:[],keycache:{},valuecache:{}};for(let ye=0;ye<xe.length;ye++)W.feature=xe.feature(ye),Z.writeMessage(2,Le,W);const Q=W.keys;for(const ye of Q)Z.writeStringField(3,ye);const ue=W.values;for(const ye of ue)Z.writeMessage(4,Ft,ye)}function Le(xe,Z){if(!xe.feature)return;const W=xe.feature;W.id!==void 0&&Z.writeVarintField(1,W.id),Z.writeMessage(2,Re,xe),Z.writeVarintField(3,W.type),Z.writeMessage(4,lt,W)}function Re(xe,Z){for(const W in xe.feature?.properties){let Q=xe.feature.properties[W],ue=xe.keycache[W];if(Q===null)continue;ue===void 0&&(xe.keys.push(W),ue=xe.keys.length-1,xe.keycache[W]=ue),Z.writeVarint(ue),typeof Q!="string"&&typeof Q!="boolean"&&typeof Q!="number"&&(Q=JSON.stringify(Q));const ye=typeof Q+":"+Q;let be=xe.valuecache[ye];be===void 0&&(xe.values.push(Q),be=xe.values.length-1,xe.valuecache[ye]=be),Z.writeVarint(be)}}function Ue(xe,Z){return(Z<<3)+(7&xe)}function pt(xe){return xe<<1^xe>>31}function lt(xe,Z){const W=xe.loadGeometry(),Q=xe.type;let ue=0,ye=0;for(const be of W){let Ae=1;Q===1&&(Ae=be.length),Z.writeVarint(Ue(1,Ae));const we=Q===3?be.length-1:be.length;for(let Ve=0;Ve<we;Ve++){Ve===1&&Q!==1&&Z.writeVarint(Ue(2,we-1));const Ke=be[Ve].x-ue,$e=be[Ve].y-ye;Z.writeVarint(pt(Ke)),Z.writeVarint(pt($e)),ue+=Ke,ye+=$e}xe.type===3&&Z.writeVarint(Ue(7,1))}}function Ft(xe,Z){const W=typeof xe;W==="string"?Z.writeStringField(1,xe):W==="boolean"?Z.writeBooleanField(7,xe):W==="number"&&(xe%1!=0?Z.writeDoubleField(3,xe):xe<0?Z.writeSVarintField(6,xe):Z.writeVarintField(5,xe))}const Pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xe=>xe},Ur=Math.fround||(Cr=new Float32Array(1),xe=>(Cr[0]=+xe,Cr[0]));var Cr;class yr{constructor(Z){this.options=Object.assign(Object.create(Pt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:W,minZoom:Q,maxZoom:ue}=this.options;W&&console.time("total time");const ye=`prepare ${Z.length} points`;W&&console.time(ye),this.points=Z;const be=[];for(let we=0;we<Z.length;we++){const Ve=Z[we];if(!Ve.geometry)continue;const[Ke,$e]=Ve.geometry.coordinates,vt=Ur(qr(Ke)),Te=Ur(Rr($e));be.push(vt,Te,1/0,we,-1,1),this.options.reduce&&be.push(0)}let Ae=this.trees[ue+1]=this._createTree(be);W&&console.timeEnd(ye);for(let we=ue;we>=Q;we--){const Ve=+Date.now();Ae=this.trees[we]=this._createTree(this._cluster(Ae,we)),W&&console.log("z%d: %d clusters in %dms",we,Ae.numItems,+Date.now()-Ve)}return W&&console.timeEnd("total time"),this}getClusters(Z,W){let Q=((Z[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,Z[1]));let ye=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)Q=-180,ye=180;else if(Q>ye){const $e=this.getClusters([Q,ue,180,be],W),vt=this.getClusters([-180,ue,ye,be],W);return $e.concat(vt)}const Ae=this.trees[this._limitZoom(W)],we=Ae.range(qr(Q),Rr(be),qr(ye),Rr(ue)),Ve=Ae.data,Ke=[];for(const $e of we){const vt=this.stride*$e;Ke.push(Ve[vt+5]>1?fr(Ve,vt,this.clusterProps):this.points[Ve[vt+3]])}return Ke}getChildren(Z){const W=this._getOriginId(Z),Q=this._getOriginZoom(Z),ue="No cluster with the specified id.",ye=this.trees[Q];if(!ye)throw new Error(ue);const be=ye.data;if(W*this.stride>=be.length)throw new Error(ue);const Ae=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),we=ye.within(be[W*this.stride],be[W*this.stride+1],Ae),Ve=[];for(const Ke of we){const $e=Ke*this.stride;be[$e+4]===Z&&Ve.push(be[$e+5]>1?fr(be,$e,this.clusterProps):this.points[be[$e+3]])}if(Ve.length===0)throw new Error(ue);return Ve}getLeaves(Z,W,Q){const ue=[];return this._appendLeaves(ue,Z,W=W||10,Q=Q||0,0),ue}getTile(Z,W,Q){const ue=this.trees[this._limitZoom(Z)],ye=Math.pow(2,Z),{extent:be,radius:Ae}=this.options,we=Ae/be,Ve=(Q-we)/ye,Ke=(Q+1+we)/ye,$e={features:[]};return this._addTileFeatures(ue.range((W-we)/ye,Ve,(W+1+we)/ye,Ke),ue.data,W,Q,ye,$e),W===0&&this._addTileFeatures(ue.range(1-we/ye,Ve,1,Ke),ue.data,ye,Q,ye,$e),W===ye-1&&this._addTileFeatures(ue.range(0,Ve,we/ye,Ke),ue.data,-1,Q,ye,$e),$e.features.length?$e:null}getClusterExpansionZoom(Z){let W=this._getOriginZoom(Z)-1;for(;W<=this.options.maxZoom;){const Q=this.getChildren(Z);if(W++,Q.length!==1)break;Z=Q[0].properties.cluster_id}return W}_appendLeaves(Z,W,Q,ue,ye){const be=this.getChildren(W);for(const Ae of be){const we=Ae.properties;if(we&&we.cluster?ye+we.point_count<=ue?ye+=we.point_count:ye=this._appendLeaves(Z,we.cluster_id,Q,ue,ye):ye<ue?ye++:Z.push(Ae),Z.length===Q)break}return ye}_createTree(Z){const W=new b.aI(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<Z.length;Q+=this.stride)W.add(Z[Q],Z[Q+1]);return W.finish(),W.data=Z,W}_addTileFeatures(Z,W,Q,ue,ye,be){for(const Ae of Z){const we=Ae*this.stride,Ve=W[we+5]>1;let Ke,$e,vt;if(Ve)Ke=xn(W,we,this.clusterProps),$e=W[we],vt=W[we+1];else{const rr=this.points[W[we+3]];Ke=rr.properties;const[Mt,Xt]=rr.geometry.coordinates;$e=qr(Mt),vt=Rr(Xt)}const Te={type:1,geometry:[[Math.round(this.options.extent*($e*ye-Q)),Math.round(this.options.extent*(vt*ye-ue))]],tags:Ke};let Ot;Ot=Ve||this.options.generateId?W[we+3]:this.points[W[we+3]].id,Ot!==void 0&&(Te.id=Ot),be.features.push(Te)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,W){const{radius:Q,extent:ue,reduce:ye,minPoints:be}=this.options,Ae=Q/(ue*Math.pow(2,W)),we=Z.data,Ve=[],Ke=this.stride;for(let $e=0;$e<we.length;$e+=Ke){if(we[$e+2]<=W)continue;we[$e+2]=W;const vt=we[$e],Te=we[$e+1],Ot=Z.within(we[$e],we[$e+1],Ae),rr=we[$e+5];let Mt=rr;for(const Xt of Ot){const Gr=Xt*Ke;we[Gr+2]>W&&(Mt+=we[Gr+5])}if(Mt>rr&&Mt>=be){let Xt,Gr=vt*rr,dn=Te*rr,bn=-1;const en=($e/Ke<<5)+(W+1)+this.points.length;for(const nr of Ot){const lr=nr*Ke;if(we[lr+2]<=W)continue;we[lr+2]=W;const wn=we[lr+5];Gr+=we[lr]*wn,dn+=we[lr+1]*wn,we[lr+4]=en,ye&&(Xt||(Xt=this._map(we,$e,!0),bn=this.clusterProps.length,this.clusterProps.push(Xt)),ye(Xt,this._map(we,lr)))}we[$e+4]=en,Ve.push(Gr/Mt,dn/Mt,1/0,en,-1,Mt),ye&&Ve.push(bn)}else{for(let Xt=0;Xt<Ke;Xt++)Ve.push(we[$e+Xt]);if(Mt>1)for(const Xt of Ot){const Gr=Xt*Ke;if(!(we[Gr+2]<=W)){we[Gr+2]=W;for(let dn=0;dn<Ke;dn++)Ve.push(we[Gr+dn])}}}}return Ve}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,W,Q){if(Z[W+5]>1){const be=this.clusterProps[Z[W+6]];return Q?Object.assign({},be):be}const ue=this.points[Z[W+3]].properties,ye=this.options.map(ue);return Q&&ye===ue?Object.assign({},ye):ye}}function fr(xe,Z,W){return{type:"Feature",id:xe[Z+3],properties:xn(xe,Z,W),geometry:{type:"Point",coordinates:[(Q=xe[Z],360*(Q-.5)),yt(xe[Z+1])]}};var Q}function xn(xe,Z,W){const Q=xe[Z+5],ue=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,ye=xe[Z+6],be=ye===-1?{}:Object.assign({},W[ye]);return Object.assign(be,{cluster:!0,cluster_id:xe[Z+3],point_count:Q,point_count_abbreviated:ue})}function qr(xe){return xe/360+.5}function Rr(xe){const Z=Math.sin(xe*Math.PI/180),W=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return W<0?0:W>1?1:W}function yt(xe){const Z=(180-360*xe)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function _t(xe,Z,W,Q){let ue=Q;const ye=Z+(W-Z>>1);let be,Ae=W-Z;const we=xe[Z],Ve=xe[Z+1],Ke=xe[W],$e=xe[W+1];for(let vt=Z+3;vt<W;vt+=3){const Te=bt(xe[vt],xe[vt+1],we,Ve,Ke,$e);if(Te>ue)be=vt,ue=Te;else if(Te===ue){const Ot=Math.abs(vt-ye);Ot<Ae&&(be=vt,Ae=Ot)}}ue>Q&&(be-Z>3&&_t(xe,Z,be,Q),xe[be+2]=ue,W-be>3&&_t(xe,be,W,Q))}function bt(xe,Z,W,Q,ue,ye){let be=ue-W,Ae=ye-Q;if(be!==0||Ae!==0){const we=((xe-W)*be+(Z-Q)*Ae)/(be*be+Ae*Ae);we>1?(W=ue,Q=ye):we>0&&(W+=be*we,Q+=Ae*we)}return be=xe-W,Ae=Z-Q,be*be+Ae*Ae}function Pe(xe,Z,W,Q){const ue={id:xe??null,type:Z,geometry:W,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Je(ue,W);else if(Z==="Polygon")Je(ue,W[0]);else if(Z==="MultiLineString")for(const ye of W)Je(ue,ye);else if(Z==="MultiPolygon")for(const ye of W)Je(ue,ye[0]);return ue}function Je(xe,Z){for(let W=0;W<Z.length;W+=3)xe.minX=Math.min(xe.minX,Z[W]),xe.minY=Math.min(xe.minY,Z[W+1]),xe.maxX=Math.max(xe.maxX,Z[W]),xe.maxY=Math.max(xe.maxY,Z[W+1])}function Wt(xe,Z,W,Q){if(!Z.geometry)return;const ue=Z.geometry.coordinates;if(ue&&ue.length===0)return;const ye=Z.geometry.type,be=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2);let Ae=[],we=Z.id;if(W.promoteId?we=Z.properties[W.promoteId]:W.generateId&&(we=Q||0),ye==="Point")er(ue,Ae);else if(ye==="MultiPoint")for(const Ve of ue)er(Ve,Ae);else if(ye==="LineString")mr(ue,Ae,be,!1);else if(ye==="MultiLineString"){if(W.lineMetrics){for(const Ve of ue)Ae=[],mr(Ve,Ae,be,!1),xe.push(Pe(we,"LineString",Ae,Z.properties));return}Qt(ue,Ae,be,!1)}else if(ye==="Polygon")Qt(ue,Ae,be,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Ve of Z.geometry.geometries)Wt(xe,{id:we,geometry:Ve,properties:Z.properties},W,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ve of ue){const Ke=[];Qt(Ve,Ke,be,!0),Ae.push(Ke)}}xe.push(Pe(we,ye,Ae,Z.properties))}function er(xe,Z){Z.push(Ir(xe[0]),cr(xe[1]),0)}function mr(xe,Z,W,Q){let ue,ye,be=0;for(let we=0;we<xe.length;we++){const Ve=Ir(xe[we][0]),Ke=cr(xe[we][1]);Z.push(Ve,Ke,0),we>0&&(be+=Q?(ue*Ke-Ve*ye)/2:Math.sqrt(Math.pow(Ve-ue,2)+Math.pow(Ke-ye,2))),ue=Ve,ye=Ke}const Ae=Z.length-3;Z[2]=1,_t(Z,0,Ae,W),Z[Ae+2]=1,Z.size=Math.abs(be),Z.start=0,Z.end=Z.size}function Qt(xe,Z,W,Q){for(let ue=0;ue<xe.length;ue++){const ye=[];mr(xe[ue],ye,W,Q),Z.push(ye)}}function Ir(xe){return xe/360+.5}function cr(xe){const Z=Math.sin(xe*Math.PI/180),W=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return W<0?0:W>1?1:W}function wr(xe,Z,W,Q,ue,ye,be,Ae){if(Q/=Z,ye>=(W/=Z)&&be<Q)return xe;if(be<W||ye>=Q)return null;const we=[];for(const Ve of xe){const Ke=Ve.geometry;let $e=Ve.type;const vt=ue===0?Ve.minX:Ve.minY,Te=ue===0?Ve.maxX:Ve.maxY;if(vt>=W&&Te<Q){we.push(Ve);continue}if(Te<W||vt>=Q)continue;let Ot=[];if($e==="Point"||$e==="MultiPoint")Bn(Ke,Ot,W,Q,ue);else if($e==="LineString")io(Ke,Ot,W,Q,ue,!1,Ae.lineMetrics);else if($e==="MultiLineString")Qr(Ke,Ot,W,Q,ue,!1);else if($e==="Polygon")Qr(Ke,Ot,W,Q,ue,!0);else if($e==="MultiPolygon")for(const rr of Ke){const Mt=[];Qr(rr,Mt,W,Q,ue,!0),Mt.length&&Ot.push(Mt)}if(Ot.length){if(Ae.lineMetrics&&$e==="LineString"){for(const rr of Ot)we.push(Pe(Ve.id,$e,rr,Ve.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(Ot.length===1?($e="LineString",Ot=Ot[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=Ot.length===3?"Point":"MultiPoint"),we.push(Pe(Ve.id,$e,Ot,Ve.tags))}}return we.length?we:null}function Bn(xe,Z,W,Q,ue){for(let ye=0;ye<xe.length;ye+=3){const be=xe[ye+ue];be>=W&&be<=Q&&an(Z,xe[ye],xe[ye+1],xe[ye+2])}}function io(xe,Z,W,Q,ue,ye,be){let Ae=Pi(xe);const we=ue===0?ea:da;let Ve,Ke,$e=xe.start;for(let Mt=0;Mt<xe.length-3;Mt+=3){const Xt=xe[Mt],Gr=xe[Mt+1],dn=xe[Mt+2],bn=xe[Mt+3],en=xe[Mt+4],nr=ue===0?Xt:Gr,lr=ue===0?bn:en;let wn=!1;be&&(Ve=Math.sqrt(Math.pow(Xt-bn,2)+Math.pow(Gr-en,2))),nr<W?lr>W&&(Ke=we(Ae,Xt,Gr,bn,en,W),be&&(Ae.start=$e+Ve*Ke)):nr>Q?lr<Q&&(Ke=we(Ae,Xt,Gr,bn,en,Q),be&&(Ae.start=$e+Ve*Ke)):an(Ae,Xt,Gr,dn),lr<W&&nr>=W&&(Ke=we(Ae,Xt,Gr,bn,en,W),wn=!0),lr>Q&&nr<=Q&&(Ke=we(Ae,Xt,Gr,bn,en,Q),wn=!0),!ye&&wn&&(be&&(Ae.end=$e+Ve*Ke),Z.push(Ae),Ae=Pi(xe)),be&&($e+=Ve)}let vt=xe.length-3;const Te=xe[vt],Ot=xe[vt+1],rr=ue===0?Te:Ot;rr>=W&&rr<=Q&&an(Ae,Te,Ot,xe[vt+2]),vt=Ae.length-3,ye&&vt>=3&&(Ae[vt]!==Ae[0]||Ae[vt+1]!==Ae[1])&&an(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&Z.push(Ae)}function Pi(xe){const Z=[];return Z.size=xe.size,Z.start=xe.start,Z.end=xe.end,Z}function Qr(xe,Z,W,Q,ue,ye){for(const be of xe)io(be,Z,W,Q,ue,ye,!1)}function an(xe,Z,W,Q){xe.push(Z,W,Q)}function ea(xe,Z,W,Q,ue,ye){const be=(ye-Z)/(Q-Z);return an(xe,ye,W+(ue-W)*be,1),be}function da(xe,Z,W,Q,ue,ye){const be=(ye-W)/(ue-W);return an(xe,Z+(Q-Z)*be,ye,1),be}function ao(xe,Z){const W=[];for(let Q=0;Q<xe.length;Q++){const ue=xe[Q],ye=ue.type;let be;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")be=fa(ue.geometry,Z);else if(ye==="MultiLineString"||ye==="Polygon"){be=[];for(const Ae of ue.geometry)be.push(fa(Ae,Z))}else if(ye==="MultiPolygon"){be=[];for(const Ae of ue.geometry){const we=[];for(const Ve of Ae)we.push(fa(Ve,Z));be.push(we)}}W.push(Pe(ue.id,ye,be,ue.tags))}return W}function fa(xe,Z){const W=[];W.size=xe.size,xe.start!==void 0&&(W.start=xe.start,W.end=xe.end);for(let Q=0;Q<xe.length;Q+=3)W.push(xe[Q]+Z,xe[Q+1],xe[Q+2]);return W}function ta(xe,Z){if(xe.transformed)return xe;const W=1<<xe.z,Q=xe.x,ue=xe.y;for(const ye of xe.features){const be=ye.geometry,Ae=ye.type;if(ye.geometry=[],Ae===1)for(let we=0;we<be.length;we+=2)ye.geometry.push(Na(be[we],be[we+1],Z,W,Q,ue));else for(let we=0;we<be.length;we++){const Ve=[];for(let Ke=0;Ke<be[we].length;Ke+=2)Ve.push(Na(be[we][Ke],be[we][Ke+1],Z,W,Q,ue));ye.geometry.push(Ve)}}return xe.transformed=!0,xe}function Na(xe,Z,W,Q,ue,ye){return[Math.round(W*(xe*Q-ue)),Math.round(W*(Z*Q-ye))]}function Fi(xe,Z,W,Q,ue){const ye=Z===ue.maxZoom?0:ue.tolerance/((1<<Z)*ue.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:xe.length,source:null,x:W,y:Q,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ae of xe)Fa(be,Ae,ye,ue);return be}function Fa(xe,Z,W,Q){const ue=Z.geometry,ye=Z.type,be=[];if(xe.minX=Math.min(xe.minX,Z.minX),xe.minY=Math.min(xe.minY,Z.minY),xe.maxX=Math.max(xe.maxX,Z.maxX),xe.maxY=Math.max(xe.maxY,Z.maxY),ye==="Point"||ye==="MultiPoint")for(let Ae=0;Ae<ue.length;Ae+=3)be.push(ue[Ae],ue[Ae+1]),xe.numPoints++,xe.numSimplified++;else if(ye==="LineString")oo(be,ue,xe,W,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Ae=0;Ae<ue.length;Ae++)oo(be,ue[Ae],xe,W,ye==="Polygon",Ae===0);else if(ye==="MultiPolygon")for(let Ae=0;Ae<ue.length;Ae++){const we=ue[Ae];for(let Ve=0;Ve<we.length;Ve++)oo(be,we[Ve],xe,W,!0,Ve===0)}if(be.length){let Ae=Z.tags||null;if(ye==="LineString"&&Q.lineMetrics){Ae={};for(const Ve in Z.tags)Ae[Ve]=Z.tags[Ve];Ae.mapbox_clip_start=ue.start/ue.size,Ae.mapbox_clip_end=ue.end/ue.size}const we={geometry:be,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Ae};Z.id!==null&&(we.id=Z.id),xe.features.push(we)}}function oo(xe,Z,W,Q,ue,ye){const be=Q*Q;if(Q>0&&Z.size<(ue?be:Q))return void(W.numPoints+=Z.length/3);const Ae=[];for(let we=0;we<Z.length;we+=3)(Q===0||Z[we+2]>be)&&(W.numSimplified++,Ae.push(Z[we],Z[we+1])),W.numPoints++;ue&&(function(we,Ve){let Ke=0;for(let $e=0,vt=we.length,Te=vt-2;$e<vt;Te=$e,$e+=2)Ke+=(we[$e]-we[Te])*(we[$e+1]+we[Te+1]);if(Ke>0===Ve)for(let $e=0,vt=we.length;$e<vt/2;$e+=2){const Te=we[$e],Ot=we[$e+1];we[$e]=we[vt-2-$e],we[$e+1]=we[vt-1-$e],we[vt-2-$e]=Te,we[vt-1-$e]=Ot}})(Ae,ye),xe.push(Ae)}const Zo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class so{constructor(Z,W){const Q=(W=this.options=(function(ye,be){for(const Ae in be)ye[Ae]=be[Ae];return ye})(Object.create(Zo),W)).debug;if(Q&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=(function(ye,be){const Ae=[];if(ye.type==="FeatureCollection")for(let we=0;we<ye.features.length;we++)Wt(Ae,ye.features[we],be,we);else Wt(Ae,ye.type==="Feature"?ye:{geometry:ye},be);return Ae})(Z,W);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=(function(ye,be){const Ae=be.buffer/be.extent;let we=ye;const Ve=wr(ye,1,-1-Ae,Ae,0,-1,2,be),Ke=wr(ye,1,1-Ae,2+Ae,0,-1,2,be);return(Ve||Ke)&&(we=wr(ye,1,-Ae,1+Ae,0,-1,2,be)||[],Ve&&(we=ao(Ve,1).concat(we)),Ke&&(we=we.concat(ao(Ke,-1)))),we})(ue,W),ue.length&&this.splitTile(ue,0,0,0),Q&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,W,Q,ue,ye,be,Ae){const we=[Z,W,Q,ue],Ve=this.options,Ke=Ve.debug;for(;we.length;){ue=we.pop(),Q=we.pop(),W=we.pop(),Z=we.pop();const $e=1<<W,vt=lo(W,Q,ue);let Te=this.tiles[vt];if(!Te&&(Ke>1&&console.time("creation"),Te=this.tiles[vt]=Fi(Z,W,Q,ue,Ve),this.tileCoords.push({z:W,x:Q,y:ue}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,Q,ue,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));const wn=`z${W}`;this.stats[wn]=(this.stats[wn]||0)+1,this.total++}if(Te.source=Z,ye==null){if(W===Ve.indexMaxZoom||Te.numPoints<=Ve.indexMaxPoints)continue}else{if(W===Ve.maxZoom||W===ye)continue;if(ye!=null){const wn=ye-W;if(Q!==be>>wn||ue!==Ae>>wn)continue}}if(Te.source=null,Z.length===0)continue;Ke>1&&console.time("clipping");const Ot=.5*Ve.buffer/Ve.extent,rr=.5-Ot,Mt=.5+Ot,Xt=1+Ot;let Gr=null,dn=null,bn=null,en=null,nr=wr(Z,$e,Q-Ot,Q+Mt,0,Te.minX,Te.maxX,Ve),lr=wr(Z,$e,Q+rr,Q+Xt,0,Te.minX,Te.maxX,Ve);Z=null,nr&&(Gr=wr(nr,$e,ue-Ot,ue+Mt,1,Te.minY,Te.maxY,Ve),dn=wr(nr,$e,ue+rr,ue+Xt,1,Te.minY,Te.maxY,Ve),nr=null),lr&&(bn=wr(lr,$e,ue-Ot,ue+Mt,1,Te.minY,Te.maxY,Ve),en=wr(lr,$e,ue+rr,ue+Xt,1,Te.minY,Te.maxY,Ve),lr=null),Ke>1&&console.timeEnd("clipping"),we.push(Gr||[],W+1,2*Q,2*ue),we.push(dn||[],W+1,2*Q,2*ue+1),we.push(bn||[],W+1,2*Q+1,2*ue),we.push(en||[],W+1,2*Q+1,2*ue+1)}}getTile(Z,W,Q){Z=+Z,W=+W,Q=+Q;const ue=this.options,{extent:ye,debug:be}=ue;if(Z<0||Z>24)return null;const Ae=1<<Z,we=lo(Z,W=W+Ae&Ae-1,Q);if(this.tiles[we])return ta(this.tiles[we],ye);be>1&&console.log("drilling down to z%d-%d-%d",Z,W,Q);let Ve,Ke=Z,$e=W,vt=Q;for(;!Ve&&Ke>0;)Ke--,$e>>=1,vt>>=1,Ve=this.tiles[lo(Ke,$e,vt)];return Ve&&Ve.source?(be>1&&(console.log("found parent tile z%d-%d-%d",Ke,$e,vt),console.time("drilling down")),this.splitTile(Ve.source,Ke,$e,vt,Z,W,Q),be>1&&console.timeEnd("drilling down"),this.tiles[we]?ta(this.tiles[we],ye):null):null}}function lo(xe,Z,W){return 32*((1<<xe)*W+Z)+xe}class Ba extends oe{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,W){return b._(this,void 0,void 0,(function*(){const Q=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!ue)return null;const ye=new Ge(ue.features,{version:2,extent:b.$});let be=(function(Ae){const we=new b.cM;return(function(Ve,Ke){for(const $e in Ve.layers)Ke.writeMessage(3,nt,Ve.layers[$e])})(Ae,we),we.finish()})(ye);return be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),{vectorTile:ye,rawData:be.buffer}}))}loadData(Z){return b._(this,void 0,void 0,(function*(){var W;(W=this._pendingRequest)===null||W===void 0||W.abort();const Q=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new b.cN(Z.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest);const ue=yield this._pendingData;this._geoJSONIndex=Z.cluster?new yr((function({superclusterOptions:be,clusterProperties:Ae}){if(!Ae||!be)return be;const we={},Ve={},Ke={accumulated:null,zoom:0},$e={properties:null},vt=Object.keys(Ae);for(const Te of vt){const[Ot,rr]=Ae[Te],Mt=b.cT(rr),Xt=b.cT(typeof Ot=="string"?[Ot,["accumulated"],["get",Te]]:Ot);we[Te]=Mt.value,Ve[Te]=Xt.value}return be.map=Te=>{$e.properties=Te;const Ot={};for(const rr of vt)Ot[rr]=we[rr].evaluate(Ke,$e);return Ot},be.reduce=(Te,Ot)=>{$e.properties=Ot;for(const rr of vt)Ke.accumulated=Te[rr],Te[rr]=Ve[rr].evaluate(Ke,$e)},be})(Z)).load(ue.features):(function(be,Ae){return new so(be,Ae)})(ue,Z.geojsonVtOptions),this.loaded={};const ye={data:ue};if(Q){const be=Q.finish();be&&(ye.resourceTiming={},ye.resourceTiming[Z.source]=JSON.parse(JSON.stringify(be)))}return ye}catch(ue){if(delete this._pendingRequest,b.cy(ue))return{abandoned:!0};throw ue}}))}getData(){return b._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Z){const W=this.loaded;return W&&W[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,W){return b._(this,void 0,void 0,(function*(){let Q=yield this.loadGeoJSON(Z,W);if(delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(Ze(Q,!0),Z.filter){const ue=b.cT(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map((be=>`${be.key}: ${be.message}`)).join(", "));Q={type:"FeatureCollection",features:Q.features.filter((be=>ue.value.evaluate({zoom:0},be)))}}return Q}))}loadGeoJSON(Z,W){return b._(this,void 0,void 0,(function*(){const{promoteId:Q}=Z;if(Z.request){const ue=yield b.j(Z.request,W);return this._dataUpdateable=b.cV(ue.data,Q)?b.cU(ue.data,Q):void 0,ue.data}if(typeof Z.data=="string")try{const ue=JSON.parse(Z.data);return this._dataUpdateable=b.cV(ue,Q)?b.cU(ue,Q):void 0,ue}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return b.cW(this._dataUpdateable,Z.dataDiff,Q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Z){return b._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class uo{constructor(Z){this.self=Z,this.actor=new b.J(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(W,Q)=>{if(this.externalWorkerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.externalWorkerSourceTypes[W]=Q},this.self.addProtocol=b.cA,this.self.removeProtocol=b.cB,this.self.registerRTLTextPlugin=W=>{b.cX.setMethods(W)},this.actor.registerMessageHandler("LDT",((W,Q)=>this._getDEMWorkerSource(W,Q.source).loadTile(Q))),this.actor.registerMessageHandler("RDT",((W,Q)=>b._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(W,Q.source).removeTile(Q)})))),this.actor.registerMessageHandler("GCEZ",((W,Q)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,Q.type,Q.source).getClusterExpansionZoom(Q)})))),this.actor.registerMessageHandler("GCC",((W,Q)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,Q.type,Q.source).getClusterChildren(Q)})))),this.actor.registerMessageHandler("GCL",((W,Q)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,Q.type,Q.source).getClusterLeaves(Q)})))),this.actor.registerMessageHandler("LD",((W,Q)=>this._getWorkerSource(W,Q.type,Q.source).loadData(Q))),this.actor.registerMessageHandler("GD",((W,Q)=>this._getWorkerSource(W,Q.type,Q.source).getData())),this.actor.registerMessageHandler("LT",((W,Q)=>this._getWorkerSource(W,Q.type,Q.source).loadTile(Q))),this.actor.registerMessageHandler("RT",((W,Q)=>this._getWorkerSource(W,Q.type,Q.source).reloadTile(Q))),this.actor.registerMessageHandler("AT",((W,Q)=>this._getWorkerSource(W,Q.type,Q.source).abortTile(Q))),this.actor.registerMessageHandler("RMT",((W,Q)=>this._getWorkerSource(W,Q.type,Q.source).removeTile(Q))),this.actor.registerMessageHandler("RS",((W,Q)=>b._(this,void 0,void 0,(function*(){if(!this.workerSources[W]||!this.workerSources[W][Q.type]||!this.workerSources[W][Q.type][Q.source])return;const ue=this.workerSources[W][Q.type][Q.source];delete this.workerSources[W][Q.type][Q.source],ue.removeSource!==void 0&&ue.removeSource(Q)})))),this.actor.registerMessageHandler("RM",(W=>b._(this,void 0,void 0,(function*(){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W]})))),this.actor.registerMessageHandler("SR",((W,Q)=>b._(this,void 0,void 0,(function*(){this.referrer=Q})))),this.actor.registerMessageHandler("SRPS",((W,Q)=>this._syncRTLPluginState(W,Q))),this.actor.registerMessageHandler("IS",((W,Q)=>b._(this,void 0,void 0,(function*(){this.self.importScripts(Q)})))),this.actor.registerMessageHandler("SI",((W,Q)=>this._setImages(W,Q))),this.actor.registerMessageHandler("UL",((W,Q)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(W).update(Q.layers,Q.removedIds)})))),this.actor.registerMessageHandler("SL",((W,Q)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(W).replace(Q)}))))}_setImages(Z,W){return b._(this,void 0,void 0,(function*(){this.availableImages[Z]=W;for(const Q in this.workerSources[Z]){const ue=this.workerSources[Z][Q];for(const ye in ue)ue[ye].availableImages=W}}))}_syncRTLPluginState(Z,W){return b._(this,void 0,void 0,(function*(){return yield b.cX.syncState(W,this.self.importScripts)}))}_getAvailableImages(Z){let W=this.availableImages[Z];return W||(W=[]),W}_getLayerIndex(Z){let W=this.layerIndexes[Z];return W||(W=this.layerIndexes[Z]=new s),W}_getWorkerSource(Z,W,Q){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][W]||(this.workerSources[Z][W]={}),!this.workerSources[Z][W][Q]){const ue={sendAsync:(ye,be)=>(ye.targetMapId=Z,this.actor.sendAsync(ye,be))};switch(W){case"vector":this.workerSources[Z][W][Q]=new oe(ue,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][W][Q]=new Ba(ue,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][W][Q]=new this.externalWorkerSourceTypes[W](ue,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][W][Q]}_getDEMWorkerSource(Z,W){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][W]||(this.demWorkerSources[Z][W]=new le),this.demWorkerSources[Z][W]}}return b.i(self)&&(self.worker=new uo(self)),uo})),T("index",["exports","./shared"],(function(b,s){var N="5.6.2";function V(){var m=new s.A(4);return s.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let K,oe;const le={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,i){const u=requestAnimationFrame((g=>{p(),e(g)})),{unsubscribe:p}=s.s(m.signal,"abort",(()=>{p(),cancelAnimationFrame(u),i(s.c())}),!1)},frameAsync(m){return new Promise(((e,i)=>{this.frame(m,e,i)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,i.drawImage(m,0,0,m.width,m.height),i},resolveURL:m=>(K||(K=document.createElement("a")),K.href=m,K.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(oe==null&&(oe=matchMedia("(prefers-reduced-motion: reduce)")),oe.matches)}};class Y{static testProp(e){if(!Y.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in Y.docStyle)return e[i];return e[0]}static create(e,i,u){const p=window.document.createElement(e);return i!==void 0&&(p.className=i),u&&u.appendChild(p),p}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(e,i){e.style[Y.transformProp]=i}static addEventListener(e,i,u,p={}){e.addEventListener(i,u,"passive"in p?p:p.capture)}static removeEventListener(e,i,u,p={}){e.removeEventListener(i,u,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)}),0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,u){const p=i.boundingClientRect;return new s.P((u.clientX-p.left)/i.x-e.clientLeft,(u.clientY-p.top)/i.y-e.clientTop)}static mousePos(e,i){const u=Y.getScale(e);return Y.getPoint(e,u,i)}static touchPos(e,i){const u=[],p=Y.getScale(e);for(let g=0;g<i.length;g++)u.push(Y.getPoint(e,p,i[g]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=i.querySelectorAll("script");for(const p of u)p.remove();return Y.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const u=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const u of i)Y.removeAttributes(u),Y.clean(u)}static removeAttributes(e){for(const{name:i,value:u}of e.attributes)Y.isPossiblyDangerous(i,u)&&e.removeAttribute(i)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const Be={supported:!1,testSupport:function(m){!He&&Ze&&(Ge?nt(m):Ne=m)}};let Ne,Ze,He=!1,Ge=!1;function nt(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Ze),m.isContextLost())return;Be.supported=!0}catch{}m.deleteTexture(e),He=!0}var Le;typeof document<"u"&&(Ze=document.createElement("img"),Ze.onload=()=>{Ne&&nt(Ne),Ne=null,Ge=!0},Ze.onerror=()=>{He=!0,Ne=null},Ze.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,i,u,p;m.resetRequestQueue=()=>{e=[],i=0,u=0,p={}},m.addThrottleControl=k=>{const z=u++;return p[z]=k,z},m.removeThrottleControl=k=>{delete p[k],x()},m.getImage=(k,z,R=!0)=>new Promise(((j,B)=>{Be.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),s.e(k,{type:"image"}),e.push({abortController:z,requestParameters:k,supportImageRefresh:R,state:"queued",onError:O=>{B(O)},onSuccess:O=>{j(O)}}),x()}));const g=k=>s._(this,void 0,void 0,(function*(){k.state="running";const{requestParameters:z,supportImageRefresh:R,onError:j,onSuccess:B,abortController:O}=k,G=R===!1&&!s.i(self)&&!s.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((re,ne)=>re&&ne==="accept"),!0));i++;const J=G?M(z,O):s.m(z,O);try{const re=yield J;delete k.abortController,k.state="completed",re.data instanceof HTMLImageElement||s.b(re.data)?B(re):re.data&&B({data:yield(te=re.data,typeof createImageBitmap=="function"?s.f(te):s.h(te)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete k.abortController,j(re)}finally{i--,x()}var te})),x=()=>{const k=(()=>{for(const z of Object.keys(p))if(p[z]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=i;z<k&&e.length>0;z++){const R=e.shift();R.abortController.signal.aborted?z--:g(R)}},M=(k,z)=>new Promise(((R,j)=>{const B=new Image,O=k.url,G=k.credentials;G&&G==="include"?B.crossOrigin="use-credentials":(G&&G==="same-origin"||!s.d(O))&&(B.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{B.src="",j(s.c())})),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,R({data:B})},B.onerror=()=>{B.onerror=B.onload=null,z.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=O}))})(Le||(Le={})),Le.resetRequestQueue();class Re{constructor(e){this._transformRequestFn=e??null}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ue(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const i=[];for(const{id:u,url:p}of m){const g=`${u}${p}`;i.indexOf(g)===-1&&(i.push(g),e.push({id:u,url:p}))}}return e}function pt(m,e,i){try{const u=new URL(m);return u.pathname+=`${e}${i}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function lt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ft extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:u}of this.requestors)u(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const u=i.spriteData;i.data=new s.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let u=!0;const p=i.data||i.spriteData;return this._validateStretch(i.stretchX,p&&p.width)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(i.stretchY,p&&p.height)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(i.content,i)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,i){if(!e)return!0;let u=0;for(const p of e){if(p[0]<u||p[1]<p[0]||i<p[1])return!1;u=p[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const u=i.spriteData,p=u&&u.width||i.data.width,g=u&&u.height||i.data.height;return!(e[0]<0||p<e[0]||e[1]<0||g<e[1]||e[2]<0||p<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,u=!0){const p=this.getImage(e);if(u&&(p.data.width!==i.data.width||p.data.height!==i.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=p.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((i,u)=>{let p=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(p=!1);this.isLoaded()||p?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})}))}_getImagesForIds(e){const i={};for(const u of e){let p=this.getImage(u);p||(this.fire(new s.l("styleimagemissing",{id:u})),p=this.getImage(u)),p?i[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:s.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],u=this.getImage(e);if(!u)return null;if(i&&i.position.version===u.version)return i.position;if(i)i.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new s.I(p,u);this.patterns[e]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:i,h:u}=s.p(e),p=this.atlasImage;p.resize({width:i||1,height:u||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],M=x.x+1,k=x.y+1,z=this.getImage(g).data,R=z.width,j=z.height;s.R.copy(z,p,{x:0,y:0},{x:M,y:k},{width:R,height:j}),s.R.copy(z,p,{x:0,y:j-1},{x:M,y:k-1},{width:R,height:1}),s.R.copy(z,p,{x:0,y:0},{x:M,y:k+j},{width:R,height:1}),s.R.copy(z,p,{x:R-1,y:0},{x:M-1,y:k},{width:1,height:j}),s.R.copy(z,p,{x:0,y:0},{x:M+R,y:k},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const u=this.getImage(i);u||s.w(`Image with ID: "${i}" was not found`),lt(u)&&this.updateImage(i,u)}}}const Pt=1e20;function Ur(m,e,i,u,p,g,x,M,k){for(let z=e;z<e+u;z++)Cr(m,i*g+z,g,p,x,M,k);for(let z=i;z<i+p;z++)Cr(m,z*g+e,1,u,x,M,k)}function Cr(m,e,i,u,p,g,x){g[0]=0,x[0]=-Pt,x[1]=Pt,p[0]=m[e];for(let M=1,k=0,z=0;M<u;M++){p[M]=m[e+M*i];const R=M*M;do{const j=g[k];z=(p[M]-p[j]+R-j*j)/(M-j)/2}while(z<=x[k]&&--k>-1);k++,g[k]=M,x[k]=z,x[k+1]=Pt}for(let M=0,k=0;M<u;M++){for(;x[k+1]<M;)k++;const z=g[k],R=M-z;m[e+M*i]=p[z]+R*R}}class yr{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return s._(this,void 0,void 0,(function*(){const i=[];for(const g in e)for(const x of e[g])i.push(this._getAndCacheGlyphsPromise(g,x));const u=yield Promise.all(i),p={};for(const{stack:g,id:x,glyph:M}of u)p[g]||(p[g]={}),p[g][x]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return p}))}_getAndCacheGlyphsPromise(e,i){return s._(this,void 0,void 0,(function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=u.glyphs[i];if(p!==void 0)return{stack:e,id:i,glyph:p};if(p=this._tinySDF(u,e,i),p)return u.glyphs[i]=p,{stack:e,id:i,glyph:p};const g=Math.floor(i/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[g])return{stack:e,id:i,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[g]){const M=yr.loadGlyphRange(e,g,this.url,this.requestManager);u.requests[g]=M}const x=yield u.requests[g];for(const M in x)this._doesCharSupportLocalGlyph(+M)||(u.glyphs[+M]=x[+M]);return u.ranges[g]=!0,{stack:e,id:i,glyph:x[i]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))||s.u["CJK Unified Ideographs"](e)||s.u["Hangul Syllables"](e)||s.u.Hiragana(e)||s.u.Katakana(e)||s.u["CJK Symbols and Punctuation"](e)||s.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,u){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let M="400";/bold/i.test(i)?M="900":/medium/i.test(i)?M="500":/light/i.test(i)&&(M="200"),g=e.tinySDF=new yr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:M})}const x=g.draw(String.fromCharCode(u));return{id:u,bitmap:new s.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}yr.loadGlyphRange=function(m,e,i,u){return s._(this,void 0,void 0,(function*(){const p=256*e,g=p+255,x=u.transformRequest(i.replace("{fontstack}",m).replace("{range}",`${p}-${g}`),"Glyphs"),M=yield s.n(x,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${g}`);const k={};for(const z of s.o(M.data))k[z.id]=z;return k}))},yr.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:i=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal",lang:M=null}={}){this.buffer=e,this.cutoff=u,this.radius=i,this.lang=M;const k=this.size=m+4*e,z=this._createCanvas(k),R=this.ctx=z.getContext("2d",{willReadFrequently:!0});R.font=`${x} ${g} ${m}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(m),x=Math.ceil(i),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),k=Math.min(this.size-this.buffer,x+Math.ceil(u)),z=M+2*this.buffer,R=k+2*this.buffer,j=Math.max(z*R,0),B=new Uint8ClampedArray(j),O={data:B,width:z,height:R,glyphWidth:M,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(M===0||k===0)return O;const{ctx:G,buffer:J,gridInner:te,gridOuter:re}=this;this.lang&&(G.lang=this.lang),G.clearRect(J,J,M,k),G.fillText(m,J,J+x);const ne=G.getImageData(J,J,M,k);re.fill(Pt,0,j),te.fill(0,0,j);for(let ce=0;ce<k;ce++)for(let ie=0;ie<M;ie++){const de=ne.data[4*(ce*M+ie)+3]/255;if(de===0)continue;const me=(ce+J)*z+ie+J;if(de===1)re[me]=0,te[me]=Pt;else{const se=.5-de;re[me]=se>0?se*se:0,te[me]=se<0?se*se:0}}Ur(re,0,0,z,R,z,this.f,this.v,this.z),Ur(te,J,J,M,k,z,this.f,this.v,this.z);for(let ce=0;ce<j;ce++){const ie=Math.sqrt(re[ce])-Math.sqrt(te[ce]);B[ce]=Math.round(255-255*(ie/this.radius+this.cutoff))}return O}};class fr{constructor(){this.specification=s.v.light.position}possiblyEvaluate(e,i){return s.B(e.expression.evaluate(i))}interpolate(e,i,u){return{x:s.C.number(e.x,i.x,u),y:s.C.number(e.y,i.y,u),z:s.C.number(e.z,i.z,u)}}}let xn;class qr extends s.E{constructor(e){super(),xn=xn||new s.r({anchor:new s.D(s.v.light.anchor),position:new fr,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.t(xn),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(s.x,e,i))for(const u in e){const p=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),p):this._transitionable.setValue(u,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u){return(!u||u.validate!==!1)&&s.y(this,e.call(s.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const Rr=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class yt extends s.E{constructor(e){super(),this._transitionable=new s.t(Rr),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0))}setSky(e,i={}){if(!this._validate(s.G,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const p=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),p):this._transitionable.setValue(u,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u={}){return u?.validate!==!1&&s.y(this,e.call(s.z,s.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class _t{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const u=e.join(",")+String(i);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,i)),this.dashEntry[u]}getDashRanges(e,i,u){const p=[];let g=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,M=!0;p.push({left:g,right:x,isDash:M,zeroLength:e[0]===0});let k=e[0];for(let z=1;z<e.length;z++){M=!M;const R=e[z];g=k*u,k+=R,x=k*u,p.push({left:g,right:x,isDash:M,zeroLength:R===0})}return p}addRoundDash(e,i,u){const p=i/2;for(let g=-u;g<=u;g++){const x=this.width*(this.nextRow+u+g);let M=0,k=e[M];for(let z=0;z<this.width;z++){z/k.right>1&&(k=e[++M]);const R=Math.abs(z-k.left),j=Math.abs(z-k.right),B=Math.min(R,j);let O;const G=g/u*(p+1);if(k.isDash){const J=p-Math.abs(G);O=Math.sqrt(B*B+J*J)}else O=p-Math.sqrt(B*B+G*G);this.data[x+z]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let M=e.length-1;M>=0;--M){const k=e[M],z=e[M+1];k.zeroLength?e.splice(M,1):z&&z.isDash===k.isDash&&(z.left=k.left,e.splice(M,1))}const i=e[0],u=e[e.length-1];i.isDash===u.isDash&&(i.left=u.left-this.width,u.right=i.right+this.width);const p=this.width*this.nextRow;let g=0,x=e[g];for(let M=0;M<this.width;M++){M/x.right>1&&(x=e[++g]);const k=Math.abs(M-x.left),z=Math.abs(M-x.right),R=Math.min(k,z);this.data[p+M]=Math.max(0,Math.min(255,(x.isDash?R:-R)+128))}}addDash(e,i){const u=i?7:0,p=2*u+1;if(this.nextRow+p>this.height)return s.w("LineAtlas out of space"),null;let g=0;for(let M=0;M<e.length;M++)g+=e[M];if(g!==0){const M=this.width/g,k=this.getDashRanges(e,this.width,M);i?this.addRoundDash(k,M,u):this.addRegularDash(k)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const bt="maplibre_preloaded_worker_pool";class Pe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Pe.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[bt]}numActive(){return Object.keys(this.active).length}}const Je=Math.floor(le.hardwareConcurrency/2);let Wt,er;function mr(){return Wt||(Wt=new Pe),Wt}Pe.workerCount=s.H(globalThis)?Math.max(Math.min(Je,3),1):1;class Qt{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const u=this.workerPool.acquire(i);for(let p=0;p<u.length;p++){const g=new s.J(u[p],i);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const u=[];for(const p of this.actors)u.push(p.sendAsync({type:e,data:i}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((i=>{i.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const u of this.actors)u.registerMessageHandler(e,i)}}function Ir(){return er||(er=new Qt(mr(),s.K),er.registerMessageHandler("GR",((m,e,i)=>s.m(e,i)))),er}function cr(m,e){const i=s.L();return s.M(i,i,[1,1,0]),s.N(i,i,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?s.O(i,i,m.calculatePosMatrix(e.toUnwrapped())):i}function wr(m,e,i,u,p,g,x){var M;const k=(function(B,O,G){if(B)for(const J of B){const te=O[J];if(te&&te.source===G&&te.type==="fill-extrusion")return!0}else for(const J in O){const te=O[J];if(te.source===G&&te.type==="fill-extrusion")return!0}return!1})((M=p?.layers)!==null&&M!==void 0?M:null,e,m.id),z=g.maxPitchScaleFactor(),R=m.tilesIn(u,z,k);R.sort(Bn);const j=[];for(const B of R)j.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(e,i,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,p,g,z,cr(m.transform,B.tileID),x?(O,G)=>x(B.tileID,O,G):void 0)});return(function(B,O){for(const G in B)for(const J of B[G])io(J,O);return B})((function(B){const O={},G={};for(const J of B){const te=J.queryResults,re=J.wrappedTileID,ne=G[re]=G[re]||{};for(const ce in te){const ie=te[ce],de=ne[ce]=ne[ce]||{},me=O[ce]=O[ce]||[];for(const se of ie)de[se.featureIndex]||(de[se.featureIndex]=!0,me.push(se))}}return O})(j),m)}function Bn(m,e){const i=m.tileID,u=e.tileID;return i.overscaledZ-u.overscaledZ||i.canonical.y-u.canonical.y||i.wrap-u.wrap||i.canonical.x-u.canonical.x}function io(m,e){const i=m.feature,u=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=u}function Pi(m,e,i){return s._(this,void 0,void 0,(function*(){let u=m;if(m.url?u=(yield s.j(e.transformRequest(m.url,"Source"),i)).data:yield le.frameAsync(i),!u)return null;const p=s.Q(s.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(p.vectorLayerIds=u.vector_layers.map((g=>g.id))),p}))}class Qr{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof s.S?new s.S(e.lng,e.lat):s.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof s.S?new s.S(e.lng,e.lat):s.S.convert(e),this}extend(e){const i=this._sw,u=this._ne;let p,g;if(e instanceof s.S)p=e,g=e;else{if(!(e instanceof Qr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Qr.convert(e)):this.extend(s.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(s.S.convert(e)):this;if(p=e._sw,g=e._ne,!p||!g)return this}return i||u?(i.lng=Math.min(p.lng,i.lng),i.lat=Math.min(p.lat,i.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new s.S(p.lng,p.lat),this._ne=new s.S(g.lng,g.lat)),this}getCenter(){return new s.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.S(this.getWest(),this.getNorth())}getSouthEast(){return new s.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:u}=s.S.convert(e);let p=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(e){return e instanceof Qr?e:e&&new Qr(e)}static fromLngLat(e,i=0){const u=360*i/40075017,p=u/Math.cos(Math.PI/180*e.lat);return new Qr(new s.S(e.lng-p,e.lat-u),new s.S(e.lng+p,e.lat+u))}adjustAntiMeridian(){const e=new s.S(this._sw.lng,this._sw.lat),i=new s.S(this._ne.lng,this._ne.lat);return new Qr(e,e.lng>i.lng?new s.S(i.lng+360,i.lat):i)}}class an{constructor(e,i,u){this.bounds=Qr.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),u=Math.floor(s.V(this.bounds.getWest())*i),p=Math.floor(s.U(this.bounds.getNorth())*i),g=Math.ceil(s.V(this.bounds.getEast())*i),x=Math.ceil(s.U(this.bounds.getSouth())*i);return e.x>=u&&e.x<g&&e.y>=p&&e.y<x}}class ea extends s.E{constructor(e,i,u,p){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.Q(i,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Pi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(s.e(this,e),e.bounds&&(this.tileBounds=new an(e.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new s.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};u.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,x)=>{e.reloadPromise={resolve:g,reject:x}}))}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:p,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return s._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class da extends s.E{constructor(e,i,u,p){super(),this.id=e,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},i),s.e(this,s.Q(i,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Pi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(s.e(this,i),i.bounds&&(this.tileBounds=new an(i.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new s.k(i))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return s.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield Le.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const p=this.map.painter.context,g=p.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new s.T(p,x,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}abortTile(e){return s._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class ao extends da{constructor(e,i,u,p){super(e,i,u,p),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const p=yield Le.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){const g=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const x=s.b(g)&&s.W()?g:yield this.readImageNow(g),M={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:M});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}}))}readImageNow(e){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.X()){const i=e.width+2,u=e.height+2;try{return new s.R({width:i,height:u},yield s.Y(e,-1,-1,i,u))}catch{}}return le.getImageData(e,1)}))}_getNeighboringTiles(e){const i=e.canonical,u=Math.pow(2,i.z),p=(i.x-1+u)%u,g=i.x===0?e.wrap-1:e.wrap,x=(i.x+1+u)%u,M=i.x+1===u?e.wrap+1:e.wrap,k={};return k[new s.Z(e.overscaledZ,g,i.z,p,i.y).key]={backfilled:!1},k[new s.Z(e.overscaledZ,M,i.z,x,i.y).key]={backfilled:!1},i.y>0&&(k[new s.Z(e.overscaledZ,g,i.z,p,i.y-1).key]={backfilled:!1},k[new s.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},k[new s.Z(e.overscaledZ,M,i.z,x,i.y-1).key]={backfilled:!1}),i.y+1<u&&(k[new s.Z(e.overscaledZ,g,i.z,p,i.y+1).key]={backfilled:!1},k[new s.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},k[new s.Z(e.overscaledZ,M,i.z,x,i.y+1).key]={backfilled:!1}),k}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class fa extends s.E{constructor(e,i,u,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:i.data},this.actor=u.getActor(),this.setEventedParent(p),this._data=i.data,this._options=s.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:s.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(s.$/this.tileSize)}_getClusterMaxZoom(e){const i=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${i}"`),i}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=s.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return s._(this,void 0,void 0,(function*(){const e=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((i=>i.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,(function*(){const e=new Qr,i=yield this.getData();let u;switch(i.type){case"FeatureCollection":u=i.features.map((p=>this.getCoordinatesFromGeometry(p.geometry))).flat(1/0);break;case"Feature":u=this.getCoordinatesFromGeometry(i.geometry);break;default:u=this.getCoordinatesFromGeometry(i)}if(u.length==0)return e;for(let p=0;p<u.length-1;p+=2)e.extend([u[p],u[p+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:u}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:i}=this._pendingWorkerUpdate;if(!e&&!i)return void s.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const u=s.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(u.request=this.map._requestManager.transformRequest(le.resolveURL(e),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):i&&(u.dataDiff=i,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));this._data=p.data;let g=null;p.resourceTiming&&p.resourceTiming[this.id]&&(g=p.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&s.e(x,{resourceTiming:g}),this.fire(new s.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(p))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const p=yield this.actor.sendAsync({type:i,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,i==="RT")}))}abortTile(e){return s._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ta extends s.E{constructor(e,i,u,p){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=i}load(e){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new s.k(i))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(s.a1.fromLngLat);var u;return this.tileID=(function(p){const g=s.a2.fromPoints(p),x=g.width(),M=g.height(),k=Math.max(x,M),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),R=Math.pow(2,z);return new s.a4(z,Math.floor((g.minX+g.maxX)/2*R),Math.floor((g.minY+g.maxY)/2*R))})(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new s.T(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:i,minY:u,maxX:p,maxY:g}=s.a2.fromPoints(e),x={};for(let M=0;M<=s.a3;M++){const k=Math.pow(2,M),z=Math.floor(i*k),R=Math.floor(u*k),j=Math.floor(p*k),B=Math.floor(g*k);x[M]={minTileX:z,minTileY:R,maxTileX:j,maxTileY:B}}return x}}class Na extends ta{constructor(e,i,u,p){super(e,i,u,p),this.roundZoom=!0,this.type="video",this.options=i}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield s.a5(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new s.k(i))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new s.k(new s.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Fi extends ta{constructor(e,i,u,p){super(e,i,u,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((x=>typeof x!="number"))))||this.fire(new s.k(new s.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a6(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.k(new s.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,u=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(i,this.canvas,u.RGBA,{premultiply:!0});let p=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Fa={},oo=m=>{switch(m){case"geojson":return fa;case"image":return ta;case"raster":return da;case"raster-dem":return ao;case"vector":return ea;case"video":return Na;case"canvas":return Fi}return Fa[m]},Zo="RTLPluginLoaded";class so extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ir()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((i=>{throw this.status="error",i}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return s._(this,arguments,void 0,(function*(i,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=le.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Zo))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let lo=null;function Ba(){return lo||(lo=new so),lo}class uo{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=s.a7(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(p,g){const x={};if(!g)return x;for(const M of p){const k=M.layerIds.map((z=>g.getLayer(z))).filter(Boolean);if(k.length!==0){M.layers=k,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map((z=>k.filter((R=>R.id===z))[0])));for(const z of k)x[z.id]=M}}return x})(e.buckets,i?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.a9){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.a9&&g.hasRTLText){this.hasRTLText=!0,Ba().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(p).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new s.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,u,p,g,x,M,k,z,R,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:R,transform:k,params:M,queryPadding:this.queryPadding*z,getElevation:j},e,i,u):{}}querySourceFeatures(e,i){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=i&&i.sourceLayer?i.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const M=s.aa(i&&i.filter),{z:k,x:z,y:R}=this.tileID.canonical,j={z:k,x:z,y:R};for(let B=0;B<x.length;B++){const O=x.feature(B);if(M.needGeometry){const te=s.ab(O,!0);if(!M.filter(new s.F(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!M.filter(new s.F(this.tileID.overscaledZ),O))continue;const G=u.getId(O,g),J=new s.ac(O,k,z,R,G);J.tile=j,e.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const u=s.ad(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(i)if(this.expirationTime<i)p=!0;else{const g=this.expirationTime-i;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",M=u[x],k=e[x];if(!M||!k||Object.keys(k).length===0)continue;g.update(k,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=i&&i.style&&i.style.getLayer(p);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<le.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=le.now()+e}setDependencies(e,i){const u={};for(const p of i)u[p]=!0;this.dependencies[e]=u}hasDependency(e,i){for(const u of e){const p=this.dependencies[u];if(p){for(const g of i)if(p[g])return!0}}return!1}}class xe{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,u){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:i,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout((()=>{this.remove(e,g)}),u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const u=e.wrapped().key,p=i===void 0?0:this.data[u].indexOf(i),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const u in this.data)for(const p of this.data[u])e(p.value)||i.push(p);for(const u of i)this.remove(u.value.tileID,u)}}class Z{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,u){const p=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},s.e(this.stateChanges[e][p],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==p&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const g in this.state[e][p])u[g]||(this.deletedStates[e][p][g]=null)}else for(const g in u)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][g]===null&&delete this.deletedStates[e][p][g]}removeFeatureState(e,i,u){if(this.deletedStates[e]===null)return;const p=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&i!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][u]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(u in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][u]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,i){const u=String(i),p=s.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][i];if(g===null)return{};for(const x in g)delete p[x]}return p}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.e(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const M of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][M];g[x]=this.state[p][x]}u[p]=u[p]||{},s.e(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in e)e[p].setFeatureState(u,i)}}const W=89.25;function Q(m,e){const i=s.ah(e.lat,-s.ai,s.ai);return new s.P(s.V(e.lng)*m,s.U(i)*m)}function ue(m,e){return new s.a1(e.x/m,e.y/m).toLngLat()}function ye(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(s.ae(90-m.pitch)),Math.tan(s.ae(W-m.pitch)))}function be(m,e){const i=m.canonical,u=e/s.af(i.z),p=i.x+Math.pow(2,i.z)*m.wrap,g=s.ag(new Float64Array(16));return s.M(g,g,[p*u,i.y*u,0]),s.N(g,g,[u/s.$,u/s.$,1]),g}function Ae(m,e,i,u,p){const g=s.a1.fromLngLat(m,e),x=p*s.aj(1,m.lat),M=x*Math.cos(s.ae(i)),k=Math.sqrt(x*x-M*M),z=k*Math.sin(s.ae(-u)),R=k*Math.cos(s.ae(-u));return new s.a1(g.x+z,g.y+R,g.z+M)}function we(m,e,i){const u=e.intersectsFrustum(m);if(!i||u===0)return u;const p=e.intersectsPlane(i);return p===0?0:u===2&&p===2?2:1}function Ve(m,e,i){let u=0;const p=(i-e)/10;for(let g=0;g<10;g++)u+=p*Math.pow(Math.cos(e+(g+.5)/10*(i-e)),m);return u}function Ke(m,e){return function(i,u,p,g,x){const M=2*((m-1)/s.ak(Math.cos(s.ae(W-x))/Math.cos(s.ae(W)))-1),k=Math.acos(p/g),z=2*Ve(M-1,0,s.ae(x/2)),R=Math.min(s.ae(W),k+s.ae(x/2)),j=Ve(M-1,Math.min(R,k-s.ae(x/2)),R),B=Math.atan(u/p),O=Math.hypot(u,p);let G=i;return G+=s.ak(g/O/Math.max(.5,Math.cos(s.ae(x/2)))),G+=M*s.ak(Math.cos(B))/2,G-=s.ak(Math.max(1,j/z/e))/2,G}}const $e=Ke(9.314,3);function vt(m,e){const i=(e.roundZoom?Math.round:Math.floor)(m.zoom+s.ak(m.tileSize/e.tileSize));return Math.max(0,i)}function Te(m,e){const i=m.getCameraFrustum(),u=m.getClippingPlane(),p=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=s.a1.fromLngLat(m.center,m.elevation);p.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const x=m.getCoveringTilesDetailsProvider(),M=x.allowVariableZoom(m,e),k=vt(m,e),z=e.minzoom||0,R=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,j=Math.min(Math.max(0,k),R),B=Math.pow(2,j),O=[B*p.x,B*p.y,0],G=[B*g.x,B*g.y,0],J=Math.hypot(g.x-p.x,g.y-p.y),te=Math.abs(g.z-p.z),re=Math.hypot(J,te),ne=de=>({zoom:0,x:0,y:0,wrap:de,fullyVisible:!1}),ce=[],ie=[];if(m.renderWorldCopies&&x.allowWorldCopies())for(let de=1;de<=3;de++)ce.push(ne(-de)),ce.push(ne(de));for(ce.push(ne(0));ce.length>0;){const de=ce.pop(),me=de.x,se=de.y;let _e=de.fullyVisible;const Ee={x:me,y:se,z:de.zoom},Me=x.getTileBoundingVolume(Ee,de.wrap,m.elevation,e);if(!_e){const it=we(i,Me,u);if(it===0)continue;_e=it===2}const ke=x.distanceToTile2d(p.x,p.y,Ee,Me);let De=k;M&&(De=(e.calculateTileZoom||$e)(m.zoom+s.ak(m.tileSize/e.tileSize),ke,te,re,m.fov)),De=(e.roundZoom?Math.round:Math.floor)(De),De=Math.max(0,De);const tt=Math.min(De,R);if(de.wrap=x.getWrap(g,Ee,de.wrap),de.zoom>=tt){if(de.zoom<z)continue;const it=j-de.zoom,We=O[0]-.5-(me<<it),St=O[1]-.5-(se<<it),Jt=e.reparseOverscaled?Math.max(de.zoom,De):de.zoom;ie.push({tileID:new s.Z(de.zoom===R?Jt:de.zoom,de.wrap,de.zoom,me,se),distanceSq:s.al([G[0]-.5-me,G[1]-.5-se]),tileDistanceToCamera:Math.sqrt(We*We+St*St)})}else for(let it=0;it<4;it++)ce.push({zoom:de.zoom+1,x:(me<<1)+it%2,y:(se<<1)+(it>>1),wrap:de.wrap,fullyVisible:_e})}return ie.sort(((de,me)=>de.distanceSq-me.distanceSq)).map((de=>de.tileID))}const Ot=s.a2.fromPoints([new s.P(0,0),new s.P(s.$,s.$)]);class rr extends s.E{constructor(e,i,u){super(),this.id=e,this.dispatcher=u,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,g,x,M)=>{const k=new(oo(g.type))(p,g,x,M);if(k.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${k.id}`);return k})(e,i,u,this),this._tiles={},this._cache=new xe(0,(p=>this._unloadTile(p))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Z,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,u){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,u)}catch(p){e.state="errored",p.status!==404?this._source.fire(new s.k(p,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new s.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const u=this._tiles[i];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Mt).map((e=>e.key))}getRenderableIds(e){const i=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&i.push(this._tiles[u]);return e?i.sort(((u,p)=>{const g=u.tileID,x=p.tileID,M=new s.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),k=new s.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-x.overscaledZ||k.y-M.y||k.x-M.x})).map((u=>u.tileID.key)):i.map((u=>u.tileID)).sort(Mt).map((u=>u.key))}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)e?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return s._(this,void 0,void 0,(function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=i),yield this._loadTile(u,e,i))}))}_tileLoaded(e,i,u){e.timeAdded=le.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let p=0;p<i.length;p++){const g=i[p];if(e.neighboringTiles&&e.neighboringTiles[g]){const x=this.getTileByID(g);u(e,x),u(x,e)}}function u(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const M=g.tileID.canonical.y-p.tileID.canonical.y,k=Math.pow(2,p.tileID.canonical.z),z=g.tileID.key;x===0&&M===0||Math.abs(M)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,M),p.neighboringTiles&&p.neighboringTiles[z]&&(p.neighboringTiles[z].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,u,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=i||x.tileID.overscaledZ>u)continue;let M=x.tileID;for(;x&&x.tileID.overscaledZ>i+1;){const z=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[z.key],x&&x.hasData()&&(M=z)}let k=M;for(;k.overscaledZ>i;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]||e[k.canonical.key]){p[M.key]=M;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=i?u:null}for(let u=e.overscaledZ-1;u>=i;u--){const p=e.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(i*u*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+i),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,i,u,p,g,x){const M={},k={},z=Object.keys(e),R=le.now();for(const j of z){const B=e[j],O=this._tiles[j];if(!O||O.fadeEndTime!==0&&O.fadeEndTime<=R)continue;const G=this.findLoadedParent(B,i),J=this.findLoadedSibling(B),te=G||J||null;te&&(this._addTile(te.tileID),M[te.tileID.key]=te.tileID),k[j]=B}this._retainLoadedChildren(k,p,u,e);for(const j in M)e[j]||(this._coveredTiles[j]=!0,e[j]=M[j]);if(x){const j={},B={};for(const O of g)this._tiles[O.key].hasData()?j[O.key]=O:B[O.key]=O;for(const O in B){const G=B[O].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(j[G[0].key]=e[G[0].key]=G[0],j[G[1].key]=e[G[1].key]=G[1],j[G[2].key]=e[G[2].key]=G[2],j[G[3].key]=e[G[3].key]=G[3],delete B[O])}for(const O in B){const G=B[O],J=this.findLoadedParent(G,this._source.minzoom),te=this.findLoadedSibling(G),re=J||te||null;if(re){j[re.tileID.key]=e[re.tileID.key]=re.tileID;for(const ne in j)j[ne].isChildOf(re.tileID)&&delete j[ne]}}for(const O in this._tiles)j[O]||(this._coveredTiles[O]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((R=>new s.Z(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y))):(u=Te(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((R=>this._source.hasTile(R))))):u=[];const p=vt(e,this._source),g=Math.max(p-rr.maxOverzooming,this._source.minzoom),x=Math.max(p+rr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const j of u)if(j.canonical.z>this._source.minzoom){const B=j.scaledTo(j.canonical.z-1);R[B.key]=B;const O=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));R[O.key]=O}u=u.concat(Object.values(R))}const M=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,p);Xt(this._source.type)&&this._updateCoveredAndRetainedTiles(k,g,x,p,u,i);for(const R in k)this._tiles[R].clearFadeHold();const z=s.am(this._tiles,k);for(const R of z){const j=this._tiles[R];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var u;const p={},g={},x=Math.max(i-rr.maxOverzooming,this._source.minzoom),M=Math.max(i+rr.maxUnderzooming,this._source.minzoom),k={};for(const z of e){const R=this._addTile(z);p[z.key]=z,R.hasData()||i<this._source.maxzoom&&(k[z.key]=z)}this._retainLoadedChildren(k,i,M,p);for(const z of e){let R=this._tiles[z.key];if(R.hasData())continue;if(i+1>this._source.maxzoom){const B=z.children(this._source.maxzoom)[0],O=this.getTile(B);if(O&&O.hasData()){p[B.key]=B;continue}}else{const B=z.children(this._source.maxzoom);if(p[B[0].key]&&p[B[1].key]&&p[B[2].key]&&p[B[3].key])continue}let j=R.wasRequested();for(let B=z.overscaledZ-1;B>=x;--B){const O=z.scaledTo(B);if(g[O.key])break;if(g[O.key]=!0,R=this.getTile(O),!R&&j&&(R=this._addTile(O)),R){const G=R.hasData();if((G||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||j)&&(p[O.key]=O),j=R.wasRequested(),G)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let u,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}i.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of i)this._loadedParentTiles[g]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,u=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=u}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const u=i;return i||(i=new uo(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,u||this._source.fire(new s.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=i.getExpiryTimeout();u&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),u))}refreshTiles(e){for(const i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&e.some((u=>u.equals(this._tiles[i].tileID.canonical)))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,u){const p=[],g=this.transform;if(!g)return p;const x=g.getCoveringTilesDetailsProvider().allowWorldCopies(),M=u?g.getCameraQueryGeometry(e):e,k=O=>g.screenPointToMercatorCoordinate(O,this.terrain),z=this.transformBbox(e,k,!x),R=this.transformBbox(M,k,!x),j=this.getIds(),B=s.a2.fromPoints(R);for(let O=0;O<j.length;O++){const G=this._tiles[j[O]];if(G.holdingForFade())continue;const J=x?[G.tileID]:[G.tileID.unwrapTo(-1),G.tileID.unwrapTo(0)],te=Math.pow(2,g.zoom-G.tileID.overscaledZ),re=i*G.queryPadding*s.$/G.tileSize/te;for(const ne of J){const ce=B.map((ie=>ne.getTilePoint(new s.a1(ie.x,ie.y))));if(ce.expandBy(re),ce.intersects(Ot)){const ie=z.map((me=>ne.getTilePoint(me))),de=R.map((me=>ne.getTilePoint(me)));p.push({tile:G,tileID:x?ne:ne.unwrapTo(0),queryGeometry:ie,cameraQueryGeometry:de,scale:te})}}}return p}transformBbox(e,i,u){let p=e.map(i);if(u){const g=s.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const x=g.map(i);s.a2.fromPoints(p).covers(x)||(p=p.map((M=>M.x>.5?new s.a1(M.x-1,M.y,M.z):M)))}return p}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map((u=>this._tiles[u].tileID));return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(Xt(this._source.type)){const e=le.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,u){this._state.updateState(e=e||"_geojsonTileLayer",i,u)}removeFeatureState(e,i,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,u)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,u){const p=this._tiles[e];p&&p.setDependencies(i,u)}reloadTilesForDependencies(e,i){for(const u in this._tiles)this._tiles[u].hasDependency(e,i)&&this._reloadTile(u,"reloading");this._cache.filter((u=>!u.hasDependency(e,i)))}}function Mt(m,e){const i=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-i||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Xt(m){return m==="raster"||m==="image"||m==="video"}rr.maxOverzooming=10,rr.maxUnderzooming=3;class Gr{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=s.ah(e,0,1);let i=1,u=this._distances[i];const p=e*this.paddedLength+this.padding;for(;u<p&&i<this._distances.length;)u=this._distances[++i];const g=i-1,x=this._distances[g],M=u-x,k=M>0?(p-x)/M:0;return this.points[g].mult(1-k).add(this.points[i].mult(k))}}function dn(m,e){let i=!0;return m==="always"||m!=="never"&&e!=="never"||(i=!1),i}class bn{constructor(e,i,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(i/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,u,p,g){this._forEachCell(i,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(e,i,u,p){this._forEachCell(i-p,u-p,i+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(u),this.circles.push(p)}_insertBoxCell(e,i,u,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(e,i,u,p,g,x){this.circleCells[g].push(x)}_query(e,i,u,p,g,x,M){if(u<0||e>this.width||p<0||i>this.height)return[];const k=[];if(e<=0&&i<=0&&this.width<=u&&this.height<=p){if(g)return[{key:null,x1:e,y1:i,x2:u,y2:p}];for(let z=0;z<this.boxKeys.length;z++)k.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const R=this.circles[3*z],j=this.circles[3*z+1],B=this.circles[3*z+2];k.push({key:this.circleKeys[z],x1:R-B,y1:j-B,x2:R+B,y2:j+B})}}else this._forEachCell(e,i,u,p,this._queryCell,k,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},M);return k}query(e,i,u,p){return this._query(e,i,u,p,!1,null)}hitTest(e,i,u,p,g,x){return this._query(e,i,u,p,!0,g,x).length>0}hitTestCircle(e,i,u,p,g){const x=e-u,M=e+u,k=i-u,z=i+u;if(M<0||x>this.width||z<0||k>this.height)return!1;const R=[];return this._forEachCell(x,k,M,z,this._queryCellCircle,R,{hitTest:!0,overlapMode:p,circle:{x:e,y:i,radius:u},seenUids:{box:{},circle:{}}},g),R.length>0}_queryCell(e,i,u,p,g,x,M,k){const{seenUids:z,hitTest:R,overlapMode:j}=M,B=this.boxCells[g];if(B!==null){const G=this.bboxes;for(const J of B)if(!z.box[J]){z.box[J]=!0;const te=4*J,re=this.boxKeys[J];if(e<=G[te+2]&&i<=G[te+3]&&u>=G[te+0]&&p>=G[te+1]&&(!k||k(re))&&(!R||!dn(j,re.overlapMode))&&(x.push({key:re,x1:G[te],y1:G[te+1],x2:G[te+2],y2:G[te+3]}),R))return!0}}const O=this.circleCells[g];if(O!==null){const G=this.circles;for(const J of O)if(!z.circle[J]){z.circle[J]=!0;const te=3*J,re=this.circleKeys[J];if(this._circleAndRectCollide(G[te],G[te+1],G[te+2],e,i,u,p)&&(!k||k(re))&&(!R||!dn(j,re.overlapMode))){const ne=G[te],ce=G[te+1],ie=G[te+2];if(x.push({key:re,x1:ne-ie,y1:ce-ie,x2:ne+ie,y2:ce+ie}),R)return!0}}}return!1}_queryCellCircle(e,i,u,p,g,x,M,k){const{circle:z,seenUids:R,overlapMode:j}=M,B=this.boxCells[g];if(B!==null){const G=this.bboxes;for(const J of B)if(!R.box[J]){R.box[J]=!0;const te=4*J,re=this.boxKeys[J];if(this._circleAndRectCollide(z.x,z.y,z.radius,G[te+0],G[te+1],G[te+2],G[te+3])&&(!k||k(re))&&!dn(j,re.overlapMode))return x.push(!0),!0}}const O=this.circleCells[g];if(O!==null){const G=this.circles;for(const J of O)if(!R.circle[J]){R.circle[J]=!0;const te=3*J,re=this.circleKeys[J];if(this._circlesCollide(G[te],G[te+1],G[te+2],z.x,z.y,z.radius)&&(!k||k(re))&&!dn(j,re.overlapMode))return x.push(!0),!0}}}_forEachCell(e,i,u,p,g,x,M,k){const z=this._convertToXCellCoord(e),R=this._convertToYCellCoord(i),j=this._convertToXCellCoord(u),B=this._convertToYCellCoord(p);for(let O=z;O<=j;O++)for(let G=R;G<=B;G++)if(g.call(this,e,i,u,p,this.xCellCount*G+O,x,M,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,u,p,g,x){const M=p-e,k=g-i,z=u+x;return z*z>M*M+k*k}_circleAndRectCollide(e,i,u,p,g,x,M){const k=(x-p)/2,z=Math.abs(e-(p+k));if(z>k+u)return!1;const R=(M-g)/2,j=Math.abs(i-(g+R));if(j>R+u)return!1;if(z<=k||j<=R)return!0;const B=z-k,O=j-R;return B*B+O*O<=u*u}}function en(m,e,i){const u=s.L();if(!m){const{vecSouth:j,vecEast:B}=lr(e),O=V();O[0]=B[0],O[1]=B[1],O[2]=j[0],O[3]=j[1],p=O,(R=(x=(g=O)[0])*(z=g[3])-(k=g[2])*(M=g[1]))&&(p[0]=z*(R=1/R),p[1]=-M*R,p[2]=-k*R,p[3]=x*R),u[0]=O[0],u[1]=O[1],u[4]=O[2],u[5]=O[3]}var p,g,x,M,k,z,R;return s.N(u,u,[1/i,1/i,1]),u}function nr(m,e,i,u){if(m){const p=s.L();if(!e){const{vecSouth:g,vecEast:x}=lr(i);p[0]=x[0],p[1]=x[1],p[4]=g[0],p[5]=g[1]}return s.N(p,p,[u,u,1]),p}return i.pixelsToClipSpaceMatrix}function lr(m){const e=Math.cos(m.rollInRadians),i=Math.sin(m.rollInRadians),u=Math.cos(m.pitchInRadians),p=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),x=s.ar();x[0]=-p*u*i-g*e,x[1]=-g*u*i+p*e;const M=s.as(x);M<1e-9?s.at(x):s.au(x,x,1/M);const k=s.ar();k[0]=p*u*e-g*i,k[1]=g*u*e+p*i;const z=s.as(k);return z<1e-9?s.at(k):s.au(k,k,1/z),{vecEast:k,vecSouth:x}}function wn(m,e,i,u){let p;u?(p=[m,e,u(m,e),1],s.aw(p,p,i)):(p=[m,e,0,1],al(p,p,i));const g=p[3];return{point:new s.P(p[0]/g,p[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Qe(m,e){return .5+m/e*.5}function Mn(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Kr(m,e,i,u,p,g,x,M,k,z,R,j,B){const O=i?m.textSizeData:m.iconSizeData,G=s.an(O,e.transform.zoom),J=[256/e.width*2+1,256/e.height*2+1],te=i?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;te.clear();const re=m.lineVertexArray,ne=i?m.text.placedSymbolArray:m.icon.placedSymbolArray,ce=e.transform.width/e.transform.height;let ie=!1;for(let de=0;de<ne.length;de++){const me=ne.get(de);if(me.hidden||me.writingMode===s.ao.vertical&&!ie){Oa(me.numGlyphs,te);continue}ie=!1;const se=new s.P(me.anchorX,me.anchorY),_e={getElevation:B,pitchedLabelPlaneMatrix:u,lineVertexArray:re,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:se,unwrappedTileID:k,width:z,height:R,translation:j},Ee=Wo(me.anchorX,me.anchorY,_e);if(!Mn(Ee.point,J)){Oa(me.numGlyphs,te);continue}const Me=Qe(e.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),ke=s.ap(O,G,me),De=g?ke*e.transform.getPitchedTextCorrection(me.anchorX,me.anchorY,k)/Me:ke*Me,tt=ft({projectionContext:_e,pitchedLabelPlaneMatrixInverse:p,symbol:me,fontSize:De,flip:!1,keepUpright:x,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:te,aspectRatio:ce,rotateToLine:M});ie=tt.useVertical,(tt.notEnoughRoom||ie||tt.needsFlipping&&ft({projectionContext:_e,pitchedLabelPlaneMatrixInverse:p,symbol:me,fontSize:De,flip:!0,keepUpright:x,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:te,aspectRatio:ce,rotateToLine:M}).notEnoughRoom)&&Oa(me.numGlyphs,te)}i?m.text.dynamicLayoutVertexBuffer.updateData(te):m.icon.dynamicLayoutVertexBuffer.updateData(te)}function ja(m,e,i,u,p,g,x,M){const k=g.glyphStartIndex+g.numGlyphs,z=g.lineStartIndex,R=g.lineStartIndex+g.lineLength,j=e.getoffsetX(g.glyphStartIndex),B=e.getoffsetX(k-1),O=co(m*j,i,u,p,g.segment,z,R,M,x);if(!O)return null;const G=co(m*B,i,u,p,g.segment,z,R,M,x);return G?M.projectionCache.anyProjectionOccluded?null:{first:O,last:G}:null}function il(m,e,i,u){return m===s.ao.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*u?{useVertical:!0}:(m===s.ao.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function ft(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:u,fontSize:p,flip:g,keepUpright:x,glyphOffsetArray:M,dynamicLayoutVertexArray:k,aspectRatio:z,rotateToLine:R}=m,j=p/24,B=u.lineOffsetX*j,O=u.lineOffsetY*j;let G;if(u.numGlyphs>1){const J=u.glyphStartIndex+u.numGlyphs,te=u.lineStartIndex,re=u.lineStartIndex+u.lineLength,ne=ja(j,M,B,O,g,u,R,e);if(!ne)return{notEnoughRoom:!0};const ce=Ho(ne.first.point.x,ne.first.point.y,e,i),ie=Ho(ne.last.point.x,ne.last.point.y,e,i);if(x&&!g){const de=il(u.writingMode,ce,ie,z);if(de)return de}G=[ne.first];for(let de=u.glyphStartIndex+1;de<J-1;de++){const me=co(j*M.getoffsetX(de),B,O,g,u.segment,te,re,e,R);if(!me)return{notEnoughRoom:!0};G.push(me)}G.push(ne.last)}else{if(x&&!g){const te=jn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,re=u.lineStartIndex+u.segment+1,ne=new s.P(e.lineVertexArray.getx(re),e.lineVertexArray.gety(re)),ce=jn(ne.x,ne.y,e),ie=ce.signedDistanceFromCamera>0?ce.point:ur(e.tileAnchorPoint,ne,te,1,e),de=Ho(te.x,te.y,e,i),me=Ho(ie.x,ie.y,e,i),se=il(u.writingMode,de,me,z);if(se)return se}const J=co(j*M.getoffsetX(u.glyphStartIndex),B,O,g,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,R);if(!J||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[J]}for(const J of G)s.av(k,J.point,J.angle);return{}}function ur(m,e,i,u,p){const g=m.add(m.sub(e)._unit()),x=jn(g.x,g.y,p).point,M=i.sub(x);return i.add(M._mult(u/M.mag()))}function Gt(m,e,i){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const p=new s.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=jn(p.x,p.y,e);if(g.signedDistanceFromCamera>0)return u.projections[m]=g.point,u.anyProjectionOccluded=u.anyProjectionOccluded||g.isOccluded,g.point;const x=m-i.direction;return ur(i.distanceFromAnchor===0?e.tileAnchorPoint:new s.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),p,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function jn(m,e,i){const u=m+i.translation[0],p=e+i.translation[1];let g;return i.pitchWithMap?(g=wn(u,p,i.pitchedLabelPlaneMatrix,i.getElevation),g.isOccluded=!1):(g=i.transform.projectTileCoordinates(u,p,i.unwrappedTileID,i.getElevation),g.point.x=(.5*g.point.x+.5)*i.width,g.point.y=(.5*-g.point.y+.5)*i.height),g}function Ho(m,e,i,u){if(i.pitchWithMap){const p=[m,e,0,1];return s.aw(p,p,u),i.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],i.unwrappedTileID,i.getElevation).point}return{x:m/i.width*2-1,y:1-e/i.height*2}}function Wo(m,e,i){return i.transform.projectTileCoordinates(m,e,i.unwrappedTileID,i.getElevation)}function Yt(m,e,i){return m._unit()._perp()._mult(e*i)}function Hl(m,e,i,u,p,g,x,M,k){if(M.projectionCache.offsets[m])return M.projectionCache.offsets[m];const z=i.add(e);if(m+k.direction<u||m+k.direction>=p)return M.projectionCache.offsets[m]=z,z;const R=Gt(m+k.direction,M,k),j=Yt(R.sub(i),x,k.direction),B=i.add(j),O=R.add(j);return M.projectionCache.offsets[m]=s.ax(g,z,B,O)||z,M.projectionCache.offsets[m]}function co(m,e,i,u,p,g,x,M,k){const z=u?m-e:m+e;let R=z>0?1:-1,j=0;u&&(R*=-1,j=Math.PI),R<0&&(j+=Math.PI);let B,O=R>0?g+p:g+p+1;M.projectionCache.cachedAnchorPoint?B=M.projectionCache.cachedAnchorPoint:(B=jn(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=B);let G,J,te=B,re=B,ne=0,ce=0;const ie=Math.abs(z),de=[];let me;for(;ne+ce<=ie;){if(O+=R,O<g||O>=x)return null;ne+=ce,re=te,J=G;const Ee={absOffsetX:ie,direction:R,distanceFromAnchor:ne,previousVertex:re};if(te=Gt(O,M,Ee),i===0)de.push(re),me=te.sub(re);else{let Me;const ke=te.sub(re);Me=ke.mag()===0?Yt(Gt(O+R,M,Ee).sub(te),i,R):Yt(ke,i,R),J||(J=re.add(Me)),G=Hl(O,Me,te,g,x,J,i,M,Ee),de.push(J),me=G.sub(J)}ce=me.mag()}const se=me._mult((ie-ne)/ce)._add(J||re),_e=j+Math.atan2(te.y-re.y,te.x-re.x);return de.push(se),{point:se,angle:k?_e:0,path:de}}const Wl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(m,e){for(let i=0;i<m;i++){const u=e.length;e.resize(u+4),e.float32.set(Wl,3*u)}}function al(m,e,i){const u=e[0],p=e[1];return m[0]=i[0]*u+i[4]*p+i[12],m[1]=i[1]*u+i[5]*p+i[13],m[3]=i[3]*u+i[7]*p+i[15],m}const ir=100;class Ou{constructor(e,i=new bn(e.width+200,e.height+200,25),u=new bn(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ir,this.screenBottomBoundary=e.height+ir,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,u,p,g,x,M,k,z,R,j,B){const O=this.projectAndGetPerspectiveRatio(e.anchorPointX+k[0],e.anchorPointY+k[1],g,R,B),G=u*O.perspectiveRatio;let J;if(x||M)J=this._projectCollisionBox(e,G,p,g,x,M,k,O,R,j,B);else{const me=O.x+(j?j.x*G:0),se=O.y+(j?j.y*G:0);J={allPointsOccluded:!1,box:[me+e.x1*G,se+e.y1*G,me+e.x2*G,se+e.y2*G]}}const[te,re,ne,ce]=J.box,ie=x?J.allPointsOccluded:O.isOccluded;let de=ie;return de||(de=O.perspectiveRatio<this.perspectiveRatioCutoff),de||(de=!this.isInsideGrid(te,re,ne,ce)),de||i!=="always"&&this.grid.hitTest(te,re,ne,ce,i,z)?{box:[te,re,ne,ce],placeable:!1,offscreen:!1,occluded:ie}:{box:[te,re,ne,ce],placeable:!0,offscreen:this.isOffscreen(te,re,ne,ce),occluded:ie}}placeCollisionCircles(e,i,u,p,g,x,M,k,z,R,j,B,O,G){const J=[],te=new s.P(i.anchorX,i.anchorY),re=this.getPerspectiveRatio(te.x,te.y,x,G),ne=(z?g*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,x)/re:g*re)/s.aB,ce={getElevation:G,pitchedLabelPlaneMatrix:M,lineVertexArray:u,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:te,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:O},ie=ja(ne,p,i.lineOffsetX*ne,i.lineOffsetY*ne,!1,i,!1,ce);let de=!1,me=!1,se=!0;if(ie){const _e=.5*j*re+B,Ee=new s.P(-100,-100),Me=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ke=new Gr,De=ie.first,tt=ie.last;let it=[];for(let Jt=De.path.length-1;Jt>=1;Jt--)it.push(De.path[Jt]);for(let Jt=1;Jt<tt.path.length;Jt++)it.push(tt.path[Jt]);const We=2.5*_e;if(z){const Jt=this.projectPathToScreenSpace(it,ce);it=Jt.some((Sr=>Sr.signedDistanceFromCamera<=0))?[]:Jt.map((Sr=>Sr.point))}let St=[];if(it.length>0){const Jt=it[0].clone(),Sr=it[0].clone();for(let Br=1;Br<it.length;Br++)Jt.x=Math.min(Jt.x,it[Br].x),Jt.y=Math.min(Jt.y,it[Br].y),Sr.x=Math.max(Sr.x,it[Br].x),Sr.y=Math.max(Sr.y,it[Br].y);St=Jt.x>=Ee.x&&Sr.x<=Me.x&&Jt.y>=Ee.y&&Sr.y<=Me.y?[it]:Sr.x<Ee.x||Jt.x>Me.x||Sr.y<Ee.y||Jt.y>Me.y?[]:s.ay([it],Ee.x,Ee.y,Me.x,Me.y)}for(const Jt of St){ke.reset(Jt,.25*_e);let Sr=0;Sr=ke.length<=.5*_e?1:Math.ceil(ke.paddedLength/We)+1;for(let Br=0;Br<Sr;Br++){const zr=Br/Math.max(Sr-1,1),Hr=ke.lerp(zr),rn=Hr.x+ir,Zt=Hr.y+ir;J.push(rn,Zt,_e,0);const Er=rn-_e,gn=Zt-_e,yn=rn+_e,zn=Zt+_e;if(se=se&&this.isOffscreen(Er,gn,yn,zn),me=me||this.isInsideGrid(Er,gn,yn,zn),e!=="always"&&this.grid.hitTestCircle(rn,Zt,_e,e,R)&&(de=!0,!k))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!k&&de||!me||re<this.perspectiveRatioCutoff?[]:J,offscreen:se,collisionDetected:de}}projectPathToScreenSpace(e,i){const u=(function(p,g){const x=s.L();return s.aq(x,g.pitchedLabelPlaneMatrix),p.map((M=>{const k=wn(M.x,M.y,x,g.getElevation),z=g.transform.projectTileCoordinates(k.point.x,k.point.y,g.unwrappedTileID,g.getElevation);return z.point.x=(.5*z.point.x+.5)*g.width,z.point.y=(.5*-z.point.y+.5)*g.height,z}))})(e,i);return(function(p){let g=0,x=0,M=0,k=0;for(let z=0;z<p.length;z++)p[z].isOccluded?(M=z+1,k=0):(k++,k>x&&(x=k,g=M));return p.slice(g,g+x)})(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[],u=new s.a2;for(const j of e){const B=new s.P(j.x+ir,j.y+ir);u.extend(B),i.push(B)}const{minX:p,minY:g,maxX:x,maxY:M}=u,k=this.grid.query(p,g,x,M).concat(this.ignoredGrid.query(p,g,x,M)),z={},R={};for(const j of k){const B=j.key;if(z[B.bucketInstanceId]===void 0&&(z[B.bucketInstanceId]={}),z[B.bucketInstanceId][B.featureIndex])continue;const O=[new s.P(j.x1,j.y1),new s.P(j.x2,j.y1),new s.P(j.x2,j.y2),new s.P(j.x1,j.y2)];s.az(i,O)&&(z[B.bucketInstanceId][B.featureIndex]=!0,R[B.bucketInstanceId]===void 0&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(e,i,u,p,g,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,u,p,g,x){const M=u?this.ignoredGrid:this.grid,k={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:i};for(let z=0;z<e.length;z+=4)M.insertCircle(k,e[z],e[z+1],e[z+2])}projectAndGetPerspectiveRatio(e,i,u,p,g){if(g){let x;p?(x=[e,i,p(e,i),1],s.aw(x,x,g)):(x=[e,i,0,1],al(x,x,g));const M=x[3];return{x:(x[0]/M+1)/2*this.transform.width+ir,y:(-x[1]/M+1)/2*this.transform.height+ir,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{const x=this.transform.projectTileCoordinates(e,i,u,p);return{x:(x.point.x+1)/2*this.transform.width+ir,y:(1-x.point.y)/2*this.transform.height+ir,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,u,p){const g=this.transform.projectTileCoordinates(e,i,u,p);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,i,u,p){return u<ir||e>=this.screenRightBoundary||p<ir||i>this.screenBottomBoundary}isInsideGrid(e,i,u,p){return u>=0&&e<this.gridRightBoundary&&p>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=s.ag([]);return s.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,u,p,g,x,M,k,z,R,j){let B=1,O=0,G=0,J=1;const te=e.anchorPointX+M[0],re=e.anchorPointY+M[1];if(x&&!g){const it=this.projectAndGetPerspectiveRatio(te+1,re,p,z,j),We=it.x-k.x,St=Math.atan((it.y-k.y)/We)+(We<0?Math.PI:0),Jt=Math.sin(St),Sr=Math.cos(St);B=Sr,O=Jt,G=-Jt,J=Sr}else if(!x&&g){const it=lr(this.transform);B=it.vecEast[0],O=it.vecEast[1],G=it.vecSouth[0],J=it.vecSouth[1]}let ne=k.x,ce=k.y,ie=i;g&&(ne=te,ce=re,ie=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),ie*=this.transform.getPitchedTextCorrection(te,re,p),R||(ie*=s.ah(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(ne+=B*R.x*ie+G*R.y*ie,ce+=O*R.x*ie+J*R.y*ie);const de=e.x1*ie,me=e.x2*ie,se=(de+me)/2,_e=e.y1*ie,Ee=e.y2*ie,Me=(_e+Ee)/2,ke=[{offsetX:de,offsetY:_e},{offsetX:se,offsetY:_e},{offsetX:me,offsetY:_e},{offsetX:me,offsetY:Me},{offsetX:me,offsetY:Ee},{offsetX:se,offsetY:Ee},{offsetX:de,offsetY:Ee},{offsetX:de,offsetY:Me}];let De=[];for(const{offsetX:it,offsetY:We}of ke)De.push(new s.P(ne+B*it+G*We,ce+O*it+J*We));let tt=!1;if(g){const it=De.map((We=>this.projectAndGetPerspectiveRatio(We.x,We.y,p,z,j)));tt=it.some((We=>!We.isOccluded)),De=it.map((We=>new s.P(We.x,We.y)))}else tt=!0;return{box:s.aA(De),allPointsOccluded:!tt}}}class ei{constructor(e,i,u,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Vr{constructor(e,i,u,p,g){this.text=new ei(e?e.text:null,i,u,g),this.icon=new ei(e?e.icon:null,i,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xl{constructor(e,i,u){this.text=e,this.icon=i,this.skipFade=u}}class Kl{constructor(e,i,u,p,g){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class Uu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:u=>u.collisionGroupID===i}}return this.collisionGroups[e]}}function ma(m,e,i,u,p){const{horizontalAlign:g,verticalAlign:x}=s.aH(m);return new s.P(-(g-.5)*e+u[0]*p,-(x-.5)*i+u[1]*p)}class Gn{constructor(e,i,u,p,g){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new Ou(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Uu(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(u,p)=>i.getElevation(e,u,p):null}getBucketParts(e,i,u,p){const g=u.getBucket(i),x=u.latestFeatureIndex;if(!g||!x||i.id!==g.layerIds[0])return;const M=u.collisionBoxArray,k=g.layers[0].layout,z=g.layers[0].paint,R=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),j=u.tileSize/s.$,B=u.tileID.toUnwrapped(),O=k.get("text-rotation-alignment")==="map",G=s.aC(u,1,this.transform.zoom),J=s.aD(this.collisionIndex.transform,u,z.get("text-translate"),z.get("text-translate-anchor")),te=s.aD(this.collisionIndex.transform,u,z.get("icon-translate"),z.get("icon-translate-anchor")),re=en(O,this.transform,G);this.retainedQueryData[g.bucketInstanceId]=new Kl(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,u.tileID);const ne={bucket:g,layout:k,translationText:J,translationIcon:te,unwrappedTileID:B,pitchedLabelPlaneMatrix:re,scale:R,textPixelRatio:j,holdingForFade:u.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const ce of g.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:de,symbolInstanceEnd:me}=ce;e.push({sortKey:ie,symbolInstanceStart:de,symbolInstanceEnd:me,parameters:ne})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ne})}attemptAnchorPlacement(e,i,u,p,g,x,M,k,z,R,j,B,O,G,J,te,re,ne,ce,ie){const de=s.aE[e.textAnchor],me=[e.textOffset0,e.textOffset1],se=ma(de,u,p,me,g),_e=this.collisionIndex.placeCollisionBox(i,B,k,z,R,M,x,te,j.predicate,ce,se,ie);if((!ne||this.collisionIndex.placeCollisionBox(ne,B,k,z,R,M,x,re,j.predicate,ce,se,ie).placeable)&&_e.placeable){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:me,width:u,height:p,anchor:de,textBoxScale:g,prevAnchor:Ee},this.markUsedJustification(G,de,O,J),G.allowVerticalPlacement&&(this.markUsedOrientation(G,J,O),this.placedOrientations[O.crossTileID]=J),{shift:se,placedGlyphBoxes:_e}}}placeLayerBucketPart(e,i,u){const{bucket:p,layout:g,translationText:x,translationIcon:M,unwrappedTileID:k,pitchedLabelPlaneMatrix:z,textPixelRatio:R,holdingForFade:j,collisionBoxArray:B,partiallyEvaluatedTextSize:O,collisionGroup:G}=e.parameters,J=g.get("text-optional"),te=g.get("icon-optional"),re=s.aF(g,"text-overlap","text-allow-overlap"),ne=re==="always",ce=s.aF(g,"icon-overlap","icon-allow-overlap"),ie=ce==="always",de=g.get("text-rotation-alignment")==="map",me=g.get("text-pitch-alignment")==="map",se=g.get("icon-text-fit")!=="none",_e=g.get("symbol-z-order")==="viewport-y",Ee=ne&&(ie||!p.hasIconData()||te),Me=ie&&(ne||!p.hasTextData()||J);!p.collisionArrays&&B&&p.deserializeCollisionBoxes(B);const ke=this.retainedQueryData[p.bucketInstanceId].tileID,De=this._getTerrainElevationFunc(ke),tt=this.transform.getFastPathSimpleProjectionMatrix(ke),it=(We,St,Jt)=>{var Sr,Br;if(i[We.crossTileID])return;if(j)return void(this.placements[We.crossTileID]=new Xl(!1,!1,!1));let zr=!1,Hr=!1,rn=!0,Zt=null,Er={box:null,placeable:!1,offscreen:null,occluded:!1},gn={placeable:!1},yn=null,zn=null,ii=null,la=0,Eo=0,Qa=0;St.textFeatureIndex?la=St.textFeatureIndex:We.useRuntimeCollisionCircles&&(la=We.featureIndex),St.verticalTextFeatureIndex&&(Eo=St.verticalTextFeatureIndex);const js=St.textBox;if(js){const gi=_n=>{let Sn=s.ao.horizontal;if(p.allowVerticalPlacement&&!_n&&this.prevPlacement){const _i=this.prevPlacement.placedOrientations[We.crossTileID];_i&&(this.placedOrientations[We.crossTileID]=_i,Sn=_i,this.markUsedOrientation(p,Sn,We))}return Sn},Pa=(_n,Sn)=>{if(p.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&St.verticalTextBox){for(const _i of p.writingModes)if(_i===s.ao.vertical?(Er=Sn(),gn=Er):Er=_n(),Er&&Er.placeable)break}else Er=_n()},yi=We.textAnchorOffsetStartIndex,Io=We.textAnchorOffsetEndIndex;if(Io===yi){const _n=(Sn,_i)=>{const Tn=this.collisionIndex.placeCollisionBox(Sn,re,R,ke,k,me,de,x,G.predicate,De,void 0,tt);return Tn&&Tn.placeable&&(this.markUsedOrientation(p,_i,We),this.placedOrientations[We.crossTileID]=_i),Tn};Pa((()=>_n(js,s.ao.horizontal)),(()=>{const Sn=St.verticalTextBox;return p.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&Sn?_n(Sn,s.ao.vertical):{box:null,offscreen:null}})),gi(Er&&Er.placeable)}else{let _n=s.aE[(Br=(Sr=this.prevPlacement)===null||Sr===void 0?void 0:Sr.variableOffsets[We.crossTileID])===null||Br===void 0?void 0:Br.anchor];const Sn=(Tn,Tu,Dl)=>{const Ln=Tn.x2-Tn.x1,Hi=Tn.y2-Tn.y1,Ma=We.textBoxScale,uh=se&&ce==="never"?Tu:null;let Li=null,ch=re==="never"?1:2,Cu="never";_n&&ch++;for(let Ao=0;Ao<ch;Ao++){for(let Nl=yi;Nl<Io;Nl++){const eo=p.textAnchorOffsets.get(Nl);if(_n&&eo.textAnchor!==_n)continue;const zo=this.attemptAnchorPlacement(eo,Tn,Ln,Hi,Ma,de,me,R,ke,k,G,Cu,We,p,Dl,x,M,uh,De);if(zo&&(Li=zo.placedGlyphBoxes,Li&&Li.placeable))return zr=!0,Zt=zo.shift,Li}_n?_n=null:Cu=re}return u&&!Li&&(Li={box:this.collisionIndex.placeCollisionBox(js,"always",R,ke,k,me,de,x,G.predicate,De,void 0,tt).box,offscreen:!1,placeable:!1,occluded:!1}),Li};Pa((()=>Sn(js,St.iconBox,s.ao.horizontal)),(()=>{const Tn=St.verticalTextBox;return p.allowVerticalPlacement&&(!Er||!Er.placeable)&&We.numVerticalGlyphVertices>0&&Tn?Sn(Tn,St.verticalIconBox,s.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Er&&(zr=Er.placeable,rn=Er.offscreen);const _i=gi(Er&&Er.placeable);if(!zr&&this.prevPlacement){const Tn=this.prevPlacement.variableOffsets[We.crossTileID];Tn&&(this.variableOffsets[We.crossTileID]=Tn,this.markUsedJustification(p,Tn.anchor,We,_i))}}}if(yn=Er,zr=yn&&yn.placeable,rn=yn&&yn.offscreen,We.useRuntimeCollisionCircles){const gi=p.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex),Pa=s.ap(p.textSizeData,O,gi),yi=g.get("text-padding");zn=this.collisionIndex.placeCollisionCircles(re,gi,p.lineVertexArray,p.glyphOffsetArray,Pa,k,z,u,me,G.predicate,We.collisionCircleDiameter,yi,x,De),zn.circles.length&&zn.collisionDetected&&!u&&s.w("Collisions detected, but collision boxes are not shown"),zr=ne||zn.circles.length>0&&!zn.collisionDetected,rn=rn&&zn.offscreen}if(St.iconFeatureIndex&&(Qa=St.iconFeatureIndex),St.iconBox){const gi=Pa=>this.collisionIndex.placeCollisionBox(Pa,ce,R,ke,k,me,de,M,G.predicate,De,se&&Zt?Zt:void 0,tt);gn&&gn.placeable&&St.verticalIconBox?(ii=gi(St.verticalIconBox),Hr=ii.placeable):(ii=gi(St.iconBox),Hr=ii.placeable),rn=rn&&ii.offscreen}const Os=J||We.numHorizontalGlyphVertices===0&&We.numVerticalGlyphVertices===0,ds=te||We.numIconVertices===0;Os||ds?ds?Os||(Hr=Hr&&zr):zr=Hr&&zr:Hr=zr=Hr&&zr;const Us=Hr&&ii.placeable;if(zr&&yn.placeable&&this.collisionIndex.insertCollisionBox(yn.box,re,g.get("text-ignore-placement"),p.bucketInstanceId,gn&&gn.placeable&&Eo?Eo:la,G.ID),Us&&this.collisionIndex.insertCollisionBox(ii.box,ce,g.get("icon-ignore-placement"),p.bucketInstanceId,Qa,G.ID),zn&&zr&&this.collisionIndex.insertCollisionCircles(zn.circles,re,g.get("text-ignore-placement"),p.bucketInstanceId,la,G.ID),u&&this.storeCollisionData(p.bucketInstanceId,Jt,St,yn,ii,zn),We.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[We.crossTileID]=new Xl((zr||Ee)&&!yn?.occluded,(Hr||Me)&&!ii?.occluded,rn||p.justReloaded),i[We.crossTileID]=!0};if(_e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const We=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let St=We.length-1;St>=0;--St){const Jt=We[St];it(p.symbolInstances.get(Jt),p.collisionArrays[Jt],Jt)}}else for(let We=e.symbolInstanceStart;We<e.symbolInstanceEnd;We++)it(p.symbolInstances.get(We),p.collisionArrays[We],We);p.justReloaded=!1}storeCollisionData(e,i,u,p,g,x){if(u.textBox||u.iconBox){let M,k;this.collisionBoxArrays.has(e)?M=this.collisionBoxArrays.get(e):(M=new Map,this.collisionBoxArrays.set(e,M)),M.has(i)?k=M.get(i):(k={text:null,icon:null},M.set(i,k)),u.textBox&&(k.text=p.box),u.iconBox&&(k.icon=g.box)}if(x){let M=this.collisionCircleArrays[e];M===void 0&&(M=this.collisionCircleArrays[e]=[]);for(let k=0;k<x.circles.length;k+=4)M.push(x.circles[k+0]-ir),M.push(x.circles[k+1]-ir),M.push(x.circles[k+2]),M.push(x.collisionDetected?1:0)}}markUsedJustification(e,i,u,p){let g;g=p===s.ao.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[s.aG(i)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const M of x)M>=0&&(e.text.placedSymbolArray.get(M).crossTileID=g>=0&&M!==g?0:u.crossTileID)}markUsedOrientation(e,i,u){const p=i===s.ao.horizontal||i===s.ao.horizontalOnly?i:0,g=i===s.ao.vertical?i:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const M of x)e.text.placedSymbolArray.get(M).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let u=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const p=i?i.symbolFadeChange(e):1,g=i?i.opacities:{},x=i?i.variableOffsets:{},M=i?i.placedOrientations:{};for(const k in this.placements){const z=this.placements[k],R=g[k];R?(this.opacities[k]=new Vr(R,p,z.text,z.icon),u=u||z.text!==R.text.placed||z.icon!==R.icon.placed):(this.opacities[k]=new Vr(null,p,z.text,z.icon,z.skipFade),u=u||z.text||z.icon)}for(const k in g){const z=g[k];if(!this.opacities[k]){const R=new Vr(z,p,!1,!1);R.isHidden()||(this.opacities[k]=R,u=u||z.text.placed||z.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in M)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=M[k]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const u={};for(const p of i){const g=p.getBucket(e);g&&p.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,p.tileID,u,p.collisionBoxArray)}}updateBucketOpacities(e,i,u,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],x=g.layout,M=new Vr(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),R=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=x.get("text-rotation-alignment")==="map",B=x.get("text-pitch-alignment")==="map",O=x.get("icon-text-fit")!=="none",G=new Vr(null,0,k&&(z||!e.hasIconData()||x.get("icon-optional")),z&&(k||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const J=(re,ne,ce)=>{for(let ie=0;ie<ne/4;ie++)re.opacityVertexArray.emplaceBack(ce);re.hasVisibleVertices=re.hasVisibleVertices||ce!==ll},te=this.collisionBoxArrays.get(e.bucketInstanceId);for(let re=0;re<e.symbolInstances.length;re++){const ne=e.symbolInstances.get(re),{numHorizontalGlyphVertices:ce,numVerticalGlyphVertices:ie,crossTileID:de}=ne;let me=this.opacities[de];u[de]?me=M:me||(me=G,this.opacities[de]=me),u[de]=!0;const se=ne.numIconVertices>0,_e=this.placedOrientations[ne.crossTileID],Ee=_e===s.ao.vertical,Me=_e===s.ao.horizontal||_e===s.ao.horizontalOnly;if(ce>0||ie>0){const De=sl(me.text);J(e.text,ce,Ee?ll:De),J(e.text,ie,Me?ll:De);const tt=me.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach((St=>{St>=0&&(e.text.placedSymbolArray.get(St).hidden=tt||Ee?1:0)})),ne.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=tt||Me?1:0);const it=this.variableOffsets[ne.crossTileID];it&&this.markUsedJustification(e,it.anchor,ne,_e);const We=this.placedOrientations[ne.crossTileID];We&&(this.markUsedJustification(e,"left",ne,We),this.markUsedOrientation(e,We,ne))}if(se){const De=sl(me.icon),tt=!(O&&ne.verticalPlacedIconSymbolIndex&&Ee);ne.placedIconSymbolIndex>=0&&(J(e.icon,ne.numIconVertices,tt?De:ll),e.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=me.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(J(e.icon,ne.numVerticalIconVertices,tt?ll:De),e.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}const ke=te&&te.has(re)?te.get(re):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const De=e.collisionArrays[re];if(De){let tt=new s.P(0,0);if(De.textBox||De.verticalTextBox){let it=!0;if(R){const We=this.variableOffsets[de];We?(tt=ma(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale),j&&tt._rotate(B?-this.transform.bearingInRadians:this.transform.bearingInRadians)):it=!1}if(De.textBox||De.verticalTextBox){let We;De.textBox&&(We=Ee),De.verticalTextBox&&(We=Me),Ic(e.textCollisionBox.collisionVertexArray,me.text.placed,!it||We,ke.text,tt.x,tt.y)}}if(De.iconBox||De.verticalIconBox){const it=!!(!Me&&De.verticalIconBox);let We;De.iconBox&&(We=it),De.verticalIconBox&&(We=!it),Ic(e.iconCollisionBox.collisionVertexArray,me.icon.placed,We,ke.icon,O?tt.x:0,O?tt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const u=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Ic(m,e,i,u,p,g){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-ir,M=u[1]-ir,k=u[2]-ir,z=u[3]-ir;m.emplaceBack(e?1:0,i?1:0,p||0,g||0,x,M),m.emplaceBack(e?1:0,i?1:0,p||0,g||0,k,M),m.emplaceBack(e?1:0,i?1:0,p||0,g||0,k,z),m.emplaceBack(e?1:0,i?1:0,p||0,g||0,x,z)}const ra=Math.pow(2,25),Qh=Math.pow(2,24),ol=Math.pow(2,17),ep=Math.pow(2,16),Vu=Math.pow(2,9),$u=Math.pow(2,8),Yl=Math.pow(2,1);function sl(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,i=Math.floor(127*m.opacity);return i*ra+e*Qh+i*ol+e*ep+i*Vu+e*$u+i*Yl+e}const ll=0;class Ac{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,u,p,g){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(x,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((M,k)=>M.sortKey-k.sortKey)));this._currentPartIndex<x.length;)if(i.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class Jl{constructor(e,i,u,p,g,x,M,k){this.placement=new Gn(e,i,x,M,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,i,u){const p=le.now(),g=()=>!this._forceFullPlacement&&le.now()-p>2;for(;this._currentPlacementIndex>=0;){const x=i[e[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=M)&&(!x.maxzoom||x.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Ac(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ss=512/s.$/2;class Ql{constructor(e,i,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let g=0;g<i.length;g++){const x=i.get(g),M=x.key,k=p.get(M);k?k.push(x):p.set(M,[x])}for(const[g,x]of p){const M={positions:x.map((k=>({x:Math.floor(k.anchorX*Ss),y:Math.floor(k.anchorY*Ss)}))),crossTileIDs:x.map((k=>k.crossTileID))};if(M.positions.length>128){const k=new s.aI(M.positions.length,16,Uint16Array);for(const{x:z,y:R}of M.positions)k.add(z,R);k.finish(),delete M.positions,M.index=k}this._symbolsByKey[g]=M}}getScaledCoordinates(e,i){const{x:u,y:p,z:g}=this.tileID.canonical,{x,y:M,z:k}=i.canonical,z=Ss/Math.pow(2,k-g),R=(M*s.$+e.anchorY)*z,j=p*s.$*Ss;return{x:Math.floor((x*s.$+e.anchorX)*z-u*s.$*Ss),y:Math.floor(R-j)}}findMatches(e,i,u){const p=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let g=0;g<e.length;g++){const x=e.get(g);if(x.crossTileID)continue;const M=this._symbolsByKey[x.key];if(!M)continue;const k=this.getScaledCoordinates(x,i);if(M.index){const z=M.index.range(k.x-p,k.y-p,k.x+p,k.y+p).sort();for(const R of z){const j=M.crossTileIDs[R];if(!u[j]){u[j]=!0,x.crossTileID=j;break}}}else if(M.positions)for(let z=0;z<M.positions.length;z++){const R=M.positions[z],j=M.crossTileIDs[z];if(Math.abs(R.x-k.x)<=p&&Math.abs(R.y-k.y)<=p&&!u[j]){u[j]=!0,x.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const x in p){const M=p[x];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+i),g[M.tileID.key]=M}this.indexes[u]=g}this.lng=e}addBucket(e,i,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<i.symbolInstances.length;g++)i.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>e.overscaledZ)for(const M in x){const k=x[M];k.tileID.isChildOf(e)&&k.findMatches(i.symbolInstances,e,p)}else{const M=x[e.scaledTo(Number(g)).key];M&&M.findMatches(i.symbolInstances,e,p)}}for(let g=0;g<i.symbolInstances.length;g++){const x=i.symbolInstances.get(g);x.crossTileID||(x.crossTileID=u.generate(),p[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ql(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const u of i.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let i=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)e[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],i=!0)}return i}}class Xo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,u){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new qp);let g=!1;const x={};p.handleWrapJump(u);for(const M of i){const k=M.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(M.tileID,k,this.crossTileIDs)&&(g=!0),x[k.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(e){const i={};e.forEach((u=>{i[u]=!0}));for(const u in this.layerIndexes)i[u]||delete this.layerIndexes[u]}}var Pr="void main() {fragColor=vec4(1.0);}";const na={prelude:ar(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ar("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ar("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ar(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ar(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ar(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ar(Pr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ar(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ar("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ar("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ar(Pr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ar(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ar(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ar(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ar(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ar(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ar(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ar(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ar(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ar(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ar(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ar("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ar("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ar("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ar("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ar(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ar("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ar(m,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),p=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,M={};return{fragmentSource:m=m.replace(i,((k,z,R,j,B)=>(M[B]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${R} ${j} ${B};
#else
uniform ${R} ${j} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${R} ${j} ${B} = u_${B};
#endif
`))),vertexSource:e=e.replace(i,((k,z,R,j,B)=>{const O=j==="float"?"vec2":"vec4",G=B.match(/color/)?"color":O;return M[B]?z==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${R} ${O} a_${B};
out ${R} ${j} ${B};
#else
uniform ${R} ${j} u_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${R} ${j} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${R} ${j} ${B} = u_${B};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${R} ${O} a_${B};
#else
uniform ${R} ${j} u_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${R} ${j} ${B} = a_${B};
#else
    ${R} ${j} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${R} ${j} ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${R} ${j} ${B} = u_${B};
#endif
`})),staticAttributes:u,staticUniforms:x}}class ho{constructor(e,i,u){this.vertexBuffer=e,this.indexBuffer=i,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var po=s.aJ([{name:"a_pos",type:"Int16",components:2}]);const Ua="#define PROJECTION_MERCATOR",Ko="mercator";class tr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ko}get shaderDefine(){return Ua}get shaderPreludeCode(){return na.projectionMercator}get vertexShaderPreludeCode(){return na.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,u,p,g){if(this._cachedMesh)return this._cachedMesh;const x=new s.aL;x.emplaceBack(0,0),x.emplaceBack(s.$,0),x.emplaceBack(0,s.$),x.emplaceBack(s.$,s.$);const M=e.createVertexBuffer(x,po.members),k=s.aM.simpleSegment(0,0,4,2),z=new s.aN;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const R=e.createIndexBuffer(z);return this._cachedMesh=new ho(M,R,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Va{constructor(e=0,i=0,u=0,p=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=u,this.right=p}interpolate(e,i,u){return i.top!=null&&e.top!=null&&(this.top=s.C.number(e.top,i.top,u)),i.bottom!=null&&e.bottom!=null&&(this.bottom=s.C.number(e.bottom,i.bottom,u)),i.left!=null&&e.left!=null&&(this.left=s.C.number(e.left,i.left,u)),i.right!=null&&e.right!=null&&(this.right=s.C.number(e.right,i.right,u)),this}getCenter(e,i){const u=s.ah((this.left+e-this.right)/2,0,e),p=s.ah((this.top+i-this.bottom)/2,0,i);return new s.P(u,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Va(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ga(m,e){if(!m.renderWorldCopies||m.lngRange)return;const i=e.lng-m.center.lng;e.lng+=i>180?-360:i<-180?360:0}function ya(m){return Math.max(0,Math.floor(m))}class un{constructor(e,i,u,p,g,x){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ya(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Va,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ya(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Va(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=s.aO(e,-180,180)*Math.PI/180;var u,p,g,x,M,k,z,R,j;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=V(),u=this._rotationMatrix,g=-this._bearingInRadians,x=(p=this._rotationMatrix)[0],M=p[1],k=p[2],z=p[3],R=Math.sin(g),j=Math.cos(g),u[0]=x*j+k*R,u[1]=M*j+z*R,u[2]=x*-R+k*j,u[3]=M*-R+z*j)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=s.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aP(this._fovInRadians)}setFov(e){e=s.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=s.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=s.af(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,u){this._unmodified=!1,this._edgeInsets.interpolate(e,i,u),this._constrain(),this._calcMatrices()}resize(e,i,u=!0){this._width=e,this._height=i,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Qr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-s.ai,s.ai])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{const{minX:u,minY:p,maxX:g,maxY:x}=s.a2.fromPoints(i).extend(e);return[new s.P(u,p),new s.P(g,p),new s.P(g,x),new s.P(u,x),new s.P(u,p)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=s.ag(new Float64Array(16));s.N(e,e,[this._width/2,-this._height/2,1]),s.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=s.ag(new Float64Array(16)),s.N(e,e,[1,-1,1]),s.M(e,e,[-1,-1,0]),s.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,u,p){const g=u!==void 0?u:this.bearing,x=p=p!==void 0?p:this.pitch,M=s.a1.fromLngLat(e,i),k=-Math.cos(s.ae(x)),z=Math.sin(s.ae(x)),R=z*Math.sin(s.ae(g)),j=-z*Math.cos(s.ae(g));let B=this.elevation;const O=i-B;let G;k*O>=0||Math.abs(k)<.1?(G=1e4,B=i+G*k):G=-O/k;let J,te,re=s.aQ(1,M.y),ne=0;do{if(ne+=1,ne>10)break;te=G/re,J=new s.a1(M.x+R*te,M.y+j*te),re=1/J.meterInMercatorCoordinateUnits()}while(Math.abs(G-te*re)>1e-12);return{center:J.toLngLat(),elevation:B,zoom:s.ak(this.height/2/Math.tan(this.fovInRadians/2)/te/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=s.aj(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/i,p=s.a1.fromLngLat(this.center,this.elevation),g=Ae(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const x=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),s.aQ(g.z,p.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=s.aj(1,this.center.lat)*this.worldSize;return Ae(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/s.$,1/i/s.$]}}class cn{constructor(e,i){this.min=e,this.max=i,this.center=s.aR([],s.aS([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],u=s.aT(this.min),p=s.aT(this.max);for(let g=0;g<i.length;g++)u[g]=i[g]?this.min[g]:this.center[g],p[g]=i[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new cn(u,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let u=0;u<e.planes.length;u++){const p=this.intersectsPlane(e.planes[u]);if(p===0)return 0;p===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],u=e[3];for(let p=0;p<3;p++)e[p]>0?(i+=e[p]*this.min[p],u+=e[p]*this.max[p]):(u+=e[p]*this.min[p],i+=e[p]*this.max[p]);return i>=0?2:u<0?0:1}}class kn{distanceToTile2d(e,i,u,p){const g=p.distanceX([e,i]),x=p.distanceY([e,i]);return Math.hypot(g,x)}getWrap(e,i,u){return u}getTileBoundingVolume(e,i,u,p){var g,x;let M=0,k=0;if(p?.terrain){const R=new s.Z(e.z,i,e.z,e.x,e.y),j=p.terrain.getMinMaxElevation(R);M=(g=j.minElevation)!==null&&g!==void 0?g:Math.min(0,u),k=(x=j.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}const z=1<<e.z;return new cn([i+e.x/z,e.y/z,M],[i+(e.x+1)/z,(e.y+1)/z,k])}allowVariableZoom(e,i){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,p=s.ah(78.5-u/2,0,60);return!!i.terrain||e.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Wr{constructor(e,i,u){this.points=e,this.planes=i,this.aabb=u}static fromInvProjectionMatrix(e,i=1,u=0,p,g){const x=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],M=Math.pow(2,u),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((B=>(function(O,G,J,te){const re=s.aw([],O,G),ne=1/re[3]/J*te;return s.aY(re,re,[ne,ne,1/re[3],ne])})(B,e,i,M)));p&&(function(B,O,G,J){const te=J?4:0,re=J?0:4;let ne=0;const ce=[],ie=[];for(let se=0;se<4;se++){const _e=s.aU([],B[se+re],B[se+te]),Ee=s.aZ(_e);s.aR(_e,_e,1/Ee),ce.push(Ee),ie.push(_e)}for(let se=0;se<4;se++){const _e=s.a_(B[se+te],ie[se],G);ne=_e!==null&&_e>=0?Math.max(ne,_e):Math.max(ne,ce[se])}const de=(function(se,_e){const Ee=s.aU([],se[_e[0]],se[_e[1]]),Me=s.aU([],se[_e[2]],se[_e[1]]),ke=[0,0,0,0];return s.aV(ke,s.aW([],Ee,Me)),ke[3]=-s.aX(ke,se[_e[0]]),ke})(B,O),me=(function(se,_e){const Ee=s.a$(se),Me=s.b0([],se,1/Ee),ke=s.aU([],_e,s.aR([],Me,s.aX(_e,Me))),De=s.a$(ke);if(De>0){const tt=Math.sqrt(1-Me[3]*Me[3]),it=s.aR([],Me,-Me[3]),We=s.aS([],it,s.aR([],ke,tt/De));return s.b1(_e,We)}return null})(G,de);if(me!==null){const se=me/s.aX(ie[0],de);ne=Math.min(ne,se)}for(let se=0;se<4;se++){const _e=Math.min(ne,ce[se]);B[se+re]=[B[se+te][0]+ie[se][0]*_e,B[se+te][1]+ie[se][1]*_e,B[se+te][2]+ie[se][2]*_e,1]}})(k,x[0],p,g);const z=x.map((B=>{const O=s.aU([],k[B[0]],k[B[1]]),G=s.aU([],k[B[2]],k[B[1]]),J=s.aV([],s.aW([],O,G)),te=-s.aX(J,k[B[1]]);return J.concat(te)})),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],j=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const B of k)for(let O=0;O<3;O++)R[O]=Math.min(R[O],B[O]),j[O]=Math.max(j[O],B[O]);return new Wr(k,z,new cn(R,j))}}class Zr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,u,p,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,M)=>this.getConstrained(x,M)},e,i,u,p,g),this._coveringTilesDetailsProvider=new kn}clone(){const e=new Zr;return e.apply(this),e}apply(e,i,u){this._helper.apply(e,i,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new s.b2(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new s.P(0,0)),p=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),M=Math.floor(Math.min(u.x,p.x,g.x,x.x)),k=Math.floor(Math.max(u.x,p.x,g.x,x.x)),z=1;for(let R=M-z;R<=k+z;R++)R!==0&&i.push(new s.b2(R,e))}return i}getCameraFrustum(){return Wr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,i){const u=s.aj(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(i,u),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),x=s.a1.fromLngLat(e),M=new s.a1(x.x-(p.x-g.x),x.y-(p.y-g.y));this.setCenter(M?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(s.a1.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.a1.fromLngLat(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const u=i||0,p=[e.x,e.y,0,1],g=[e.x,e.y,1,1];s.aw(p,p,this._pixelMatrixInverse),s.aw(g,g,this._pixelMatrixInverse);const x=p[3],M=g[3],k=p[1]/x,z=g[1]/M,R=p[2]/x,j=g[2]/M,B=R===j?0:(u-R)/(j-R);return new s.a1(s.C.number(p[0]/x,g[0]/M,B)/this.worldSize,s.C.number(k,z,B)/this.worldSize,u)}coordinatePoint(e,i=0,u=this._pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,i,1];return s.aw(p,p,u),new s.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ye(this));return new Qr().extend(this.screenPointToLocation(new s.P(0,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-ye(this)}calculatePosMatrix(e,i=!1,u){var p;const g=(p=e.key)!==null&&p!==void 0?p:s.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),x=i?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(g)){const z=x.get(g);return u?z.f32:z.f64}const M=be(e,this.worldSize);s.O(M,i?this._alignedProjMatrix:this._viewProjMatrix,M);const k={f64:M,f32:new Float32Array(M)};return x.set(g,k),u?k.f32:k.f64}calculateFogMatrix(e){const i=e.key,u=this._fogMatrixCacheF32;if(u.has(i))return u.get(i);const p=be(e,this.worldSize);return s.O(p,this._fogMatrix,p),u.set(i,new Float32Array(p)),u.get(i)}getConstrained(e,i){i=s.ah(+i,this.minZoom,this.maxZoom);const u={center:new s.S(e.lng,e.lat),zoom:i};let p=this._helper._lngRange;if(!this._helper._renderWorldCopies&&p===null){const ce=179.9999999999;p=[-ce,ce]}const g=this.tileSize*s.af(u.zoom);let x=0,M=g,k=0,z=g,R=0,j=0;const{x:B,y:O}=this.size;if(this._helper._latRange){const ce=this._helper._latRange;x=s.U(ce[1])*g,M=s.U(ce[0])*g,M-x<O&&(R=O/(M-x))}p&&(k=s.aO(s.V(p[0])*g,0,g),z=s.aO(s.V(p[1])*g,0,g),z<k&&(z+=g),z-k<B&&(j=B/(z-k)));const{x:G,y:J}=Q(g,e);let te,re;const ne=Math.max(j||0,R||0);if(ne){const ce=new s.P(j?(z+k)/2:G,R?(M+x)/2:J);return u.center=ue(g,ce).wrap(),u.zoom+=s.ak(ne),u}if(this._helper._latRange){const ce=O/2;J-ce<x&&(re=x+ce),J+ce>M&&(re=M-ce)}if(p){const ce=(k+z)/2;let ie=G;this._helper._renderWorldCopies&&(ie=s.aO(G,ce-g/2,ce+g/2));const de=B/2;ie-de<k&&(te=k+de),ie+de>z&&(te=z-de)}if(te!==void 0||re!==void 0){const ce=new s.P(te??G,re??J);u.center=ue(g,ce).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,i,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,p)}_calculateNearFarZIfNeeded(e,i,u){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-p*this._helper._pixelPerMeter/Math.cos(i),x=p<0?g:e,M=Math.PI/2+this.pitchInRadians,k=s.ae(this.fov)*(Math.abs(Math.cos(s.ae(this.roll)))*this.height+Math.abs(Math.sin(s.ae(this.roll)))*this.width)/this.height*(.5+u.y/this.height),z=Math.sin(k)*x/Math.sin(s.ah(Math.PI-M-k,.01,Math.PI-.01)),R=ye(this),j=Math.atan(R/this._helper.cameraToCenterDistance),B=s.ae(.75),O=j>B?2*j*(.5+u.y/(2*R)):B,G=Math.sin(O)*x/Math.sin(s.ah(Math.PI-M-O,.01,Math.PI-.01)),J=Math.min(z,G);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*J+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=Q(this.worldSize,this.center),u=i.x,p=i.y;this._helper._pixelPerMeter=s.aj(1,this.center.lat)*this.worldSize;const g=s.ae(Math.min(this.pitch,W)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let M;this._calculateNearFarZIfNeeded(x,g,e),M=new Float64Array(16),s.b4(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aq(this._invProjMatrix,M),M[8]=2*-e.x/this._helper._width,M[9]=2*e.y/this._helper._height,this._projectionMatrix=s.b5(M),s.N(M,M,[1,-1,1]),s.M(M,M,[0,0,-this._helper.cameraToCenterDistance]),s.b6(M,M,-this.rollInRadians),s.b7(M,M,this.pitchInRadians),s.b6(M,M,-this.bearingInRadians),s.M(M,M,[-u,-p,0]),this._mercatorMatrix=s.N([],M,[this.worldSize,this.worldSize,this.worldSize]),s.N(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),s.M(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=s.aq([],M);const k=[0,0,-1,1];s.aw(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),s.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,s.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.M(this._fogMatrix,this._fogMatrix,[-u,-p,0]),s.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);const z=this._helper._width%2/2,R=this._helper._height%2/2,j=Math.cos(this.bearingInRadians),B=Math.sin(-this.bearingInRadians),O=u-Math.round(u)+j*z+B*R,G=p-Math.round(p)+j*R+B*z,J=new Float64Array(M);if(s.M(J,J,[O>.5?O-1:O,G>.5?G-1:G,0]),this._alignedProjMatrix=J,M=s.aq(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new s.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return s.aw(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=s.aj(1,this.center.lat)*this.worldSize;return Ae(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const u=s.a1.fromLngLat(e),p=[u.x*this.worldSize,u.y*this.worldSize,i,1];return s.aw(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(e){const{overscaledTileID:i,aligned:u,applyTerrainMatrix:p}=e,g=this._helper.getMercatorTileCoordinates(i),x=i?this.calculatePosMatrix(i,u,!0):null;let M;return M=i&&i.terrainRttPosMatrix32f&&p?i.terrainRttPosMatrix32f:x||s.b8(),{mainMatrix:M,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,u){return 1}transformLightDirection(e){return s.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,u,p){const g=this.calculatePosMatrix(u);let x;p?(x=[e,i,p(e,i),1],s.aw(x,x,g)):(x=[e,i,0,1],al(x,x,g));const M=x[3];return{point:new s.P(x[0]/M,x[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const u=s.a1.fromLngLat(e,i),p=u.meterInMercatorCoordinateUnits(),g=s.b9();return s.M(g,g,[u.x,u.y,u.z]),s.b6(g,g,Math.PI),s.b7(g,g,Math.PI/2),s.N(g,g,[-p,p,p]),g}getProjectionDataForCustomLayer(e=!0){const i=new s.Z(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),p=be(i,this.worldSize);s.O(p,this._viewProjMatrix,p),u.tileMercatorCoords=[0,0,1,1];const g=[s.$,s.$,this.worldSize/this._helper.pixelsPerMeter],x=s.ba();return s.N(x,p,g),u.fallbackMatrix=x,u.mainMatrix=x,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function zc(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function En(m){if(m.useSlerp)if(m.k<1){const e=s.bb(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),i=s.bb(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),u=new Float64Array(4);s.bc(u,e,i,m.k);const p=s.bd(u);m.tr.setRoll(p.roll),m.tr.setPitch(p.pitch),m.tr.setBearing(p.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(s.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(s.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(s.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Bi(m,e,i,u,p){const g=p.padding,x=Q(p.worldSize,i.getNorthWest()),M=Q(p.worldSize,i.getNorthEast()),k=Q(p.worldSize,i.getSouthEast()),z=Q(p.worldSize,i.getSouthWest()),R=s.ae(-u),j=x.rotate(R),B=M.rotate(R),O=k.rotate(R),G=z.rotate(R),J=new s.P(Math.max(j.x,B.x,G.x,O.x),Math.max(j.y,B.y,G.y,O.y)),te=new s.P(Math.min(j.x,B.x,G.x,O.x),Math.min(j.y,B.y,G.y,O.y)),re=J.sub(te),ne=(p.width-(g.left+g.right+e.left+e.right))/re.x,ce=(p.height-(g.top+g.bottom+e.top+e.bottom))/re.y;if(ce<0||ne<0)return void zc();const ie=Math.min(s.ak(p.scale*Math.min(ne,ce)),m.maxZoom),de=s.P.convert(m.offset),me=new s.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(s.ae(u)),se=de.add(me).mult(p.scale/s.af(ie));return{center:ue(p.worldSize,x.add(k).div(2).sub(se)),zoom:ie,bearing:u}}class Zn{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,u){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,i,u,p,g){return Bi(e,i,u,p,g)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(s.S.convert(i.center))}handleEaseTo(e,i){const u=e.zoom,p=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},M=i.zoom!==void 0,k=!e.isPaddingEqual(i.padding);let z=!1;const R=M?+i.zoom:e.zoom;let j=e.centerPoint.add(i.offsetAsPoint);const B=e.screenPointToLocation(j),{center:O,zoom:G}=e.getConstrained(s.S.convert(i.center||B),R??u);ga(e,O);const J=Q(e.worldSize,B),te=Q(e.worldSize,O).sub(J),re=s.af(G-u);return z=G!==u,{easeFunc:ne=>{if(z&&e.setZoom(s.C.number(u,G,ne)),s.be(g,x)||En({startEulerAngles:g,endEulerAngles:x,tr:e,k:ne,useSlerp:g.roll!=x.roll}),k&&(e.interpolatePadding(p,i.padding,ne),j=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const ce=s.af(e.zoom-u),ie=G>u?Math.min(2,re):Math.max(.5,re),de=Math.pow(ie,1-ne),me=ue(e.worldSize,J.add(te.mult(ne*de)).mult(ce));e.setLocationAtPoint(e.renderWorldCopies?me.wrap():me,j)}},isZooming:z,elevationCenter:O}}handleFlyTo(e,i){const u=i.zoom!==void 0,p=e.zoom,g=e.getConstrained(s.S.convert(i.center||i.locationAtOffset),u?+i.zoom:p),x=g.center,M=g.zoom;ga(e,x);const k=Q(e.worldSize,i.locationAtOffset),z=Q(e.worldSize,x).sub(k),R=z.mag(),j=s.af(M-p);let B;if(i.minZoom!==void 0){const O=Math.min(+i.minZoom,p,M),G=e.getConstrained(x,O).zoom;B=s.af(G-p)}return{easeFunc:(O,G,J,te)=>{e.setZoom(O===1?M:p+s.ak(G));const re=O===1?x:ue(e.worldSize,k.add(z.mult(J)).mult(G));e.setLocationAtPoint(e.renderWorldCopies?re.wrap():re,te)},scaleOfZoom:j,targetCenter:x,scaleOfMinZoom:B,pixelPathLength:R}}}class $r{constructor(e,i,u){this.blendFunction=e,this.blendColor=i,this.mask=u}}$r.Replace=[1,0],$r.disabled=new $r($r.Replace,s.bf.transparent,[!1,!1,!1,!1]),$r.unblended=new $r($r.Replace,s.bf.transparent,[!0,!0,!0,!0]),$r.alphaBlended=new $r([1,771],s.bf.transparent,[!0,!0,!0,!0]);const Yo=2305;class Bt{constructor(e,i,u){this.enable=e,this.mode=i,this.frontFace=u}}Bt.disabled=new Bt(!1,1029,Yo),Bt.backCCW=new Bt(!0,1029,Yo),Bt.frontCCW=new Bt(!0,1028,Yo);class Ut{constructor(e,i,u){this.func=e,this.mask=i,this.range=u}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const ji=7680;class or{constructor(e,i,u,p,g,x){this.test=e,this.ref=i,this.mask=u,this.fail=p,this.depthFail=g,this.pass=x}}or.disabled=new or({func:519,mask:0},0,0,ji,ji,ji);const ti=new WeakMap;function $a(m){var e;if(ti.has(m))return ti.get(m);{const i=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ti.set(m,i),i}}class qa{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,u=i.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const p=new s.aL;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const g=new s.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new ho(i.createVertexBuffer(p,po.members),i.createIndexBuffer(g),s.aM.simpleSegment(0,0,p.length,g.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(u.TEXTURE1);const x=u.createTexture();u.bindTexture(u.TEXTURE_2D,x),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),$a(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const u=this._cachedRenderContext.context,p=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:s.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,p.TRIANGLES,Ut.disabled,or.disabled,$r.unblended,Bt.disabled,((g,x)=>({u_input:g,u_output_expected:x}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&$a(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const g=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&$a(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=qa._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const ul=s.$/128;function cl(m,e){const i=m.granularity!==void 0?Math.max(m.granularity,1):1,u=i+(m.generateBorders?2:0),p=i+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=u+1,x=p+1,M=m.generateBorders?-1:0,k=m.generateBorders||m.extendToNorthPole?-1:0,z=i+(m.generateBorders?1:0),R=i+(m.generateBorders||m.extendToSouthPole?1:0),j=g*x,B=u*p*6,O=g*x>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const G=O||e==="32bit",J=new Int16Array(2*j);let te=0;for(let ce=k;ce<=R;ce++)for(let ie=M;ie<=z;ie++){let de=ie/i*s.$;ie===-1&&(de=-ul),ie===i+1&&(de=s.$+ul);let me=ce/i*s.$;ce===-1&&(me=m.extendToNorthPole?s.bh:-ul),ce===i+1&&(me=m.extendToSouthPole?s.bi:s.$+ul),J[te++]=de,J[te++]=me}const re=G?new Uint32Array(B):new Uint16Array(B);let ne=0;for(let ce=0;ce<p;ce++)for(let ie=0;ie<u;ie++){const de=ie+1+ce*g,me=ie+(ce+1)*g,se=ie+1+(ce+1)*g;re[ne++]=ie+ce*g,re[ne++]=me,re[ne++]=de,re[ne++]=de,re[ne++]=me,re[ne++]=se}return{vertices:J.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:G}}const Jo=new s.aK({fill:new s.bj(128,2),line:new s.bj(512,0),tile:new s.bj(128,32),stencil:new s.bj(128,1),circle:3});class hl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return na.projectionGlobe}get vertexShaderPreludeCode(){return na.projectionMercator.vertexSource}get subdivisionGranularity(){return Jo}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new qa(e));const i=s.U(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(i,u),g=le.now();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=g);const x=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bl(x))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,u,p,g){const x=(g==="stencil"?Jo.stencil:Jo.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:x,generateBorders:u,extendToNorthPole:i.y===0&&p,extendToSouthPole:i.y===(1<<i.z)-1&&p})}_getMesh(e,i){const u=this._getMeshKey(i);if(u in this._tileMeshCache)return this._tileMeshCache[u];const p=(function(g,x){const M=cl(x,"16bit"),k=s.aL.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),z=s.aN.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new ho(g.createVertexBuffer(k,po.members),g.createIndexBuffer(z),s.aM.simpleSegment(0,0,k.length,z.length))})(e,i);return this._tileMeshCache[u]=p,p}recalculate(e){}hasTransition(){const e=le.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const _a=new s.r({type:new s.D(s.v.projection.type)});class pl extends s.E{constructor(e){super(),this._transitionable=new s.t(_a),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0)),this._mercatorProjection=new tr,this._verticalPerspectiveProjection=new hl}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof s.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,u,p,g){return this.currentProjection.getMeshFromTileID(e,i,u,p,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Cs(m){const e=fo(m.worldSize,m.center.lat);return 2*Math.PI*e}function ia(m,e,i,u,p){const g=1/(1<<p),x=e/s.$*g+u*g,M=s.bo((m/s.$*g+i*g)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,z=Math.cos(k),R=new Float64Array(3);return R[0]=Math.sin(M)*z,R[1]=Math.sin(k),R[2]=Math.cos(M)*z,R}function fn(m){return(function(e,i){const u=Math.cos(i),p=new Float64Array(3);return p[0]=Math.sin(e)*u,p[1]=Math.sin(i),p[2]=Math.cos(e)*u,p})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function fo(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function dl(m){const e=Math.asin(m[1])/Math.PI*180,i=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(i>1e-6){const u=m[0]/i,p=Math.acos(m[2]/i),g=(u>0?p:-p)/Math.PI*180;return new s.S(s.aO(g,-180,180),e)}return new s.S(0,e)}function In(m){return Math.cos(m*Math.PI/180)}function Xr(m,e){const i=In(m),u=In(e);return s.ak(u/i)}function qu(m,e){const i=m.rotate(e.bearingInRadians),u=e.zoom+Xr(e.center.lat,0),p=s.bk(1/In(e.center.lat),1/In(Math.min(Math.abs(e.center.lat),60)),s.bn(u,7,3,0,1)),g=360/Cs({worldSize:e.worldSize,center:{lat:e.center.lat}});return new s.S(e.center.lng-i.x*g*p,s.ah(e.center.lat+i.y*g,-s.ai,s.ai))}function mo(m){const e=.5*m,i=Math.sin(e),u=Math.cos(e);return Math.log(i+u)-Math.log(u-i)}function Lc(m,e,i,u){const p=m.lat+i*u;if(Math.abs(i)>1){const g=(Math.sign(m.lat+i)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,x=Math.abs(m.lat+i)*Math.PI/180,M=mo(g+u*(x-g)),k=mo(g),z=mo(x);return new s.S(m.lng+e*((M-k)/(z-k)),p)}return new s.S(m.lng+e*u,p)}class Rc{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,i,u,p){const g=`${e.z}_${e.x}_${e.y}_${p?.terrain?"t":""}`,x=this._cache.get(g);if(x)return x;const M=this._cachePrevious.get(g);if(M)return this._cache.set(g,M),M;const k=this._boundingVolumeFactory(e,i,u,p);return this._cache.set(g,k),this._hadAnyChanges=!0,k}}class Qo{constructor(e,i,u,p){this.min=u,this.max=p,this.points=e,this.planes=i}static fromAabb(e,i){const u=[];for(let p=0;p<8;p++)u.push([1&~p?e[0]:i[0],(p>>1&1)==1?i[1]:e[1],(p>>2&1)==1?i[2]:e[2]]);return new Qo(u,[[-1,0,0,i[0]],[1,0,0,-e[0]],[0,-1,0,i[1]],[0,1,0,-e[1]],[0,0,-1,i[2]],[0,0,1,-e[2]]],e,i)}static fromCenterSizeAngles(e,i,u){const p=s.br([],u[0],u[1],u[2]),g=s.bs([],[i[0],0,0],p),x=s.bs([],[0,i[1],0],p),M=s.bs([],[0,0,i[2]],p),k=[...e],z=[...e];for(let j=0;j<8;j++)for(let B=0;B<3;B++){const O=e[B]+g[B]*(1&~j?-1:1)+x[B]*((j>>1&1)==1?1:-1)+M[B]*((j>>2&1)==1?1:-1);k[B]=Math.min(k[B],O),z[B]=Math.max(z[B],O)}const R=[];for(let j=0;j<8;j++){const B=[...e];s.aS(B,B,s.aR([],g,1&~j?-1:1)),s.aS(B,B,s.aR([],x,(j>>1&1)==1?1:-1)),s.aS(B,B,s.aR([],M,(j>>2&1)==1?1:-1)),R.push(B)}return new Qo(R,[[...g,-s.aX(g,R[0])],[...x,-s.aX(x,R[0])],[...M,-s.aX(M,R[0])],[-g[0],-g[1],-g[2],-s.aX(g,R[7])],[-x[0],-x[1],-x[2],-s.aX(x,R[7])],[-M[0],-M[1],-M[2],-s.aX(M,R[7])]],k,z)}intersectsFrustum(e){let i=!0;const u=this.points.length,p=this.planes.length,g=e.planes.length,x=e.points.length;for(let M=0;M<g;M++){const k=e.planes[M];let z=0;for(let R=0;R<u;R++){const j=this.points[R];k[0]*j[0]+k[1]*j[1]+k[2]*j[2]+k[3]>=0&&z++}if(z===0)return 0;z<u&&(i=!1)}if(i)return 2;for(let M=0;M<p;M++){const k=this.planes[M];let z=0;for(let R=0;R<x;R++){const j=e.points[R];k[0]*j[0]+k[1]*j[1]+k[2]*j[2]+k[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(e){const i=this.points.length;let u=0;for(let p=0;p<i;p++){const g=this.points[p];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&u++}return u===i?2:u===0?0:1}}function mn(m,e,i){const u=m-e;return u<0?-u:Math.max(0,u-i)}function es(m,e,i,u,p){const g=m-i;let x;return x=g<0?Math.min(-g,1+g-p):g>1?Math.min(Math.max(g-p,0),1-g):0,Math.max(x,mn(e,u,p))}class va{constructor(){this._boundingVolumeCache=new Rc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,i,u,p){const g=1<<u.z,x=1/g,M=u.x/g,k=u.y/g;let z=2;return z=Math.min(z,es(e,i,M,k,x)),z=Math.min(z,es(e,i,M+.5,-k-x,x)),z=Math.min(z,es(e,i,M+.5,2-k-x,x)),z}getWrap(e,i,u){const p=1<<i.z,g=1/p,x=i.x/p,M=mn(e.x,x,g),k=mn(e.x,x-1,g),z=mn(e.x,x+1,g),R=Math.min(M,k,z);return R===z?1:R===k?-1:0}allowVariableZoom(e,i){return vt(e,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,i,u,p){return this._boundingVolumeCache.getTileBoundingVolume(e,i,u,p)}_computeTileBoundingVolume(e,i,u,p){var g,x;let M=0,k=0;if(p?.terrain){const z=new s.Z(e.z,i,e.z,e.x,e.y),R=p.terrain.getMinMaxElevation(z);M=(g=R.minElevation)!==null&&g!==void 0?g:Math.min(0,u),k=(x=R.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}if(M/=s.bu,k/=s.bu,M+=1,k+=1,e.z<=0)return Qo.fromAabb([-k,-k,-k],[k,k,k]);if(e.z===1)return Qo.fromAabb([e.x===0?-k:0,e.y===0?0:-k,-k],[e.x===0?0:k,e.y===0?k:0,k]);{const z=[ia(0,0,e.x,e.y,e.z),ia(s.$,0,e.x,e.y,e.z),ia(s.$,s.$,e.x,e.y,e.z),ia(0,s.$,e.x,e.y,e.z)],R=[];for(const ke of z)R.push(s.aR([],ke,k));if(k!==M)for(const ke of z)R.push(s.aR([],ke,M));e.y===0&&R.push([0,1,0]),e.y===(1<<e.z)-1&&R.push([0,-1,0]);const j=[1,1,1],B=[-1,-1,-1];for(const ke of R)for(let De=0;De<3;De++)j[De]=Math.min(j[De],ke[De]),B[De]=Math.max(B[De],ke[De]);const O=ia(s.$/2,s.$/2,e.x,e.y,e.z),G=s.aW([],[0,1,0],O);s.aV(G,G);const J=s.aW([],O,G);s.aV(J,J);const te=s.aW([],z[2],z[1]);s.aV(te,te);const re=s.aW([],z[0],z[3]);s.aV(re,re),R.push(s.aR([],O,k)),e.y>=(1<<e.z)/2&&R.push(s.aR([],ia(s.$/2,0,e.x,e.y,e.z),k)),e.y<(1<<e.z)/2&&R.push(s.aR([],ia(s.$/2,s.$,e.x,e.y,e.z),k));const ne=eu(O,R),ce=eu(J,R),ie=[-O[0],-O[1],-O[2],ne.max],de=[O[0],O[1],O[2],-ne.min],me=[-J[0],-J[1],-J[2],ce.max],se=[J[0],J[1],J[2],-ce.min],_e=[...te,0],Ee=[...re,0],Me=[];return e.y===0?Me.push(s.bt(Ee,_e,ie),s.bt(Ee,_e,de)):Me.push(s.bt(me,_e,ie),s.bt(me,_e,de),s.bt(me,Ee,ie),s.bt(me,Ee,de)),e.y===(1<<e.z)-1?Me.push(s.bt(Ee,_e,ie),s.bt(Ee,_e,de)):Me.push(s.bt(se,_e,ie),s.bt(se,_e,de),s.bt(se,Ee,ie),s.bt(se,Ee,de)),new Qo(Me,[ie,de,me,se,_e,Ee],j,B)}}}function eu(m,e){let i=1/0,u=-1/0;for(const p of e){const g=s.aX(m,p);i=Math.min(i,g),u=Math.max(u,g)}return{min:i,max:u}}class tu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=s.bv(),this._projectionMatrix=s.b9(),this._globeViewProjMatrix32f=s.b8(),this._globeViewProjMatrixNoCorrection=s.b9(),this._globeViewProjMatrixNoCorrectionInverted=s.b9(),this._globeProjMatrixInverted=s.b9(),this._cameraPosition=s.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new va}clone(){const e=new tu;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=s.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:u}=e,p=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,u=this.cameraToCenterDistance/e,p=Math.sin(i)*u,g=Math.cos(i)*u+1,x=1/Math.sqrt(p*p+g*g)*1;let M=-p,k=g;const z=Math.sqrt(M*M+k*k);M/=z,k/=z;const R=[0,M,k];s.bw(R,R,[0,0,0],-this.bearingInRadians),s.bx(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),s.by(R,R,[0,0,0],this.center.lng*Math.PI/180);const j=1/s.aZ(R);return s.aR(R,R,j),[...R,-x*j]}isLocationOccluded(e){return!this.isSurfacePointVisible(fn(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,p=Math.cos(u),g=[Math.sin(i)*p,Math.sin(u),Math.cos(i)*p],x=[g[2],0,-g[0]],M=[0,0,0];s.aW(M,x,g),s.aV(x,x),s.aV(M,M);const k=[0,0,0];return s.aV(k,[x[0]*e[0]+M[0]*e[1]+g[0]*e[2],x[1]*e[0]+M[1]*e[1]+g[1]*e[2],x[2]*e[0]+M[2]*e[1]+g[2]*e[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,u){const p=(function(M,k,z){const R=1/(1<<z.z);return new s.a1(M/s.$*R+z.x*R,k/s.$*R+z.y*R)})(e,i,u.canonical),g=(x=p.y,[s.bo(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,i,u,p){const g=u.canonical,x=ia(e,i,g.x,g.y,g.z),M=1+(p?p(e,i):0)/s.bu,k=[x[0]*M,x[1]*M,x[2]*M,1];s.aw(k,k,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,R=z[0]*x[0]+z[1]*x[1]+z[2]*x[2]+z[3]<0;return{point:new s.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=fo(this.worldSize,this.center.lat),i=s.ba(),u=s.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),s.b4(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;i[8]=2*-p.x/this._helper._width,i[9]=2*p.y/this._helper._height,this._projectionMatrix=s.b5(i),this._globeProjMatrixInverted=s.ba(),s.aq(this._globeProjMatrixInverted,i),s.M(i,i,[0,0,-this.cameraToCenterDistance]),s.b6(i,i,this.rollInRadians),s.b7(i,i,-this.pitchInRadians),s.b6(i,i,this.bearingInRadians),s.M(i,i,[0,0,-e]);const g=s.bp();g[0]=e,g[1]=e,g[2]=e,s.b7(u,i,this.center.lat*Math.PI/180),s.bz(u,u,-this.center.lng*Math.PI/180),s.N(u,u,g),this._globeViewProjMatrixNoCorrection=u,s.b7(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bz(i,i,-this.center.lng*Math.PI/180),s.N(i,i,g),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=s.ba(),s.aq(this._globeViewProjMatrixNoCorrectionInverted,u);const x=s.bp();this._cameraPosition=s.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,s.bw(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),s.bx(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),s.bw(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),s.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bx(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),s.by(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const M=s.b5(this._globeViewProjMatrixNoCorrectionInverted);s.N(M,M,[1,1,-1]),this._cachedFrustum=Wr.fromInvProjectionMatrix(M,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){s.w("calculateFogMatrix is not supported on globe projection.");const i=s.ba();return s.ag(i),i}getVisibleUnwrappedCoordinates(e){return[new s.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=fn(e);s.aR(u,u,1+i/s.bu);const p=s.bv();return s.aw(p,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,u=[new s.P(0,0),new s.P(e,0),new s.P(this.width,0),new s.P(this.width,i),new s.P(this.width,this.height),new s.P(e,this.height),new s.P(0,this.height),new s.P(0,i)],p=[];for(const j of u)p.push(this.unprojectScreenPoint(j));let g=0,x=0,M=0,k=0;const z=this.center;for(const j of p){const B=s.bA(z.lng,j.lng),O=s.bA(z.lat,j.lat);B<x&&(x=B),B>g&&(g=B),O<k&&(k=O),O>M&&(M=O)}const R=[z.lng+x,z.lat+k,z.lng+g,z.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new Qr(R)}getConstrained(e,i){const u=s.ah(e.lat,-s.ai,s.ai),p=s.ah(+i,this.minZoom+Xr(0,u),this.maxZoom);return{center:new s.S(e.lng,u),zoom:p}}calculateCenterFromCameraLngLatAlt(e,i,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,p)}setLocationAtPoint(e,i){const u=fn(this.unprojectScreenPoint(i)),p=fn(e),g=s.bp();s.bB(g);const x=s.bp();s.by(x,u,g,-this.center.lng*Math.PI/180),s.bx(x,x,g,this.center.lat*Math.PI/180);const M=p[0]*p[0]+p[2]*p[2],k=x[0]*x[0];if(M<k)return;const z=Math.sqrt(M-k),R=-z,j=s.bC(p[0],p[2],x[0],z),B=s.bC(p[0],p[2],x[0],R),O=s.bp();s.by(O,p,g,-j);const G=s.bC(O[1],O[2],x[1],x[2]),J=s.bp();s.by(J,p,g,-B);const te=s.bC(J[1],J[2],x[1],x[2]),re=.5*Math.PI,ne=G>=-re&&G<=re,ce=te>=-re&&te<=re;let ie,de;if(ne&&ce){const Ee=this.center.lng*Math.PI/180,Me=this.center.lat*Math.PI/180;s.bD(j,Ee)+s.bD(G,Me)<s.bD(B,Ee)+s.bD(te,Me)?(ie=j,de=G):(ie=B,de=te)}else if(ne)ie=j,de=G;else{if(!ce)return;ie=B,de=te}const me=ie/Math.PI*180,se=de/Math.PI*180,_e=this.center.lat;this.setCenter(new s.S(me,s.ah(se,-90,90))),this.setZoom(this.zoom+Xr(_e,this.center.lat))}locationToScreenPoint(e,i){const u=fn(e);if(i){const p=i.getElevationForLngLatZoom(e,this._helper._tileZoom);s.aR(u,u,1+p/s.bu)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const i=s.bv();return s.aw(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new s.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u)return u}return s.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,i){const u=this._cameraPosition,p=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,p)}getRayDirectionFromPixel(e){const i=s.bv();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,s.aw(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const u=s.bp();u[0]=i[0]-this._cameraPosition[0],u[1]=i[1]-this._cameraPosition[1],u[2]=i[2]-this._cameraPosition[2];const p=s.bp();return s.aV(p,u),p}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=s.bv();return s.aw(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const u=s.aX(e,i),p=s.bp(),g=s.bp();s.aR(g,i,u),s.aU(p,e,g);const x=1-s.aX(p,p);if(x<0)return null;const M=s.aX(e,e)-1,k=-u+(u<0?1:-1)*Math.sqrt(x),z=M/k,R=k;return{tMin:Math.min(z,R),tMax:Math.max(z,R)}}unprojectScreenPoint(e){const i=this._cameraPosition,u=this.getRayDirectionFromPixel(e),p=this.rayPlanetIntersection(i,u);if(p){const R=s.bp();s.aS(R,i,[u[0]*p.tMin,u[1]*p.tMin,u[2]*p.tMin]);const j=s.bp();return s.aV(j,R),dl(j)}const g=this._cachedClippingPlane,x=g[0]*u[0]+g[1]*u[1]+g[2]*u[2],M=-s.b1(g,i)/x,k=s.bp();if(M>0)s.aS(k,i,[u[0]*M,u[1]*M,u[2]*M]);else{const R=s.bp();s.aS(R,i,[2*u[0],2*u[1],2*u[2]]);const j=s.b1(this._cachedClippingPlane,R);s.aU(k,R,[this._cachedClippingPlane[0]*j,this._cachedClippingPlane[1]*j,this._cachedClippingPlane[2]*j])}const z=(function(R){const j=s.bp();return j[0]=R[0]*-R[3],j[1]=R[1]*-R[3],j[2]=R[2]*-R[3],{center:j,radius:Math.sqrt(1-R[3]*R[3])}})(g);return dl((function(R,j,B){const O=s.bp();s.aU(O,B,R);const G=s.bp();return s.bq(G,R,O,j/s.a$(O)),G})(z.center,z.radius,k))}getMatrixForModel(e,i){const u=s.S.convert(e),p=1/s.bu,g=s.b9();return s.bz(g,g,u.lng/180*Math.PI),s.b7(g,g,-u.lat/180*Math.PI),s.M(g,g,[0,0,1+i/s.bu]),s.b7(g,g,.5*Math.PI),s.N(g,g,[p,p,p]),g}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new s.Z(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class ru{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new Zr,this._verticalPerspectiveTransform=new tu}clone(){const e=new ru;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:i.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return s.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,u){const p=this._mercatorTransform.getPitchedTextCorrection(e,i,u),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,u);return s.bk(p,g,this._globeness)}projectTileCoordinates(e,i,u,p){return this.currentTransform.projectTileCoordinates(e,i,u,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,p)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=i.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class On{get useGlobeControls(){return!0}handlePanInertia(e,i){const u=qu(e,i);return Math.abs(u.lng-i.center.lng)>180&&(u.lng=i.center.lng+179.5*Math.sign(u.lng-i.center.lng)),{easingCenter:u,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const u=e.around,p=i.screenPointToLocation(u);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const g=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const x=i.zoom-g;if(x===0)return;const M=s.bA(i.center.lng,p.lng),k=M/(Math.abs(M/180)+1),z=s.bA(i.center.lat,p.lat),R=i.getRayDirectionFromPixel(u),j=i.cameraPosition,B=-1*s.aX(j,R),O=s.bp();s.aS(O,j,[R[0]*B,R[1]*B,R[2]*B]);const G=s.aZ(O)-1,J=Math.exp(.5*-Math.max(G-.3,0)),te=fo(i.worldSize,i.center.lat)/Math.min(i.width,i.height),re=s.bn(te,.9,.5,1,.25),ne=(1-s.af(-x))*Math.min(J,re),ce=i.center.lat,ie=i.zoom,de=new s.S(i.center.lng+k*ne,s.ah(i.center.lat+z*ne,-s.ai,s.ai));i.setLocationAtPoint(p,u);const me=i.center,se=s.bn(Math.abs(M),45,85,0,1),_e=s.bn(te,.75,.35,0,1),Ee=Math.pow(Math.max(se,_e),.25),Me=s.bA(me.lng,de.lng),ke=s.bA(me.lat,de.lat);i.setCenter(new s.S(me.lng+Me*Ee,me.lat+ke*Ee).wrap()),i.setZoom(ie+Xr(ce,i.center.lat))}handleMapControlsPan(e,i,u){if(!e.panDelta)return;const p=i.center.lat,g=i.zoom;i.setCenter(qu(e.panDelta,i).wrap()),i.setZoom(g+Xr(p,i.center.lat))}cameraForBoxAndBearing(e,i,u,p,g){const x=Bi(e,i,u,p,g),M=i.left/g.width*2-1,k=(g.width-i.right)/g.width*2-1,z=i.top/g.height*-2+1,R=(g.height-i.bottom)/g.height*-2+1,j=s.bA(u.getWest(),u.getEast())<0,B=j?u.getEast():u.getWest(),O=j?u.getWest():u.getEast(),G=Math.max(u.getNorth(),u.getSouth()),J=Math.min(u.getNorth(),u.getSouth()),te=B+.5*s.bA(B,O),re=G+.5*s.bA(G,J),ne=g.clone();ne.setCenter(x.center),ne.setBearing(x.bearing),ne.setPitch(0),ne.setRoll(0),ne.setZoom(x.zoom);const ce=ne.modelViewProjectionMatrix,ie=[fn(u.getNorthWest()),fn(u.getNorthEast()),fn(u.getSouthWest()),fn(u.getSouthEast()),fn(new s.S(O,re)),fn(new s.S(B,re)),fn(new s.S(te,G)),fn(new s.S(te,J))],de=fn(x.center);let me=Number.POSITIVE_INFINITY;for(const se of ie)M<0&&(me=On.getLesserNonNegativeNonNull(me,On.solveVectorScale(se,de,ce,"x",M))),k>0&&(me=On.getLesserNonNegativeNonNull(me,On.solveVectorScale(se,de,ce,"x",k))),z>0&&(me=On.getLesserNonNegativeNonNull(me,On.solveVectorScale(se,de,ce,"y",z))),R<0&&(me=On.getLesserNonNegativeNonNull(me,On.solveVectorScale(se,de,ce,"y",R)));if(Number.isFinite(me)&&me!==0)return x.zoom=ne.zoom+s.ak(me),x;zc()}handleJumpToCenterZoom(e,i){const u=e.center.lat,p=e.getConstrained(i.center?s.S.convert(i.center):e.center,e.zoom).center;e.setCenter(p.wrap());const g=i.zoom!==void 0?+i.zoom:e.zoom+Xr(u,p.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,i){const u=e.zoom,p=e.center,g=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},M={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},k=i.zoom!==void 0,z=!e.isPaddingEqual(i.padding);let R=!1;const j=i.center?s.S.convert(i.center):p,B=e.getConstrained(j,u).center;ga(e,B);const O=e.clone();O.setCenter(B),O.setZoom(k?+i.zoom:u+Xr(p.lat,j.lat)),O.setBearing(i.bearing);const G=new s.P(s.ah(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),s.ah(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(B,G);const J=(i.offset&&i.offsetAsPoint.mag())>0?O.center:B,te=k?+i.zoom:u+Xr(p.lat,J.lat),re=u+Xr(p.lat,0),ne=te+Xr(J.lat,0),ce=s.bA(p.lng,J.lng),ie=s.bA(p.lat,J.lat),de=s.af(ne-re);return R=te!==u,{easeFunc:me=>{if(s.be(x,M)||En({startEulerAngles:x,endEulerAngles:M,tr:e,k:me,useSlerp:x.roll!=M.roll}),z&&e.interpolatePadding(g,i.padding,me),i.around)s.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const se=ne>re?Math.min(2,de):Math.max(.5,de),_e=Math.pow(se,1-me),Ee=Lc(p,ce,ie,me*_e);e.setCenter(Ee.wrap())}if(R){const se=s.C.number(re,ne,me)+Xr(0,e.center.lat);e.setZoom(se)}},isZooming:R,elevationCenter:J}}handleFlyTo(e,i){const u=i.zoom!==void 0,p=e.center,g=e.zoom,x=e.padding,M=!e.isPaddingEqual(i.padding),k=e.getConstrained(s.S.convert(i.center||i.locationAtOffset),g).center,z=u?+i.zoom:e.zoom+Xr(e.center.lat,k.lat),R=e.clone();R.setCenter(k),R.setZoom(z),R.setBearing(i.bearing);const j=new s.P(s.ah(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),s.ah(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));R.setLocationAtPoint(k,j);const B=R.center;ga(e,B);const O=(function(ie,de,me){const se=fn(de),_e=fn(me),Ee=s.aX(se,_e),Me=Math.acos(Ee),ke=Cs(ie);return Me/(2*Math.PI)*ke})(e,p,B),G=g+Xr(p.lat,0),J=z+Xr(B.lat,0),te=s.af(J-G);let re;if(typeof i.minZoom=="number"){const ie=+i.minZoom+Xr(B.lat,0),de=Math.min(ie,G,J)+Xr(0,B.lat),me=e.getConstrained(B,de).zoom+Xr(B.lat,0);re=s.af(me-G)}const ne=s.bA(p.lng,B.lng),ce=s.bA(p.lat,B.lat);return{easeFunc:(ie,de,me,se)=>{const _e=Lc(p,ne,ce,me);M&&e.interpolatePadding(x,i.padding,ie);const Ee=ie===1?B:_e;e.setCenter(Ee.wrap());const Me=G+s.ak(de);e.setZoom(ie===1?z:Me+Xr(0,Ee.lat))},scaleOfZoom:te,targetCenter:B,scaleOfMinZoom:re,pixelPathLength:O}}static solveVectorScale(e,i,u,p,g){const x=p==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],M=[u[3],u[7],u[11],u[15]],k=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],z=e[0]*M[0]+e[1]*M[1]+e[2]*M[2],R=i[0]*x[0]+i[1]*x[1]+i[2]*x[2],j=i[0]*M[0]+i[1]*M[1]+i[2]*M[2];return R+g*z===k+g*j||M[3]*(k-R)+x[3]*(j-z)+k*j==R*z?null:(R+x[3]-g*j-g*M[3])/(R-k-g*j+g*z)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class tp{constructor(e){this._globe=e,this._mercatorCameraHelper=new Zn,this._verticalPerspectiveCameraHelper=new On}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,u){this.currentHelper.handleMapControlsPan(e,i,u)}cameraForBoxAndBearing(e,i,u,p,g){return this.currentHelper.cameraForBoxAndBearing(e,i,u,p,g)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Gu=(m,e)=>s.y(m,e&&e.filter((i=>i.identifier!=="source.canvas"))),Gp=s.bE();class Dc extends s.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const p=this.sourceCaches[u].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Qt(mr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((u,p)=>this.getGlyphs(u,p))),this.dispatcher.registerMessageHandler("GI",((u,p)=>this.getImages(u,p))),this.imageManager=new Ft,this.imageManager.setEventedParent(this),this.glyphManager=new yr(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new Xo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",s.bG()),Ba().on(Zo,this._rtlPluginLoaded),this.on("data",(u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const p=this.sourceCaches[u.sourceId];if(!p)return;const g=p.getSource();if(g&&g.vectorLayerIds)for(const x in this._layers){const M=this._layers[x];M.source===g.id&&this._validateLayer(M)}}))}setGlobalStateProperty(e,i){var u,p,g;this._checkLoaded();const x=i===null?(g=(p=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||p===void 0?void 0:p.default)!==null&&g!==void 0?g:null:i;if(s.bH(x,this._globalState[e]))return this;this._globalState[e]=x;const M=this._findGlobalStateAffectedSources([e]);for(const k in this.sourceCaches)M.has(k)&&(this._reloadSource(k),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const i=[];for(const p in e)!s.bH(this._globalState[p],e[p].default)&&(i.push(p),this._globalState[p]=e[p].default);const u=this._findGlobalStateAffectedSources(i);for(const p in this.sourceCaches)u.has(p)&&(this._reloadSource(p),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const i=new Set;for(const u in this._layers){const p=this._layers[u],g=p.getLayoutAffectingGlobalStateRefs();for(const x of e)g.has(x)&&i.add(p.source)}return i}loadURL(e,i={},u){this.fire(new s.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;s.j(p,this._loadStyleRequest).then((x=>{this._loadStyleRequest=null,this._load(x.data,i,u)})).catch((x=>{this._loadStyleRequest=null,x&&!g.signal.aborted&&this.fire(new s.k(x))}))}loadJSON(e,i={},u){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,le.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,u)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(Gp,{validate:!1})}_load(e,i,u){var p,g,x;const M=i.transformStyle?i.transformStyle(u,e):e;if(!i.validate||!Gu(this,s.z(M))){this._loaded=!0,this.stylesheet=M;for(const k in M.sources)this.addSource(k,M.sources[k],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new qr(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new yt(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.setGlobalState((x=this.stylesheet.state)!==null&&x!==void 0?x:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){const e=s.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((i=>i.id)),this._layers={},this._serializedLayers=null;for(const i of e){const u=s.bJ(i);u.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=u}}_loadSprite(e,i=!1,u=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,x,M,k){return s._(this,void 0,void 0,(function*(){const z=Ue(g),R=M>1?"@2x":"",j={},B={};for(const{id:O,url:G}of z){const J=x.transformRequest(pt(G,R,".json"),"SpriteJSON");j[O]=s.j(J,k);const te=x.transformRequest(pt(G,R,".png"),"SpriteImage");B[O]=Le.getImage(te,k)}return yield Promise.all([...Object.values(j),...Object.values(B)]),(function(O,G){return s._(this,void 0,void 0,(function*(){const J={};for(const te in O){J[te]={};const re=le.getImageCanvasContext((yield G[te]).data),ne=(yield O[te]).data;for(const ce in ne){const{width:ie,height:de,x:me,y:se,sdf:_e,pixelRatio:Ee,stretchX:Me,stretchY:ke,content:De,textFitWidth:tt,textFitHeight:it}=ne[ce];J[te][ce]={data:null,pixelRatio:Ee,sdf:_e,stretchX:Me,stretchY:ke,content:De,textFitWidth:tt,textFitHeight:it,spriteData:{width:ie,height:de,x:me,y:se,context:re}}}}return J}))})(j,B)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const x in g){this._spritesImagesIds[x]=[];const M=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter((k=>!(k in g))):[];for(const k of M)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in g[x]){const z=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,g[x][k],!1):this.imageManager.addImage(z,g[x][k]),i&&(this._changedImages[z]=!0)}}})).catch((g=>{this._spriteRequest=null,p=g,this.fire(new s.k(p))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),u&&u(p)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const u=e.sourceLayer;if(!u)return;const p=i.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.k(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?s.bK(u):u);const p=[];for(const g of e)if(u[g]){const x=i?s.bK(u[g]):u[g];p.push(x)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const u of i){const p=this._layers[u];p.type!=="custom"&&(e[u]=p.serialize())}return e}hasTransitions(){var e,i,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const x in this._updatedSources){const M=this._updatedSources[x];if(M==="reload")this._reloadSource(x);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];u[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in u){const g=this.sourceCaches[p];!!u[p]!=!!g.used&&g.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var u;this._checkLoaded();const p=this.serialize();if(e=i.transformStyle?i.transformStyle(p,e):e,((u=i.validate)===null||u===void 0||u)&&Gu(this,s.z(e)))return!1;(e=s.bK(e)).layers=s.bI(e.layers);const g=s.bL(p,e),x=this._getOperationsToPerform(g);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const M of x.operations)M();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],u=[];for(const p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":i.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":i.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":i.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":i.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":i.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":i.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":i.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":i.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":i.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":i.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":i.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":i.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":i.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":i.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":i.push((()=>{}));break;default:u.push(p.command)}return{operations:i,unimplemented:u}}addImage(e,i){if(this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(s.z.source,`sources.${e}`,i,null,u))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const p=this.sourceCaches[e]=new rr(e,i,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e}))),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new s.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,u={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new s.k(new Error(`Layer "${p}" already exists on this map.`)));let g;if(e.type==="custom"){if(Gu(this,s.bM(e)))return;g=s.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=s.bK(e),e=s.e(e,{source:p})),this._validate(s.z.layer,`layers.${p}`,e,{arrayIndex:-1},u))return;g=s.bJ(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}const x=i?this._order.indexOf(i):this._order.length;if(i&&x===-1)this.fire(new s.k(new Error(`Cannot add layer "${p}" before non-existing layer "${i}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const M=this._removedLayers[p];delete this._removedLayers[p],M.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new s.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const u=this._order.indexOf(e);this._order.splice(u,1);const p=i?this._order.indexOf(i):this._order.length;i&&p===-1?this.fire(new s.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,u){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===i&&p.maxzoom===u||(i!=null&&(p.minzoom=i),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,u={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!s.bH(p.filter,i))return i==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(s.z.filter,`layers.${p.id}.filter`,i,null,u)||(p.setFilter(s.bK(i)),this._updateLayer(p)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return s.bK(this.getLayer(e).filter)}setLayoutProperty(e,i,u,p={}){this._checkLoaded();const g=this.getLayer(e);g?s.bH(g.getLayoutProperty(i),u)||(g.setLayoutProperty(i,u,p),this._updateLayer(g)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const u=this.getLayer(e);if(u)return u.getLayoutProperty(i);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,u,p={}){this._checkLoaded();const g=this.getLayer(e);g?s.bH(g.getPaintProperty(i),u)||(g.setPaintProperty(i,u,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const u=e.source,p=e.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&p?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,e.id,i)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const u=e.source,p=this.sourceCaches[u];if(p===void 0)return void this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)));const g=p.getSource().type,x=g==="vector"?e.sourceLayer:void 0;g!=="vector"||x?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,e.id,i):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,u=e.sourceLayer,p=this.sourceCaches[i];if(p!==void 0)return p.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,e.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=s.bN(this.sourceCaches,(g=>g.serialize())),i=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,p=this.stylesheet;return s.bO({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:e,layers:i,terrain:u},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=x=>this._layers[x].type==="fill-extrusion",u={},p=[];for(let x=this._order.length-1;x>=0;x--){const M=this._order[x];if(i(M)){u[M]=x;for(const k of e){const z=k[M];if(z)for(const R of z)p.push(R)}}}p.sort(((x,M)=>M.intersectionZ-x.intersectionZ));const g=[];for(let x=this._order.length-1;x>=0;x--){const M=this._order[x];if(i(M))for(let k=p.length-1;k>=0;k--){const z=p[k].feature;if(u[z.layer.id]<x)break;g.push(z),p.pop()}else for(const k of e){const z=k[M];if(z)for(const R of z)g.push(R.feature)}}return g}queryRenderedFeatures(e,i,u){i&&i.filter&&this._validate(s.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);const p={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of i.layers){const R=this._layers[z];if(!R)return this.fire(new s.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];p[R.source]=!0}}const g=[];i.availableImages=this._availableImages;const x=this._serializedAllLayers(),M=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,k=Object.assign(Object.assign({},i),{layers:M});for(const z in this.sourceCaches)i.layers&&!p[z]||g.push(wr(this.sourceCaches[z],this._layers,x,e,k,u,this.map.terrain?(R,j,B)=>this.map.terrain.getElevation(R,j,B):void 0));return this.placement&&g.push((function(z,R,j,B,O,G,J){const te={},re=G.queryRenderedSymbols(B),ne=[];for(const ce of Object.keys(re).map(Number))ne.push(J[ce]);ne.sort(Bn);for(const ce of ne){const ie=ce.featureIndex.lookupSymbolFeatures(re[ce.bucketInstanceId],R,ce.bucketIndex,ce.sourceLayerIndex,O.filter,O.layers,O.availableImages,z);for(const de in ie){const me=te[de]=te[de]||[],se=ie[de];se.sort(((_e,Ee)=>{const Me=ce.featureSortOrder;if(Me){const ke=Me.indexOf(_e.featureIndex);return Me.indexOf(Ee.featureIndex)-ke}return Ee.featureIndex-_e.featureIndex}));for(const _e of se)me.push(_e)}}return(function(ce,ie,de){for(const me in ce)for(const se of ce[me])io(se,de[ie[me].source]);return ce})(te,z,j)})(this._layers,x,this.sourceCaches,e,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,i){i&&i.filter&&this._validate(s.z.filter,"querySourceFeatures.filter",i.filter,null,i);const u=this.sourceCaches[e];return u?(function(p,g){const x=p.getRenderableIds().map((z=>p.getTileByID(z))),M=[],k={};for(let z=0;z<x.length;z++){const R=x[z],j=R.tileID.canonical.key;k[j]||(k[j]=!0,R.querySourceFeatures(M,g))}return M})(u,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const x in e)if(!s.bH(e[x],u[x])){p=!0;break}if(!p)return;const g={now:le.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const u=this.getSky();let p=!1;if(!e&&!u)return;if(e&&!u)p=!0;else if(!e&&u)p=!0;else for(const x in e)if(!s.bH(e[x],u[x])){p=!0;break}if(!p)return;const g={now:le.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(g)}_setProjectionInternal(e){const i=(function(u){if(Array.isArray(u)){const p=new pl({type:u});return{projection:p,transform:new ru,cameraHelper:new tp(p)}}switch(u){case"mercator":return{projection:new tr,transform:new Zr,cameraHelper:new Zn};case"globe":{const p=new pl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:p,transform:new ru,cameraHelper:new tp(p)}}case"vertical-perspective":return{projection:new hl,transform:new tu,cameraHelper:new On};default:return s.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new tr,transform:new Zr,cameraHelper:new Zn}}})(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,i,u,p,g={}){return(!g||g.validate!==!1)&&Gu(this,e.call(s.z,s.e({key:i,style:this.serialize(),value:u,styleSpec:s.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ba().off(Zo,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const u=this.sourceCaches[i];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,u,p,g=!1){let x=!1,M=!1;const k={};for(const z of this._order){const R=this._layers[z];if(R.type!=="symbol")continue;if(!k[R.source]){const B=this.sourceCaches[R.source];k[R.source]=B.getRenderableIds(!0).map((O=>B.getTileByID(O))).sort(((O,G)=>G.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(G.tileID)?-1:1)))}const j=this.crossTileSymbolIndex.addLayer(R,k[R.source],e.center.lng);x=x||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(le.now(),e.zoom))&&(this.pauseablePlacement=new Jl(e,this.map.terrain,this._order,g,i,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(le.now()),M=!0),x&&this.pauseablePlacement.placement.setStale()),M||x)for(const z of this._order){const R=this._layers[z];R.type==="symbol"&&this.placement.updateLayerOpacities(R,k[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(le.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return s._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[i.source];return p&&p.setDependencies(i.tileID.key,i.type,i.icons),u}))}getGlyphs(e,i){return s._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(i.stacks),p=this.sourceCaches[i.source];return p&&p.setDependencies(i.tileID.key,i.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(s.z.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,u={},p){this._checkLoaded();const g=[{id:e,url:i}],x=[...Ue(this.stylesheet.sprite),...g];this._validate(s.z.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,p))}removeSprite(e){this._checkLoaded();const i=Ue(this.stylesheet.sprite);if(i.find((u=>u.id===e))){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;i.splice(i.findIndex((u=>u.id===e)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ue(this.stylesheet.sprite)}setSprite(e,i={},u){this._checkLoaded(),e&&this._validate(s.z.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Zp=s.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class rp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,u,p,g,x,M,k,z){this.context=e;let R=this.boundPaintVertexBuffers.length!==p.length;for(let j=0;!R&&j<p.length;j++)this.boundPaintVertexBuffers[j]!==p[j]&&(R=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==u||R||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==z?this.freshBind(i,u,p,g,x,M,k,z):(e.bindVertexArray.set(this.vao),M&&M.bind(),g&&g.dynamicDraw&&g.bind(),k&&k.bind(),z&&z.bind())}freshBind(e,i,u,p,g,x,M,k){const z=e.numAttributes,R=this.context,j=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=k,i.enableAttributes(j,e);for(const B of u)B.enableAttributes(j,e);x&&x.enableAttributes(j,e),M&&M.enableAttributes(j,e),k&&k.enableAttributes(j,e),i.bind(),i.setVertexAttribPointers(j,e,g);for(const B of u)B.bind(),B.setVertexAttribPointers(j,e,g);x&&(x.bind(),x.setVertexAttribPointers(j,e,g)),p&&p.bind(),M&&(M.bind(),M.setVertexAttribPointers(j,e,g)),k&&(k.bind(),k.setVertexAttribPointers(j,e,g)),R.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Zu=(m,e,i,u,p)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):s.bf.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:i?i.calculateFogBlendOpacity(u):0,u_horizon_color:i?i.properties.get("horizon-color"):s.bf.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),Nc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ps(m){const e=[];for(let i=0;i<m.length;i++){if(m[i]===null)continue;const u=m[i].split(" ");e.push(u.pop())}return e}class Fc{constructor(e,i,u,p,g,x,M,k,z=[]){const R=e.gl;this.program=R.createProgram();const j=Ps(i.staticAttributes),B=u?u.getBinderAttributes():[],O=j.concat(B),G=na.prelude.staticUniforms?Ps(na.prelude.staticUniforms):[],J=M.staticUniforms?Ps(M.staticUniforms):[],te=i.staticUniforms?Ps(i.staticUniforms):[],re=u?u.getBinderUniforms():[],ne=G.concat(J).concat(te).concat(re),ce=[];for(const Me of ne)ce.indexOf(Me)<0&&ce.push(Me);const ie=u?u.defines():[];$a(R)&&ie.unshift("#version 300 es"),g&&ie.push("#define OVERDRAW_INSPECTOR;"),x&&ie.push("#define TERRAIN3D;"),k&&ie.push(k),z&&ie.push(...z);let de=ie.concat(na.prelude.fragmentSource,M.fragmentSource,i.fragmentSource).join(`
`),me=ie.concat(na.prelude.vertexSource,M.vertexSource,i.vertexSource).join(`
`);$a(R)||(de=(function(Me){return Me.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(de),me=(function(Me){return Me.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(me));const se=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(se,de),R.compileShader(se),!R.getShaderParameter(se,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(se)}`);R.attachShader(this.program,se);const _e=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(_e,me),R.compileShader(_e),!R.getShaderParameter(_e,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(_e)}`);R.attachShader(this.program,_e),this.attributes={};const Ee={};this.numAttributes=O.length;for(let Me=0;Me<this.numAttributes;Me++)O[Me]&&(R.bindAttribLocation(this.program,Me,O[Me]),this.attributes[O[Me]]=Me);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(_e),R.deleteShader(se);for(let Me=0;Me<ce.length;Me++){const ke=ce[Me];if(ke&&!Ee[ke]){const De=R.getUniformLocation(this.program,ke);De&&(Ee[ke]=De)}}this.fixedUniforms=p(e,Ee),this.terrainUniforms=((Me,ke)=>({u_depth:new s.bP(Me,ke.u_depth),u_terrain:new s.bP(Me,ke.u_terrain),u_terrain_dim:new s.bg(Me,ke.u_terrain_dim),u_terrain_matrix:new s.bR(Me,ke.u_terrain_matrix),u_terrain_unpack:new s.bS(Me,ke.u_terrain_unpack),u_terrain_exaggeration:new s.bg(Me,ke.u_terrain_exaggeration)}))(e,Ee),this.projectionUniforms=((Me,ke)=>({u_projection_matrix:new s.bR(Me,ke.u_projection_matrix),u_projection_tile_mercator_coords:new s.bS(Me,ke.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bS(Me,ke.u_projection_clipping_plane),u_projection_transition:new s.bg(Me,ke.u_projection_transition),u_projection_fallback_matrix:new s.bR(Me,ke.u_projection_fallback_matrix)}))(e,Ee),this.binderUniforms=u?u.getUniforms(e,Ee):[]}draw(e,i,u,p,g,x,M,k,z,R,j,B,O,G,J,te,re,ne,ce){const ie=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(p),e.setColorMode(g),e.setCullFace(x),k){e.activeTexture.set(ie.TEXTURE2),ie.bindTexture(ie.TEXTURE_2D,k.depthTexture),e.activeTexture.set(ie.TEXTURE3),ie.bindTexture(ie.TEXTURE_2D,k.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(k[me])}if(z)for(const me in z)this.projectionUniforms[Nc[me]].set(z[me]);if(M)for(const me in this.fixedUniforms)this.fixedUniforms[me].set(M[me]);te&&te.setUniforms(e,this.binderUniforms,G,{zoom:J});let de=0;switch(i){case ie.LINES:de=2;break;case ie.TRIANGLES:de=3;break;case ie.LINE_STRIP:de=1}for(const me of O.get()){const se=me.vaos||(me.vaos={});(se[R]||(se[R]=new rp)).bind(e,this,j,te?te.getPaintVertexBuffers():[],B,me.vertexOffset,re,ne,ce),ie.drawElements(i,me.primitiveLength*de,ie.UNSIGNED_SHORT,me.primitiveOffset*de*2)}}}function fl(m,e,i){const u=1/s.aC(i,1,e.transform.tileZoom),p=Math.pow(2,i.tileID.overscaledZ),g=i.tileSize*Math.pow(2,e.transform.tileZoom)/p,x=g*(i.tileID.canonical.x+i.tileID.wrap*p),M=g*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,M>>16],u_pixel_coord_lower:[65535&x,65535&M]}}const xa=(m,e,i,u)=>{const p=m.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],M=s.bV();p.properties.get("anchor")==="viewport"&&s.bW(M,m.transform.bearingInRadians),s.bX(x,x,M);const k=m.transform.transformLightDirection(x),z=p.properties.get("color");return{u_lightpos:x,u_lightpos_globe:k,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:u}},Hp=(m,e,i,u,p,g,x)=>s.e(xa(m,e,i,u),fl(g,m,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),Hu=(m,e,i,u)=>s.e(fl(e,m,i),{u_fill_translate:u}),ml=(m,e)=>({u_world:m,u_fill_translate:e}),nu=(m,e,i,u,p)=>s.e(Hu(m,e,i,p),{u_world:u}),Wp=(m,e,i,u,p)=>{const g=m.transform;let x,M,k=0;if(i.paint.get("circle-pitch-alignment")==="map"){const z=s.aC(e,1,g.zoom);x=!0,M=[z,z],k=z/(s.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*p}else x=!1,M=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:k,u_translate:u}},Wu=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Xp=m=>({u_viewport_size:[m.width,m.height]}),Ms=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),np=(m,e,i,u)=>{const p=s.aC(m,1,e)/(s.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:s.aC(m,1,e),u_intensity:i,u_globe_extrude_scale:p}},Bc=(m,e,i,u)=>{const p=s.L();s.bY(p,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:p,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:i,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},jc=(m,e,i)=>{const u=i.paint.get("hillshade-accent-color");let p;switch(i.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const g=i.getIlluminationProperties();for(let x=0;x<g.directionRadians.length;x++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[x]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Oc(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:u,u_method:p,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},gl=(m,e)=>{const i=e.stride,u=s.L();return s.bY(u,0,s.$,-s.$,0,0,1),s.M(u,u,[0,-s.$,0]),{u_matrix:u,u_image:1,u_dimension:[i,i],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Oc(m,e){const i=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new s.a1(0,u/i).toLngLat().lat,new s.a1(0,(u+1)/i).toLngLat().lat]}const Uc=(m,e,i=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:i,u_opacity:m.paint.get("color-relief-opacity")}),iu=(m,e,i,u)=>{const p=m.transform;return{u_translation:qc(m,e,i),u_ratio:u/s.aC(e,1,p.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Vc=(m,e,i,u,p)=>s.e(iu(m,e,i,u),{u_image:0,u_image_height:p}),$c=(m,e,i,u,p)=>{const g=m.transform,x=rs(e,g);return{u_translation:qc(m,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:u/s.aC(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ts=(m,e,i,u,p,g)=>{const x=m.lineAtlas,M=rs(e,m.transform),k=i.layout.get("line-cap")==="round",z=x.getDash(p.from,k),R=x.getDash(p.to,k),j=z.width*g.fromScale,B=R.width*g.toScale;return s.e(iu(m,e,i,u),{u_patternscale_a:[M/j,-z.height/2],u_patternscale_b:[M/B,-R.height/2],u_sdfgamma:x.width/(256*Math.min(j,B)*m.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:R.y,u_mix:g.t})};function rs(m,e){return 1/s.aC(m,1,e.tileZoom)}function qc(m,e,i){return s.aD(m.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const au=(m,e,i,u,p)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=u.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Kp(u.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var g,x};function Kp(m){m*=Math.PI/180;const e=Math.sin(m),i=Math.cos(m);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const yl=(m,e,i,u,p,g,x,M,k,z,R,j,B)=>{const O=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:O.width/O.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:k,u_is_text:+R,u_pitch_with_map:+u,u_is_along_line:p,u_is_variable_anchor:g,u_texsize:j,u_texture:0,u_translation:z,u_pitched_scale:B}},Gc=(m,e,i,u,p,g,x,M,k,z,R,j,B,O)=>{const G=x.transform;return s.e(yl(m,e,i,u,p,g,x,M,k,z,R,j,O),{u_gamma_scale:u?Math.cos(G.pitch*Math.PI/180)*G.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},ou=(m,e,i,u,p,g,x,M,k,z,R,j,B)=>s.e(Gc(m,e,i,u,p,g,x,M,k,z,!0,R,0,B),{u_texsize_icon:j,u_texture_icon:1}),_l=(m,e)=>({u_opacity:m,u_color:e}),ip=(m,e,i,u,p)=>s.e((function(g,x,M,k){const z=M.imageManager.getPattern(g.from.toString()),R=M.imageManager.getPattern(g.to.toString()),{width:j,height:B}=M.imageManager.getPixelSize(),O=Math.pow(2,k.tileID.overscaledZ),G=k.tileSize*Math.pow(2,M.transform.tileZoom)/O,J=G*(k.tileID.canonical.x+k.tileID.wrap*O),te=G*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,B],u_mix:x.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/s.aC(k,1,M.transform.tileZoom),u_pixel_coord_upper:[J>>16,te>>16],u_pixel_coord_lower:[65535&J,65535&te]}})(i,p,e,u),{u_opacity:m}),vl=(m,e)=>{},Zc={fillExtrusion:(m,e)=>({u_lightpos:new s.bT(m,e.u_lightpos),u_lightpos_globe:new s.bT(m,e.u_lightpos_globe),u_lightintensity:new s.bg(m,e.u_lightintensity),u_lightcolor:new s.bT(m,e.u_lightcolor),u_vertical_gradient:new s.bg(m,e.u_vertical_gradient),u_opacity:new s.bg(m,e.u_opacity),u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new s.bT(m,e.u_lightpos),u_lightpos_globe:new s.bT(m,e.u_lightpos_globe),u_lightintensity:new s.bg(m,e.u_lightintensity),u_lightcolor:new s.bT(m,e.u_lightcolor),u_vertical_gradient:new s.bg(m,e.u_vertical_gradient),u_height_factor:new s.bg(m,e.u_height_factor),u_opacity:new s.bg(m,e.u_opacity),u_fill_translate:new s.bU(m,e.u_fill_translate),u_image:new s.bP(m,e.u_image),u_texsize:new s.bU(m,e.u_texsize),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new s.bP(m,e.u_image),u_texsize:new s.bU(m,e.u_texsize),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade),u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new s.bU(m,e.u_world),u_fill_translate:new s.bU(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new s.bU(m,e.u_world),u_image:new s.bP(m,e.u_image),u_texsize:new s.bU(m,e.u_texsize),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade),u_fill_translate:new s.bU(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_scale_with_map:new s.bP(m,e.u_scale_with_map),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_extrude_scale:new s.bU(m,e.u_extrude_scale),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new s.bg(m,e.u_globe_extrude_scale),u_translate:new s.bU(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new s.bU(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new s.bU(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new s.bQ(m,e.u_color),u_overlay:new s.bP(m,e.u_overlay),u_overlay_scale:new s.bg(m,e.u_overlay_scale)}),depth:vl,clippingMask:vl,heatmap:(m,e)=>({u_extrude_scale:new s.bg(m,e.u_extrude_scale),u_intensity:new s.bg(m,e.u_intensity),u_globe_extrude_scale:new s.bg(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new s.bR(m,e.u_matrix),u_world:new s.bU(m,e.u_world),u_image:new s.bP(m,e.u_image),u_color_ramp:new s.bP(m,e.u_color_ramp),u_opacity:new s.bg(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new s.bP(m,e.u_image),u_latrange:new s.bU(m,e.u_latrange),u_exaggeration:new s.bg(m,e.u_exaggeration),u_altitudes:new s.b_(m,e.u_altitudes),u_azimuths:new s.b_(m,e.u_azimuths),u_accent:new s.bQ(m,e.u_accent),u_method:new s.bP(m,e.u_method),u_shadows:new s.bZ(m,e.u_shadows),u_highlights:new s.bZ(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new s.bR(m,e.u_matrix),u_image:new s.bP(m,e.u_image),u_dimension:new s.bU(m,e.u_dimension),u_zoom:new s.bg(m,e.u_zoom),u_unpack:new s.bS(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new s.bP(m,e.u_image),u_unpack:new s.bS(m,e.u_unpack),u_dimension:new s.bU(m,e.u_dimension),u_elevation_stops:new s.bP(m,e.u_elevation_stops),u_color_stops:new s.bP(m,e.u_color_stops),u_color_ramp_size:new s.bP(m,e.u_color_ramp_size),u_opacity:new s.bg(m,e.u_opacity)}),line:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels),u_image:new s.bP(m,e.u_image),u_image_height:new s.bg(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_texsize:new s.bU(m,e.u_texsize),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_image:new s.bP(m,e.u_image),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels),u_scale:new s.bT(m,e.u_scale),u_fade:new s.bg(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new s.bU(m,e.u_translation),u_ratio:new s.bg(m,e.u_ratio),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(m,e.u_units_to_pixels),u_patternscale_a:new s.bU(m,e.u_patternscale_a),u_patternscale_b:new s.bU(m,e.u_patternscale_b),u_sdfgamma:new s.bg(m,e.u_sdfgamma),u_image:new s.bP(m,e.u_image),u_tex_y_a:new s.bg(m,e.u_tex_y_a),u_tex_y_b:new s.bg(m,e.u_tex_y_b),u_mix:new s.bg(m,e.u_mix)}),raster:(m,e)=>({u_tl_parent:new s.bU(m,e.u_tl_parent),u_scale_parent:new s.bg(m,e.u_scale_parent),u_buffer_scale:new s.bg(m,e.u_buffer_scale),u_fade_t:new s.bg(m,e.u_fade_t),u_opacity:new s.bg(m,e.u_opacity),u_image0:new s.bP(m,e.u_image0),u_image1:new s.bP(m,e.u_image1),u_brightness_low:new s.bg(m,e.u_brightness_low),u_brightness_high:new s.bg(m,e.u_brightness_high),u_saturation_factor:new s.bg(m,e.u_saturation_factor),u_contrast_factor:new s.bg(m,e.u_contrast_factor),u_spin_weights:new s.bT(m,e.u_spin_weights),u_coords_top:new s.bS(m,e.u_coords_top),u_coords_bottom:new s.bS(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new s.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(m,e.u_is_size_feature_constant),u_size_t:new s.bg(m,e.u_size_t),u_size:new s.bg(m,e.u_size),u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_pitch:new s.bg(m,e.u_pitch),u_rotate_symbol:new s.bP(m,e.u_rotate_symbol),u_aspect_ratio:new s.bg(m,e.u_aspect_ratio),u_fade_change:new s.bg(m,e.u_fade_change),u_label_plane_matrix:new s.bR(m,e.u_label_plane_matrix),u_coord_matrix:new s.bR(m,e.u_coord_matrix),u_is_text:new s.bP(m,e.u_is_text),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_is_along_line:new s.bP(m,e.u_is_along_line),u_is_variable_anchor:new s.bP(m,e.u_is_variable_anchor),u_texsize:new s.bU(m,e.u_texsize),u_texture:new s.bP(m,e.u_texture),u_translation:new s.bU(m,e.u_translation),u_pitched_scale:new s.bg(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new s.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(m,e.u_is_size_feature_constant),u_size_t:new s.bg(m,e.u_size_t),u_size:new s.bg(m,e.u_size),u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_pitch:new s.bg(m,e.u_pitch),u_rotate_symbol:new s.bP(m,e.u_rotate_symbol),u_aspect_ratio:new s.bg(m,e.u_aspect_ratio),u_fade_change:new s.bg(m,e.u_fade_change),u_label_plane_matrix:new s.bR(m,e.u_label_plane_matrix),u_coord_matrix:new s.bR(m,e.u_coord_matrix),u_is_text:new s.bP(m,e.u_is_text),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_is_along_line:new s.bP(m,e.u_is_along_line),u_is_variable_anchor:new s.bP(m,e.u_is_variable_anchor),u_texsize:new s.bU(m,e.u_texsize),u_texture:new s.bP(m,e.u_texture),u_gamma_scale:new s.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_is_halo:new s.bP(m,e.u_is_halo),u_translation:new s.bU(m,e.u_translation),u_pitched_scale:new s.bg(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new s.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(m,e.u_is_size_feature_constant),u_size_t:new s.bg(m,e.u_size_t),u_size:new s.bg(m,e.u_size),u_camera_to_center_distance:new s.bg(m,e.u_camera_to_center_distance),u_pitch:new s.bg(m,e.u_pitch),u_rotate_symbol:new s.bP(m,e.u_rotate_symbol),u_aspect_ratio:new s.bg(m,e.u_aspect_ratio),u_fade_change:new s.bg(m,e.u_fade_change),u_label_plane_matrix:new s.bR(m,e.u_label_plane_matrix),u_coord_matrix:new s.bR(m,e.u_coord_matrix),u_is_text:new s.bP(m,e.u_is_text),u_pitch_with_map:new s.bP(m,e.u_pitch_with_map),u_is_along_line:new s.bP(m,e.u_is_along_line),u_is_variable_anchor:new s.bP(m,e.u_is_variable_anchor),u_texsize:new s.bU(m,e.u_texsize),u_texsize_icon:new s.bU(m,e.u_texsize_icon),u_texture:new s.bP(m,e.u_texture),u_texture_icon:new s.bP(m,e.u_texture_icon),u_gamma_scale:new s.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new s.bg(m,e.u_device_pixel_ratio),u_is_halo:new s.bP(m,e.u_is_halo),u_translation:new s.bU(m,e.u_translation),u_pitched_scale:new s.bg(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new s.bg(m,e.u_opacity),u_color:new s.bQ(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new s.bg(m,e.u_opacity),u_image:new s.bP(m,e.u_image),u_pattern_tl_a:new s.bU(m,e.u_pattern_tl_a),u_pattern_br_a:new s.bU(m,e.u_pattern_br_a),u_pattern_tl_b:new s.bU(m,e.u_pattern_tl_b),u_pattern_br_b:new s.bU(m,e.u_pattern_br_b),u_texsize:new s.bU(m,e.u_texsize),u_mix:new s.bg(m,e.u_mix),u_pattern_size_a:new s.bU(m,e.u_pattern_size_a),u_pattern_size_b:new s.bU(m,e.u_pattern_size_b),u_scale_a:new s.bg(m,e.u_scale_a),u_scale_b:new s.bg(m,e.u_scale_b),u_pixel_coord_upper:new s.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bg(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new s.bP(m,e.u_texture),u_ele_delta:new s.bg(m,e.u_ele_delta),u_fog_matrix:new s.bR(m,e.u_fog_matrix),u_fog_color:new s.bQ(m,e.u_fog_color),u_fog_ground_blend:new s.bg(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bg(m,e.u_fog_ground_blend_opacity),u_horizon_color:new s.bQ(m,e.u_horizon_color),u_horizon_fog_blend:new s.bg(m,e.u_horizon_fog_blend),u_is_globe_mode:new s.bg(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new s.bg(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new s.bP(m,e.u_texture),u_terrain_coords_id:new s.bg(m,e.u_terrain_coords_id),u_ele_delta:new s.bg(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new s.bg(m,e.u_input),u_output_expected:new s.bg(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new s.bT(m,e.u_sun_pos),u_atmosphere_blend:new s.bg(m,e.u_atmosphere_blend),u_globe_position:new s.bT(m,e.u_globe_position),u_globe_radius:new s.bg(m,e.u_globe_radius),u_inv_proj_matrix:new s.bR(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new s.bQ(m,e.u_sky_color),u_horizon_color:new s.bQ(m,e.u_horizon_color),u_horizon:new s.bU(m,e.u_horizon),u_horizon_normal:new s.bU(m,e.u_horizon_normal),u_sky_horizon_blend:new s.bg(m,e.u_sky_horizon_blend),u_sky_blend:new s.bg(m,e.u_sky_blend)})};class Hc{constructor(e,i,u){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ba{constructor(e,i,u,p){this.length=i.length,this.attributes=u,this.itemSize=i.bytesPerElement,this.dynamicDraw=p,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let u=0;u<this.attributes.length;u++){const p=i.attributes[this.attributes[u].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,i,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=i.attributes[g.name];x!==void 0&&e.vertexAttribPointer(x,g.components,e[xl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class br{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xu extends br{getDefault(){return s.bf.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ku extends br{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ap extends br{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Wc extends br{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ks extends br{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Xc extends br{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Yp extends br{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class wa extends br{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class su extends br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class op extends br{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Kc extends br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class sp extends br{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Yc extends br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class bl extends br{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Yu extends br{getDefault(){return s.bf.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ju extends br{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ns extends br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class go extends br{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class yo extends br{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class is extends br{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Oi extends br{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class lu extends br{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Es extends br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class uu extends br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class as extends br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Is extends br{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class cu extends br{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class wl extends br{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const u=this.gl;$a(u)?u.bindVertexArray(e):(i=u.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class hu extends br{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Jc extends br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class As extends br{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class _o extends br{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class vo extends _o{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class pu extends _o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class sr extends _o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const du="Framebuffer is not complete";class Jp{constructor(e,i,u,p,g){this.context=e,this.width=i,this.height=u;const x=e.gl,M=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new vo(e,M),p)this.depthAttachment=g?new sr(e,M):new pu(e,M);else if(g)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(du)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Sl{constructor(e){var i,u;if(this.gl=e,this.clearColor=new Xu(this),this.clearDepth=new Ku(this),this.clearStencil=new ap(this),this.colorMask=new Wc(this),this.depthMask=new ks(this),this.stencilMask=new Xc(this),this.stencilFunc=new Yp(this),this.stencilOp=new wa(this),this.stencilTest=new su(this),this.depthRange=new op(this),this.depthTest=new Kc(this),this.depthFunc=new sp(this),this.blend=new Yc(this),this.blendFunc=new bl(this),this.blendColor=new Yu(this),this.blendEquation=new Ju(this),this.cullFace=new ns(this),this.cullFaceSide=new go(this),this.frontFace=new yo(this),this.program=new is(this),this.activeTexture=new Oi(this),this.viewport=new lu(this),this.bindFramebuffer=new Es(this),this.bindRenderbuffer=new uu(this),this.bindTexture=new as(this),this.bindVertexBuffer=new Is(this),this.bindElementBuffer=new cu(this),this.bindVertexArray=new wl(this),this.pixelStoreUnpack=new hu(this),this.pixelStoreUnpackPremultiplyAlpha=new Jc(this),this.pixelStoreUnpackFlipY=new As(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),$a(e)){this.HALF_FLOAT=e.HALF_FLOAT;const p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:p?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new Hc(this,e,i)}createVertexBuffer(e,i,u){return new ba(this,e,i,u)}createRenderbuffer(e,i,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,e,i,u),this.bindRenderbuffer.set(null),g}createFramebuffer(e,i,u,p){return new Jp(this,e,i,u,p)}clear({color:e,depth:i,stencil:u}){const p=this.gl;let g=0;e&&(g|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(g|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),u!==void 0&&(g|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){s.bH(e.blendFunction,$r.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return $a(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return $a(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let os;function Qc(m,e,i,u,p){const g=m.context,x=m.transform,M=g.gl,k=m.useProgram("collisionBox"),z=[];let R=0,j=0;for(let re=0;re<u.length;re++){const ne=u[re],ce=e.getTile(ne).getBucket(i);if(!ce)continue;const ie=p?ce.textCollisionBox:ce.iconCollisionBox,de=ce.collisionCircleArray;de.length>0&&(z.push({circleArray:de,circleOffset:j,coord:ne}),R+=de.length/4,j=R),ie&&k.draw(g,M.LINES,Ut.disabled,or.disabled,m.colorModeForRenderPass(),Bt.disabled,Wu(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne),x.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,null,m.transform.zoom,null,null,ie.collisionVertexBuffer)}if(!p||!z.length)return;const B=m.useProgram("collisionCircle"),O=new s.b$;O.resize(4*R),O._trim();let G=0;for(const re of z)for(let ne=0;ne<re.circleArray.length/4;ne++){const ce=4*ne,ie=re.circleArray[ce+0],de=re.circleArray[ce+1],me=re.circleArray[ce+2],se=re.circleArray[ce+3];O.emplace(G++,ie,de,me,se,0),O.emplace(G++,ie,de,me,se,1),O.emplace(G++,ie,de,me,se,2),O.emplace(G++,ie,de,me,se,3)}(!os||os.length<2*R)&&(os=(function(re){const ne=2*re,ce=new s.c1;ce.resize(ne),ce._trim();for(let ie=0;ie<ne;ie++){const de=6*ie;ce.uint16[de+0]=4*ie+0,ce.uint16[de+1]=4*ie+1,ce.uint16[de+2]=4*ie+2,ce.uint16[de+3]=4*ie+2,ce.uint16[de+4]=4*ie+3,ce.uint16[de+5]=4*ie+0}return ce})(R));const J=g.createIndexBuffer(os,!0),te=g.createVertexBuffer(O,s.c0.members,!0);for(const re of z){const ne=Xp(m.transform);B.draw(g,M.TRIANGLES,Ut.disabled,or.disabled,m.colorModeForRenderPass(),Bt.disabled,ne,m.style.map.terrain&&m.style.map.terrain.getTerrainData(re.coord),null,i.id,te,J,s.aM.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}te.destroy(),J.destroy()}const lp=s.ag(new Float32Array(16));function Yr(m,e,i,u,p,g){const{horizontalAlign:x,verticalAlign:M}=s.aH(m);return new s.P((-(x-.5)*e/p+u[0])*g,(-(M-.5)*i/p+u[1])*g)}function eh(m,e,i,u,p,g){const x=e.tileAnchorPoint.add(new s.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let M=u.mult(g);i||(M=M.rotate(-p));const k=x.add(M);return wn(k.x,k.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const M=jn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),k=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return m.add(u.rotate(k))}return m.add(u)}function Tl(m,e,i,u,p,g,x,M,k,z,R,j){const B=m.text.placedSymbolArray,O=m.text.dynamicLayoutVertexArray,G=m.icon.dynamicLayoutVertexArray,J={};O.clear();for(let te=0;te<B.length;te++){const re=B.get(te),ne=re.hidden||!re.crossTileID||m.allowVerticalPlacement&&!re.placedOrientation?null:u[re.crossTileID];if(ne){const ce=new s.P(re.anchorX,re.anchorY),ie={getElevation:j,width:p.width,height:p.height,pitchedLabelPlaneMatrix:g,pitchWithMap:i,transform:p,tileAnchorPoint:ce,translation:z,unwrappedTileID:R},de=i?Wo(ce.x,ce.y,ie):jn(ce.x,ce.y,ie),me=Qe(p.cameraToCenterDistance,de.signedDistanceFromCamera);let se=s.ap(m.textSizeData,M,re)*me/s.aB;i&&(se*=m.tilePixelRatio/x);const{width:_e,height:Ee,anchor:Me,textOffset:ke,textBoxScale:De}=ne,tt=Yr(Me,_e,Ee,ke,De,se),it=p.getPitchedTextCorrection(ce.x+z[0],ce.y+z[1],R),We=eh(de.point,ie,e,tt,-p.bearingInRadians,it),St=m.allowVerticalPlacement&&re.placedOrientation===s.ao.vertical?Math.PI/2:0;for(let Jt=0;Jt<re.numGlyphs;Jt++)s.av(O,We,St);k&&re.associatedIconIndex>=0&&(J[re.associatedIconIndex]={shiftedAnchor:We,angle:St})}else Oa(re.numGlyphs,O)}if(k){G.clear();const te=m.icon.placedSymbolArray;for(let re=0;re<te.length;re++){const ne=te.get(re);if(ne.hidden)Oa(ne.numGlyphs,G);else{const ce=J[re];if(ce)for(let ie=0;ie<ne.numGlyphs;ie++)s.av(G,ce.shiftedAnchor,ce.angle);else Oa(ne.numGlyphs,G)}}m.icon.dynamicLayoutVertexBuffer.updateData(G)}m.text.dynamicLayoutVertexBuffer.updateData(O)}function ss(m,e,i){return i.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Cl(m,e,i,u,p,g,x,M,k,z,R,j,B){const O=m.context,G=O.gl,J=m.transform,te=M==="map",re=k==="map",ne=M!=="viewport"&&i.layout.get("symbol-placement")!=="point",ce=te&&!re&&!ne,ie=!i.layout.get("symbol-sort-key").isConstant();let de=!1;const me=m.getDepthModeForSublayer(0,Ut.ReadOnly),se=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[],Ee=J.getCircleRadiusCorrection();for(const Me of u){const ke=e.getTile(Me),De=ke.getBucket(i);if(!De)continue;const tt=p?De.text:De.icon;if(!tt||!tt.segments.get().length||!tt.hasVisibleVertices)continue;const it=tt.programConfigurations.get(i.id),We=p||De.sdfIcons,St=p?De.textSizeData:De.iconSizeData,Jt=re||J.pitch!==0,Sr=m.useProgram(ss(We,p,De),it),Br=s.an(St,J.zoom),zr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Me);let Hr,rn,Zt,Er,gn=[0,0],yn=null;if(p)rn=ke.glyphAtlasTexture,Zt=G.LINEAR,Hr=ke.glyphAtlasTexture.size,De.iconsInText&&(gn=ke.imageAtlasTexture.size,yn=ke.imageAtlasTexture,Er=Jt||m.options.rotating||m.options.zooming||St.kind==="composite"||St.kind==="camera"?G.LINEAR:G.NEAREST);else{const _n=i.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;rn=ke.imageAtlasTexture,Zt=We||m.options.rotating||m.options.zooming||_n||Jt?G.LINEAR:G.NEAREST,Hr=ke.imageAtlasTexture.size}const zn=s.aC(ke,1,m.transform.zoom),ii=en(te,m.transform,zn),la=s.L();s.aq(la,ii);const Eo=nr(re,te,m.transform,zn),Qa=s.aD(J,ke,g,x),js=J.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Os=se&&De.hasTextData(),ds=i.layout.get("icon-text-fit")!=="none"&&Os&&De.hasIconData();if(ne){const _n=m.style.map.terrain?(_i,Tn)=>m.style.map.terrain.getElevation(Me,_i,Tn):null,Sn=i.layout.get("text-rotation-alignment")==="map";Kr(De,m,p,ii,la,re,z,Sn,Me.toUnwrapped(),J.width,J.height,Qa,_n)}const Us=p&&se||ds,gi=ne||Us?lp:re?ii:m.transform.clipSpaceToPixelsMatrix,Pa=We&&i.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yi;yi=We?De.iconsInText?ou(St.kind,Br,ce,re,ne,Us,m,gi,Eo,Qa,Hr,gn,Ee):Gc(St.kind,Br,ce,re,ne,Us,m,gi,Eo,Qa,p,Hr,0,Ee):yl(St.kind,Br,ce,re,ne,Us,m,gi,Eo,Qa,p,Hr,Ee);const Io={program:Sr,buffers:tt,uniformValues:yi,projectionData:js,atlasTexture:rn,atlasTextureIcon:yn,atlasInterpolation:Zt,atlasInterpolationIcon:Er,isSDF:We,hasHalo:Pa};if(ie&&De.canOverlap){de=!0;const _n=tt.segments.get();for(const Sn of _n)_e.push({segments:new s.aM([Sn]),sortKey:Sn.sortKey,state:Io,terrainData:zr})}else _e.push({segments:tt.segments,sortKey:0,state:Io,terrainData:zr})}de&&_e.sort(((Me,ke)=>Me.sortKey-ke.sortKey));for(const Me of _e){const ke=Me.state;if(O.activeTexture.set(G.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,G.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(O.activeTexture.set(G.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),ke.isSDF){const De=ke.uniformValues;ke.hasHalo&&(De.u_is_halo=1,zs(ke.buffers,Me.segments,i,m,ke.program,me,R,j,De,ke.projectionData,Me.terrainData)),De.u_is_halo=0}zs(ke.buffers,Me.segments,i,m,ke.program,me,R,j,ke.uniformValues,ke.projectionData,Me.terrainData)}}function zs(m,e,i,u,p,g,x,M,k,z,R){const j=u.context;p.draw(j,j.gl.TRIANGLES,g,x,M,Bt.backCCW,k,R,z,i.id,m.layoutVertexBuffer,m.indexBuffer,e,i.paint,u.transform.zoom,m.programConfigurations.get(i.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ls(m,e,i,u,p){const g=m.context,x=g.gl,M=or.disabled,k=new $r([x.ONE,x.ONE],s.bf.transparent,[!0,!0,!0,!0]),z=e.getBucket(i);if(!z)return;const R=u.key;let j=i.heatmapFbos.get(R);j||(j=Ga(g,e.tileSize,e.tileSize),i.heatmapFbos.set(R,j)),g.bindFramebuffer.set(j.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:s.bf.transparent});const B=z.programConfigurations.get(i.id),O=m.useProgram("heatmap",B,!p),G=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),J=m.style.map.terrain.getTerrainData(u);O.draw(g,x.TRIANGLES,Ut.disabled,M,k,Bt.disabled,np(e,m.transform.zoom,i.paint.get("heatmap-intensity"),1),J,G,i.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,i.paint,m.transform.zoom,B)}function fu(m,e,i,u,p){const g=m.context,x=g.gl,M=m.transform;g.setColorMode(m.colorModeForRenderPass());const k=Pl(g,e),z=i.key,R=e.heatmapFbos.get(z);if(!R)return;g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,R.colorAttachment.get()),g.activeTexture.set(x.TEXTURE1),k.bind(x.LINEAR,x.CLAMP_TO_EDGE);const j=M.getProjectionData({overscaledTileID:i,applyTerrainMatrix:p,applyGlobeMatrix:!u});m.useProgram("heatmapTexture").draw(g,x.TRIANGLES,Ut.disabled,or.disabled,m.colorModeForRenderPass(),Bt.disabled,Bc(m,e,0,1),null,j,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,M.zoom),R.destroy(),e.heatmapFbos.delete(z)}function Ga(m,e,i){var u,p;const g=m.gl,x=g.createTexture();g.bindTexture(g.TEXTURE_2D,x),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const M=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:g.UNSIGNED_BYTE,k=(p=m.RGBA16F)!==null&&p!==void 0?p:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,k,e,i,0,g.RGBA,M,null);const z=m.createFramebuffer(e,i,!1,!1);return z.colorAttachment.set(x),z}function Pl(m,e){return e.colorRampTexture||(e.colorRampTexture=new s.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function mu(m,e,i,u,p){if(!i||!u||!u.imageAtlas)return;const g=u.imageAtlas.patternPositions;let x=g[i.to.toString()],M=g[i.from.toString()];if(!x&&M&&(x=M),!M&&x&&(M=x),!x||!M){const k=p.getPaintProperty(e);x=g[k],M=g[k]}x&&M&&m.setConstantPatternPositions(x,M)}function Qu(m,e,i,u,p,g,x,M){const k=m.context.gl,z="fill-pattern",R=i.paint.get(z),j=R&&R.constantOr(1),B=i.getCrossfadeParameters();let O,G,J,te,re;const ne=m.transform,ce=i.paint.get("fill-translate"),ie=i.paint.get("fill-translate-anchor");x?(G=j&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=k.LINES):(G=j?"fillPattern":"fill",O=k.TRIANGLES);const de=R.constantOr(null);for(const me of u){const se=e.getTile(me);if(j&&!se.patternsLoaded())continue;const _e=se.getBucket(i);if(!_e)continue;const Ee=_e.programConfigurations.get(i.id),Me=m.useProgram(G,Ee),ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(me);j&&(m.context.activeTexture.set(k.TEXTURE0),se.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ee.updatePaintBuffers(B)),mu(Ee,z,de,se,i);const De=ne.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),tt=s.aD(ne,se,ce,ie);if(x){te=_e.indexBuffer2,re=_e.segments2;const We=[k.drawingBufferWidth,k.drawingBufferHeight];J=G==="fillOutlinePattern"&&j?nu(m,B,se,We,tt):ml(We,tt)}else te=_e.indexBuffer,re=_e.segments,J=j?Hu(m,B,se,tt):{u_fill_translate:tt};const it=m.stencilModeForClipping(me);Me.draw(m.context,O,p,it,g,Bt.backCCW,J,ke,De,i.id,_e.layoutVertexBuffer,te,re,i.paint,m.transform.zoom,Ee)}}function ec(m,e,i,u,p,g,x,M){const k=m.context,z=k.gl,R="fill-extrusion-pattern",j=i.paint.get(R),B=j.constantOr(1),O=i.getCrossfadeParameters(),G=i.paint.get("fill-extrusion-opacity"),J=j.constantOr(null),te=m.transform;for(const re of u){const ne=e.getTile(re),ce=ne.getBucket(i);if(!ce)continue;const ie=m.style.map.terrain&&m.style.map.terrain.getTerrainData(re),de=ce.programConfigurations.get(i.id),me=m.useProgram(B?"fillExtrusionPattern":"fillExtrusion",de);B&&(m.context.activeTexture.set(z.TEXTURE0),ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),de.updatePaintBuffers(O));const se=te.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!M,applyTerrainMatrix:!0});mu(de,R,J,ne,i);const _e=s.aD(te,ne,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Ee=i.paint.get("fill-extrusion-vertical-gradient"),Me=B?Hp(m,Ee,G,_e,re,O,ne):xa(m,Ee,G,_e);me.draw(k,k.gl.TRIANGLES,p,g,x,Bt.backCCW,Me,ie,se,i.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,i.paint,m.transform.zoom,de,m.style.map.terrain&&ce.centroidVertexBuffer)}}function Za(m,e,i,u,p,g,x,M,k){var z;const R=m.style.projection,j=m.context,B=m.transform,O=j.gl,G=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],J=m.useProgram("hillshade",null,!1,G),te=!m.options.moving;for(const re of u){const ne=e.getTile(re),ce=ne.fbo;if(!ce)continue;const ie=R.getMeshFromTileID(j,re.canonical,M,!0,"raster"),de=(z=m.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(re);j.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,ce.colorAttachment.get());const me=B.getProjectionData({overscaledTileID:re,aligned:te,applyGlobeMatrix:!k,applyTerrainMatrix:!0});J.draw(j,O.TRIANGLES,g,p[re.overscaledZ],x,Bt.backCCW,jc(m,ne,i),de,me,i.id,ie.vertexBuffer,ie.indexBuffer,ie.segments)}}function Ml(m,e,i,u,p,g,x,M,k){var z;const R=m.style.projection,j=m.context,B=m.transform,O=j.gl,G=m.useProgram("colorRelief"),J=!m.options.moving;let te=!0,re=0;for(const ne of u){const ce=e.getTile(ne),ie=ce.dem;if(te){const Me=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:ke,colorTexture:De}=i.getColorRampTextures(j,Me,ie.getUnpackVector());j.activeTexture.set(O.TEXTURE1),ke.bind(O.NEAREST,O.CLAMP_TO_EDGE),j.activeTexture.set(O.TEXTURE4),De.bind(O.LINEAR,O.CLAMP_TO_EDGE),te=!1,re=ke.size[0]}if(!ie||!ie.data)continue;const de=ie.stride,me=ie.getPixels();if(j.activeTexture.set(O.TEXTURE0),j.pixelStoreUnpackPremultiplyAlpha.set(!1),ce.demTexture=ce.demTexture||m.getTileTexture(de),ce.demTexture){const Me=ce.demTexture;Me.update(me,{premultiply:!1}),Me.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else ce.demTexture=new s.T(j,me,O.RGBA,{premultiply:!1}),ce.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const se=R.getMeshFromTileID(j,ne.canonical,M,!0,"raster"),_e=(z=m.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(ne),Ee=B.getProjectionData({overscaledTileID:ne,aligned:J,applyGlobeMatrix:!k,applyTerrainMatrix:!0});G.draw(j,O.TRIANGLES,g,p[ne.overscaledZ],x,Bt.backCCW,Uc(i,ce.dem,re),_e,Ee,i.id,se.vertexBuffer,se.indexBuffer,se.segments)}}const kl=[new s.P(0,0),new s.P(s.$,0),new s.P(s.$,s.$),new s.P(0,s.$)];function xo(m,e,i,u,p,g,x,M,k=!1,z=!1){const R=u[u.length-1].overscaledZ,j=m.context,B=j.gl,O=m.useProgram("raster"),G=m.transform,J=m.style.projection,te=m.colorModeForRenderPass(),re=!m.options.moving;for(const ne of u){const ce=m.getDepthModeForSublayer(ne.overscaledZ-R,i.paint.get("raster-opacity")===1?Ut.ReadWrite:Ut.ReadOnly,B.LESS),ie=e.getTile(ne);ie.registerFadeDuration(i.paint.get("raster-fade-duration"));const de=e.findLoadedParent(ne,0),me=e.findLoadedSibling(ne),se=gu(ie,de||me||null,e,i,m.transform,m.style.map.terrain);let _e,Ee;const Me=i.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;j.activeTexture.set(B.TEXTURE0),ie.texture.bind(Me,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(B.TEXTURE1),de?(de.texture.bind(Me,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,de.tileID.overscaledZ-ie.tileID.overscaledZ),Ee=[ie.tileID.canonical.x*_e%1,ie.tileID.canonical.y*_e%1]):ie.texture.bind(Me,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),ie.texture.useMipmap&&j.extTextureFilterAnisotropic&&m.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne),De=G.getProjectionData({overscaledTileID:ne,aligned:re,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),tt=au(Ee||[0,0],_e||1,se,i,M),it=J.getMeshFromTileID(j,ne.canonical,g,x,"raster");O.draw(j,B.TRIANGLES,ce,p?p[ne.overscaledZ]:or.disabled,te,k?Bt.frontCCW:Bt.backCCW,tt,ke,De,i.id,it.vertexBuffer,it.indexBuffer,it.segments)}}function gu(m,e,i,u,p,g){const x=u.paint.get("raster-fade-duration");if(!g&&x>0){const M=le.now(),k=(M-m.timeAdded)/x,z=e?(M-e.timeAdded)/x:-1,R=i.getSource(),j=vt(p,{tileSize:R.tileSize,roundZoom:R.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-j)>Math.abs(m.tileID.overscaledZ-j),O=B&&m.refreshedUponExpiration?1:s.ah(B?k:1-z,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const tc=new s.bf(1,0,0,1),up=new s.bf(0,1,0,1),yu=new s.bf(0,0,1,1),th=new s.bf(1,0,1,1),Qp=new s.bf(0,1,1,1);function _u(m,e,i,u){Sa(m,0,e+i/2,m.transform.width,i,u)}function Dr(m,e,i,u){Sa(m,e-i/2,0,i,m.transform.height,u)}function Sa(m,e,i,u,p,g){const x=m.context,M=x.gl;M.enable(M.SCISSOR_TEST),M.scissor(e*m.pixelRatio,i*m.pixelRatio,u*m.pixelRatio,p*m.pixelRatio),x.clear({color:g}),M.disable(M.SCISSOR_TEST)}function Hn(m,e,i){const u=m.context,p=u.gl,g=m.useProgram("debug"),x=Ut.disabled,M=or.disabled,k=m.colorModeForRenderPass(),z="$debug",R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(i);u.activeTexture.set(p.TEXTURE0);const j=e.getTileByID(i.key).latestRawTileData,B=Math.floor((j&&j.byteLength||0)/1024),O=e.getTile(i).tileSize,G=512/Math.min(O,512)*(i.overscaledZ/m.transform.zoom)*.5;let J=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(J+=` => ${i.overscaledZ}`),(function(re,ne){re.initDebugOverlayCanvas();const ce=re.debugOverlayCanvas,ie=re.context.gl,de=re.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,ce.width,ce.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(ne,5,5),de.strokeText(ne,5,5),re.debugOverlayTexture.update(ce),re.debugOverlayTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)})(m,`${J} ${B}kB`);const te=m.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(u,p.TRIANGLES,x,M,$r.alphaBlended,Bt.disabled,Ms(s.bf.transparent,G),null,te,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(u,p.LINE_STRIP,x,M,k,Bt.disabled,Ms(s.bf.red),R,te,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ui(m,e,i,u){const{isRenderingGlobe:p}=u,g=m.context,x=g.gl,M=m.transform,k=m.colorModeForRenderPass(),z=m.getDepthModeFor3D(),R=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const j of i){const B=e.getTerrainMesh(j.tileID),O=m.renderToTexture.getTexture(j),G=e.getTerrainData(j.tileID);g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,O.texture);const J=e.getMeshFrameDelta(M.zoom),te=M.calculateFogMatrix(j.tileID.toUnwrapped()),re=Zu(J,te,m.style.sky,M.pitch,p),ne=M.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(g,x.TRIANGLES,z,or.disabled,k,Bt.backCCW,re,G,ne,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}function bo(m,e){if(!e.mesh){const i=new s.aL;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const u=new s.aN;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new ho(m.createVertexBuffer(i,po.members),m.createIndexBuffer(u),s.aM.simpleSegment(0,0,i.length,u.length))}return e.mesh}class Ha{constructor(e,i){this.context=new Sl(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=rr.maxUnderzooming+rr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xo}resize(e,i,u){if(this.width=Math.floor(e*u),this.height=Math.floor(i*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,i=new s.aL;i.emplaceBack(0,0),i.emplaceBack(s.$,0),i.emplaceBack(0,s.$),i.emplaceBack(s.$,s.$),this.tileExtentBuffer=e.createVertexBuffer(i,po.members),this.tileExtentSegments=s.aM.simpleSegment(0,0,4,2);const u=new s.aL;u.emplaceBack(0,0),u.emplaceBack(s.$,0),u.emplaceBack(0,s.$),u.emplaceBack(s.$,s.$),this.debugBuffer=e.createVertexBuffer(u,po.members),this.debugSegments=s.aM.simpleSegment(0,0,4,5);const p=new s.c6;p.emplaceBack(0,0,0,0),p.emplaceBack(s.$,0,s.$,0),p.emplaceBack(0,s.$,0,s.$),p.emplaceBack(s.$,s.$,s.$,s.$),this.rasterBoundsBuffer=e.createVertexBuffer(p,Zp.members),this.rasterBoundsSegments=s.aM.simpleSegment(0,0,4,2);const g=new s.aL;g.emplaceBack(0,0),g.emplaceBack(s.$,0),g.emplaceBack(0,s.$),g.emplaceBack(s.$,s.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,po.members),this.rasterBoundsSegmentsPosOnly=s.aM.simpleSegment(0,0,4,5);const x=new s.aL;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(x,po.members),this.viewportSegments=s.aM.simpleSegment(0,0,4,2);const M=new s.c7;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(M);const k=new s.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(k);const z=this.context.gl;this.stencilClearMode=new or({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new ho(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=s.L();s.bY(u,0,this.width,this.height,0,0,1),s.N(u,u,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const p={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,Ut.disabled,this.stencilClearMode,$r.disabled,Bt.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const p=this.context;p.setColorMode($r.disabled),p.setDepthMode(Ut.disabled);const g={};for(const x of i)g[x.key]=this.nextStencilID++;this._renderTileMasks(g,i,u,!0),this._renderTileMasks(g,i,u,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,i,u,p){const g=this.context,x=g.gl,M=this.style.projection,k=this.transform,z=this.useProgram("clippingMask");for(const R of i){const j=e[R.key],B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),O=M.getMeshFromTileID(this.context,R.canonical,p,!0,"stencil"),G=k.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!u,applyTerrainMatrix:!0});z.draw(g,x.TRIANGLES,Ut.disabled,new or({func:x.ALWAYS,mask:0},j,255,x.KEEP,x.KEEP,x.REPLACE),$r.disabled,u?Bt.disabled:Bt.backCCW,null,B,G,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,u=this.style.projection,p=this.transform,g=this.useProgram("depth"),x=this.getDepthModeFor3D(),M=Te(p,{tileSize:p.tileSize});for(const k of M){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),R=u.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),j=p.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,i.TRIANGLES,x,or.disabled,$r.disabled,Bt.backCCW,null,z,j,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new or({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new or({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,u=e.sort(((x,M)=>M.overscaledZ-x.overscaledZ)),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let M=0;M<g;M++)x[M+p]=new or({func:i.GEQUAL,mask:255},M+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=g,[x,u]}return[{[p]:or.disabled},u]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,u=e.sort(((x,M)=>M.overscaledZ-x.overscaledZ)),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(this.clearStencil(),g>1){const x={},M={};for(let k=0;k<g;k++)x[k+p]=new or({func:i.GREATER,mask:255},g+1+k,255,i.KEEP,i.KEEP,i.REPLACE),M[k+p]=new or({func:i.GREATER,mask:255},1+k,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*g+1,[x,M,u]}return this.nextStencilID=3,[{[p]:new or({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[p]:new or({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new $r([e.CONSTANT_COLOR,e.ONE],new s.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$r.unblended:$r.alphaBlended}getDepthModeForSublayer(e,i,u){if(!this.opaquePassEnabledForLayer())return Ut.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ut(u||this.context.gl.LEQUAL,i,[p,p])}getDepthModeFor3D(){return new Ut(this.context.gl.LEQUAL,Ut.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var u,p;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(le.now()),this.imageManager.beginFrame();const g=this.style._order,x=this.style.sourceCaches,M={},k={},z={},R={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const B in x){const O=x[B];O.used&&O.prepare(this.context),M[B]=O.getVisibleCoordinates(!1),k[B]=M[B].slice().reverse(),z[B]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<g.length;B++)if(this.style._layers[g[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of g){const O=this.style._layers[B];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const G=k[O.source];(O.type==="custom"||G.length)&&this.renderLayer(this,x[O.source],O,G,R)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:B=>this.useProgram(B)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?s.bf.black:s.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(B,O){const G=B.context,J=G.gl,te=((me,se,_e)=>{const Ee=Math.cos(se.rollInRadians),Me=Math.sin(se.rollInRadians),ke=ye(se),De=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:me.properties.get("sky-color"),u_horizon_color:me.properties.get("horizon-color"),u_horizon:[(se.width/2-ke*Me)*_e,(se.height/2+ke*Ee)*_e],u_horizon_normal:[-Me,Ee],u_sky_horizon_blend:me.properties.get("sky-horizon-blend")*se.height/2*_e,u_sky_blend:De}})(O,B.style.map.transform,B.pixelRatio),re=new Ut(J.LEQUAL,Ut.ReadWrite,[0,1]),ne=or.disabled,ce=B.colorModeForRenderPass(),ie=B.useProgram("sky"),de=bo(G,O);ie.draw(G,J.TRIANGLES,re,ne,ce,Bt.disabled,te,null,void 0,"sky",de.vertexBuffer,de.indexBuffer,de.segments)})(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[g[this.currentLayer]],O=x[B.source],G=M[B.source];this._renderTileClippingMasks(B,G,!1),this.renderLayer(this,O,B,G,R)}this.renderPass="translucent";let j=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const B=this.style._layers[g[this.currentLayer]],O=x[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B,R))continue;this.opaquePassEnabledForLayer()||j||(j=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const G=(B.type==="symbol"?z:k)[B.source];this._renderTileClippingMasks(B,M[B.source],!!this.renderToTexture),this.renderLayer(this,O,B,G,R)}if(R.isRenderingGlobe&&(function(B,O,G){const J=B.context,te=J.gl,re=B.useProgram("atmosphere"),ne=new Ut(te.LEQUAL,Ut.ReadOnly,[0,1]),ce=B.transform,ie=(function(De,tt){const it=De.properties.get("position"),We=[-it.x,-it.y,-it.z],St=s.ag(new Float64Array(16));return De.properties.get("anchor")==="map"&&(s.b6(St,St,tt.rollInRadians),s.b7(St,St,-tt.pitchInRadians),s.b6(St,St,tt.bearingInRadians),s.b7(St,St,tt.center.lat*Math.PI/180),s.bz(St,St,-tt.center.lng*Math.PI/180)),s.c5(We,We,St),We})(G,B.transform),de=ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),me=O.properties.get("atmosphere-blend")*de.projectionTransition;if(me===0)return;const se=fo(ce.worldSize,ce.center.lat),_e=ce.inverseProjectionMatrix,Ee=new Float64Array(4);Ee[3]=1,s.aw(Ee,Ee,ce.modelViewProjectionMatrix),Ee[0]/=Ee[3],Ee[1]/=Ee[3],Ee[2]/=Ee[3],Ee[3]=1,s.aw(Ee,Ee,_e),Ee[0]/=Ee[3],Ee[1]/=Ee[3],Ee[2]/=Ee[3],Ee[3]=1;const Me=((De,tt,it,We,St)=>({u_sun_pos:De,u_atmosphere_blend:tt,u_globe_position:it,u_globe_radius:We,u_inv_proj_matrix:St}))(ie,me,[Ee[0],Ee[1],Ee[2]],se,_e),ke=bo(J,O);re.draw(J,te.TRIANGLES,ne,or.disabled,$r.alphaBlended,Bt.disabled,Me,null,null,"atmosphere",ke.vertexBuffer,ke.indexBuffer,ke.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const B=(function(O,G){let J=null;const te=Object.values(O._layers).flatMap((ie=>ie.source&&!ie.isHidden(G)?[O.sourceCaches[ie.source]]:[])),re=te.filter((ie=>ie.getSource().type==="vector")),ne=te.filter((ie=>ie.getSource().type!=="vector")),ce=ie=>{(!J||J.getSource().maxzoom<ie.getSource().maxzoom)&&(J=ie)};return re.forEach((ie=>ce(ie))),J||ne.forEach((ie=>ce(ie))),J})(this.style,this.transform.zoom);B&&(function(O,G,J){for(let te=0;te<J.length;te++)Hn(O,G,J[te])})(this,B,B.getVisibleCoordinates())}this.options.showPadding&&(function(B){const O=B.transform.padding;_u(B,B.transform.height-(O.top||0),3,tc),_u(B,O.bottom||0,3,up),Dr(B,O.left||0,3,yu),Dr(B,B.transform.width-(O.right||0),3,th);const G=B.transform.centerPoint;(function(J,te,re,ne){Sa(J,te-1,re-10,2,20,ne),Sa(J,te-10,re-1,20,2,ne)})(B,G.x,B.transform.height-G.y,Qp)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!s.c8(i,u):!s.c9(i,u)),p||(p=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(s.ca(i,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,x){const M=g.context,k=M.gl,z=g.transform,R=$r.unblended,j=new Ut(k.LEQUAL,Ut.ReadWrite,[0,1]),B=x.sourceCache.getRenderableTiles(),O=g.useProgram("terrainDepth");M.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),M.clear({color:s.bf.transparent,depth:1});for(const G of B){const J=x.getTerrainMesh(G.tileID),te=x.getTerrainData(G.tileID),re=z.getProjectionData({overscaledTileID:G.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ne={u_ele_delta:x.getMeshFrameDelta(z.zoom)};O.draw(M,k.TRIANGLES,j,or.disabled,R,Bt.backCCW,ne,te,re,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,x){const M=g.context,k=M.gl,z=g.transform,R=$r.unblended,j=new Ut(k.LEQUAL,Ut.ReadWrite,[0,1]),B=x.getCoordsTexture(),O=x.sourceCache.getRenderableTiles(),G=g.useProgram("terrainCoords");M.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),M.clear({color:s.bf.transparent,depth:1}),x.coordsIndex=[];for(const J of O){const te=x.getTerrainMesh(J.tileID),re=x.getTerrainData(J.tileID);M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,B.texture);const ne={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(z.zoom)},ce=z.getProjectionData({overscaledTileID:J.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(M,k.TRIANGLES,j,or.disabled,R,Bt.backCCW,ne,re,ce,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),x.coordsIndex.push(J.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,i,u,p,g){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(p||[]).length)&&(this.id=u.id,s.cb(u)?(function(x,M,k,z,R,j){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:B}=j,O=or.disabled,G=x.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(J,te,re,ne,ce,ie,de,me,se){const _e=te.transform,Ee=te.style.map.terrain,Me=ce==="map",ke=ie==="map";for(const De of J){const tt=ne.getTile(De),it=tt.getBucket(re);if(!it||!it.text||!it.text.segments.get().length)continue;const We=s.an(it.textSizeData,_e.zoom),St=s.aC(tt,1,te.transform.zoom),Jt=en(Me,te.transform,St),Sr=re.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(We){const Br=Math.pow(2,_e.zoom-tt.tileID.overscaledZ),zr=Ee?(Hr,rn)=>Ee.getElevation(De,Hr,rn):null;Tl(it,Me,ke,se,_e,Jt,Br,We,Sr,s.aD(_e,tt,de,me),De.toUnwrapped(),zr)}}})(z,x,k,M,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),R),k.paint.get("icon-opacity").constantOr(1)!==0&&Cl(x,M,k,z,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),O,G,B),k.paint.get("text-opacity").constantOr(1)!==0&&Cl(x,M,k,z,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),O,G,B),M.map.showCollisionBoxes&&(Qc(x,M,k,z,!0),Qc(x,M,k,z,!1))})(e,i,u,p,this.style.placement.variableOffsets,g):s.cc(u)?(function(x,M,k,z,R){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=R,B=k.paint.get("circle-opacity"),O=k.paint.get("circle-stroke-width"),G=k.paint.get("circle-stroke-opacity"),J=!k.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(O.constantOr(1)===0||G.constantOr(1)===0))return;const te=x.context,re=te.gl,ne=x.transform,ce=x.getDepthModeForSublayer(0,Ut.ReadOnly),ie=or.disabled,de=x.colorModeForRenderPass(),me=[],se=ne.getCircleRadiusCorrection();for(let _e=0;_e<z.length;_e++){const Ee=z[_e],Me=M.getTile(Ee),ke=Me.getBucket(k);if(!ke)continue;const De=k.paint.get("circle-translate"),tt=k.paint.get("circle-translate-anchor"),it=s.aD(ne,Me,De,tt),We=ke.programConfigurations.get(k.id),St=x.useProgram("circle",We),Jt=ke.layoutVertexBuffer,Sr=ke.indexBuffer,Br=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ee),zr={programConfiguration:We,program:St,layoutVertexBuffer:Jt,indexBuffer:Sr,uniformValues:Wp(x,Me,k,it,se),terrainData:Br,projectionData:ne.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!j,applyTerrainMatrix:!0})};if(J){const Hr=ke.segments.get();for(const rn of Hr)me.push({segments:new s.aM([rn]),sortKey:rn.sortKey,state:zr})}else me.push({segments:ke.segments,sortKey:0,state:zr})}J&&me.sort(((_e,Ee)=>_e.sortKey-Ee.sortKey));for(const _e of me){const{programConfiguration:Ee,program:Me,layoutVertexBuffer:ke,indexBuffer:De,uniformValues:tt,terrainData:it,projectionData:We}=_e.state;Me.draw(te,re.TRIANGLES,ce,ie,de,Bt.backCCW,tt,it,We,k.id,ke,De,_e.segments,k.paint,x.transform.zoom,Ee)}})(e,i,u,p,g):s.cd(u)?(function(x,M,k,z,R){if(k.paint.get("heatmap-opacity")===0)return;const j=x.context,{isRenderingToTexture:B,isRenderingGlobe:O}=R;if(x.style.map.terrain){for(const G of z){const J=M.getTile(G);M.hasRenderableParent(G)||(x.renderPass==="offscreen"?Ls(x,J,k,G,O):x.renderPass==="translucent"&&fu(x,k,G,B,O))}j.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?(function(G,J,te,re){const ne=G.context,ce=ne.gl,ie=G.transform,de=or.disabled,me=new $r([ce.ONE,ce.ONE],s.bf.transparent,[!0,!0,!0,!0]);(function(se,_e,Ee){const Me=se.gl;se.activeTexture.set(Me.TEXTURE1),se.viewport.set([0,0,_e.width/4,_e.height/4]);let ke=Ee.heatmapFbos.get(s.c2);ke?(Me.bindTexture(Me.TEXTURE_2D,ke.colorAttachment.get()),se.bindFramebuffer.set(ke.framebuffer)):(ke=Ga(se,_e.width/4,_e.height/4),Ee.heatmapFbos.set(s.c2,ke))})(ne,G,te),ne.clear({color:s.bf.transparent});for(let se=0;se<re.length;se++){const _e=re[se];if(J.hasRenderableParent(_e))continue;const Ee=J.getTile(_e),Me=Ee.getBucket(te);if(!Me)continue;const ke=Me.programConfigurations.get(te.id),De=G.useProgram("heatmap",ke),tt=ie.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),it=ie.getCircleRadiusCorrection();De.draw(ne,ce.TRIANGLES,Ut.disabled,de,me,Bt.backCCW,np(Ee,ie.zoom,te.paint.get("heatmap-intensity"),it),null,tt,te.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,te.paint,ie.zoom,ke)}ne.viewport.set([0,0,G.width,G.height])})(x,M,k,z):x.renderPass==="translucent"&&(function(G,J){const te=G.context,re=te.gl;te.setColorMode(G.colorModeForRenderPass());const ne=J.heatmapFbos.get(s.c2);ne&&(te.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,ne.colorAttachment.get()),te.activeTexture.set(re.TEXTURE1),Pl(te,J).bind(re.LINEAR,re.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(te,re.TRIANGLES,Ut.disabled,or.disabled,G.colorModeForRenderPass(),Bt.disabled,Bc(G,J,0,1),null,null,J.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,J.paint,G.transform.zoom))})(x,k)})(e,i,u,p,g):s.ce(u)?(function(x,M,k,z,R){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=R,B=k.paint.get("line-opacity"),O=k.paint.get("line-width");if(B.constantOr(1)===0||O.constantOr(1)===0)return;const G=x.getDepthModeForSublayer(0,Ut.ReadOnly),J=x.colorModeForRenderPass(),te=k.paint.get("line-dasharray"),re=k.paint.get("line-pattern"),ne=re.constantOr(1),ce=k.paint.get("line-gradient"),ie=k.getCrossfadeParameters(),de=ne?"linePattern":te?"lineSDF":ce?"lineGradient":"line",me=x.context,se=me.gl,_e=x.transform;let Ee=!0;for(const Me of z){const ke=M.getTile(Me);if(ne&&!ke.patternsLoaded())continue;const De=ke.getBucket(k);if(!De)continue;const tt=De.programConfigurations.get(k.id),it=x.context.program.get(),We=x.useProgram(de,tt),St=Ee||We.program!==it,Jt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me),Sr=re.constantOr(null);if(Sr&&ke.imageAtlas){const Zt=ke.imageAtlas,Er=Zt.patternPositions[Sr.to.toString()],gn=Zt.patternPositions[Sr.from.toString()];Er&&gn&&tt.setConstantPatternPositions(Er,gn)}const Br=_e.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),zr=_e.getPixelScale(),Hr=ne?$c(x,ke,k,zr,ie):te?ts(x,ke,k,zr,te,ie):ce?Vc(x,ke,k,zr,De.lineClipsArray.length):iu(x,ke,k,zr);if(ne)me.activeTexture.set(se.TEXTURE0),ke.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),tt.updatePaintBuffers(ie);else if(te&&(St||x.lineAtlas.dirty))me.activeTexture.set(se.TEXTURE0),x.lineAtlas.bind(me);else if(ce){const Zt=De.gradients[k.id];let Er=Zt.texture;if(k.gradientVersion!==Zt.version){let gn=256;if(k.stepInterpolant){const yn=M.getSource().maxzoom,zn=Me.canonical.z===yn?Math.ceil(1<<x.transform.maxZoom-Me.canonical.z):1;gn=s.ah(s.c3(De.maxLineLength/s.$*1024*zn),256,me.maxTextureSize)}Zt.gradient=s.c4({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:gn,image:Zt.gradient||void 0,clips:De.lineClipsArray}),Zt.texture?Zt.texture.update(Zt.gradient):Zt.texture=new s.T(me,Zt.gradient,se.RGBA),Zt.version=k.gradientVersion,Er=Zt.texture}me.activeTexture.set(se.TEXTURE0),Er.bind(k.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}const rn=x.stencilModeForClipping(Me);We.draw(me,se.TRIANGLES,G,rn,J,Bt.disabled,Hr,Jt,Br,k.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,k.paint,x.transform.zoom,tt,De.layoutVertexBuffer2),Ee=!1}})(e,i,u,p,g):s.cf(u)?(function(x,M,k,z,R){const j=k.paint.get("fill-color"),B=k.paint.get("fill-opacity");if(B.constantOr(1)===0)return;const{isRenderingToTexture:O}=R,G=x.colorModeForRenderPass(),J=k.paint.get("fill-pattern"),te=x.opaquePassEnabledForLayer()&&!J.constantOr(1)&&j.constantOr(s.bf.transparent).a===1&&B.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===te){const re=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?Ut.ReadWrite:Ut.ReadOnly);Qu(x,M,k,z,re,G,!1,O)}if(x.renderPass==="translucent"&&k.paint.get("fill-antialias")){const re=x.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly);Qu(x,M,k,z,re,G,!0,O)}})(e,i,u,p,g):s.cg(u)?(function(x,M,k,z,R){const j=k.paint.get("fill-extrusion-opacity");if(j===0)return;const{isRenderingToTexture:B}=R;if(x.renderPass==="translucent"){const O=new Ut(x.context.gl.LEQUAL,Ut.ReadWrite,x.depthRangeFor3D);if(j!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))ec(x,M,k,z,O,or.disabled,$r.disabled,B),ec(x,M,k,z,O,x.stencilModeFor3D(),x.colorModeForRenderPass(),B);else{const G=x.colorModeForRenderPass();ec(x,M,k,z,O,or.disabled,G,B)}}})(e,i,u,p,g):s.ch(u)?(function(x,M,k,z,R){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=R,B=x.context,O=x.style.projection.useSubdivision,G=x.getDepthModeForSublayer(0,Ut.ReadOnly),J=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(te,re,ne,ce,ie,de,me){const se=te.context,_e=se.gl;for(const Ee of ne){const Me=re.getTile(Ee),ke=Me.dem;if(!ke||!ke.data||!Me.needsHillshadePrepare)continue;const De=ke.dim,tt=ke.stride,it=ke.getPixels();if(se.activeTexture.set(_e.TEXTURE1),se.pixelStoreUnpackPremultiplyAlpha.set(!1),Me.demTexture=Me.demTexture||te.getTileTexture(tt),Me.demTexture){const St=Me.demTexture;St.update(it,{premultiply:!1}),St.bind(_e.NEAREST,_e.CLAMP_TO_EDGE)}else Me.demTexture=new s.T(se,it,_e.RGBA,{premultiply:!1}),Me.demTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);se.activeTexture.set(_e.TEXTURE0);let We=Me.fbo;if(!We){const St=new s.T(se,{width:De,height:De,data:null},_e.RGBA);St.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),We=Me.fbo=se.createFramebuffer(De,De,!0,!1),We.colorAttachment.set(St.texture)}se.bindFramebuffer.set(We.framebuffer),se.viewport.set([0,0,De,De]),te.useProgram("hillshadePrepare").draw(se,_e.TRIANGLES,ie,de,me,Bt.disabled,gl(Me.tileID,ke),null,null,ce.id,te.rasterBoundsBuffer,te.quadTriangleIndexBuffer,te.rasterBoundsSegments),Me.needsHillshadePrepare=!1}})(x,M,z,k,G,or.disabled,J),B.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(O){const[te,re,ne]=x.stencilConfigForOverlapTwoPass(z);Za(x,M,k,ne,te,G,J,!1,j),Za(x,M,k,ne,re,G,J,!0,j)}else{const[te,re]=x.getStencilConfigForOverlapAndUpdateStencilID(z);Za(x,M,k,re,te,G,J,!1,j)}})(e,i,u,p,g):s.ci(u)?(function(x,M,k,z,R){if(x.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:j}=R,B=x.style.projection.useSubdivision,O=x.getDepthModeForSublayer(0,Ut.ReadOnly),G=x.colorModeForRenderPass();if(B){const[J,te,re]=x.stencilConfigForOverlapTwoPass(z);Ml(x,M,k,re,J,O,G,!1,j),Ml(x,M,k,re,te,O,G,!0,j)}else{const[J,te]=x.getStencilConfigForOverlapAndUpdateStencilID(z);Ml(x,M,k,te,J,O,G,!1,j)}})(e,i,u,p,g):s.cj(u)?(function(x,M,k,z,R){if(x.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:j}=R,B=M.getSource(),O=x.style.projection.useSubdivision;if(B instanceof ta)xo(x,M,k,z,null,!1,!1,B.tileCoords,B.flippedWindingOrder,j);else if(O){const[G,J,te]=x.stencilConfigForOverlapTwoPass(z);xo(x,M,k,te,G,!1,!0,kl,!1,j),xo(x,M,k,te,J,!0,!0,kl,!1,j)}else{const[G,J]=x.getStencilConfigForOverlapAndUpdateStencilID(z);xo(x,M,k,J,G,!1,!0,kl,!1,j)}})(e,i,u,p,g):s.ck(u)?(function(x,M,k,z,R){const j=k.paint.get("background-color"),B=k.paint.get("background-opacity");if(B===0)return;const{isRenderingToTexture:O}=R,G=x.context,J=G.gl,te=x.style.projection,re=x.transform,ne=re.tileSize,ce=k.paint.get("background-pattern");if(x.isPatternMissing(ce))return;const ie=!ce&&j.a===1&&B===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==ie)return;const de=or.disabled,me=x.getDepthModeForSublayer(0,ie==="opaque"?Ut.ReadWrite:Ut.ReadOnly),se=x.colorModeForRenderPass(),_e=x.useProgram(ce?"backgroundPattern":"background"),Ee=z||Te(re,{tileSize:ne,terrain:x.style.map.terrain});ce&&(G.activeTexture.set(J.TEXTURE0),x.imageManager.bind(x.context));const Me=k.getCrossfadeParameters();for(const ke of Ee){const De=re.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),tt=ce?ip(B,x,ce,{tileID:ke,tileSize:ne},Me):_l(B,j),it=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ke),We=te.getMeshFromTileID(G,ke.canonical,!1,!0,"raster");_e.draw(G,J.TRIANGLES,me,de,se,Bt.backCCW,tt,it,De,k.id,We.vertexBuffer,We.indexBuffer,We.segments)}})(e,0,u,p,g):s.cl(u)&&(function(x,M,k,z){const{isRenderingGlobe:R}=z,j=x.context,B=k.implementation,O=x.style.projection,G=x.transform,J=G.getProjectionDataForCustomLayer(R),te={farZ:G.farZ,nearZ:G.nearZ,fov:G.fov*Math.PI/180,modelViewProjectionMatrix:G.modelViewProjectionMatrix,projectionMatrix:G.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:J},re=B.renderingMode?B.renderingMode:"2d";if(x.renderPass==="offscreen"){const ne=B.prerender;ne&&(x.setCustomLayerDefaults(),j.setColorMode(x.colorModeForRenderPass()),ne.call(B,j.gl,te),j.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),j.setColorMode(x.colorModeForRenderPass()),j.setStencilMode(or.disabled);const ne=re==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,Ut.ReadOnly);j.setDepthMode(ne),B.render(j.gl,te),j.setDirty(),x.setBaseState(),j.bindFramebuffer.set(null)}})(e,0,u,g))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!i||!u}useProgram(e,i,u=!1,p=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,x=this.style.projection,M=u?na.projectionMercator:x.shaderPreludeCode,k=u?Ua:x.shaderDefine,z=e+(i?i.cacheKey:"")+`/${u?Ko:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[z]||(this.cache[z]=new Fc(this.context,na[e],i,Zc[e],this._showOverdrawInspector,g,M,k,p)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function wo(m,e){let i,u=!1,p=null,g=null;const x=()=>{p=null,u&&(m.apply(g,i),p=setTimeout(x,e),u=!1)};return(...M)=>(u=!0,g=this,i=M,p||x(),p)}class rc{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(u=p)})),(u&&u[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const u=i.join("/");let p=u;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${u}`);let g=window.location.hash.replace(p,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let x=window.location.href.replace(/(#.+)?$/,g);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=wo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(i.lng*g)/g,M=Math.round(i.lat*g)/g,k=this._map.getBearing(),z=this._map.getPitch();let R="";if(R+=e?`/${x}/${M}/${u}`:`${u}/${M}/${x}`,(k||z)&&(R+="/"+Math.round(10*k)/10),z&&(R+=`/${Math.round(z)}`),this._hashName){const j=this._hashName;let B=!1;const O=window.location.hash.slice(1).split("&").map((G=>{const J=G.split("=")[0];return J===j?(B=!0,`${J}=${R}`):G})).filter((G=>G));return B||O.push(`${j}=${R}`),`#${O.join("&")}`}return`#${R}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new s.S(+e[2],+e[1])}catch{return!1}const i=+e[0],u=+(e[3]||0),p=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&u>=-180&&u<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const So={linearity:.3,easing:s.cm(0,0,.3,1)},To=s.e({deceleration:2500,maxSpeed:1400},So),El=s.e({deceleration:20,maxSpeed:1400},So),Rs=s.e({deceleration:1e3,maxSpeed:360},So),vu=s.e({deceleration:1e3,maxSpeed:90},So),nc=s.e({deceleration:1e3,maxSpeed:360},So);class Ds{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:le.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=le.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)i.zoom+=g.zoomDelta||0,i.bearing+=g.bearingDelta||0,i.pitch+=g.pitchDelta||0,i.roll+=g.rollDelta||0,g.panDelta&&i.pan._add(g.panDelta),g.around&&(i.around=g.around),g.pinchAround&&(i.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(i.pan.mag()){const g=Nr(i.pan.mag(),u,s.e({},To,e||{})),x=i.pan.mult(g.amount/i.pan.mag()),M=this._map.cameraHelper.handlePanInertia(x,this._map.transform);p.center=M.easingCenter,p.offset=M.easingOffset,Un(p,g)}if(i.zoom){const g=Nr(i.zoom,u,El);p.zoom=this._map.transform.zoom+g.amount,Un(p,g)}if(i.bearing){const g=Nr(i.bearing,u,Rs);p.bearing=this._map.transform.bearing+s.ah(g.amount,-179,179),Un(p,g)}if(i.pitch){const g=Nr(i.pitch,u,vu);p.pitch=this._map.transform.pitch+g.amount,Un(p,g)}if(i.roll){const g=Nr(i.roll,u,nc);p.roll=this._map.transform.roll+s.ah(g.amount,-179,179),Un(p,g)}if(p.zoom||p.bearing){const g=i.pinchAround===void 0?i.around:i.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),s.e(p,{noMoveStart:!0})}}function Un(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Nr(m,e,i){const{maxSpeed:u,linearity:p,deceleration:g}=i,x=s.ah(m*p/(e/1e3),-u,u),M=Math.abs(x)/(g*p);return{easing:i.easing,duration:1e3*M,amount:x*(M/2)}}class pr extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u,p={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const g=Y.mousePos(i.getCanvas(),u),x=i.unproject(g);super(e,s.e({point:g,lngLat:x,originalEvent:u},p)),this._defaultPrevented=!1,this.target=i}}class Vi extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){const p=e==="touchend"?u.changedTouches:u.touches,g=Y.touchPos(i.getCanvasContainer(),p),x=g.map((k=>i.unproject(k))),M=g.reduce(((k,z,R,j)=>k.add(z.div(j.length))),new s.P(0,0));super(e,{points:g,point:M,lngLats:x,lngLat:i.unproject(M),originalEvent:u}),this._defaultPrevented=!1}}class Vn extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class hi{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Vn(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new pr(e.type,this._map,e))}mouseup(e){this._map.fire(new pr(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new pr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new pr(e.type,this._map,e))}mouseover(e){this._map.fire(new pr(e.type,this._map,e))}mouseout(e){this._map.fire(new pr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Vi(e.type,this._map,e))}touchmove(e){this._map.fire(new Vi(e.type,this._map,e))}touchend(e){this._map.fire(new Vi(e.type,this._map,e))}touchcancel(e){this._map.fire(new Vi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ls{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new pr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new pr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ta{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(s.P.convert(e),this._map.terrain)}}class ri{constructor(e,i){this._map=e,this._tr=new Ta(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const u=i;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(p.x,u.x),x=Math.max(p.x,u.x),M=Math.min(p.y,u.y),k=Math.max(p.y,u.y);Y.setTransform(this._box,`translate(${g}px,${M}px)`),this._box.style.width=x-g+"px",this._box.style.height=k-M+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const u=this._startPos,p=i;if(this.reset(),Y.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new s.l(e,{originalEvent:i}))}}function Co(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const i={};for(let u=0;u<m.length;u++)i[m[u].identifier]=e[u];return i}class rh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=(function(p){const g=new s.P(0,0);for(const x of p)g._add(x);return g.div(p.length)})(i),this.touches=Co(u,i)))}touchmove(e,i,u){if(this.aborted||!this.centroid)return;const p=Co(u,i);for(const g in this.touches){const x=p[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,i,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class pi{constructor(e){this.singleTap=new rh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,u){this.singleTap.touchstart(e,i,u)}touchmove(e,i,u){this.singleTap.touchmove(e,i,u)}touchend(e,i,u){const p=this.singleTap.touchend(e,i,u);if(p){const g=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Mi{constructor(e){this._tr=new Ta(e),this._zoomIn=new pi({numTouches:1,numTaps:2}),this._zoomOut=new pi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,u){this._zoomIn.touchstart(e,i,u),this._zoomOut.touchstart(e,i,u)}touchmove(e,i,u){this._zoomIn.touchmove(e,i,u),this._zoomOut.touchmove(e,i,u)}touchend(e,i,u){const p=this._zoomIn.touchend(e,i,u),g=this._zoomOut.touchend(e,i,u),x=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const p=Array.isArray(i)?i[0]:i;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Y.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const An=0,Po=2,nh={[An]:1,[Po]:2};class Il{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=Y.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(i,u){const p=nh[u];return i.buttons===void 0||(i.buttons&p)!==p})(e,this._eventButton)}isValidEndEvent(e){return Y.mouseButton(e)===this._eventButton}}class ed{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class us{constructor(e=new Il({checkCorrectEvent:()=>!0}),i=new ed){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,u){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.startMove(i)),(i=>this.oneFingerTouchMoveStateManager.startMove(i)))}endMove(e){this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.endMove(i)),(i=>this.oneFingerTouchMoveStateManager.endMove(i)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.isValidStartEvent(i)),(i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.isValidMoveEvent(i)),(i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.isValidEndEvent(i)),(i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i)))}}const Wa=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class Xa{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,u){return this._calculateTransform(e,i,u)}touchmove(e,i,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,i,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,u){this._calculateTransform(e,i,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,u){u.length>0&&(this._active=!0);const p=Co(u,i),g=new s.P(0,0),x=new s.P(0,0);let M=0;for(const z in p){const R=p[z],j=this._touches[z];j&&(g._add(R),x._add(R.sub(j)),M++,p[z]=R)}if(this._touches=p,this._shouldBePrevented(M)||!x.mag())return;const k=x.div(M);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(M),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ki{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,u){if(!this._firstTwoTouches)return;e.preventDefault();const[p,g]=this._firstTwoTouches,x=mt(u,i,p),M=mt(u,i,g);if(!x||!M)return;const k=this._aroundCenter?null:x.add(M).div(2);return this._move([x,M],k,e)}touchend(e,i,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=mt(u,i,p),M=mt(u,i,g);x&&M||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function mt(m,e,i){for(let u=0;u<m.length;u++)if(m[u].identifier===i)return e[u]}function Ei(m,e){return Math.log(m/e)/Math.LN2}class di extends ki{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ei(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ei(this._distance,u),pinchAround:i}}}function Mo(m,e){return 180*m.angleWith(e)/Math.PI}class Ii extends ki{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,u){const p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mo(this._vector,p),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,u=Mo(e,this._startVector);return Math.abs(u)<i}}function fi(m){return Math.abs(m.y)>Math.abs(m.x)}class Ka extends ki{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,u){super.touchstart(e,i,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,fi(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,u){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,g=i.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==i.y>0;return fi(e)&&fi(i)&&x}}const hr={panStep:100,bearingStep:15,pitchStep:10};class Al{constructor(e){this._tr=new Ta(e);const i=hr;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,u=0,p=0,g=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:M=>{const k=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:ih,zoom:i?Math.round(k.zoom)+i*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ih(m){return m*(2-m)}const ni=4.000244140625,$i=1/450;class tn{constructor(e,i){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Ta(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$i}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=le.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,i!==0&&i%ni==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Y.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(s.S.convert(u.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const M=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ni?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&k!==0&&(k=1/k);const z=typeof this._targetZoom!="number"?e.scale:s.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),s.ak(z*k)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,p=this._easing;let g,x=!1;if(this._type==="wheel"&&u&&p){const M=le.now()-this._lastWheelEventTime,k=Math.min((M+5)/200,1),z=p(k);g=s.C.number(u,i,z),k<1?this._frameId||(this._frameId=!0):x=!0}else g=i,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=s.co;if(this._prevEase){const u=this._prevEase,p=(le.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,M=Math.sqrt(.0729-x*x);i=s.cm(x,M,.25,1)}return this._prevEase={start:le.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class qi{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ic{constructor(e){this._tr=new Ta(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ah{constructor(){this._tap=new pi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,u){if(!this._swipePoint)if(this._tapTime){const p=i[0],g=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;g&&x?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,i,u)}touchmove(e,i,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=i[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,i,u)}touchend(e,i,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(e,i,u);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ac{constructor(e,i,u){this._el=e,this._mousePan=i,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xu{constructor(e,i,u,p){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=u,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class oh{constructor(e,i,u,p){this._el=e,this._touchZoom=i,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class bu{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Y.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=i,this._container.appendChild(p);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=u,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const aa=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Fr extends s.l{}function cs(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class sh{constructor(e,i){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,g)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=p.type==="renderFrame"?void 0:p,M={needsRenderFrame:!1},k={},z={};for(const{handlerName:B,handler:O,allowed:G}of this._handlers){if(!O.isEnabled())continue;let J;if(this._blockedByActive(z,G,B))O.reset();else if(O[g||p.type]){if(s.cp(p,g||p.type)){const te=Y.mousePos(this._map.getCanvas(),p);J=O[g||p.type](p,te)}else if(s.cq(p,g||p.type)){const te=this._getMapTouches(p.touches),re=Y.touchPos(this._map.getCanvas(),te);J=O[g||p.type](p,re,te)}else s.cr(g||p.type)||(J=O[g||p.type](p));this.mergeHandlerResult(M,k,J,B,x),J&&J.needsRenderFrame&&this._triggerRenderFrame()}(J||O.isActive())&&(z[B]=O)}const R={};for(const B in this._previousActiveHandlers)z[B]||(R[B]=x);this._previousActiveHandlers=z,(Object.keys(R).length||cs(M))&&(this._changes.push([M,k,R]),this._triggerRenderFrame()),(Object.keys(z).length||cs(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=M;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ds(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners)Y.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,i,u]of this._listeners)Y.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const i=this._map,u=i.getCanvasContainer();this._add("mapEvent",new hi(i,e));const p=i.boxZoom=new ri(i,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const g=i.cooperativeGestures=new bu(i,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const x=new Mi(i),M=new ic(i);i.doubleClickZoom=new qi(M,x),this._add("tapZoom",x),this._add("clickZoom",M),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const k=new ah;this._add("tapDragZoom",k);const z=i.touchPitch=new Ka(i);this._add("touchPitch",z),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const R=()=>i.project(i.getCenter()),j=(function({enable:ie,clickTolerance:de,aroundCenter:me=!0,minPixelCenterThreshold:se=100,rotateDegreesPerPixelMoved:_e=.8},Ee){const Me=new Il({checkCorrectEvent:ke=>Y.mouseButton(ke)===0&&ke.ctrlKey||Y.mouseButton(ke)===2&&!ke.ctrlKey});return new Ns({clickTolerance:de,move:(ke,De)=>{const tt=Ee();if(me&&Math.abs(tt.y-ke.y)>se)return{bearingDelta:s.cn(new s.P(ke.x,De.y),De,tt)};let it=(De.x-ke.x)*_e;return me&&De.y<tt.y&&(it=-it),{bearingDelta:it}},moveStateManager:Me,enable:ie,assignEvents:Wa})})(e,R),B=(function({enable:ie,clickTolerance:de,pitchDegreesPerPixelMoved:me=-.5}){const se=new Il({checkCorrectEvent:_e=>Y.mouseButton(_e)===0&&_e.ctrlKey||Y.mouseButton(_e)===2});return new Ns({clickTolerance:de,move:(_e,Ee)=>({pitchDelta:(Ee.y-_e.y)*me}),moveStateManager:se,enable:ie,assignEvents:Wa})})(e),O=(function({enable:ie,clickTolerance:de,rollDegreesPerPixelMoved:me=.3},se){const _e=new Il({checkCorrectEvent:Ee=>Y.mouseButton(Ee)===2&&Ee.ctrlKey});return new Ns({clickTolerance:de,move:(Ee,Me)=>{const ke=se();let De=(Me.x-Ee.x)*me;return Me.y<ke.y&&(De=-De),{rollDelta:De}},moveStateManager:_e,enable:ie,assignEvents:Wa})})(e,R);i.dragRotate=new xu(e,j,B,O),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",B,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const G=(function({enable:ie,clickTolerance:de}){const me=new Il({checkCorrectEvent:se=>Y.mouseButton(se)===0&&!se.ctrlKey});return new Ns({clickTolerance:de,move:(se,_e)=>({around:_e,panDelta:_e.sub(se)}),activateOnStart:!0,moveStateManager:me,enable:ie,assignEvents:Wa})})(e),J=new Xa(e,i);i.dragPan=new ac(u,G,J),this._add("mousePan",G),this._add("touchPan",J,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const te=new Ii,re=new di;i.touchZoomRotate=new oh(u,re,te,k),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const ne=i.scrollZoom=new tn(i,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ne,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const ce=i.keyboard=new Al(i);this._add("keyboard",ce),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new ls(i))}_add(e,i,u){this._handlers.push({handlerName:e,handler:i,allowed:u}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!aa(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,u){for(const p in e)if(p!==u&&(!i||i.indexOf(p)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const u of e)this._el.contains(u.target)&&i.push(u);return i}mergeHandlerResult(e,i,u,p,g){if(!u)return;s.e(e,u);const x={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(i.zoom=x),u.panDelta!==void 0&&(i.drag=x),u.rollDelta!==void 0&&(i.roll=x),u.pitchDelta!==void 0&&(i.pitch=x),u.bearingDelta!==void 0&&(i.rotate=x)}_applyChanges(){const e={},i={},u={};for(const[p,g,x]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(e.rollDelta=(e.rollDelta||0)+p.rollDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),s.e(i,g),s.e(u,x);this._updateMapTransform(e,i,u),this._changes=[]}_updateMapTransform(e,i,u){const p=this._map,g=p._getTransformForUpdate(),x=p.terrain;if(!(cs(e)||x&&this._terrainMovement))return this._fireEvents(i,u,!0);p._stop(!0);let{panDelta:M,zoomDelta:k,bearingDelta:z,pitchDelta:R,rollDelta:j,around:B,pinchAround:O}=e;O!==void 0&&(B=O),B=B||p.transform.centerPoint,x&&!g.isPointOnMapSurface(B)&&(B=g.centerPoint);const G={panDelta:M,zoomDelta:k,rollDelta:j,pitchDelta:R,bearingDelta:z,around:B};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(B)&&(B=g.centerPoint);const J=B.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(M?B.sub(M):B);x?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(G,g),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(M))):this._map.cameraHelper.handleMapControlsPan(G,g,J):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(G,g,J))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(G,g),this._map.cameraHelper.handleMapControlsPan(G,g,J)),p._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,u,!0)}_fireEvents(e,i,u){const p=aa(this._eventsInProgress),g=aa(e),x={};for(const j in e){const{originalEvent:B}=e[j];this._eventsInProgress[j]||(x[`${j}start`]=B),this._eventsInProgress[j]=e[j]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const j in x)this._fireEvent(j,x[j]);g&&this._fireEvent("move",g.originalEvent);for(const j in e){const{originalEvent:B}=e[j];this._fireEvent(j,B)}const M={};let k;for(const j in this._eventsInProgress){const{handlerName:B,originalEvent:O}=this._eventsInProgress[j];this._handlersById[B].isActive()||(delete this._eventsInProgress[j],k=i[B]||O,M[`${j}end`]=k)}for(const j in M)this._fireEvent(j,M[j]);const z=aa(this._eventsInProgress),R=(p||g)&&!z;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&j.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(j)}if(u&&R){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!j||!j.essential&&le.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:k})),B(this._map.getBearing())&&this._map.resetNorth()):(B(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new s.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Fr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zl extends s.E{constructor(e,i,u){super(),this._renderFrameCallback=()=>{const p=Math.min((le.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=i,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new s.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,u){return e=s.P.convert(e).mult(-1),this.panTo(this.transform.center,s.e({offset:e},i),u)}panTo(e,i,u){return this.easeTo(s.e({center:e},i),u)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,u){return this.easeTo(s.e({zoom:e},i),u)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new s.l("movestart",i)).fire(new s.l("move",i)).fire(new s.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,u){return this.easeTo(s.e({bearing:e},i),u)}resetNorth(e,i){return this.rotateTo(0,s.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=Qr.convert(e).adjustAntiMeridian();const u=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,i)}_cameraForBoxAndBearing(e,i,u,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=s.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const z=p.padding;p.padding={top:z,bottom:z,right:z,left:z}}const x=s.e(g,p.padding);p.padding=x;const M=this.transform,k=new Qr(e,i);return this.cameraHelper.cameraForBoxAndBearing(p,x,k,u,M)}fitBounds(e,i,u){return this._fitInternal(this.cameraForBounds(e,i),i,u)}fitScreenCoordinates(e,i,u,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(e)),this.transform.screenPointToLocation(s.P.convert(i)),u,p),p,g)}_fitInternal(e,i,u){return e?(delete(i=s.e(e,i)).padding,i.linear?this.easeTo(i,u):this.flyTo(i,u)):this}jumpTo(e,i){this.stop();const u=this._getTransformForUpdate();let p=!1,g=!1,x=!1;const M=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const k=u.zoom!==M;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(p=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(g=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(x=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new s.l("movestart",i)).fire(new s.l("move",i)),k&&this.fire(new s.l("zoomstart",i)).fire(new s.l("zoom",i)).fire(new s.l("zoomend",i)),p&&this.fire(new s.l("rotatestart",i)).fire(new s.l("rotate",i)).fire(new s.l("rotateend",i)),g&&this.fire(new s.l("pitchstart",i)).fire(new s.l("pitch",i)).fire(new s.l("pitchend",i)),x&&this.fire(new s.l("rollstart",i)).fire(new s.l("roll",i)).fire(new s.l("rollend",i)),this.fire(new s.l("moveend",i))}calculateCameraOptionsFromTo(e,i,u,p=0){const g=s.a1.fromLngLat(e,i),x=s.a1.fromLngLat(u,p),M=x.x-g.x,k=x.y-g.y,z=x.z-g.z,R=Math.hypot(M,k,z);if(R===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(M,k),B=s.ak(this.transform.cameraToCenterDistance/R/this.transform.tileSize),O=180*Math.atan2(M,-k)/Math.PI;let G=180*Math.acos(j/R)/Math.PI;return G=z<0?90-G:90+G,{center:x.toLngLat(),elevation:p,zoom:B,pitch:G,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,u,p,g){const x=this.transform.calculateCenterFromCameraLngLatAlt(e,i,u,p);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:u,pitch:p,roll:g}}easeTo(e,i){this._stop(!1,e.easeId),((e=s.e({offset:[0,0],duration:500,easing:s.co},e)).animate===!1||!e.essential&&le.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=this.getBearing(),g=u.pitch,x=u.roll,M="bearing"in e?this._normalizeBearing(e.bearing,p):p,k="pitch"in e?+e.pitch:g,z="roll"in e?this._normalizeBearing(e.roll,x):x,R="padding"in e?e.padding:u.padding,j=s.P.convert(e.offset);let B,O;e.around&&(B=s.S.convert(e.around),O=u.locationToScreenPoint(B));const G={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},J=this.cameraHelper.handleEaseTo(u,{bearing:M,pitch:k,roll:z,padding:R,around:B,aroundPoint:O,offsetAsPoint:j,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||p!==M,this._pitching=this._pitching||k!==g,this._rolling=this._rolling||z!==x,this._padding=!u.isPaddingEqual(R),this._zooming=this._zooming||J.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,G),this.terrain&&this._prepareElevation(J.elevationCenter),this._ease((te=>{J.easeFunc(te),this.terrain&&!e.freezeElevation&&this._updateElevation(te),this._applyUpdatedTransform(u),this._fireMoveEvents(i)}),(te=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,te)}),e),this}_prepareEase(e,i,u={}){this._moving=!0,i||u.moving||this.fire(new s.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new s.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new s.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new s.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new s.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(i-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(s.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),u=e.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(u<p){const g=this.calculateCameraOptionsFromTo(i,p,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&i.push((p=>this.transformCameraUpdate(p))),!i.length)return;const u=e.clone();for(const p of i){const g=u.clone(),{center:x,zoom:M,roll:k,pitch:z,bearing:R,elevation:j}=p(g);x&&g.setCenter(x),j!==void 0&&g.setElevation(j),M!==void 0&&g.setZoom(M),k!==void 0&&g.setRoll(k),z!==void 0&&g.setPitch(z),R!==void 0&&g.setBearing(R),u.apply(g)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new s.l("move",e)),this._zooming&&this.fire(new s.l("zoom",e)),this._rotating&&this.fire(new s.l("rotate",e)),this._pitching&&this.fire(new s.l("pitch",e)),this._rolling&&this.fire(new s.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const u=this._zooming,p=this._rotating,g=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new s.l("zoomend",e)),p&&this.fire(new s.l("rotateend",e)),g&&this.fire(new s.l("pitchend",e)),x&&this.fire(new s.l("rollend",e)),this.fire(new s.l("moveend",e))}flyTo(e,i){if(!e.essential&&le.prefersReducedMotion){const De=s.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(De,i)}this.stop(),e=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.co},e);const u=this._getTransformForUpdate(),p=u.bearing,g=u.pitch,x=u.roll,M=u.padding,k="bearing"in e?this._normalizeBearing(e.bearing,p):p,z="pitch"in e?+e.pitch:g,R="roll"in e?this._normalizeBearing(e.roll,x):x,j="padding"in e?e.padding:u.padding,B=s.P.convert(e.offset);let O=u.centerPoint.add(B);const G=u.screenPointToLocation(O),J=this.cameraHelper.handleFlyTo(u,{bearing:k,pitch:z,roll:R,padding:j,locationAtOffset:G,offsetAsPoint:B,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let te=e.curve;const re=Math.max(u.width,u.height),ne=re/J.scaleOfZoom,ce=J.pixelPathLength;typeof J.scaleOfMinZoom=="number"&&(te=Math.sqrt(re/J.scaleOfMinZoom/ce*2));const ie=te*te;function de(De){const tt=(ne*ne-re*re+(De?-1:1)*ie*ie*ce*ce)/(2*(De?ne:re)*ie*ce);return Math.log(Math.sqrt(tt*tt+1)-tt)}function me(De){return(Math.exp(De)-Math.exp(-De))/2}function se(De){return(Math.exp(De)+Math.exp(-De))/2}const _e=de(!1);let Ee=function(De){return se(_e)/se(_e+te*De)},Me=function(De){return re*((se(_e)*(me(tt=_e+te*De)/se(tt))-me(_e))/ie)/ce;var tt},ke=(de(!0)-_e)/te;if(Math.abs(ce)<2e-6||!isFinite(ke)){if(Math.abs(re-ne)<1e-6)return this.easeTo(e,i);const De=ne<re?-1:1;ke=Math.abs(Math.log(ne/re))/te,Me=()=>0,Ee=tt=>Math.exp(De*te*tt)}return e.duration="duration"in e?+e.duration:1e3*ke/("screenSpeed"in e?+e.screenSpeed/te:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=p!==k,this._pitching=z!==g,this._rolling=R!==x,this._padding=!u.isPaddingEqual(j),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(J.targetCenter),this._ease((De=>{const tt=De*ke,it=1/Ee(tt),We=Me(tt);this._rotating&&u.setBearing(s.C.number(p,k,De)),this._pitching&&u.setPitch(s.C.number(g,z,De)),this._rolling&&u.setRoll(s.C.number(x,R,De)),this._padding&&(u.interpolatePadding(M,j,De),O=u.centerPoint.add(B)),J.easeFunc(De,it,We,O),this.terrain&&!e.freezeElevation&&this._updateElevation(De),this._applyUpdatedTransform(u),this._fireMoveEvents(i)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,i)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,i,u){u.animate===!1||u.duration===0?(e(1),i()):(this._easeStart=le.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=s.aO(e,-180,180);const u=Math.abs(e-i);return Math.abs(e-360-i)<u&&(e-=360),Math.abs(e+360-i)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(s.S.convert(e),this.transform.tileZoom):null}}const Ll={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class oc{constructor(e=Ll){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const u=this._map._getUIString(`AttributionControl.${i}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const i=this._map.style.sourceCaches;for(const p in i){const g=i[p];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter((p=>String(p).trim())),e.sort(((p,g)=>p.length-g.length)),e=e.filter(((p,g)=>{for(let x=g+1;x<e.length;x++)if(e[x].indexOf(p)>=0)return!1;return!0}));const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=Y.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class lh{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const i=Y.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class mi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,u=i?this._queue.concat(i):this._queue;for(const p of u)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const u of i)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var wu=s.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class wt extends s.E{constructor(e){super(),this._lastTilesetChange=le.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const u={};for(const p of Te(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),s.bY(p.terrainRttPosMatrix32f,0,s.$,s.$,0,0,1),this._tiles[p.key]=new uo(p,this.tileSize),this._lastTilesetChange=le.now());for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(e){for(const i in this._tiles){const u=this._tiles[i];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID,g=e.clone(),x=s.ba();if(p.canonical.equals(e.canonical))s.bY(x,0,s.$,s.$,0,0,1);else if(p.canonical.isChildOf(e.canonical)){const M=p.canonical.z-e.canonical.z,k=p.canonical.x-(p.canonical.x>>M<<M),z=p.canonical.y-(p.canonical.y>>M<<M),R=s.$>>M;s.bY(x,0,R,R,0,0,1),s.M(x,x,[-k*R,-z*R,0])}else{if(!e.canonical.isChildOf(p.canonical))continue;{const M=e.canonical.z-p.canonical.z,k=e.canonical.x-(e.canonical.x>>M<<M),z=e.canonical.y-(e.canonical.y>>M<<M),R=s.$>>M;s.bY(x,0,s.$,s.$,0,0,1),s.M(x,x,[k*R,z*R,0]),s.N(x,x,[1/2**M,1/2**M,0])}}g.terrainRttPosMatrix32f=new Float32Array(x),i[u]=g}return i}_getTerrainCoordsForTileRanges(e,i){const u={};for(const p of this._renderableTilesKeys){const g=this._tiles[p].tileID;if(!this._isWithinTileRanges(g,i))continue;const x=e.clone(),M=s.ba();if(g.canonical.z===e.canonical.z){const k=e.canonical.x-g.canonical.x,z=e.canonical.y-g.canonical.y;s.bY(M,0,s.$,s.$,0,0,1),s.M(M,M,[k*s.$,z*s.$,0])}else if(g.canonical.z>e.canonical.z){const k=g.canonical.z-e.canonical.z,z=g.canonical.x-(g.canonical.x>>k<<k),R=g.canonical.y-(g.canonical.y>>k<<k),j=e.canonical.x-(g.canonical.x>>k),B=e.canonical.y-(g.canonical.y>>k),O=s.$>>k;s.bY(M,0,O,O,0,0,1),s.M(M,M,[-z*O+j*s.$,-R*O+B*s.$,0])}else{const k=e.canonical.z-g.canonical.z,z=e.canonical.x-(e.canonical.x>>k<<k),R=e.canonical.y-(e.canonical.y>>k<<k),j=(e.canonical.x>>k)-g.canonical.x,B=(e.canonical.y>>k)-g.canonical.y,O=s.$<<k;s.bY(M,0,O,O,0,0,1),s.M(M,M,[z*s.$+j*O,R*s.$+B*O,0])}x.terrainRttPosMatrix32f=new Float32Array(M),u[p]=x}return u}getSourceTile(e,i){const u=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&i)for(;p>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(p--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class zt{constructor(e,i,u){this._meshCache={},this.painter=e,this.sourceCache=new wt(i),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,u,p=s.$){var g;if(!(i>=0&&i<p&&u>=0&&u<p))return 0;const x=this.getTerrainData(e),M=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!M)return 0;const k=s.cs([],[i/p*s.$,u/p*s.$],x.u_terrain_matrix),z=[k[0]*M.dim,k[1]*M.dim],R=Math.floor(z[0]),j=Math.floor(z[1]),B=z[0]-R,O=z[1]-j;return M.get(R,j)*(1-B)*(1-O)+M.get(R+1,j)*B*(1-O)+M.get(R,j+1)*(1-B)*O+M.get(R+1,j+1)*B*O}getElevationForLngLatZoom(e,i){if(!s.ct(i,e.wrap()))return 0;const{tileID:u,mercatorX:p,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(u,p%s.$,g%s.$,s.$)}getElevation(e,i,u,p=s.$){return this.getDEMElevation(e,i,u,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.painter.context,g=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(p,new s.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ag([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const p=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new s.T(p,i.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),i.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const u=i&&i+i.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?g=e.canonical.z-p:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>g<<g),M=e.canonical.y-(e.canonical.y>>g<<g),k=s.cu(new Float64Array(16),[1/(s.$<<g),1/(s.$<<g),0]);s.M(k,k,[x*s.$,M*s.$,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,u=i.width/devicePixelRatio,p=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(i.context,{width:u,height:p,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(i.context,{width:u,height:p,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let M=0;M<this._coordsTextureSize;M++,x+=4)i[x+0]=255&M,i[x+1]=255&g,i[x+2]=M>>8<<4|g>>8,i[x+3]=0;const u=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),p=new s.T(e,u,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),u=this.painter.context,p=u.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(g,M-x-1,1,1,p.RGBA,p.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null);const k=i[0]+(i[2]>>4<<8),z=i[1]+((15&i[2])<<8),R=this.coordsIndex[255-i[3]],j=R&&this.sourceCache.getTileByID(R);if(!j)return null;const B=this._coordsTextureSize,O=(1<<j.tileID.canonical.z)*B;return new s.a1((j.tileID.canonical.x*B+k)/O+j.tileID.wrap,(j.tileID.canonical.y*B+z)/O,this.getElevation(j.tileID,k,z,B))}depthAtPoint(e){const i=new Uint8Array(4),u=this.painter.context,p=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const u=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,p=u&&e.canonical.y===0,g=u&&e.canonical.y===(1<<e.canonical.z)-1,x=`m_${p?"n":""}_${g?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const M=this.painter.context,k=new s.cv,z=new s.aN,R=this.meshSize,j=s.$/R,B=R*R;for(let se=0;se<=R;se++)for(let _e=0;_e<=R;_e++)k.emplaceBack(_e*j,se*j,0);for(let se=0;se<B;se+=R+1)for(let _e=0;_e<R;_e++)z.emplaceBack(_e+se,R+_e+se+1,R+_e+se+2),z.emplaceBack(_e+se,R+_e+se+2,_e+se+1);const O=k.length,G=O+(R+1),J=(R+1)*R,te=p?s.bh:0,re=p?0:1,ne=g?s.bi:s.$,ce=g?0:1;for(let se=0;se<=R;se++)k.emplaceBack(se*j,te,re);for(let se=0;se<=R;se++)k.emplaceBack(se*j,ne,ce);for(let se=0;se<R;se++)z.emplaceBack(J+se,G+se,G+se+1),z.emplaceBack(J+se,G+se+1,J+se+1),z.emplaceBack(0+se,O+se+1,O+se),z.emplaceBack(0+se,0+se+1,O+se+1);const ie=k.length,de=ie+2*(R+1);for(const se of[0,1])for(let _e=0;_e<=R;_e++)for(const Ee of[0,1])k.emplaceBack(se*s.$,_e*j,Ee);for(let se=0;se<2*R;se+=2)z.emplaceBack(ie+se,ie+se+1,ie+se+3),z.emplaceBack(ie+se,ie+se+3,ie+se+2),z.emplaceBack(de+se,de+se+3,de+se+1),z.emplaceBack(de+se,de+se+2,de+se+3);const me=new ho(M.createVertexBuffer(k,wu.members),M.createIndexBuffer(z),s.aM.simpleSegment(0,0,k.length,z.length));return this._meshCache[x]=me,me}getMeshFrameDelta(e){return 2*Math.PI*s.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var u;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return i&&i.dem&&(u.minElevation=i.dem.min*this.exaggeration,u.maxElevation=i.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,i){const u=s.a1.fromLngLat(e.wrap()),p=(1<<i)*s.$,g=u.x*p,x=u.y*p,M=Math.floor(g/s.$),k=Math.floor(x/s.$);return{tileID:new s.Z(i,0,i,M,k),mercatorX:g,mercatorY:x}}}class ko{constructor(e,i,u){this._context=e,this._size=i,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(u.texture),{id:e,fbo:i,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((i=>e.id!==i)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const Ya={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Rl{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new ko(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((u=>!e._layers[u].isHidden(i))),this._coordsAscending={};for(const u in e.sourceCaches){this._coordsAscending[u]={};const p=e.sourceCaches[u].getVisibleCoordinates(),g=e.sourceCaches[u].getSource(),x=g instanceof ta?g.terrainTileRanges:null;for(const M of p){const k=this.terrain.sourceCache.getTerrainCoords(M,x);for(const z in k)this._coordsAscending[u][z]||(this._coordsAscending[u][z]=[]),this._coordsAscending[u][z].push(k[z])}}this._coordsAscendingStr={};for(const u of e._order){const p=e._layers[u],g=p.source;if(Ya[p.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const x in this._coordsAscending[g])this._coordsAscendingStr[g][x]=this._coordsAscending[g][x].map((M=>M.key)).sort().join()}}for(const u of this._renderableTiles)for(const p in this._coordsAscendingStr){const g=this._coordsAscendingStr[p][u.tileID.key];g&&g!==u.rttCoords[p]&&(u.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),p=e.type,g=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ya[p]&&(this._prevType&&Ya[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(e.id),!x))return!0;if(Ya[this._prevType]||Ya[p]&&x){this._prevType=p;const M=this._stacks.length-1,k=this._stacks[M]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(Ui(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[M]){const j=this.pool.getObjectForId(z.rtt[M].id);if(j.stamp===z.rtt[M].stamp){this.pool.useObject(j);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),z.rtt[M]={id:R.id,stamp:R.stamp},g.context.bindFramebuffer.set(R.fbo.framebuffer),g.context.clear({color:s.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let j=0;j<k.length;j++){const B=g.style._layers[k[j]],O=B.source?this._coordsAscending[B.source][z.tileID.key]:[z.tileID];g.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),g._renderTileClippingMasks(B,O,!0),g.renderLayer(g,g.style.sourceCaches[B.source],B,O,u),B.source&&(z.rttCoords[B.source]=this._coordsAscendingStr[B.source][z.tileID.key])}}return Ui(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),Ya[p]}return!1}}const Wn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},sc=N,Xn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ll,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},oa={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ca{constructor(e,i,u=!1){this.mousedown=g=>{this.startMove(g,Y.mousePos(this.element,g)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,Y.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const p=new us;this._rotatePitchHandler=new Ns({clickTolerance:3,move:(g,x)=>{const M=i.getBoundingClientRect(),k=new s.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:s.cn(new s.P(g.x,x.y),x,k),pitchDelta:u?-.5*(x.y-g.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=e,Y.addEventListener(i,"mousedown",this.mousedown),Y.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHandler.dragStart(e,i),Y.disableDrag()}move(e,i){const u=this.map,{bearingDelta:p,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,i)||{};p&&u.setBearing(u.getBearing()+p),g&&u.setPitch(u.getPitch()+g)}off(){const e=this.element;Y.removeEventListener(e,"mousedown",this.mousedown),Y.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let Ar;function on(m,e,i,u=!1){if(u||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const p=new s.S(m.lng,m.lat);if(m=new s.S(m.lng,m.lat),e){const g=new s.S(m.lng-360,m.lat),x=new s.S(m.lng+360,m.lat),M=i.locationToScreenPoint(m).distSqr(e);i.locationToScreenPoint(g).distSqr(e)<M?m=g:i.locationToScreenPoint(x).distSqr(e)<M&&(m=x)}for(;Math.abs(m.lng-i.center.lng)>180;){const g=i.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=i.width&&g.y<=i.height)break;m.lng>i.center.lng?m.lng-=360:m.lng+=360}return m.lng!==p.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(m))?m:p}const sa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gi(m,e,i){const u=m.classList;for(const p in sa)u.remove(`maplibregl-${i}-anchor-${p}`);u.add(`maplibregl-${i}-anchor-${e}`)}class hs extends s.E{constructor(e){if(super(),this._onKeyPress=i=>{const u=i.code,p=i.charCode||i.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=i=>{const u=i.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(i?.type==="terrain"||i?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=on(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${sa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${p}`),le.frameAsync(new AbortController).then((()=>{this._updateOpacity(i&&i.type==="moveend")})).catch((()=>{}))},this._onMove=i=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=s.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div");const i=Y.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${u}px`),i.setAttributeNS(null,"width",`${p}px`),i.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const g=Y.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=Y.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const M=Y.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of k){const ne=Y.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",re.rx),ne.setAttributeNS(null,"ry",re.ry),M.appendChild(ne)}const z=Y.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const R=Y.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(R);const j=Y.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const B=Y.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(B);const O=Y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");const G=Y.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=Y.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const te=Y.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#FFFFFF"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962"),G.appendChild(J),G.appendChild(te),x.appendChild(M),x.appendChild(z),x.appendChild(j),x.appendChild(O),x.appendChild(G),i.appendChild(x),i.setAttributeNS(null,"height",u*this._scale+"px"),i.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(i),this._offset=s.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(i=>{i.preventDefault()})),this._element.addEventListener("mousedown",(i=>{i.preventDefault()})),Gi(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=s.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,u;const p=(i=this._map)===null||i===void 0?void 0:i.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!p||g){const O=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const x=this._map,M=x.terrain.depthAtPoint(this._pos),k=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,k)-M<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/x.transform.pixelsPerMeter,R=Math.sin(x.getPitch()*Math.PI/180)*z,j=x.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),B=x.transform.lngLatToCameraDepth(this._lngLat,k+R)-j>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&B&&this._popup.remove(),this._element.style.opacity=B?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=s.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const lc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ai=0,zi=!1;const ps={maxWidth:100,unit:"metric"};function Su(m,e,i){const u=i&&i.maxWidth||100,p=m._container.clientHeight/2,g=m._container.clientWidth/2,x=m.unproject([g-u/2,p]),M=m.unproject([g+u/2,p]),k=Math.round(m.project(M).x-m.project(x).x),z=Math.min(u,k,m._container.clientWidth),R=x.distanceTo(M);if(i&&i.unit==="imperial"){const j=3.2808*R;j>5280?Ja(e,z,j/5280,m._getUIString("ScaleControl.Miles")):Ja(e,z,j,m._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Ja(e,z,R/1852,m._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Ja(e,z,R/1e3,m._getUIString("ScaleControl.Kilometers")):Ja(e,z,R,m._getUIString("ScaleControl.Meters"))}function Ja(m,e,i,u){const p=(function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let M=g/x;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(k){const z=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*z)/z})(M),x*M})(i);m.style.width=e*(p/i)+"px",m.innerHTML=`${p}&nbsp;${u}`}const uc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Fs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zi(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,m),"top-left":new s.P(e,e),"top-right":new s.P(-e,e),bottom:new s.P(0,-m),"bottom-left":new s.P(e,-e),"bottom-right":new s.P(-e,-e),left:new s.P(m,0),right:new s.P(-m,0)}}if(m instanceof s.P||Array.isArray(m)){const e=s.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:s.P.convert(m.center||[0,0]),top:s.P.convert(m.top||[0,0]),"top-left":s.P.convert(m["top-left"]||[0,0]),"top-right":s.P.convert(m["top-right"]||[0,0]),bottom:s.P.convert(m.bottom||[0,0]),"bottom-left":s.P.convert(m["bottom-left"]||[0,0]),"bottom-right":s.P.convert(m["bottom-right"]||[0,0]),left:s.P.convert(m.left||[0,0]),right:s.P.convert(m.right||[0,0])}}return Zi(new s.P(0,0))}const Bs=N;b.AJAXError=s.cz,b.Event=s.l,b.Evented=s.E,b.LngLat=s.S,b.MercatorCoordinate=s.a1,b.Point=s.P,b.addProtocol=s.cA,b.config=s.a,b.removeProtocol=s.cB,b.AttributionControl=oc,b.BoxZoomHandler=ri,b.CanvasSource=Fi,b.CooperativeGesturesHandler=bu,b.DoubleClickZoomHandler=qi,b.DragPanHandler=ac,b.DragRotateHandler=xu,b.EdgeInsets=Va,b.FullscreenControl=class extends s.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=fa,b.GeolocateControl=class extends s.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new s.S(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,p=this._map.getBearing(),g=s.e({bearing:p},this.options.fitBoundsOptions),x=Qr.fromLngLat(i,u);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new s.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&zi)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new hs({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(i=>{const u=i?.[0]instanceof ResizeObserverEntry;i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},lc,m)}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(e=!1){if(Ar!==void 0&&!e)return Ar;if(window.navigator.permissions===void 0)return Ar=!!window.navigator.geolocation,Ar;try{Ar=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ar=!!window.navigator.geolocation}return Ar}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ai=0,zi=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),i=m.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),i=m.getNorthEast(),u=e.distanceTo(i),p=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ai--,zi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ai++,Ai>1?(m={maximumAge:6e5,timeout:0},zi=!0):(m=this.options.positionOptions,zi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Y.create("button","maplibregl-ctrl-globe",this._container),Y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=rc,b.ImageSource=ta,b.KeyboardHandler=Al,b.LngLatBounds=Qr,b.LogoControl=lh,b.Map=class extends zl{constructor(m){var e,i;s.cw.mark(s.cx.create);const u=Object.assign(Object.assign(Object.assign({},Xn),m),{canvasContextAttributes:Object.assign(Object.assign({},Xn.canvasContextAttributes),m.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new Zr,g=new Zn;if(u.minZoom!==void 0&&p.setMinZoom(u.minZoom),u.maxZoom!==void 0&&p.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&p.setMinPitch(u.minPitch),u.maxPitch!==void 0&&p.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&p.setRenderWorldCopies(u.renderWorldCopies),super(p,g,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new mi,this._controls=[],this._mapId=s.a7(),this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Wn),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Le.addThrottleControl((()=>this.isMoving())),this._requestManager=new Re(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let M=!1;const k=wo((z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((z=>{M?k(z):M=!0})),this._resizeObserver.observe(this._container)}this.handlers=new sh(this,u),this._hash=u.hash&&new rc(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,s.e({},u.fitBoundsOptions,{duration:0}))));const x=typeof u.style=="string"||((i=(e=u.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new oc(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new lh,u.logoPosition),this.on("style.load",(()=>{if(x||this._resizeTransform(),this.transform.unmodified){const M=s.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}})),this.on("data",(M=>{this._update(M.dataType==="style"),this.fire(new s.l(`${M.dataType}data`,M))})),this.on("dataloading",(M=>{this.fire(new s.l(`${M.dataType}dataloading`,M))})),this.on("dataabort",(M=>{this.fire(new s.l("sourcedataabort",M))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(i,u.firstChild):u.appendChild(i),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,i,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,i,u)}resize(m,e=!0){const[i,u]=this._containerDimensions(),p=this._getClampedPixelRatio(i,u);if(this._resizeCanvas(i,u,p),this.painter.resize(i,u,p),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const M=this._getClampedPixelRatio(i,u);this._resizeCanvas(i,u,M),this.painter.resize(i,u,M)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new s.l("movestart",m)).fire(new s.l("move",m))),this.fire(new s.l("resize",m)),g&&this.fire(new s.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[i,u]=this._containerDimensions();this.transform.resize(i,u,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,u,m)}_getClampedPixelRatio(m,e){const{0:i,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),g=m*p,x=e*p;return Math.min(g>i?i/g:1,x>u?u/x:1)*p}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Qr.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(s.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(s.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,i){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:g=>{const x=e.filter((k=>this.getLayer(k))),M=x.length!==0?this.queryRenderedFeatures(g.point,{layers:x}):[];M.length?u||(u=!0,i.call(this,new pr(m,this,g.originalEvent,{features:M}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:x=>{const M=e.filter((k=>this.getLayer(k)));(M.length!==0?this.queryRenderedFeatures(x.point,{layers:M}):[]).length?u=!0:u&&(u=!1,i.call(this,new pr(m,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,i.call(this,new pr(m,this,x.originalEvent)))}}}}{const u=p=>{const g=e.filter((M=>this.getLayer(M))),x=g.length!==0?this.queryRenderedFeatures(p.point,{layers:g}):[];x.length&&(p.features=x,i.call(this,p),delete p.features)};return{layers:e,listener:i,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,i){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let p=0;p<u.length;p++){const g=u[p];if(g.listener===i&&g.layers.length===e.length&&g.layers.every((x=>e.includes(x)))){for(const x in g.delegates)this.off(x,g.delegates[x]);return void u.splice(p,1)}}}on(m,e,i){if(i===void 0)return super.on(m,e);const u=typeof e=="string"?[e]:e,p=this._createDelegatedListener(m,u,i);this._saveDelegatedListener(m,p);for(const g in p.delegates)this.on(g,p.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,u,i)}}}once(m,e,i){if(i===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,p=this._createDelegatedListener(m,u,i);for(const g in p.delegates){const x=p.delegates[g];p.delegates[g]=(...M)=>{this._removeDelegatedListener(m,u,i),x(...M)}}this._saveDelegatedListener(m,p);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(m,e,i){return i===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let i;const u=m instanceof s.P||Array.isArray(m),p=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},p instanceof s.P||typeof p[0]=="number")i=[s.P.convert(p)];else{const g=s.P.convert(p[0]),x=s.P.convert(p[1]);i=[g,new s.P(x.x,g.y),x,new s.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var i,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));const p=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Dc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,p):this.style.loadJSON(m,e,p),this):((u=(i=this.style)===null||i===void 0?void 0:i.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Dc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const i=this._requestManager.transformRequest(m,"Style");s.j(i,new AbortController).then((u=>{this._updateDiff(u.data,e)})).catch((u=>{u&&this.fire(new s.k(u))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(i){s.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new s.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const u=this.style._layers[i];u.type==="hillshade"&&u.source===m.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===m.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zt(this.painter,e,m),this.painter.renderToTexture=new Rl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var u;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=i.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const i=m[e]._tiles;for(const u in i){const p=i[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,i){if(i){const u=this.getSource(i);if(!u)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);u.calculateTileZoom=Ke(Math.max(1,m),Math.max(1,e))}else for(const u in this.style.sourceCaches)this.style.sourceCaches[u].getSource().calculateTileZoom=Ke(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const i=this.style.sourceCaches[m];if(!i)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);e===void 0?i.reload(!0):i.refreshTiles(e.map((u=>new s.a4(u.z,u.x,u.y))))}addImage(m,e,i={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:g,stretchY:x,content:M,textFitWidth:k,textFitHeight:z}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||s.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:j,data:B}=e,O=e;return this.style.addImage(m,{data:new s.R({width:R,height:j},new Uint8Array(B)),pixelRatio:u,stretchX:g,stretchY:x,content:M,textFitWidth:k,textFitHeight:z,sdf:p,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m),this}}{const{width:R,height:j,data:B}=le.getImageData(e);this.style.addImage(m,{data:new s.R({width:R,height:j},B),pixelRatio:u,stretchX:g,stretchY:x,content:M,textFitWidth:k,textFitHeight:z,sdf:p,version:0})}}updateImage(m,e){const i=this.style.getImage(m);if(!i)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||s.b(e)?le.getImageData(e):e,{width:p,height:g,data:x}=u;if(p===void 0||g===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==i.data.width||g!==i.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(e instanceof HTMLImageElement||s.b(e));return i.data.replace(x,M),this.style.updateImage(m,i),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Le.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,i){return this.style.setLayerZoomRange(m,e,i),this._update(!0)}setFilter(m,e,i={}){return this.style.setFilter(m,e,i),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,i,u={}){return this.style.setPaintProperty(m,e,i,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,i,u={}){return this.style.setLayoutProperty(m,e,i,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,i,(u=>{u||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(i=>{i||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=Y.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),u=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],u);const p=this._controlContainer=Y.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{g[x]=Y.create("div",`maplibregl-ctrl-${x} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,i){this._canvas.width=Math.floor(i*m),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)}),{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!i){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Ha(i,this.transform),Be.testSupport(i)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,i,u,p,g;const x=this._idleTriggered?this._fadeDuration:0,M=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,B=le.now();this.style.zoomHistory.update(j,B);const O=new s.F(j,{now:B,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),G=O.crossFadingFactor();G===1&&G===this._crossFadingFactor||(k=!0,this._crossFadingFactor=G),this.style.update(O)}const z=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==M;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cw.mark(s.cx.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,s.cw.mark(s.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Le.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cw.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,le.frame(this._frameRequest,(m=>{s.cw.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!s.cy(e)&&!(function(i){return i.message===du})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return sc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},b.MapMouseEvent=pr,b.MapTouchEvent=Vi,b.MapWheelEvent=Vn,b.Marker=hs,b.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const u=this._map._getUIString(`NavigationControl.${i}`);e.title=u,e.setAttribute("aria-label",u)},this.options=s.e({},oa,m),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ca(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const i=Y.create("button",m,this._container);return i.type="button",i.addEventListener("click",e),i}},b.Popup=class extends s.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=on(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const p=Zi(this.options.offset);if(!u){const x=this._container.offsetWidth,M=this._container.offsetHeight;let k;k=i.y+p.bottom.y<M?["top"]:i.y>this._map.transform.height-M?["bottom"]:[],i.x<x/2?k.push("left"):i.x>this._map.transform.width-x/2&&k.push("right"),u=k.length===0?"bottom":k.join("-")}let g=i.add(p[u]);this.options.subpixelPositioning||(g=g.round()),Y.setTransform(this._container,`${sa[u]} translate(${g.x}px,${g.y}px)`),Gi(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(uc),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=s.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),i=document.createElement("body");let u;for(i.innerHTML=m;u=i.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Fs);m&&m.focus()}},b.RasterDEMTileSource=ao,b.RasterTileSource=da,b.ScaleControl=class{constructor(m){this._onMove=()=>{Su(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Su(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ps),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=tn,b.Style=Dc,b.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=Ka,b.TwoFingersTouchRotateHandler=Ii,b.TwoFingersTouchZoomHandler=di,b.TwoFingersTouchZoomRotateHandler=oh,b.VectorTileSource=ea,b.VideoSource=Na,b.addSourceType=(m,e)=>s._(void 0,void 0,void 0,(function*(){if(oo(m))throw new Error(`A source type called "${m}" already exists.`);((i,u)=>{Fa[i]=u})(m,e)})),b.clearPrewarmedResources=function(){const m=Wt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(bt),Wt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=cl,b.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return Ba().getRTLTextPluginStatus()},b.getVersion=function(){return Bs},b.getWorkerCount=function(){return Pe.workerCount},b.getWorkerUrl=function(){return s.a.WORKER_URL},b.importScriptInWorkers=function(m){return Ir().broadcast("IS",m)},b.prewarm=function(){mr().acquire(bt)},b.setMaxParallelImageRequests=function(m){s.a.MAX_PARALLEL_IMAGE_REQUESTS=m},b.setRTLTextPlugin=function(m,e){return Ba().setRTLTextPlugin(m,e)},b.setWorkerCount=function(m){Pe.workerCount=m},b.setWorkerUrl=function(m){s.a.WORKER_URL=m}}));var E=f;return E}))})(Yf)),Yf.exports}var qx=$x();const Dt=o0(qx);function Gx(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class Zx{constructor(){this._apiKey="",this._fetch=Gx(),this.tileCacheSize=200}set apiKey(l){this._apiKey=l}get apiKey(){return this._apiKey}set fetch(l){this._fetch=l}get fetch(){return this._fetch}}const Dp=new Zx,Hx={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},Wx={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},ef={...Hx,...Wx};function Xx(d,l=ef){return d in l?d[d]:null}function bg(d,l=ef){for(const f of Object.values(l))if(f.code===d)return f;return null}function wg(d,l=ef){for(const f of Object.values(l))if(f.flag===d)return f;return null}function Kx(d){return d!==null&&typeof d=="object"&&"code"in d&&"flag"in d&&"name"in d&&"latin"in d&&"isMode"in d&&"geocoding"in d&&(typeof d.code=="string"||d.code===null)&&typeof d.flag=="string"&&typeof d.name=="string"&&typeof d.latin=="boolean"&&typeof d.isMode=="boolean"&&typeof d.geocoding=="boolean"}function r_(d,l=ef){return Kx(d)?wg(d.flag,l):typeof d!="string"?null:Xx(d,l)||bg(d,l)||wg(d,l)||null}async function Yx(d,l={}){if(Dp.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(d).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Dp.fetch(d,l)}const c0={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(c0);class Jx extends Error{constructor(l,f=""){super(`Call to enpoint ${l.url} failed with the status code ${l.status}. ${f}`),this.res=l}}const n_={403:"Key is missing, invalid or restricted"};async function Qx(d={}){const l=new URL("geolocation/ip.json",c0.maptilerApiURL);l.searchParams.set("key",d.apiKey??Dp.apiKey),"elevation"in d&&l.searchParams.set("elevation",d.elevation?"true":"false");const f=l.toString(),S=await Yx(f);if(!S.ok)throw new Jx(S,S.status in n_?n_[S.status]:"");return await S.json()}const i_={info:Qx};function h0(d){const l=/^maptiler:\/\/(.*)/;let f;const S=d.trim();let T;return S.startsWith("http://")||S.startsWith("https://")?T=S:(f=l.exec(S))!==null?T=`https://api.maptiler.com/maps/${f[1]}/style.json`:T=`https://api.maptiler.com/maps/${S}/style.json`,T}class p0{constructor(l,f,S,T,E,b,s=!1){this.name=l,this.variantType=f,this.id=S,this.referenceStyle=T,this.description=E,this.imageURL=b,this.deprecated=s}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(l){return this.referenceStyle.hasVariant(l)}getVariant(l){const f=this.referenceStyle.getVariant(l);return this.warnIfDeprecated(f),f}getVariants(){return this.referenceStyle.getVariants().filter(l=>l!==this).map(l=>(this.warnIfDeprecated(l),l))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return h0(this.getId())}warnIfDeprecated(l=this){if(!l.deprecated)return l;const f=l.getFullName();return console.warn(`Style "${f}" is deprecated and will be removed in a future version.`),l}}class d0{constructor(l,f){this.name=l,this.id=f,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(l){this.variants[l.getType()]=l,this.orderedVariants.push(l)}hasVariant(l){return l in this.variants}getVariant(l){return l in this.variants?this.variants[l]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const Od=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function e1(d){return new Proxy(d,{get(l,f,S){return l.hasVariant(f)?l.getVariant(f):f.toString().toUpperCase()===f?d.getDefaultVariant():Reflect.get(l,f,S)}})}function t1(){const d={};for(let l=0;l<Od.length;l+=1){const f=Od[l],S=e1(new d0(f.name,f.referenceStyleID));for(let T=0;T<f.variants.length;T+=1){const E=f.variants[T],b=new p0(E.name,E.variantType,E.id,S,E.description,E.imageURL,E.deprecated);S.addVariant(b)}d[f.referenceStyleID]=S}return d}const Np=t1();var $f={exports:{}},a_;function r1(){if(a_)return $f.exports;a_=1;var d=typeof Reflect=="object"?Reflect:null,l=d&&typeof d.apply=="function"?d.apply:function(Re,Ue,pt){return Function.prototype.apply.call(Re,Ue,pt)},f;d&&typeof d.ownKeys=="function"?f=d.ownKeys:Object.getOwnPropertySymbols?f=function(Re){return Object.getOwnPropertyNames(Re).concat(Object.getOwnPropertySymbols(Re))}:f=function(Re){return Object.getOwnPropertyNames(Re)};function S(Le){console&&console.warn&&console.warn(Le)}var T=Number.isNaN||function(Re){return Re!==Re};function E(){E.init.call(this)}$f.exports=E,$f.exports.once=He,E.EventEmitter=E,E.prototype._events=void 0,E.prototype._eventsCount=0,E.prototype._maxListeners=void 0;var b=10;function s(Le){if(typeof Le!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Le)}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(Le){if(typeof Le!="number"||Le<0||T(Le))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Le+".");b=Le}}),E.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},E.prototype.setMaxListeners=function(Re){if(typeof Re!="number"||Re<0||T(Re))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Re+".");return this._maxListeners=Re,this};function N(Le){return Le._maxListeners===void 0?E.defaultMaxListeners:Le._maxListeners}E.prototype.getMaxListeners=function(){return N(this)},E.prototype.emit=function(Re){for(var Ue=[],pt=1;pt<arguments.length;pt++)Ue.push(arguments[pt]);var lt=Re==="error",Ft=this._events;if(Ft!==void 0)lt=lt&&Ft.error===void 0;else if(!lt)return!1;if(lt){var Pt;if(Ue.length>0&&(Pt=Ue[0]),Pt instanceof Error)throw Pt;var Ur=new Error("Unhandled error."+(Pt?" ("+Pt.message+")":""));throw Ur.context=Pt,Ur}var Cr=Ft[Re];if(Cr===void 0)return!1;if(typeof Cr=="function")l(Cr,this,Ue);else for(var yr=Cr.length,fr=Be(Cr,yr),pt=0;pt<yr;++pt)l(fr[pt],this,Ue);return!0};function V(Le,Re,Ue,pt){var lt,Ft,Pt;if(s(Ue),Ft=Le._events,Ft===void 0?(Ft=Le._events=Object.create(null),Le._eventsCount=0):(Ft.newListener!==void 0&&(Le.emit("newListener",Re,Ue.listener?Ue.listener:Ue),Ft=Le._events),Pt=Ft[Re]),Pt===void 0)Pt=Ft[Re]=Ue,++Le._eventsCount;else if(typeof Pt=="function"?Pt=Ft[Re]=pt?[Ue,Pt]:[Pt,Ue]:pt?Pt.unshift(Ue):Pt.push(Ue),lt=N(Le),lt>0&&Pt.length>lt&&!Pt.warned){Pt.warned=!0;var Ur=new Error("Possible EventEmitter memory leak detected. "+Pt.length+" "+String(Re)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ur.name="MaxListenersExceededWarning",Ur.emitter=Le,Ur.type=Re,Ur.count=Pt.length,S(Ur)}return Le}E.prototype.addListener=function(Re,Ue){return V(this,Re,Ue,!1)},E.prototype.on=E.prototype.addListener,E.prototype.prependListener=function(Re,Ue){return V(this,Re,Ue,!0)};function K(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function oe(Le,Re,Ue){var pt={fired:!1,wrapFn:void 0,target:Le,type:Re,listener:Ue},lt=K.bind(pt);return lt.listener=Ue,pt.wrapFn=lt,lt}E.prototype.once=function(Re,Ue){return s(Ue),this.on(Re,oe(this,Re,Ue)),this},E.prototype.prependOnceListener=function(Re,Ue){return s(Ue),this.prependListener(Re,oe(this,Re,Ue)),this},E.prototype.removeListener=function(Re,Ue){var pt,lt,Ft,Pt,Ur;if(s(Ue),lt=this._events,lt===void 0)return this;if(pt=lt[Re],pt===void 0)return this;if(pt===Ue||pt.listener===Ue)--this._eventsCount===0?this._events=Object.create(null):(delete lt[Re],lt.removeListener&&this.emit("removeListener",Re,pt.listener||Ue));else if(typeof pt!="function"){for(Ft=-1,Pt=pt.length-1;Pt>=0;Pt--)if(pt[Pt]===Ue||pt[Pt].listener===Ue){Ur=pt[Pt].listener,Ft=Pt;break}if(Ft<0)return this;Ft===0?pt.shift():Ne(pt,Ft),pt.length===1&&(lt[Re]=pt[0]),lt.removeListener!==void 0&&this.emit("removeListener",Re,Ur||Ue)}return this},E.prototype.off=E.prototype.removeListener,E.prototype.removeAllListeners=function(Re){var Ue,pt,lt;if(pt=this._events,pt===void 0)return this;if(pt.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):pt[Re]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete pt[Re]),this;if(arguments.length===0){var Ft=Object.keys(pt),Pt;for(lt=0;lt<Ft.length;++lt)Pt=Ft[lt],Pt!=="removeListener"&&this.removeAllListeners(Pt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ue=pt[Re],typeof Ue=="function")this.removeListener(Re,Ue);else if(Ue!==void 0)for(lt=Ue.length-1;lt>=0;lt--)this.removeListener(Re,Ue[lt]);return this};function le(Le,Re,Ue){var pt=Le._events;if(pt===void 0)return[];var lt=pt[Re];return lt===void 0?[]:typeof lt=="function"?Ue?[lt.listener||lt]:[lt]:Ue?Ze(lt):Be(lt,lt.length)}E.prototype.listeners=function(Re){return le(this,Re,!0)},E.prototype.rawListeners=function(Re){return le(this,Re,!1)},E.listenerCount=function(Le,Re){return typeof Le.listenerCount=="function"?Le.listenerCount(Re):Y.call(Le,Re)},E.prototype.listenerCount=Y;function Y(Le){var Re=this._events;if(Re!==void 0){var Ue=Re[Le];if(typeof Ue=="function")return 1;if(Ue!==void 0)return Ue.length}return 0}E.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function Be(Le,Re){for(var Ue=new Array(Re),pt=0;pt<Re;++pt)Ue[pt]=Le[pt];return Ue}function Ne(Le,Re){for(;Re+1<Le.length;Re++)Le[Re]=Le[Re+1];Le.pop()}function Ze(Le){for(var Re=new Array(Le.length),Ue=0;Ue<Re.length;++Ue)Re[Ue]=Le[Ue].listener||Le[Ue];return Re}function He(Le,Re){return new Promise(function(Ue,pt){function lt(Pt){Le.removeListener(Re,Ft),pt(Pt)}function Ft(){typeof Le.removeListener=="function"&&Le.removeListener("error",lt),Ue([].slice.call(arguments))}nt(Le,Re,Ft,{once:!0}),Re!=="error"&&Ge(Le,lt,{once:!0})})}function Ge(Le,Re,Ue){typeof Le.on=="function"&&nt(Le,"error",Re,Ue)}function nt(Le,Re,Ue,pt){if(typeof Le.on=="function")pt.once?Le.once(Re,Ue):Le.on(Re,Ue);else if(typeof Le.addEventListener=="function")Le.addEventListener(Re,function lt(Ft){pt.once&&Le.removeEventListener(Re,lt),Ue(Ft)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Le)}return $f.exports}var n1=r1();const i1=o0(n1),Ji=[];for(let d=0;d<256;++d)Ji.push((d+256).toString(16).slice(1));function a1(d,l=0){return(Ji[d[l+0]]+Ji[d[l+1]]+Ji[d[l+2]]+Ji[d[l+3]]+"-"+Ji[d[l+4]]+Ji[d[l+5]]+"-"+Ji[d[l+6]]+Ji[d[l+7]]+"-"+Ji[d[l+8]]+Ji[d[l+9]]+"-"+Ji[d[l+10]]+Ji[d[l+11]]+Ji[d[l+12]]+Ji[d[l+13]]+Ji[d[l+14]]+Ji[d[l+15]]).toLowerCase()}let ig;const o1=new Uint8Array(16);function s1(){if(!ig){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ig=crypto.getRandomValues.bind(crypto)}return ig(o1)}const l1=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),o_={randomUUID:l1};function u1(d,l,f){if(o_.randomUUID&&!d)return o_.randomUUID();d=d||{};const S=d.random??d.rng?.()??s1();if(S.length<16)throw new Error("Random bytes length must be >= 16");return S[6]=S[6]&15|64,S[8]=S[8]&63|128,a1(S)}const f0="3.7.8",c1=f0,Up=typeof Buffer=="function",s_=typeof TextDecoder=="function"?new TextDecoder:void 0,l_=typeof TextEncoder=="function"?new TextEncoder:void 0,h1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Dd=Array.prototype.slice.call(h1),qf=(d=>{let l={};return d.forEach((f,S)=>l[f]=S),l})(Dd),p1=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Qi=String.fromCharCode.bind(String),u_=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):d=>new Uint8Array(Array.prototype.slice.call(d,0)),m0=d=>d.replace(/=/g,"").replace(/[+\/]/g,l=>l=="+"?"-":"_"),g0=d=>d.replace(/[^A-Za-z0-9\+\/]/g,""),y0=d=>{let l,f,S,T,E="";const b=d.length%3;for(let s=0;s<d.length;){if((f=d.charCodeAt(s++))>255||(S=d.charCodeAt(s++))>255||(T=d.charCodeAt(s++))>255)throw new TypeError("invalid character found");l=f<<16|S<<8|T,E+=Dd[l>>18&63]+Dd[l>>12&63]+Dd[l>>6&63]+Dd[l&63]}return b?E.slice(0,b-3)+"===".substring(b):E},Bg=typeof btoa=="function"?d=>btoa(d):Up?d=>Buffer.from(d,"binary").toString("base64"):y0,Sg=Up?d=>Buffer.from(d).toString("base64"):d=>{let f=[];for(let S=0,T=d.length;S<T;S+=4096)f.push(Qi.apply(null,d.subarray(S,S+4096)));return Bg(f.join(""))},Jf=(d,l=!1)=>l?m0(Sg(d)):Sg(d),d1=d=>{if(d.length<2){var l=d.charCodeAt(0);return l<128?d:l<2048?Qi(192|l>>>6)+Qi(128|l&63):Qi(224|l>>>12&15)+Qi(128|l>>>6&63)+Qi(128|l&63)}else{var l=65536+(d.charCodeAt(0)-55296)*1024+(d.charCodeAt(1)-56320);return Qi(240|l>>>18&7)+Qi(128|l>>>12&63)+Qi(128|l>>>6&63)+Qi(128|l&63)}},f1=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,_0=d=>d.replace(f1,d1),c_=Up?d=>Buffer.from(d,"utf8").toString("base64"):l_?d=>Sg(l_.encode(d)):d=>Bg(_0(d)),Fp=(d,l=!1)=>l?m0(c_(d)):c_(d),h_=d=>Fp(d,!0),m1=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,g1=d=>{switch(d.length){case 4:var l=(7&d.charCodeAt(0))<<18|(63&d.charCodeAt(1))<<12|(63&d.charCodeAt(2))<<6|63&d.charCodeAt(3),f=l-65536;return Qi((f>>>10)+55296)+Qi((f&1023)+56320);case 3:return Qi((15&d.charCodeAt(0))<<12|(63&d.charCodeAt(1))<<6|63&d.charCodeAt(2));default:return Qi((31&d.charCodeAt(0))<<6|63&d.charCodeAt(1))}},v0=d=>d.replace(m1,g1),x0=d=>{if(d=d.replace(/\s+/g,""),!p1.test(d))throw new TypeError("malformed base64.");d+="==".slice(2-(d.length&3));let l,f,S,T=[];for(let E=0;E<d.length;)l=qf[d.charAt(E++)]<<18|qf[d.charAt(E++)]<<12|(f=qf[d.charAt(E++)])<<6|(S=qf[d.charAt(E++)]),f===64?T.push(Qi(l>>16&255)):S===64?T.push(Qi(l>>16&255,l>>8&255)):T.push(Qi(l>>16&255,l>>8&255,l&255));return T.join("")},jg=typeof atob=="function"?d=>atob(g0(d)):Up?d=>Buffer.from(d,"base64").toString("binary"):x0,b0=Up?d=>u_(Buffer.from(d,"base64")):d=>u_(jg(d).split("").map(l=>l.charCodeAt(0))),w0=d=>b0(S0(d)),y1=Up?d=>Buffer.from(d,"base64").toString("utf8"):s_?d=>s_.decode(b0(d)):d=>v0(jg(d)),S0=d=>g0(d.replace(/[-_]/g,l=>l=="-"?"+":"/")),Tg=d=>y1(S0(d)),_1=d=>{if(typeof d!="string")return!1;const l=d.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(l)||!/[^\s0-9a-zA-Z\-_]/.test(l)},T0=d=>({value:d,enumerable:!1,writable:!0,configurable:!0}),C0=function(){const d=(l,f)=>Object.defineProperty(String.prototype,l,T0(f));d("fromBase64",function(){return Tg(this)}),d("toBase64",function(l){return Fp(this,l)}),d("toBase64URI",function(){return Fp(this,!0)}),d("toBase64URL",function(){return Fp(this,!0)}),d("toUint8Array",function(){return w0(this)})},P0=function(){const d=(l,f)=>Object.defineProperty(Uint8Array.prototype,l,T0(f));d("toBase64",function(l){return Jf(this,l)}),d("toBase64URI",function(){return Jf(this,!0)}),d("toBase64URL",function(){return Jf(this,!0)})},v1=()=>{C0(),P0()},x1={version:f0,VERSION:c1,atob:jg,atobPolyfill:x0,btoa:Bg,btoaPolyfill:y0,fromBase64:Tg,toBase64:Fp,encode:Fp,encodeURI:h_,encodeURL:h_,utob:_0,btou:v0,decode:Tg,isValid:_1,fromUint8Array:Jf,toUint8Array:w0,extendString:C0,extendUint8Array:P0,extendBuiltins:v1};var b1=Object.defineProperty,M0=d=>{throw TypeError(d)},w1=(d,l,f)=>l in d?b1(d,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):d[l]=f,xt=(d,l,f)=>w1(d,typeof l!="symbol"?l+"":l,f),Og=(d,l,f)=>l.has(d)||M0("Cannot "+f),Nt=(d,l,f)=>(Og(d,l,"read from private field"),f?f.call(d):l.get(d)),no=(d,l,f)=>l.has(d)?M0("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(d):l.set(d,f),Vo=(d,l,f,S)=>(Og(d,l,"write to private field"),l.set(d,f),f),Oo=(d,l,f)=>(Og(d,l,"access private method"),f);const Or={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...ef};function p_(){if(typeof navigator>"u"){const d=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return bg(d)||Or.ENGLISH}return Array.from(new Set(navigator.languages.map(d=>d.split("-")[0]))).map(d=>bg(d)).filter(d=>d)[0]??Or.LOCAL}const Da={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Or.STYLE,secondaryLanguage:Or.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Da);const Ug=u1();class S1 extends i1{constructor(){super(...arguments),xt(this,"primaryLanguage",Da.primaryLanguage),xt(this,"secondaryLanguage"),xt(this,"session",!0),xt(this,"caching",!0),xt(this,"telemetry",!0),xt(this,"_unit","metric"),xt(this,"_apiKey","")}set unit(l){this._unit=l,this.emit("unit",l)}get unit(){return this._unit}set apiKey(l){this._apiKey=l,Dp.apiKey=l,this.emit("apiKey",l)}get apiKey(){return this._apiKey}set fetch(l){Dp.fetch=l}get fetch(){return Dp.fetch}}const ui=new S1,Cg="localcache_source",Pg="localcache",T1="maptiler_sdk",C1=1e3,P1=100,Mg=typeof caches<"u",{addProtocol:d_}=Dt;function M1(d,l){if(Mg&&ui.caching&&ui.session&&d.host===Da.maptilerApiHost){if(l==="Source"&&d.href.includes("tiles.json"))return d.href.replace("https://",`${Cg}://`);if(l==="Tile"||l==="Glyphs")return d.href.replace("https://",`${Pg}://`)}return d.href}let ag;async function k0(){return ag||(ag=await caches.open(T1)),ag}let f_=0;async function k1(){const d=await k0(),l=await d.keys(),f=l.slice(0,Math.max(l.length-C1,0));for(const S of f)d.delete(S)}function E1(){d_(Cg,async(d,l)=>{if(!d.url)throw new Error("");d.url=d.url.replace(`${Cg}://`,"https://");const f=d;f.signal=l.signal;const S=await fetch(d.url,f),T=await S.json();return T.tiles&&T.tiles.length>0&&(T.tiles[0]+=`&last-modified=${S.headers.get("Last-Modified")}`),{data:T,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}}),d_(Pg,async(d,l)=>{if(!d.url)throw new Error("");d.url=d.url.replace(`${Pg}://`,"https://");const f=new URL(d.url),S=new URL(f);S.searchParams.delete("mtsid"),S.searchParams.delete("key");const T=S.toString(),E=new URL(f);E.searchParams.delete("last-modified");const b=E.toString(),s=async le=>({data:await le.arrayBuffer(),cacheControl:le.headers.get("Cache-Control"),expires:le.headers.get("Expires")}),N=await k0(),V=await N.match(T);if(V)return s(V);const K=d;K.signal=l.signal;const oe=await fetch(b,K);return oe.status>=200&&oe.status<300&&(N.put(T,oe.clone()).catch(()=>{}),++f_>P1&&(k1(),f_=0)),s(oe)})}function I1(){if(typeof window>"u")return;const d=Dt.getRTLTextPluginStatus();if(d==="unavailable"||d==="requested")try{Dt.setRTLTextPlugin(Da.rtlPluginURL,!0)}catch{}}function A1(d,l){for(const f of d)typeof l[f]=="function"&&(l[f]=l[f].bind(l))}function m_(d,l){let f=null;try{f=new URL(d)}catch{return{url:d}}return f.host===Da.maptilerApiHost&&(f.searchParams.has("key")||f.searchParams.append("key",ui.apiKey),ui.session&&f.searchParams.append("mtsid",Ug)),{url:M1(f,l)}}function g_(d){return(l,f)=>{if(d!=null){const S=d(l,f),T=m_(S?.url??"",f);return{...S,...T}}return m_(l,f)}}function z1(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function L1(d){const l=z1();if(!l)return;let f=null;if(typeof d=="string"?f=document.getElementById(d):d instanceof HTMLElement&&(f=d),!f)throw new Error("The Map container must be provided.");const S=document.createElement("div");throw S.innerHTML=l,S.classList.add("webgl-warning-div"),f.appendChild(S),new Error(l)}function y_(d,l){return!(!Array.isArray(d)||d.length!==2||d[0]!=="get"||typeof d[1]!="string"||l&&!d[1].startsWith("name:")||!l&&d[1]!=="name")}function R1(d,l,f){const S=structuredClone(d),T=E=>{if(typeof E!="string")for(let b=0;b<E.length;b+=1)y_(E[b],f)?E[b]=structuredClone(l):T(E[b])};return y_(S,f)?l:(T(S),S)}function D1(d,l){const f=l?/\{name:\S+\}/:/\{name\}/;return{contains:f.test(d),exactMatch:new RegExp(`^${f.source}$`).test(d)}}function N1(d,l,f){const S=f?/\{name:\S+\}/:/\{name\}/,T=d.split(S);return["concat",...T.flatMap((E,b)=>b===T.length-1?[E]:[E,l])]}function F1(d){var l;const f=/\{name(?::(?<language>\S+))?\}/g,S=[];for(;;){const T=f.exec(d);if(!T)break;const E=((l=T.groups)==null?void 0:l.language)??null;S.push(E)}return S}function B1(d){return!Array.isArray(d)||d.length!==2||d[0]!=="get"||typeof d[1]!="string"?null:d[1].trim()==="name"?{isLanguage:!0,localization:null}:d[1].trim().startsWith("name:")?{isLanguage:!0,localization:d[1].trim().split(":").pop()}:null}function j1(d){const l=[],f=structuredClone(d),S=T=>{if(typeof T!="string")for(let E=0;E<T.length;E+=1){const b=B1(T[E]);b?l.push(b.localization):S(T[E])}};return S([f]),l}function O1(d,l){const f=[];for(const E of d){if(E.type!=="symbol")continue;const b=E,{id:s,layout:N}=b;if(!N||!("text-field"in N))continue;const V=l.getLayoutProperty(s,"text-field");if(V)if(typeof V=="string"){const K=F1(V);f.push(K)}else{const K=j1(V);f.push(K)}}const S=f.flat(),T={unlocalized:0,localized:{}};for(const E of S)E===null?T.unlocalized+=1:(E in T.localized||(T.localized[E]=0),T.localized[E]+=1);return T}let U1=class extends Dt.Marker{addTo(d){return super.addTo(d)}};class hS extends Dt.Popup{addTo(l){return super.addTo(l)}}class pS extends Dt.Style{constructor(l,f={}){super(l,f)}}class dS extends Dt.CanvasSource{onAdd(l){super.onAdd(l)}}class fS extends Dt.GeoJSONSource{onAdd(l){super.onAdd(l)}}class mS extends Dt.ImageSource{onAdd(l){super.onAdd(l)}}class gS extends Dt.RasterTileSource{onAdd(l){super.onAdd(l)}}class yS extends Dt.RasterDEMTileSource{onAdd(l){super.onAdd(l)}}class _S extends Dt.VectorTileSource{onAdd(l){super.onAdd(l)}}class vS extends Dt.VideoSource{onAdd(l){super.onAdd(l)}}class E0 extends Dt.NavigationControl{onAdd(l){return super.onAdd(l)}}class V1 extends Dt.GeolocateControl{onAdd(l){return super.onAdd(l)}}class xS extends Dt.AttributionControl{onAdd(l){return super.onAdd(l)}}class $1 extends Dt.LogoControl{onAdd(l){return super.onAdd(l)}}class q1 extends Dt.ScaleControl{onAdd(l){return super.onAdd(l)}}class G1 extends Dt.FullscreenControl{onAdd(l){return super.onAdd(l)}}class bS extends Dt.TerrainControl{onAdd(l){return super.onAdd(l)}}class wS extends Dt.BoxZoomHandler{constructor(l,f){super(l,f)}}class SS extends Dt.ScrollZoomHandler{constructor(l,f){super(l,f)}}class TS extends Dt.CooperativeGesturesHandler{constructor(l,f){super(l,f)}}class CS extends Dt.KeyboardHandler{constructor(l){super(l)}}class PS extends Dt.TwoFingersTouchPitchHandler{constructor(l){super(l)}}class MS extends Dt.MapWheelEvent{constructor(l,f,S){super(l,f,S)}}class kS extends Dt.MapTouchEvent{constructor(l,f,S){super(l,f,S)}}class ES extends Dt.MapMouseEvent{constructor(l,f,S,T={}){super(l,f,S,T)}}class __ extends $1{constructor(l={}){super(l),xt(this,"logoURL",""),xt(this,"linkURL",""),this.logoURL=l.logoURL??Da.maptilerLogoURL,this.linkURL=l.linkURL??Da.maptilerURL}onAdd(l){this._map=l,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const f=window.document.createElement("a");return f.style.backgroundRepeat="no-repeat",f.style.cursor="pointer",f.style.display="block",f.style.height="23px",f.style.margin="0 0 -4px -4px",f.style.overflow="hidden",f.style.width="88px",f.style.backgroundImage=`url(${this.logoURL})`,f.style.backgroundSize="100px 30px",f.style.width="100px",f.style.height="30px",f.target="_blank",f.rel="noopener",f.href=this.linkURL,f.setAttribute("aria-label","MapTiler logo"),f.setAttribute("rel","noopener"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var Z1=8,H1={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},W1={"*":{type:"source"}},X1=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],K1={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Y1={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},J1={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Q1={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},eb={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},tb={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},rb={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},nb=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],ib={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},ab={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},ob={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},sb={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},lb={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},ub={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},cb={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},hb={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},pb={type:"array",value:"*"},db={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},fb={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},mb={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},gb={type:"array",value:"*",minimum:1},yb={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},_b={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},vb={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},xb={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},bb=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],wb={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},Sb={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},Tb={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},Cb={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},Pb={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},Mb={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},kb={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},Eb={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},Ib={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},Ab={"*":{type:"string"}},zb={$version:Z1,$root:H1,sources:W1,source:X1,source_vector:K1,source_raster:Y1,source_raster_dem:J1,source_geojson:Q1,source_video:eb,source_image:tb,layer:rb,layout:nb,layout_background:ib,layout_fill:ab,layout_circle:ob,layout_heatmap:sb,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:lb,layout_symbol:ub,layout_raster:cb,layout_hillshade:hb,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:pb,filter_operator:db,geometry_type:fb,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:mb,expression:gb,light:yb,sky:_b,terrain:vb,projection:xb,paint:bb,paint_fill:wb,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:Sb,paint_circle:Tb,paint_heatmap:Cb,paint_symbol:Pb,paint_raster:Mb,paint_hillshade:kb,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:Eb,transition:Ib,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:Ab};class st{constructor(l,f,S,T){this.message=(l?`${l}: `:"")+S,T&&(this.identifier=T),f!=null&&f.__line__&&(this.line=f.__line__)}}function im(d,...l){for(const f of l)for(const S in f)d[S]=f[S];return d}class Vl extends Error{constructor(l,f){super(f),this.message=f,this.key=l}}class Vg{constructor(l,f=[]){this.parent=l,this.bindings={};for(const[S,T]of f)this.bindings[S]=T}concat(l){return new Vg(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return this.bindings[l]?!0:this.parent?this.parent.has(l):!1}}const dm={kind:"null"},gt={kind:"number"},xr={kind:"string"},gr={kind:"boolean"},$l={kind:"color"},fm={kind:"projectionDefinition"},Gh={kind:"object"},dr={kind:"value"},Lb={kind:"error"},mm={kind:"collator"},gm={kind:"formatted"},ym={kind:"padding"},qd={kind:"colorArray"},_m={kind:"numberArray"},tf={kind:"resolvedImage"},vm={kind:"variableAnchorOffsetCollection"};function $o(d,l){return{kind:"array",itemType:d,N:l}}function Pn(d){if(d.kind==="array"){const l=Pn(d.itemType);return typeof d.N=="number"?`array<${l}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${l}>`}else return d.kind}const Rb=[dm,gt,xr,gr,$l,fm,gm,Gh,$o(dr),ym,_m,qd,tf,vm];function Gd(d,l){if(l.kind==="error")return null;if(d.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Gd(d.itemType,l.itemType))&&(typeof d.N!="number"||d.N===l.N))return null}else{if(d.kind===l.kind)return null;if(d.kind==="value"){for(const f of Rb)if(!Gd(f,l))return null}}return`Expected ${Pn(d)} but found ${Pn(l)} instead.`}function $g(d,l){return l.some(f=>f.kind===d.kind)}function Zh(d,l){return l.some(f=>f==="null"?d===null:f==="array"?Array.isArray(d):f==="object"?d&&!Array.isArray(d)&&typeof d=="object":f===typeof d)}function Pc(d,l){return d.kind==="array"&&l.kind==="array"?d.itemType.kind===l.itemType.kind&&typeof d.N=="number":d.kind===l.kind}const I0=.96422,A0=1,z0=.82521,L0=4/29,Bp=6/29,R0=3*Bp*Bp,Db=Bp*Bp*Bp,Nb=Math.PI/180,Fb=180/Math.PI;function D0(d){return d=d%360,d<0&&(d+=360),d}function N0([d,l,f,S]){d=og(d),l=og(l),f=og(f);let T,E;const b=sg((.2225045*d+.7168786*l+.0606169*f)/A0);d===l&&l===f?T=E=b:(T=sg((.4360747*d+.3850649*l+.1430804*f)/I0),E=sg((.0139322*d+.0971045*l+.7141733*f)/z0));const s=116*b-16;return[s<0?0:s,500*(T-b),200*(b-E),S]}function og(d){return d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function sg(d){return d>Db?Math.pow(d,1/3):d/R0+L0}function F0([d,l,f,S]){let T=(d+16)/116,E=isNaN(l)?T:T+l/500,b=isNaN(f)?T:T-f/200;return T=A0*ug(T),E=I0*ug(E),b=z0*ug(b),[lg(3.1338561*E-1.6168667*T-.4906146*b),lg(-.9787684*E+1.9161415*T+.033454*b),lg(.0719453*E-.2289914*T+1.4052427*b),S]}function lg(d){return d=d<=.00304?12.92*d:1.055*Math.pow(d,1/2.4)-.055,d<0?0:d>1?1:d}function ug(d){return d>Bp?d*d*d:R0*(d-L0)}function Bb(d){const[l,f,S,T]=N0(d),E=Math.sqrt(f*f+S*S);return[Math.round(E*1e4)?D0(Math.atan2(S,f)*Fb):NaN,E,l,T]}function jb([d,l,f,S]){return d=isNaN(d)?0:d*Nb,F0([f,Math.cos(d)*l,Math.sin(d)*l,S])}function Ob([d,l,f,S]){d=D0(d),l/=100,f/=100;function T(E){const b=(E+d/30)%12,s=l*Math.min(f,1-f);return f-s*Math.max(-1,Math.min(b-3,9-b,1))}return[T(0),T(8),T(4),S]}const Ub=Object.hasOwn||function(d,l){return Object.prototype.hasOwnProperty.call(d,l)};function Ud(d,l){return Ub(d,l)?d[l]:void 0}function Vb(d){if(d=d.toLowerCase().trim(),d==="transparent")return[0,0,0,0];const l=Ud($b,d);if(l){const[T,E,b]=l;return[T/255,E/255,b/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const T=d.length<6?1:2;let E=1;return[Gf(d.slice(E,E+=T)),Gf(d.slice(E,E+=T)),Gf(d.slice(E,E+=T)),Gf(d.slice(E,E+T)||"ff")]}if(d.startsWith("rgb")){const T=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,E=d.match(T);if(E){const[b,s,N,V,K,oe,le,Y,Be,Ne,Ze,He]=E,Ge=[V||" ",le||" ",Ne].join("");if(Ge==="  "||Ge==="  /"||Ge===",,"||Ge===",,,"){const nt=[N,oe,Be].join(""),Le=nt==="%%%"?100:nt===""?255:0;if(Le){const Re=[Lp(+s/Le,0,1),Lp(+K/Le,0,1),Lp(+Y/Le,0,1),Ze?v_(+Ze,He):1];if(x_(Re))return Re}}return}}const f=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,S=d.match(f);if(S){const[T,E,b,s,N,V,K,oe,le]=S,Y=[b||" ",N||" ",K].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const Be=[+E,Lp(+s,0,100),Lp(+V,0,100),oe?v_(+oe,le):1];if(x_(Be))return Ob(Be)}}}function Gf(d){return parseInt(d.padEnd(2,d),16)/255}function v_(d,l){return Lp(l?d/100:d,0,1)}function Lp(d,l,f){return Math.min(Math.max(l,d),f)}function x_(d){return!d.some(Number.isNaN)}const $b={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Hh(d,l,f){return d+f*(l-d)}function Zd(d,l,f){return d.map((S,T)=>Hh(S,l[T],f))}class Jr{constructor(l,f,S,T=1,E=!0){this.r=l,this.g=f,this.b=S,this.a=T,E||(this.r*=T,this.g*=T,this.b*=T,T||this.overwriteGetter("rgb",[l,f,S,T]))}static parse(l){if(l instanceof Jr)return l;if(typeof l!="string")return;const f=Vb(l);if(f)return new Jr(...f,!1)}get rgb(){const{r:l,g:f,b:S,a:T}=this,E=T||1/0;return this.overwriteGetter("rgb",[l/E,f/E,S/E,T])}get hcl(){return this.overwriteGetter("hcl",Bb(this.rgb))}get lab(){return this.overwriteGetter("lab",N0(this.rgb))}overwriteGetter(l,f){return Object.defineProperty(this,l,{value:f}),f}toString(){const[l,f,S,T]=this.rgb;return`rgba(${[l,f,S].map(E=>Math.round(E*255)).join(",")},${T})`}static interpolate(l,f,S,T="rgb"){switch(T){case"rgb":{const[E,b,s,N]=Zd(l.rgb,f.rgb,S);return new Jr(E,b,s,N,!1)}case"hcl":{const[E,b,s,N]=l.hcl,[V,K,oe,le]=f.hcl;let Y,Be;if(!isNaN(E)&&!isNaN(V)){let nt=V-E;V>E&&nt>180?nt-=360:V<E&&E-V>180&&(nt+=360),Y=E+S*nt}else isNaN(E)?isNaN(V)?Y=NaN:(Y=V,(s===1||s===0)&&(Be=K)):(Y=E,(oe===1||oe===0)&&(Be=b));const[Ne,Ze,He,Ge]=jb([Y,Be??Hh(b,K,S),Hh(s,oe,S),Hh(N,le,S)]);return new Jr(Ne,Ze,He,Ge,!1)}case"lab":{const[E,b,s,N]=F0(Zd(l.lab,f.lab,S));return new Jr(E,b,s,N,!1)}}}}Jr.black=new Jr(0,0,0,1);Jr.white=new Jr(1,1,1,1);Jr.transparent=new Jr(0,0,0,0);Jr.red=new Jr(1,0,0,1);class qg{constructor(l,f,S){l?this.sensitivity=f?"variant":"case":this.sensitivity=f?"accent":"base",this.locale=S,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,f){return this.collator.compare(l,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const qb=["bottom","center","top"];class kg{constructor(l,f,S,T,E,b){this.text=l,this.image=f,this.scale=S,this.fontStack=T,this.textColor=E,this.verticalAlign=b}}class Fu{constructor(l){this.sections=l}static fromString(l){return new Fu([new kg(l,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof Fu?l:Fu.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Qs{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Qs)return l;if(typeof l=="number")return new Qs([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const f of l)if(typeof f!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]];break}return new Qs(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,f,S){return new Qs(Zd(l.values,f.values,S))}}class el{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof el)return l;if(typeof l=="number")return new el([l]);if(Array.isArray(l)){for(const f of l)if(typeof f!="number")return;return new el(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,f,S){return new el(Zd(l.values,f.values,S))}}class qo{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof qo)return l;if(typeof l=="string"){const S=Jr.parse(l);return S?new qo([S]):void 0}if(!Array.isArray(l))return;const f=[];for(const S of l){if(typeof S!="string")return;const T=Jr.parse(S);if(!T)return;f.push(T)}return new qo(f)}toString(){return JSON.stringify(this.values)}static interpolate(l,f,S,T="rgb"){const E=[];if(l.values.length!=f.values.length)throw new Error(`colorArray: Arrays have mismatched length (${l.values.length} vs. ${f.values.length}), cannot interpolate.`);for(let b=0;b<l.values.length;b++)E.push(Jr.interpolate(l.values[b],f.values[b],S,T));return new qo(E)}}class Fn extends Error{constructor(l){super(l),this.name="RuntimeError"}toJSON(){return this.message}}const Gb=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ql{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof ql)return l;if(!(!Array.isArray(l)||l.length<1||l.length%2!==0)){for(let f=0;f<l.length;f+=2){const S=l[f],T=l[f+1];if(typeof S!="string"||!Gb.has(S)||!Array.isArray(T)||T.length!==2||typeof T[0]!="number"||typeof T[1]!="number")return}return new ql(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,f,S){const T=l.values,E=f.values;if(T.length!==E.length)throw new Fn(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${f.toString()}`);const b=[];for(let s=0;s<T.length;s+=2){if(T[s]!==E[s])throw new Fn(`Cannot interpolate values containing mismatched anchors. from[${s}]: ${T[s]}, to[${s}]: ${E[s]}`);b.push(T[s]);const[N,V]=T[s+1],[K,oe]=E[s+1];b.push([Hh(N,K,S),Hh(V,oe,S)])}return new ql(b)}}class Ec{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Ec({name:l,available:!1}):null}}class Ys{constructor(l,f,S){this.from=l,this.to=f,this.transition=S}static interpolate(l,f,S){return new Ys(l,f,S)}static parse(l){if(l instanceof Ys)return l;if(Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number")return new Ys(l[0],l[1],l[2]);if(typeof l=="object"&&typeof l.from=="string"&&typeof l.to=="string"&&typeof l.transition=="number")return new Ys(l.from,l.to,l.transition);if(typeof l=="string")return new Ys(l,l,1)}}function B0(d,l,f,S){return typeof d=="number"&&d>=0&&d<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof f=="number"&&f>=0&&f<=255?typeof S>"u"||typeof S=="number"&&S>=0&&S<=1?null:`Invalid rgba value [${[d,l,f,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof S=="number"?[d,l,f,S]:[d,l,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hd(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof Ys||d instanceof Jr||d instanceof qg||d instanceof Fu||d instanceof Qs||d instanceof el||d instanceof qo||d instanceof ql||d instanceof Ec)return!0;if(Array.isArray(d)){for(const l of d)if(!Hd(l))return!1;return!0}else if(typeof d=="object"){for(const l in d)if(!Hd(d[l]))return!1;return!0}else return!1}function ci(d){if(d===null)return dm;if(typeof d=="string")return xr;if(typeof d=="boolean")return gr;if(typeof d=="number")return gt;if(d instanceof Jr)return $l;if(d instanceof Ys)return fm;if(d instanceof qg)return mm;if(d instanceof Fu)return gm;if(d instanceof Qs)return ym;if(d instanceof el)return _m;if(d instanceof qo)return qd;if(d instanceof ql)return vm;if(d instanceof Ec)return tf;if(Array.isArray(d)){const l=d.length;let f;for(const S of d){const T=ci(S);if(!f)f=T;else{if(f===T)continue;f=dr;break}}return $o(f||dr,l)}else return Gh}function Vd(d){const l=typeof d;return d===null?"":l==="string"||l==="number"||l==="boolean"?String(d):d instanceof Jr||d instanceof Ys||d instanceof Fu||d instanceof Qs||d instanceof el||d instanceof qo||d instanceof ql||d instanceof Ec?d.toString():JSON.stringify(d)}class jp{constructor(l,f){this.type=l,this.value=f}static parse(l,f){if(l.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Hd(l[1]))return f.error("invalid value");const S=l[1];let T=ci(S);const E=f.expectedType;return T.kind==="array"&&T.N===0&&E&&E.kind==="array"&&(typeof E.N!="number"||E.N===0)&&(T=E),new jp(T,S)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Zf={string:xr,number:gt,boolean:gr,object:Gh};class Js{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let S=1,T;const E=l[0];if(E==="array"){let s;if(l.length>2){const V=l[1];if(typeof V!="string"||!(V in Zf)||V==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);s=Zf[V],S++}else s=dr;let N;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return f.error('The length argument to "array" must be a positive integer literal',2);N=l[2],S++}T=$o(s,N)}else{if(!Zf[E])throw new Error(`Types doesn't contain name = ${E}`);T=Zf[E]}const b=[];for(;S<l.length;S++){const s=f.parse(l[S],S,dr);if(!s)return null;b.push(s)}return new Js(T,b)}evaluate(l){for(let f=0;f<this.args.length;f++){const S=this.args[f].evaluate(l);if(Gd(this.type,ci(S))){if(f===this.args.length-1)throw new Fn(`Expected value to be of type ${Pn(this.type)}, but found ${Pn(ci(S))} instead.`)}else return S}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const b_={"to-boolean":gr,"to-color":$l,"to-number":gt,"to-string":xr};class Mc{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const S=l[0];if(!b_[S])throw new Error(`Can't parse ${S} as it is not part of the known types`);if((S==="to-boolean"||S==="to-string")&&l.length!==2)return f.error("Expected one argument.");const T=b_[S],E=[];for(let b=1;b<l.length;b++){const s=f.parse(l[b],b,dr);if(!s)return null;E.push(s)}return new Mc(T,E)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let f,S;for(const T of this.args){if(f=T.evaluate(l),S=null,f instanceof Jr)return f;if(typeof f=="string"){const E=l.parseColor(f);if(E)return E}else if(Array.isArray(f)&&(f.length<3||f.length>4?S=`Invalid rgba value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:S=B0(f[0],f[1],f[2],f[3]),!S))return new Jr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Fn(S||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const S of this.args){f=S.evaluate(l);const T=Qs.parse(f);if(T)return T}throw new Fn(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"numberArray":{let f;for(const S of this.args){f=S.evaluate(l);const T=el.parse(f);if(T)return T}throw new Fn(`Could not parse numberArray from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"colorArray":{let f;for(const S of this.args){f=S.evaluate(l);const T=qo.parse(f);if(T)return T}throw new Fn(`Could not parse colorArray from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const S of this.args){f=S.evaluate(l);const T=ql.parse(f);if(T)return T}throw new Fn(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const S of this.args){if(f=S.evaluate(l),f===null)return 0;const T=Number(f);if(!isNaN(T))return T}throw new Fn(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Fu.fromString(Vd(this.args[0].evaluate(l)));case"resolvedImage":return Ec.fromString(Vd(this.args[0].evaluate(l)));case"projectionDefinition":return this.args[0].evaluate(l);default:return Vd(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const Zb=["Unknown","Point","LineString","Polygon"];class j0{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let f=this._parseColorCache.get(l);return f||(f=Jr.parse(l),this._parseColorCache.set(l,f)),f}}class xm{constructor(l,f,S=[],T,E=new Vg,b=[]){this.registry=l,this.path=S,this.key=S.map(s=>`[${s}]`).join(""),this.scope=E,this.errors=b,this.expectedType=T,this._isConstant=f}parse(l,f,S,T,E={}){return f?this.concat(f,S,T)._parse(l,E):this._parse(l,E)}_parse(l,f){(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number")&&(l=["literal",l]);function S(T,E,b){return b==="assert"?new Js(E,[T]):b==="coerce"?new Mc(E,[T]):T}if(Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const T=l[0];if(typeof T!="string")return this.error(`Expression name must be a string, but found ${typeof T} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[T];if(E){let b=E.parse(l,this);if(!b)return null;if(this.expectedType){const s=this.expectedType,N=b.type;if((s.kind==="string"||s.kind==="number"||s.kind==="boolean"||s.kind==="object"||s.kind==="array")&&N.kind==="value")b=S(b,s,f.typeAnnotation||"assert");else if(s.kind==="projectionDefinition"&&["string","array"].includes(N.kind)||["color","formatted","resolvedImage"].includes(s.kind)&&["value","string"].includes(N.kind)||["padding","numberArray"].includes(s.kind)&&["value","number","array"].includes(N.kind)||s.kind==="colorArray"&&["value","string","array"].includes(N.kind)||s.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(N.kind))b=S(b,s,f.typeAnnotation||"coerce");else if(this.checkSubtype(s,N))return null}if(!(b instanceof jp)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const s=new j0;try{b=new jp(b.type,b.evaluate(s))}catch(N){return this.error(N.message),null}}return b}return this.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof l>"u"?this.error("'undefined' value invalid. Use null instead."):typeof l=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof l} instead.`)}concat(l,f,S){const T=typeof l=="number"?this.path.concat(l):this.path,E=S?this.scope.concat(S):this.scope;return new xm(this.registry,this._isConstant,T,f||null,E,this.errors)}error(l,...f){const S=`${this.key}${f.map(T=>`[${T}]`).join("")}`;this.errors.push(new Vl(S,l))}checkSubtype(l,f){const S=Gd(l,f);return S&&this.error(S),S}}class bm{constructor(l,f){this.type=f.type,this.bindings=[].concat(l),this.result=f}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const f of this.bindings)l(f[1]);l(this.result)}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const S=[];for(let E=1;E<l.length-1;E+=2){const b=l[E];if(typeof b!="string")return f.error(`Expected string, but found ${typeof b} instead.`,E);if(/[^a-zA-Z0-9_]/.test(b))return f.error("Variable names must contain only alphanumeric characters or '_'.",E);const s=f.parse(l[E+1],E+1);if(!s)return null;S.push([b,s])}const T=f.parse(l[l.length-1],l.length-1,f.expectedType,S);return T?new bm(S,T):null}outputDefined(){return this.result.outputDefined()}}class wm{constructor(l,f){this.type=f.type,this.name=l,this.boundExpression=f}static parse(l,f){if(l.length!==2||typeof l[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const S=l[1];return f.scope.has(S)?new wm(S,f.scope.get(S)):f.error(`Unknown variable "${S}". Make sure "${S}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Gg{constructor(l,f,S){this.type=l,this.index=f,this.input=S}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const S=f.parse(l[1],1,gt),T=f.parse(l[2],2,$o(f.expectedType||dr));if(!S||!T)return null;const E=T.type;return new Gg(E.itemType,S,T)}evaluate(l){const f=this.index.evaluate(l),S=this.input.evaluate(l);if(f<0)throw new Fn(`Array index out of bounds: ${f} < 0.`);if(f>=S.length)throw new Fn(`Array index out of bounds: ${f} > ${S.length-1}.`);if(f!==Math.floor(f))throw new Fn(`Array index must be an integer, but found ${f} instead.`);return S[f]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Zg{constructor(l,f){this.type=gr,this.needle=l,this.haystack=f}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const S=f.parse(l[1],1,dr),T=f.parse(l[2],2,dr);return!S||!T?null:$g(S.type,[gr,xr,gt,dm,dr])?new Zg(S,T):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(S.type)} instead`)}evaluate(l){const f=this.needle.evaluate(l),S=this.haystack.evaluate(l);if(!S)return!1;if(!Zh(f,["boolean","string","number","null"]))throw new Fn(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(ci(f))} instead.`);if(!Zh(S,["string","array"]))throw new Fn(`Expected second argument to be of type array or string, but found ${Pn(ci(S))} instead.`);return S.indexOf(f)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class am{constructor(l,f,S){this.type=gt,this.needle=l,this.haystack=f,this.fromIndex=S}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const S=f.parse(l[1],1,dr),T=f.parse(l[2],2,dr);if(!S||!T)return null;if(!$g(S.type,[gr,xr,gt,dm,dr]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(S.type)} instead`);if(l.length===4){const E=f.parse(l[3],3,gt);return E?new am(S,T,E):null}else return new am(S,T)}evaluate(l){const f=this.needle.evaluate(l),S=this.haystack.evaluate(l);if(!Zh(f,["boolean","string","number","null"]))throw new Fn(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(ci(f))} instead.`);let T;if(this.fromIndex&&(T=this.fromIndex.evaluate(l)),Zh(S,["string"])){const E=S.indexOf(f,T);return E===-1?-1:[...S.slice(0,E)].length}else{if(Zh(S,["array"]))return S.indexOf(f,T);throw new Fn(`Expected second argument to be of type array or string, but found ${Pn(ci(S))} instead.`)}}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Hg{constructor(l,f,S,T,E,b){this.inputType=l,this.type=f,this.input=S,this.cases=T,this.outputs=E,this.otherwise=b}static parse(l,f){if(l.length<5)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!==1)return f.error("Expected an even number of arguments.");let S,T;f.expectedType&&f.expectedType.kind!=="value"&&(T=f.expectedType);const E={},b=[];for(let V=2;V<l.length-1;V+=2){let K=l[V];const oe=l[V+1];Array.isArray(K)||(K=[K]);const le=f.concat(V);if(K.length===0)return le.error("Expected at least one branch label.");for(const Be of K){if(typeof Be!="number"&&typeof Be!="string")return le.error("Branch labels must be numbers or strings.");if(typeof Be=="number"&&Math.abs(Be)>Number.MAX_SAFE_INTEGER)return le.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Be=="number"&&Math.floor(Be)!==Be)return le.error("Numeric branch labels must be integer values.");if(!S)S=ci(Be);else if(le.checkSubtype(S,ci(Be)))return null;if(typeof E[String(Be)]<"u")return le.error("Branch labels must be unique.");E[String(Be)]=b.length}const Y=f.parse(oe,V,T);if(!Y)return null;T=T||Y.type,b.push(Y)}const s=f.parse(l[1],1,dr);if(!s)return null;const N=f.parse(l[l.length-1],l.length-1,T);return!N||s.type.kind!=="value"&&f.concat(1).checkSubtype(S,s.type)?null:new Hg(S,T,s,E,b,N)}evaluate(l){const f=this.input.evaluate(l);return(ci(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class Wg{constructor(l,f,S){this.type=l,this.branches=f,this.otherwise=S}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!==0)return f.error("Expected an odd number of arguments.");let S;f.expectedType&&f.expectedType.kind!=="value"&&(S=f.expectedType);const T=[];for(let b=1;b<l.length-1;b+=2){const s=f.parse(l[b],b,gr);if(!s)return null;const N=f.parse(l[b+1],b+1,S);if(!N)return null;T.push([s,N]),S=S||N.type}const E=f.parse(l[l.length-1],l.length-1,S);if(!E)return null;if(!S)throw new Error("Can't infer output type");return new Wg(S,T,E)}evaluate(l){for(const[f,S]of this.branches)if(f.evaluate(l))return S.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[f,S]of this.branches)l(f),l(S);l(this.otherwise)}outputDefined(){return this.branches.every(([l,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class om{constructor(l,f,S,T){this.type=l,this.input=f,this.beginIndex=S,this.endIndex=T}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const S=f.parse(l[1],1,dr),T=f.parse(l[2],2,gt);if(!S||!T)return null;if(!$g(S.type,[$o(dr),xr,dr]))return f.error(`Expected first argument to be of type array or string, but found ${Pn(S.type)} instead`);if(l.length===4){const E=f.parse(l[3],3,gt);return E?new om(S.type,S,T,E):null}else return new om(S.type,S,T)}evaluate(l){const f=this.input.evaluate(l),S=this.beginIndex.evaluate(l);let T;if(this.endIndex&&(T=this.endIndex.evaluate(l)),Zh(f,["string"]))return[...f].slice(S,T).join("");if(Zh(f,["array"]))return f.slice(S,T);throw new Fn(`Expected first argument to be of type array or string, but found ${Pn(ci(f))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function O0(d,l){const f=d.length-1;let S=0,T=f,E=0,b,s;for(;S<=T;)if(E=Math.floor((S+T)/2),b=d[E],s=d[E+1],b<=l){if(E===f||l<s)return E;S=E+1}else if(b>l)T=E-1;else throw new Fn("Input is not a number.");return 0}class Sm{constructor(l,f,S){this.type=l,this.input=f,this.labels=[],this.outputs=[];for(const[T,E]of S)this.labels.push(T),this.outputs.push(E)}static parse(l,f){if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!==0)return f.error("Expected an even number of arguments.");const S=f.parse(l[1],1,gt);if(!S)return null;const T=[];let E=null;f.expectedType&&f.expectedType.kind!=="value"&&(E=f.expectedType);for(let b=1;b<l.length;b+=2){const s=b===1?-1/0:l[b],N=l[b+1],V=b,K=b+1;if(typeof s!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(T.length&&T[T.length-1][0]>=s)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);const oe=f.parse(N,K,E);if(!oe)return null;E=E||oe.type,T.push([s,oe])}return new Sm(E,S,T)}evaluate(l){const f=this.labels,S=this.outputs;if(f.length===1)return S[0].evaluate(l);const T=this.input.evaluate(l);if(T<=f[0])return S[0].evaluate(l);const E=f.length;if(T>=f[E-1])return S[E-1].evaluate(l);const b=O0(f,T);return S[b].evaluate(l)}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Hb(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var cg,w_;function Wb(){if(w_)return cg;w_=1,cg=d;function d(l,f,S,T){this.cx=3*l,this.bx=3*(S-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(T-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=f,this.p2x=S,this.p2y=T}return d.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,f){if(f===void 0&&(f=1e-6),l<0)return 0;if(l>1)return 1;for(var S=l,T=0;T<8;T++){var E=this.sampleCurveX(S)-l;if(Math.abs(E)<f)return S;var b=this.sampleCurveDerivativeX(S);if(Math.abs(b)<1e-6)break;S=S-E/b}var s=0,N=1;for(S=l,T=0;T<20&&(E=this.sampleCurveX(S),!(Math.abs(E-l)<f));T++)l>E?s=S:N=S,S=(N-s)*.5+s;return S},solve:function(l,f){return this.sampleCurveY(this.solveCurveX(l,f))}},cg}var Xb=Wb(),Kb=Hb(Xb);class Gl{constructor(l,f,S,T,E){this.type=l,this.operator=f,this.interpolation=S,this.input=T,this.labels=[],this.outputs=[];for(const[b,s]of E)this.labels.push(b),this.outputs.push(s)}static interpolationFactor(l,f,S,T){let E=0;if(l.name==="exponential")E=hg(f,l.base,S,T);else if(l.name==="linear")E=hg(f,1,S,T);else if(l.name==="cubic-bezier"){const b=l.controlPoints;E=new Kb(b[0],b[1],b[2],b[3]).solve(hg(f,1,S,T))}return E}static parse(l,f){let[S,T,E,...b]=l;if(!Array.isArray(T)||T.length===0)return f.error("Expected an interpolation type expression.",1);if(T[0]==="linear")T={name:"linear"};else if(T[0]==="exponential"){const V=T[1];if(typeof V!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);T={name:"exponential",base:V}}else if(T[0]==="cubic-bezier"){const V=T.slice(1);if(V.length!==4||V.some(K=>typeof K!="number"||K<0||K>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);T={name:"cubic-bezier",controlPoints:V}}else return f.error(`Unknown interpolation type ${String(T[0])}`,1,0);if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!==0)return f.error("Expected an even number of arguments.");if(E=f.parse(E,2,gt),!E)return null;const s=[];let N=null;(S==="interpolate-hcl"||S==="interpolate-lab")&&f.expectedType!=qd?N=$l:f.expectedType&&f.expectedType.kind!=="value"&&(N=f.expectedType);for(let V=0;V<b.length;V+=2){const K=b[V],oe=b[V+1],le=V+3,Y=V+4;if(typeof K!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',le);if(s.length&&s[s.length-1][0]>=K)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',le);const Be=f.parse(oe,Y,N);if(!Be)return null;N=N||Be.type,s.push([K,Be])}return!Pc(N,gt)&&!Pc(N,fm)&&!Pc(N,$l)&&!Pc(N,ym)&&!Pc(N,_m)&&!Pc(N,qd)&&!Pc(N,vm)&&!Pc(N,$o(gt))?f.error(`Type ${Pn(N)} is not interpolatable.`):new Gl(N,S,T,E,s)}evaluate(l){const f=this.labels,S=this.outputs;if(f.length===1)return S[0].evaluate(l);const T=this.input.evaluate(l);if(T<=f[0])return S[0].evaluate(l);const E=f.length;if(T>=f[E-1])return S[E-1].evaluate(l);const b=O0(f,T),s=f[b],N=f[b+1],V=Gl.interpolationFactor(this.interpolation,T,s,N),K=S[b].evaluate(l),oe=S[b+1].evaluate(l);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Hh(K,oe,V);case"color":return Jr.interpolate(K,oe,V);case"padding":return Qs.interpolate(K,oe,V);case"colorArray":return qo.interpolate(K,oe,V);case"numberArray":return el.interpolate(K,oe,V);case"variableAnchorOffsetCollection":return ql.interpolate(K,oe,V);case"array":return Zd(K,oe,V);case"projectionDefinition":return Ys.interpolate(K,oe,V)}case"interpolate-hcl":switch(this.type.kind){case"color":return Jr.interpolate(K,oe,V,"hcl");case"colorArray":return qo.interpolate(K,oe,V,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Jr.interpolate(K,oe,V,"lab");case"colorArray":return qo.interpolate(K,oe,V,"lab")}}}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function hg(d,l,f,S){const T=S-f,E=d-f;return T===0?0:l===1?E/T:(Math.pow(l,E)-1)/(Math.pow(l,T)-1)}class Wd{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let S=null;const T=f.expectedType;T&&T.kind!=="value"&&(S=T);const E=[];for(const b of l.slice(1)){const s=f.parse(b,1+E.length,S,void 0,{typeAnnotation:"omit"});if(!s)return null;S=S||s.type,E.push(s)}if(!S)throw new Error("No output type");return T&&E.some(b=>Gd(T,b.type))?new Wd(dr,E):new Wd(S,E)}evaluate(l){let f=null,S=0,T;for(const E of this.args)if(S++,f=E.evaluate(l),f&&f instanceof Ec&&!f.available&&(T||(T=f.name),f=null,S===this.args.length&&(f=T)),f!==null)break;return f}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function S_(d,l){return d==="=="||d==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Yb(d,l,f){return l===f}function Jb(d,l,f){return l!==f}function Qb(d,l,f){return l<f}function ew(d,l,f){return l>f}function tw(d,l,f){return l<=f}function rw(d,l,f){return l>=f}function U0(d,l,f,S){return S.compare(l,f)===0}function nw(d,l,f,S){return!U0(d,l,f,S)}function iw(d,l,f,S){return S.compare(l,f)<0}function aw(d,l,f,S){return S.compare(l,f)>0}function ow(d,l,f,S){return S.compare(l,f)<=0}function sw(d,l,f,S){return S.compare(l,f)>=0}function Vp(d,l,f){const S=d!=="=="&&d!=="!=";return class V0{constructor(E,b,s){this.type=gr,this.lhs=E,this.rhs=b,this.collator=s,this.hasUntypedArgument=E.type.kind==="value"||b.type.kind==="value"}static parse(E,b){if(E.length!==3&&E.length!==4)return b.error("Expected two or three arguments.");const s=E[0];let N=b.parse(E[1],1,dr);if(!N)return null;if(!S_(s,N.type))return b.concat(1).error(`"${s}" comparisons are not supported for type '${Pn(N.type)}'.`);let V=b.parse(E[2],2,dr);if(!V)return null;if(!S_(s,V.type))return b.concat(2).error(`"${s}" comparisons are not supported for type '${Pn(V.type)}'.`);if(N.type.kind!==V.type.kind&&N.type.kind!=="value"&&V.type.kind!=="value")return b.error(`Cannot compare types '${Pn(N.type)}' and '${Pn(V.type)}'.`);S&&(N.type.kind==="value"&&V.type.kind!=="value"?N=new Js(V.type,[N]):N.type.kind!=="value"&&V.type.kind==="value"&&(V=new Js(N.type,[V])));let K=null;if(E.length===4){if(N.type.kind!=="string"&&V.type.kind!=="string"&&N.type.kind!=="value"&&V.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(K=b.parse(E[3],3,mm),!K)return null}return new V0(N,V,K)}evaluate(E){const b=this.lhs.evaluate(E),s=this.rhs.evaluate(E);if(S&&this.hasUntypedArgument){const N=ci(b),V=ci(s);if(N.kind!==V.kind||!(N.kind==="string"||N.kind==="number"))throw new Fn(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${N.kind}, ${V.kind}) instead.`)}if(this.collator&&!S&&this.hasUntypedArgument){const N=ci(b),V=ci(s);if(N.kind!=="string"||V.kind!=="string")return l(E,b,s)}return this.collator?f(E,b,s,this.collator.evaluate(E)):l(E,b,s)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const lw=Vp("==",Yb,U0),uw=Vp("!=",Jb,nw),cw=Vp("<",Qb,iw),hw=Vp(">",ew,aw),pw=Vp("<=",tw,ow),dw=Vp(">=",rw,sw);class Tm{constructor(l,f,S){this.type=mm,this.locale=S,this.caseSensitive=l,this.diacriticSensitive=f}static parse(l,f){if(l.length!==2)return f.error("Expected one argument.");const S=l[1];if(typeof S!="object"||Array.isArray(S))return f.error("Collator options argument must be an object.");const T=f.parse(S["case-sensitive"]===void 0?!1:S["case-sensitive"],1,gr);if(!T)return null;const E=f.parse(S["diacritic-sensitive"]===void 0?!1:S["diacritic-sensitive"],1,gr);if(!E)return null;let b=null;return S.locale&&(b=f.parse(S.locale,1,xr),!b)?null:new Tm(T,E,b)}evaluate(l){return new qg(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Xg{constructor(l,f,S,T,E){this.type=xr,this.number=l,this.locale=f,this.currency=S,this.minFractionDigits=T,this.maxFractionDigits=E}static parse(l,f){if(l.length!==3)return f.error("Expected two arguments.");const S=f.parse(l[1],1,gt);if(!S)return null;const T=l[2];if(typeof T!="object"||Array.isArray(T))return f.error("NumberFormat options argument must be an object.");let E=null;if(T.locale&&(E=f.parse(T.locale,1,xr),!E))return null;let b=null;if(T.currency&&(b=f.parse(T.currency,1,xr),!b))return null;let s=null;if(T["min-fraction-digits"]&&(s=f.parse(T["min-fraction-digits"],1,gt),!s))return null;let N=null;return T["max-fraction-digits"]&&(N=f.parse(T["max-fraction-digits"],1,gt),!N)?null:new Xg(S,E,b,s,N)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Kg{constructor(l){this.type=gm,this.sections=l}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const S=l[1];if(!Array.isArray(S)&&typeof S=="object")return f.error("First argument must be an image or text section.");const T=[];let E=!1;for(let b=1;b<=l.length-1;++b){const s=l[b];if(E&&typeof s=="object"&&!Array.isArray(s)){E=!1;let N=null;if(s["font-scale"]&&(N=f.parse(s["font-scale"],1,gt),!N))return null;let V=null;if(s["text-font"]&&(V=f.parse(s["text-font"],1,$o(xr)),!V))return null;let K=null;if(s["text-color"]&&(K=f.parse(s["text-color"],1,$l),!K))return null;let oe=null;if(s["vertical-align"]){if(typeof s["vertical-align"]=="string"&&!qb.includes(s["vertical-align"]))return f.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${s["vertical-align"]}' instead.`);if(oe=f.parse(s["vertical-align"],1,xr),!oe)return null}const le=T[T.length-1];le.scale=N,le.font=V,le.textColor=K,le.verticalAlign=oe}else{const N=f.parse(l[b],1,dr);if(!N)return null;const V=N.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,T.push({content:N,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Kg(T)}evaluate(l){const f=S=>{const T=S.content.evaluate(l);return ci(T)===tf?new kg("",T,null,null,null,S.verticalAlign?S.verticalAlign.evaluate(l):null):new kg(Vd(T),null,S.scale?S.scale.evaluate(l):null,S.font?S.font.evaluate(l).join(","):null,S.textColor?S.textColor.evaluate(l):null,S.verticalAlign?S.verticalAlign.evaluate(l):null)};return new Fu(this.sections.map(f))}eachChild(l){for(const f of this.sections)l(f.content),f.scale&&l(f.scale),f.font&&l(f.font),f.textColor&&l(f.textColor),f.verticalAlign&&l(f.verticalAlign)}outputDefined(){return!1}}class Yg{constructor(l){this.type=tf,this.input=l}static parse(l,f){if(l.length!==2)return f.error("Expected two arguments.");const S=f.parse(l[1],1,xr);return S?new Yg(S):f.error("No image name provided.")}evaluate(l){const f=this.input.evaluate(l),S=Ec.fromString(f);return S&&l.availableImages&&(S.available=l.availableImages.indexOf(f)>-1),S}eachChild(l){l(this.input)}outputDefined(){return!1}}class Jg{constructor(l){this.type=gt,this.input=l}static parse(l,f){if(l.length!==2)return f.error(`Expected 1 argument, but found ${l.length-1} instead.`);const S=f.parse(l[1],1);return S?S.type.kind!=="array"&&S.type.kind!=="string"&&S.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${Pn(S.type)} instead.`):new Jg(S):null}evaluate(l){const f=this.input.evaluate(l);if(typeof f=="string")return[...f].length;if(Array.isArray(f))return f.length;throw new Fn(`Expected value to be of type string or array, but found ${Pn(ci(f))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Zl=8192;function fw(d,l){const f=mw(d[0]),S=yw(d[1]),T=Math.pow(2,l.z);return[Math.round(f*T*Zl),Math.round(S*T*Zl)]}function Qg(d,l){const f=Math.pow(2,l.z),S=(d[0]/Zl+l.x)/f,T=(d[1]/Zl+l.y)/f;return[gw(S),_w(T)]}function mw(d){return(180+d)/360}function gw(d){return d*360-180}function yw(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function _w(d){return 360/Math.PI*Math.atan(Math.exp((180-d*360)*Math.PI/180))-90}function rf(d,l){d[0]=Math.min(d[0],l[0]),d[1]=Math.min(d[1],l[1]),d[2]=Math.max(d[2],l[0]),d[3]=Math.max(d[3],l[1])}function Xd(d,l){return!(d[0]<=l[0]||d[2]>=l[2]||d[1]<=l[1]||d[3]>=l[3])}function vw(d,l,f){return l[1]>d[1]!=f[1]>d[1]&&d[0]<(f[0]-l[0])*(d[1]-l[1])/(f[1]-l[1])+l[0]}function xw(d,l,f){const S=d[0]-l[0],T=d[1]-l[1],E=d[0]-f[0],b=d[1]-f[1];return S*b-E*T===0&&S*E<=0&&T*b<=0}function Cm(d,l,f,S){const T=[l[0]-d[0],l[1]-d[1]],E=[S[0]-f[0],S[1]-f[1]];return Tw(E,T)===0?!1:!!(T_(d,l,f,S)&&T_(f,S,d,l))}function bw(d,l,f){for(const S of f)for(let T=0;T<S.length-1;++T)if(Cm(d,l,S[T],S[T+1]))return!0;return!1}function $p(d,l,f=!1){let S=!1;for(const T of l)for(let E=0;E<T.length-1;E++){if(xw(d,T[E],T[E+1]))return f;vw(d,T[E],T[E+1])&&(S=!S)}return S}function ww(d,l){for(const f of l)if($p(d,f))return!0;return!1}function $0(d,l){for(const f of d)if(!$p(f,l))return!1;for(let f=0;f<d.length-1;++f)if(bw(d[f],d[f+1],l))return!1;return!0}function Sw(d,l){for(const f of l)if($0(d,f))return!0;return!1}function Tw(d,l){return d[0]*l[1]-d[1]*l[0]}function T_(d,l,f,S){const T=d[0]-f[0],E=d[1]-f[1],b=l[0]-f[0],s=l[1]-f[1],N=S[0]-f[0],V=S[1]-f[1],K=T*V-N*E,oe=b*V-N*s;return K>0&&oe<0||K<0&&oe>0}function ey(d,l,f){const S=[];for(let T=0;T<d.length;T++){const E=[];for(let b=0;b<d[T].length;b++){const s=fw(d[T][b],f);rf(l,s),E.push(s)}S.push(E)}return S}function q0(d,l,f){const S=[];for(let T=0;T<d.length;T++){const E=ey(d[T],l,f);S.push(E)}return S}function G0(d,l,f,S){if(d[0]<f[0]||d[0]>f[2]){const T=S*.5;let E=d[0]-f[0]>T?-S:f[0]-d[0]>T?S:0;E===0&&(E=d[0]-f[2]>T?-S:f[2]-d[0]>T?S:0),d[0]+=E}rf(l,d)}function Cw(d){d[0]=d[1]=1/0,d[2]=d[3]=-1/0}function C_(d,l,f,S){const T=Math.pow(2,S.z)*Zl,E=[S.x*Zl,S.y*Zl],b=[];for(const s of d)for(const N of s){const V=[N.x+E[0],N.y+E[1]];G0(V,l,f,T),b.push(V)}return b}function P_(d,l,f,S){const T=Math.pow(2,S.z)*Zl,E=[S.x*Zl,S.y*Zl],b=[];for(const s of d){const N=[];for(const V of s){const K=[V.x+E[0],V.y+E[1]];rf(l,K),N.push(K)}b.push(N)}if(l[2]-l[0]<=T/2){Cw(l);for(const s of b)for(const N of s)G0(N,l,f,T)}return b}function Pw(d,l){const f=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=d.canonicalID();if(l.type==="Polygon"){const E=ey(l.coordinates,S,T),b=C_(d.geometry(),f,S,T);if(!Xd(f,S))return!1;for(const s of b)if(!$p(s,E))return!1}if(l.type==="MultiPolygon"){const E=q0(l.coordinates,S,T),b=C_(d.geometry(),f,S,T);if(!Xd(f,S))return!1;for(const s of b)if(!ww(s,E))return!1}return!0}function Mw(d,l){const f=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=d.canonicalID();if(l.type==="Polygon"){const E=ey(l.coordinates,S,T),b=P_(d.geometry(),f,S,T);if(!Xd(f,S))return!1;for(const s of b)if(!$0(s,E))return!1}if(l.type==="MultiPolygon"){const E=q0(l.coordinates,S,T),b=P_(d.geometry(),f,S,T);if(!Xd(f,S))return!1;for(const s of b)if(!Sw(s,E))return!1}return!0}class Wh{constructor(l,f){this.type=gr,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Hd(l[1])){const S=l[1];if(S.type==="FeatureCollection"){const T=[];for(const E of S.features){const{type:b,coordinates:s}=E.geometry;b==="Polygon"&&T.push(s),b==="MultiPolygon"&&T.push(...s)}if(T.length){const E={type:"MultiPolygon",coordinates:T};return new Wh(S,E)}}else if(S.type==="Feature"){const T=S.geometry.type;if(T==="Polygon"||T==="MultiPolygon")return new Wh(S,S.geometry)}else if(S.type==="Polygon"||S.type==="MultiPolygon")return new Wh(S,S)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return Pw(l,this.geometries);if(l.geometryType()==="LineString")return Mw(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Z0{constructor(l=[],f=(S,T)=>S<T?-1:S>T?1:0){if(this.data=l,this.length=this.data.length,this.compare=f,this.length>0)for(let S=(this.length>>1)-1;S>=0;S--)this._down(S)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],f=this.data.pop();return--this.length>0&&(this.data[0]=f,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:f,compare:S}=this,T=f[l];for(;l>0;){const E=l-1>>1,b=f[E];if(S(T,b)>=0)break;f[l]=b,l=E}f[l]=T}_down(l){const{data:f,compare:S}=this,T=this.length>>1,E=f[l];for(;l<T;){let b=(l<<1)+1;const s=b+1;if(s<this.length&&S(f[s],f[b])<0&&(b=s),S(f[b],E)>=0)break;f[l]=f[b],l=b}f[l]=E}}function kw(d,l){if(d.length<=1)return[d];const f=[];let S,T;for(const E of d){const b=Ew(E);b!==0&&(E.area=Math.abs(b),T===void 0&&(T=b<0),T===b<0?(S&&f.push(S),S=[E]):S.push(E))}return S&&f.push(S),f}function Ew(d){let l=0;for(let f=0,S=d.length,T=S-1,E,b;f<S;T=f++)E=d[f],b=d[T],l+=(b.x-E.x)*(E.y+b.y);return l}const Iw=6378.137,M_=1/298.257223563,k_=M_*(2-M_),E_=Math.PI/180;class ty{constructor(l){const f=E_*Iw*1e3,S=Math.cos(l*E_),T=1/(1-k_*(1-S*S)),E=Math.sqrt(T);this.kx=f*E*S,this.ky=f*E*T*(1-k_)}distance(l,f){const S=this.wrap(l[0]-f[0])*this.kx,T=(l[1]-f[1])*this.ky;return Math.sqrt(S*S+T*T)}pointOnLine(l,f){let S=1/0,T,E,b,s;for(let N=0;N<l.length-1;N++){let V=l[N][0],K=l[N][1],oe=this.wrap(l[N+1][0]-V)*this.kx,le=(l[N+1][1]-K)*this.ky,Y=0;(oe!==0||le!==0)&&(Y=(this.wrap(f[0]-V)*this.kx*oe+(f[1]-K)*this.ky*le)/(oe*oe+le*le),Y>1?(V=l[N+1][0],K=l[N+1][1]):Y>0&&(V+=oe/this.kx*Y,K+=le/this.ky*Y)),oe=this.wrap(f[0]-V)*this.kx,le=(f[1]-K)*this.ky;const Be=oe*oe+le*le;Be<S&&(S=Be,T=V,E=K,b=N,s=Y)}return{point:[T,E],index:b,t:Math.max(0,Math.min(1,s))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}const Eg=100,Ig=50;function H0(d,l){return l[0]-d[0]}function sm(d){return d[1]-d[0]+1}function ju(d,l){return d[1]>=d[0]&&d[1]<l}function Ag(d,l){if(d[0]>d[1])return[null,null];const f=sm(d);if(l){if(f===2)return[d,null];const T=Math.floor(f/2);return[[d[0],d[0]+T],[d[0]+T,d[1]]]}if(f===1)return[d,null];const S=Math.floor(f/2)-1;return[[d[0],d[0]+S],[d[0]+S+1,d[1]]]}function zg(d,l){if(!ju(l,d.length))return[1/0,1/0,-1/0,-1/0];const f=[1/0,1/0,-1/0,-1/0];for(let S=l[0];S<=l[1];++S)rf(f,d[S]);return f}function Lg(d){const l=[1/0,1/0,-1/0,-1/0];for(const f of d)for(const S of f)rf(l,S);return l}function I_(d){return d[0]!==-1/0&&d[1]!==-1/0&&d[2]!==1/0&&d[3]!==1/0}function ry(d,l,f){if(!I_(d)||!I_(l))return NaN;let S=0,T=0;return d[2]<l[0]&&(S=l[0]-d[2]),d[0]>l[2]&&(S=d[0]-l[2]),d[1]>l[3]&&(T=d[1]-l[3]),d[3]<l[1]&&(T=l[1]-d[3]),f.distance([0,0],[S,T])}function qh(d,l,f){const S=f.pointOnLine(l,d);return f.distance(d,S.point)}function ny(d,l,f,S,T){const E=Math.min(qh(d,[f,S],T),qh(l,[f,S],T)),b=Math.min(qh(f,[d,l],T),qh(S,[d,l],T));return Math.min(E,b)}function Aw(d,l,f,S,T){if(!(ju(l,d.length)&&ju(S,f.length)))return 1/0;let E=1/0;for(let b=l[0];b<l[1];++b){const s=d[b],N=d[b+1];for(let V=S[0];V<S[1];++V){const K=f[V],oe=f[V+1];if(Cm(s,N,K,oe))return 0;E=Math.min(E,ny(s,N,K,oe,T))}}return E}function zw(d,l,f,S,T){if(!(ju(l,d.length)&&ju(S,f.length)))return NaN;let E=1/0;for(let b=l[0];b<=l[1];++b)for(let s=S[0];s<=S[1];++s)if(E=Math.min(E,T.distance(d[b],f[s])),E===0)return E;return E}function Lw(d,l,f){if($p(d,l,!0))return 0;let S=1/0;for(const T of l){const E=T[0],b=T[T.length-1];if(E!==b&&(S=Math.min(S,qh(d,[b,E],f)),S===0))return S;const s=f.pointOnLine(T,d);if(S=Math.min(S,f.distance(d,s.point)),S===0)return S}return S}function Rw(d,l,f,S){if(!ju(l,d.length))return NaN;for(let E=l[0];E<=l[1];++E)if($p(d[E],f,!0))return 0;let T=1/0;for(let E=l[0];E<l[1];++E){const b=d[E],s=d[E+1];for(const N of f)for(let V=0,K=N.length,oe=K-1;V<K;oe=V++){const le=N[oe],Y=N[V];if(Cm(b,s,le,Y))return 0;T=Math.min(T,ny(b,s,le,Y,S))}}return T}function A_(d,l){for(const f of d)for(const S of f)if($p(S,l,!0))return!0;return!1}function Dw(d,l,f,S=1/0){const T=Lg(d),E=Lg(l);if(S!==1/0&&ry(T,E,f)>=S)return S;if(Xd(T,E)){if(A_(d,l))return 0}else if(A_(l,d))return 0;let b=1/0;for(const s of d)for(let N=0,V=s.length,K=V-1;N<V;K=N++){const oe=s[K],le=s[N];for(const Y of l)for(let Be=0,Ne=Y.length,Ze=Ne-1;Be<Ne;Ze=Be++){const He=Y[Ze],Ge=Y[Be];if(Cm(oe,le,He,Ge))return 0;b=Math.min(b,ny(oe,le,He,Ge,f))}}return b}function z_(d,l,f,S,T,E){if(!E)return;const b=ry(zg(S,E),T,f);b<l&&d.push([b,E,[0,0]])}function Hf(d,l,f,S,T,E,b){if(!E||!b)return;const s=ry(zg(S,E),zg(T,b),f);s<l&&d.push([s,E,b])}function lm(d,l,f,S,T=1/0){let E=Math.min(S.distance(d[0],f[0][0]),T);if(E===0)return E;const b=new Z0([[0,[0,d.length-1],[0,0]]],H0),s=Lg(f);for(;b.length>0;){const N=b.pop();if(N[0]>=E)continue;const V=N[1],K=l?Ig:Eg;if(sm(V)<=K){if(!ju(V,d.length))return NaN;if(l){const oe=Rw(d,V,f,S);if(isNaN(oe)||oe===0)return oe;E=Math.min(E,oe)}else for(let oe=V[0];oe<=V[1];++oe){const le=Lw(d[oe],f,S);if(E=Math.min(E,le),E===0)return 0}}else{const oe=Ag(V,l);z_(b,E,S,d,s,oe[0]),z_(b,E,S,d,s,oe[1])}}return E}function um(d,l,f,S,T,E=1/0){let b=Math.min(E,T.distance(d[0],f[0]));if(b===0)return b;const s=new Z0([[0,[0,d.length-1],[0,f.length-1]]],H0);for(;s.length>0;){const N=s.pop();if(N[0]>=b)continue;const V=N[1],K=N[2],oe=l?Ig:Eg,le=S?Ig:Eg;if(sm(V)<=oe&&sm(K)<=le){if(!ju(V,d.length)&&ju(K,f.length))return NaN;let Y;if(l&&S)Y=Aw(d,V,f,K,T),b=Math.min(b,Y);else if(l&&!S){const Be=d.slice(V[0],V[1]+1);for(let Ne=K[0];Ne<=K[1];++Ne)if(Y=qh(f[Ne],Be,T),b=Math.min(b,Y),b===0)return b}else if(!l&&S){const Be=f.slice(K[0],K[1]+1);for(let Ne=V[0];Ne<=V[1];++Ne)if(Y=qh(d[Ne],Be,T),b=Math.min(b,Y),b===0)return b}else Y=zw(d,V,f,K,T),b=Math.min(b,Y)}else{const Y=Ag(V,l),Be=Ag(K,S);Hf(s,b,T,d,f,Y[0],Be[0]),Hf(s,b,T,d,f,Y[0],Be[1]),Hf(s,b,T,d,f,Y[1],Be[0]),Hf(s,b,T,d,f,Y[1],Be[1])}}return b}function Nw(d,l){const f=d.geometry(),S=f.flat().map(b=>Qg([b.x,b.y],d.canonical));if(f.length===0)return NaN;const T=new ty(S[0][1]);let E=1/0;for(const b of l){switch(b.type){case"Point":E=Math.min(E,um(S,!1,[b.coordinates],!1,T,E));break;case"LineString":E=Math.min(E,um(S,!1,b.coordinates,!0,T,E));break;case"Polygon":E=Math.min(E,lm(S,!1,b.coordinates,T,E));break}if(E===0)return E}return E}function Fw(d,l){const f=d.geometry(),S=f.flat().map(b=>Qg([b.x,b.y],d.canonical));if(f.length===0)return NaN;const T=new ty(S[0][1]);let E=1/0;for(const b of l){switch(b.type){case"Point":E=Math.min(E,um(S,!0,[b.coordinates],!1,T,E));break;case"LineString":E=Math.min(E,um(S,!0,b.coordinates,!0,T,E));break;case"Polygon":E=Math.min(E,lm(S,!0,b.coordinates,T,E));break}if(E===0)return E}return E}function Bw(d,l){const f=d.geometry();if(f.length===0||f[0].length===0)return NaN;const S=kw(f).map(b=>b.map(s=>s.map(N=>Qg([N.x,N.y],d.canonical)))),T=new ty(S[0][0][0][1]);let E=1/0;for(const b of l)for(const s of S){switch(b.type){case"Point":E=Math.min(E,lm([b.coordinates],!1,s,T,E));break;case"LineString":E=Math.min(E,lm(b.coordinates,!0,s,T,E));break;case"Polygon":E=Math.min(E,Dw(s,b.coordinates,T,E));break}if(E===0)return E}return E}function pg(d){return d.type==="MultiPolygon"?d.coordinates.map(l=>({type:"Polygon",coordinates:l})):d.type==="MultiLineString"?d.coordinates.map(l=>({type:"LineString",coordinates:l})):d.type==="MultiPoint"?d.coordinates.map(l=>({type:"Point",coordinates:l})):[d]}class Xh{constructor(l,f){this.type=gt,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Hd(l[1])){const S=l[1];if(S.type==="FeatureCollection")return new Xh(S,S.features.map(T=>pg(T.geometry)).flat());if(S.type==="Feature")return new Xh(S,pg(S.geometry));if("type"in S&&"coordinates"in S)return new Xh(S,pg(S))}return f.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return Nw(l,this.geometries);if(l.geometryType()==="LineString")return Fw(l,this.geometries);if(l.geometryType()==="Polygon")return Bw(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class nf{constructor(l){this.type=dr,this.key=l}static parse(l,f){if(l.length!==2)return f.error(`Expected 1 argument, but found ${l.length-1} instead.`);const S=l[1];return S==null?f.error("Global state property must be defined."):typeof S!="string"?f.error(`Global state property must be string, but found ${typeof l[1]} instead.`):new nf(S)}evaluate(l){var f;const S=(f=l.globals)===null||f===void 0?void 0:f.globalState;return!S||Object.keys(S).length===0?null:Ud(S,this.key)}eachChild(){}outputDefined(){return!1}}const iy={"==":lw,"!=":uw,">":hw,"<":cw,">=":dw,"<=":pw,array:Js,at:Gg,boolean:Js,case:Wg,coalesce:Wd,collator:Tm,format:Kg,image:Yg,in:Zg,"index-of":am,interpolate:Gl,"interpolate-hcl":Gl,"interpolate-lab":Gl,length:Jg,let:bm,literal:jp,match:Hg,number:Js,"number-format":Xg,object:Js,slice:om,step:Sm,string:Js,"to-boolean":Mc,"to-color":Mc,"to-number":Mc,"to-string":Mc,var:wm,within:Wh,distance:Xh,"global-state":nf};class tl{constructor(l,f,S,T){this.name=l,this.type=f,this._evaluate=S,this.args=T}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,f){const S=l[0],T=tl.definitions[S];if(!T)return f.error(`Unknown expression "${S}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(T)?T[0]:T.type,b=Array.isArray(T)?[[T[1],T[2]]]:T.overloads,s=b.filter(([V])=>!Array.isArray(V)||V.length===l.length-1);let N=null;for(const[V,K]of s){N=new xm(f.registry,cm,f.path,null,f.scope);const oe=[];let le=!1;for(let Y=1;Y<l.length;Y++){const Be=l[Y],Ne=Array.isArray(V)?V[Y-1]:V.type,Ze=N.parse(Be,1+oe.length,Ne);if(!Ze){le=!0;break}oe.push(Ze)}if(!le){if(Array.isArray(V)&&V.length!==oe.length){N.error(`Expected ${V.length} arguments, but found ${oe.length} instead.`);continue}for(let Y=0;Y<oe.length;Y++){const Be=Array.isArray(V)?V[Y]:V.type,Ne=oe[Y];N.concat(Y+1).checkSubtype(Be,Ne.type)}if(N.errors.length===0)return new tl(S,E,K,oe)}}if(s.length===1)f.errors.push(...N.errors);else{const V=(s.length?s:b).map(([oe])=>Ow(oe)).join(" | "),K=[];for(let oe=1;oe<l.length;oe++){const le=f.parse(l[oe],1+K.length);if(!le)return null;K.push(Pn(le.type))}f.error(`Expected arguments of type ${V}, but found (${K.join(", ")}) instead.`)}return null}static register(l,f){tl.definitions=f;for(const S in f)l[S]=tl}}function L_(d,[l,f,S,T]){l=l.evaluate(d),f=f.evaluate(d),S=S.evaluate(d);const E=T?T.evaluate(d):1,b=B0(l,f,S,E);if(b)throw new Fn(b);return new Jr(l/255,f/255,S/255,E,!1)}function R_(d,l){return d in l}function dg(d,l){const f=l[d];return typeof f>"u"?null:f}function jw(d,l,f,S){for(;f<=S;){const T=f+S>>1;if(l[T]===d)return!0;l[T]>d?S=T-1:f=T+1}return!1}function Nh(d){return{type:d}}tl.register(iy,{error:[Lb,[xr],(d,[l])=>{throw new Fn(l.evaluate(d))}],typeof:[xr,[dr],(d,[l])=>Pn(ci(l.evaluate(d)))],"to-rgba":[$o(gt,4),[$l],(d,[l])=>{const[f,S,T,E]=l.evaluate(d).rgb;return[f*255,S*255,T*255,E]}],rgb:[$l,[gt,gt,gt],L_],rgba:[$l,[gt,gt,gt,gt],L_],has:{type:gr,overloads:[[[xr],(d,[l])=>R_(l.evaluate(d),d.properties())],[[xr,Gh],(d,[l,f])=>R_(l.evaluate(d),f.evaluate(d))]]},get:{type:dr,overloads:[[[xr],(d,[l])=>dg(l.evaluate(d),d.properties())],[[xr,Gh],(d,[l,f])=>dg(l.evaluate(d),f.evaluate(d))]]},"feature-state":[dr,[xr],(d,[l])=>dg(l.evaluate(d),d.featureState||{})],properties:[Gh,[],d=>d.properties()],"geometry-type":[xr,[],d=>d.geometryType()],id:[dr,[],d=>d.id()],zoom:[gt,[],d=>d.globals.zoom],"heatmap-density":[gt,[],d=>d.globals.heatmapDensity||0],elevation:[gt,[],d=>d.globals.elevation||0],"line-progress":[gt,[],d=>d.globals.lineProgress||0],accumulated:[dr,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[gt,Nh(gt),(d,l)=>{let f=0;for(const S of l)f+=S.evaluate(d);return f}],"*":[gt,Nh(gt),(d,l)=>{let f=1;for(const S of l)f*=S.evaluate(d);return f}],"-":{type:gt,overloads:[[[gt,gt],(d,[l,f])=>l.evaluate(d)-f.evaluate(d)],[[gt],(d,[l])=>-l.evaluate(d)]]},"/":[gt,[gt,gt],(d,[l,f])=>l.evaluate(d)/f.evaluate(d)],"%":[gt,[gt,gt],(d,[l,f])=>l.evaluate(d)%f.evaluate(d)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(d,[l,f])=>Math.pow(l.evaluate(d),f.evaluate(d))],sqrt:[gt,[gt],(d,[l])=>Math.sqrt(l.evaluate(d))],log10:[gt,[gt],(d,[l])=>Math.log(l.evaluate(d))/Math.LN10],ln:[gt,[gt],(d,[l])=>Math.log(l.evaluate(d))],log2:[gt,[gt],(d,[l])=>Math.log(l.evaluate(d))/Math.LN2],sin:[gt,[gt],(d,[l])=>Math.sin(l.evaluate(d))],cos:[gt,[gt],(d,[l])=>Math.cos(l.evaluate(d))],tan:[gt,[gt],(d,[l])=>Math.tan(l.evaluate(d))],asin:[gt,[gt],(d,[l])=>Math.asin(l.evaluate(d))],acos:[gt,[gt],(d,[l])=>Math.acos(l.evaluate(d))],atan:[gt,[gt],(d,[l])=>Math.atan(l.evaluate(d))],min:[gt,Nh(gt),(d,l)=>Math.min(...l.map(f=>f.evaluate(d)))],max:[gt,Nh(gt),(d,l)=>Math.max(...l.map(f=>f.evaluate(d)))],abs:[gt,[gt],(d,[l])=>Math.abs(l.evaluate(d))],round:[gt,[gt],(d,[l])=>{const f=l.evaluate(d);return f<0?-Math.round(-f):Math.round(f)}],floor:[gt,[gt],(d,[l])=>Math.floor(l.evaluate(d))],ceil:[gt,[gt],(d,[l])=>Math.ceil(l.evaluate(d))],"filter-==":[gr,[xr,dr],(d,[l,f])=>d.properties()[l.value]===f.value],"filter-id-==":[gr,[dr],(d,[l])=>d.id()===l.value],"filter-type-==":[gr,[xr],(d,[l])=>d.geometryType()===l.value],"filter-<":[gr,[xr,dr],(d,[l,f])=>{const S=d.properties()[l.value],T=f.value;return typeof S==typeof T&&S<T}],"filter-id-<":[gr,[dr],(d,[l])=>{const f=d.id(),S=l.value;return typeof f==typeof S&&f<S}],"filter->":[gr,[xr,dr],(d,[l,f])=>{const S=d.properties()[l.value],T=f.value;return typeof S==typeof T&&S>T}],"filter-id->":[gr,[dr],(d,[l])=>{const f=d.id(),S=l.value;return typeof f==typeof S&&f>S}],"filter-<=":[gr,[xr,dr],(d,[l,f])=>{const S=d.properties()[l.value],T=f.value;return typeof S==typeof T&&S<=T}],"filter-id-<=":[gr,[dr],(d,[l])=>{const f=d.id(),S=l.value;return typeof f==typeof S&&f<=S}],"filter->=":[gr,[xr,dr],(d,[l,f])=>{const S=d.properties()[l.value],T=f.value;return typeof S==typeof T&&S>=T}],"filter-id->=":[gr,[dr],(d,[l])=>{const f=d.id(),S=l.value;return typeof f==typeof S&&f>=S}],"filter-has":[gr,[dr],(d,[l])=>l.value in d.properties()],"filter-has-id":[gr,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[gr,[$o(xr)],(d,[l])=>l.value.indexOf(d.geometryType())>=0],"filter-id-in":[gr,[$o(dr)],(d,[l])=>l.value.indexOf(d.id())>=0],"filter-in-small":[gr,[xr,$o(dr)],(d,[l,f])=>f.value.indexOf(d.properties()[l.value])>=0],"filter-in-large":[gr,[xr,$o(dr)],(d,[l,f])=>jw(d.properties()[l.value],f.value,0,f.value.length-1)],all:{type:gr,overloads:[[[gr,gr],(d,[l,f])=>l.evaluate(d)&&f.evaluate(d)],[Nh(gr),(d,l)=>{for(const f of l)if(!f.evaluate(d))return!1;return!0}]]},any:{type:gr,overloads:[[[gr,gr],(d,[l,f])=>l.evaluate(d)||f.evaluate(d)],[Nh(gr),(d,l)=>{for(const f of l)if(f.evaluate(d))return!0;return!1}]]},"!":[gr,[gr],(d,[l])=>!l.evaluate(d)],"is-supported-script":[gr,[xr],(d,[l])=>{const f=d.globals&&d.globals.isSupportedScript;return f?f(l.evaluate(d)):!0}],upcase:[xr,[xr],(d,[l])=>l.evaluate(d).toUpperCase()],downcase:[xr,[xr],(d,[l])=>l.evaluate(d).toLowerCase()],concat:[xr,Nh(dr),(d,l)=>l.map(f=>Vd(f.evaluate(d))).join("")],"resolved-locale":[xr,[mm],(d,[l])=>l.evaluate(d).resolvedLocale()]});function Ow(d){return Array.isArray(d)?`(${d.map(Pn).join(", ")})`:`(${Pn(d.type)}...)`}function cm(d){if(d instanceof wm)return cm(d.boundExpression);if(d instanceof tl&&d.name==="error"||d instanceof Tm||d instanceof Wh||d instanceof Xh||d instanceof nf)return!1;const l=d instanceof Mc||d instanceof Js;let f=!0;return d.eachChild(S=>{l?f=f&&cm(S):f=f&&S instanceof jp}),f?Pm(d)&&Mm(d,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Pm(d){if(d instanceof tl&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof Wh||d instanceof Xh)return!1;let l=!0;return d.eachChild(f=>{l&&!Pm(f)&&(l=!1)}),l}function Kd(d){if(d instanceof tl&&d.name==="feature-state")return!1;let l=!0;return d.eachChild(f=>{l&&!Kd(f)&&(l=!1)}),l}function Mm(d,l){if(d instanceof tl&&l.indexOf(d.name)>=0)return!1;let f=!0;return d.eachChild(S=>{f&&!Mm(S,l)&&(f=!1)}),f}function Rg(d){return{result:"success",value:d}}function Rp(d){return{result:"error",value:d}}function hm(d){return d["property-type"]==="data-driven"||d["property-type"]==="cross-faded-data-driven"}function W0(d){return!!d.expression&&d.expression.parameters.indexOf("zoom")>-1}function X0(d){return!!d.expression&&d.expression.interpolated}function kr(d){return d instanceof Number?"number":d instanceof String?"string":d instanceof Boolean?"boolean":Array.isArray(d)?"array":d===null?"null":typeof d}function ay(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)&&ci(d)===Gh}class Uw{constructor(l,f){this.expression=l,this._warningHistory={},this._evaluator=new j0,this._defaultValue=f?qw(f):null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(l,f,S,T,E,b){return this._evaluator.globals=l,this._evaluator.feature=f,this._evaluator.featureState=S,this._evaluator.canonical=T,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(l,f,S,T,E,b){this._evaluator.globals=l,this._evaluator.feature=f||null,this._evaluator.featureState=S||null,this._evaluator.canonical=T,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=b||null;try{const s=this.expression.evaluate(this._evaluator);if(s==null||typeof s=="number"&&s!==s)return this._defaultValue;if(this._enumValues&&!(s in this._enumValues))throw new Fn(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(s)} instead.`);return s}catch(s){return this._warningHistory[s.message]||(this._warningHistory[s.message]=!0,typeof console<"u"&&console.warn(s.message)),this._defaultValue}}}function K0(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in iy}function Y0(d,l){const f=new xm(iy,cm,[],l?$w(l):void 0),S=f.parse(d,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return S?Rg(new Uw(S,l)):Rp(f.errors)}class D_{constructor(l,f){this.kind=l,this._styleExpression=f,this.isStateDependent=l!=="constant"&&!Kd(f.expression),this.globalStateRefs=oy(f.expression)}evaluateWithoutErrorHandling(l,f,S,T,E,b){return this._styleExpression.evaluateWithoutErrorHandling(l,f,S,T,E,b)}evaluate(l,f,S,T,E,b){return this._styleExpression.evaluate(l,f,S,T,E,b)}}class N_{constructor(l,f,S,T){this.kind=l,this.zoomStops=S,this._styleExpression=f,this.isStateDependent=l!=="camera"&&!Kd(f.expression),this.globalStateRefs=oy(f.expression),this.interpolationType=T}evaluateWithoutErrorHandling(l,f,S,T,E,b){return this._styleExpression.evaluateWithoutErrorHandling(l,f,S,T,E,b)}evaluate(l,f,S,T,E,b){return this._styleExpression.evaluate(l,f,S,T,E,b)}interpolationFactor(l,f,S){return this.interpolationType?Gl.interpolationFactor(this.interpolationType,l,f,S):0}}function Vw(d,l){const f=Y0(d,l);if(f.result==="error")return f;const S=f.value.expression,T=Pm(S);if(!T&&!hm(l))return Rp([new Vl("","data expressions not supported")]);const E=Mm(S,["zoom"]);if(!E&&!W0(l))return Rp([new Vl("","zoom expressions not supported")]);const b=Qf(S);if(!b&&!E)return Rp([new Vl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(b instanceof Vl)return Rp([b]);if(b instanceof Gl&&!X0(l))return Rp([new Vl("",'"interpolate" expressions cannot be used with this property')]);if(!b)return Rg(T?new D_("constant",f.value):new D_("source",f.value));const s=b instanceof Gl?b.interpolation:void 0;return Rg(T?new N_("camera",f.value,b.labels,s):new N_("composite",f.value,b.labels,s))}function Qf(d){let l=null;if(d instanceof bm)l=Qf(d.result);else if(d instanceof Wd){for(const f of d.args)if(l=Qf(f),l)break}else(d instanceof Sm||d instanceof Gl)&&d.input instanceof tl&&d.input.name==="zoom"&&(l=d);return l instanceof Vl||d.eachChild(f=>{const S=Qf(f);S instanceof Vl?l=S:!l&&S?l=new Vl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&S&&l!==S&&(l=new Vl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function oy(d,l=new Set){return d instanceof nf&&l.add(d.key),d.eachChild(f=>{oy(f,l)}),l}function $w(d){const l={color:$l,string:xr,number:gt,enum:xr,boolean:gr,formatted:gm,padding:ym,numberArray:_m,colorArray:qd,projectionDefinition:fm,resolvedImage:tf,variableAnchorOffsetCollection:vm};return d.type==="array"?$o(l[d.value]||dr,d.length):l[d.type]}function qw(d){if(d.type==="color"&&ay(d.default))return new Jr(0,0,0,0);switch(d.type){case"color":return Jr.parse(d.default)||null;case"padding":return Qs.parse(d.default)||null;case"numberArray":return el.parse(d.default)||null;case"colorArray":return qo.parse(d.default)||null;case"variableAnchorOffsetCollection":return ql.parse(d.default)||null;case"projectionDefinition":return Ys.parse(d.default)||null;default:return d.default===void 0?null:d.default}}function J0(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const l of d.slice(1))if(!J0(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function Q0(d){const l=d.key,f=d.value;return f?[new st(l,f,"constants have been deprecated as of v8")]:[]}function qn(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function Yh(d){if(Array.isArray(d))return d.map(Yh);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const l={};for(const f in d)l[f]=Yh(d[f]);return l}return qn(d)}function vs(d){const l=d.key,f=d.value,S=d.valueSpec||{},T=d.objectElementValidators||{},E=d.style,b=d.styleSpec,s=d.validateSpec;let N=[];const V=kr(f);if(V!=="object")return[new st(l,f,`object expected, ${V} found`)];for(const K in f){const oe=K.split(".")[0],le=Ud(S,oe)||S["*"];let Y;if(Ud(T,oe))Y=T[oe];else if(Ud(S,oe))Y=s;else if(T["*"])Y=T["*"];else if(S["*"])Y=s;else{N.push(new st(l,f[K],`unknown property "${K}"`));continue}N=N.concat(Y({key:(l&&`${l}.`)+K,value:f[K],valueSpec:le,style:E,styleSpec:b,object:f,objectKey:K,validateSpec:s},f))}for(const K in S)T[K]||S[K].required&&S[K].default===void 0&&f[K]===void 0&&N.push(new st(l,f,`missing required property "${K}"`));return N}function sy(d){const l=d.value,f=d.valueSpec,S=d.validateSpec,T=d.style,E=d.styleSpec,b=d.key,s=d.arrayElementValidator||S;if(kr(l)!=="array")return[new st(b,l,`array expected, ${kr(l)} found`)];if(f.length&&l.length!==f.length)return[new st(b,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new st(b,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let N={type:f.value,values:f.values};E.$version<7&&(N.function=f.function),kr(f.value)==="object"&&(N=f.value);let V=[];for(let K=0;K<l.length;K++)V=V.concat(s({array:l,arrayIndex:K,value:l[K],valueSpec:N,validateSpec:d.validateSpec,style:T,styleSpec:E,key:`${b}[${K}]`}));return V}function km(d){const l=d.key,f=d.value,S=d.valueSpec;let T=kr(f);return T==="number"&&f!==f&&(T="NaN"),T!=="number"?[new st(l,f,`number expected, ${T} found`)]:"minimum"in S&&f<S.minimum?[new st(l,f,`${f} is less than the minimum value ${S.minimum}`)]:"maximum"in S&&f>S.maximum?[new st(l,f,`${f} is greater than the maximum value ${S.maximum}`)]:[]}function ev(d){const l=d.valueSpec,f=qn(d.value.type);let S,T={},E,b;const s=f!=="categorical"&&d.value.property===void 0,N=!s,V=kr(d.value.stops)==="array"&&kr(d.value.stops[0])==="array"&&kr(d.value.stops[0][0])==="object",K=vs({key:d.key,value:d.value,valueSpec:d.styleSpec.function,validateSpec:d.validateSpec,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:oe,default:Be}});return f==="identity"&&s&&K.push(new st(d.key,d.value,'missing required property "property"')),f!=="identity"&&!d.value.stops&&K.push(new st(d.key,d.value,'missing required property "stops"')),f==="exponential"&&d.valueSpec.expression&&!X0(d.valueSpec)&&K.push(new st(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(N&&!hm(d.valueSpec)?K.push(new st(d.key,d.value,"property functions not supported")):s&&!W0(d.valueSpec)&&K.push(new st(d.key,d.value,"zoom functions not supported"))),(f==="categorical"||V)&&d.value.property===void 0&&K.push(new st(d.key,d.value,'"property" property is required')),K;function oe(Ne){if(f==="identity")return[new st(Ne.key,Ne.value,'identity function may not have a "stops" property')];let Ze=[];const He=Ne.value;return Ze=Ze.concat(sy({key:Ne.key,value:He,valueSpec:Ne.valueSpec,validateSpec:Ne.validateSpec,style:Ne.style,styleSpec:Ne.styleSpec,arrayElementValidator:le})),kr(He)==="array"&&He.length===0&&Ze.push(new st(Ne.key,He,"array must have at least one stop")),Ze}function le(Ne){let Ze=[];const He=Ne.value,Ge=Ne.key;if(kr(He)!=="array")return[new st(Ge,He,`array expected, ${kr(He)} found`)];if(He.length!==2)return[new st(Ge,He,`array length 2 expected, length ${He.length} found`)];if(V){if(kr(He[0])!=="object")return[new st(Ge,He,`object expected, ${kr(He[0])} found`)];if(He[0].zoom===void 0)return[new st(Ge,He,"object stop key must have zoom")];if(He[0].value===void 0)return[new st(Ge,He,"object stop key must have value")];if(b&&b>qn(He[0].zoom))return[new st(Ge,He[0].zoom,"stop zoom values must appear in ascending order")];qn(He[0].zoom)!==b&&(b=qn(He[0].zoom),E=void 0,T={}),Ze=Ze.concat(vs({key:`${Ge}[0]`,value:He[0],valueSpec:{zoom:{}},validateSpec:Ne.validateSpec,style:Ne.style,styleSpec:Ne.styleSpec,objectElementValidators:{zoom:km,value:Y}}))}else Ze=Ze.concat(Y({key:`${Ge}[0]`,value:He[0],validateSpec:Ne.validateSpec,style:Ne.style,styleSpec:Ne.styleSpec},He));return K0(Yh(He[1]))?Ze.concat([new st(`${Ge}[1]`,He[1],"expressions are not allowed in function stops.")]):Ze.concat(Ne.validateSpec({key:`${Ge}[1]`,value:He[1],valueSpec:l,validateSpec:Ne.validateSpec,style:Ne.style,styleSpec:Ne.styleSpec}))}function Y(Ne,Ze){const He=kr(Ne.value),Ge=qn(Ne.value),nt=Ne.value!==null?Ne.value:Ze;if(!S)S=He;else if(He!==S)return[new st(Ne.key,nt,`${He} stop domain type must match previous stop domain type ${S}`)];if(He!=="number"&&He!=="string"&&He!=="boolean")return[new st(Ne.key,nt,"stop domain value must be a number, string, or boolean")];if(He!=="number"&&f!=="categorical"){let Le=`number expected, ${He} found`;return hm(l)&&f===void 0&&(Le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(Ne.key,nt,Le)]}return f==="categorical"&&He==="number"&&(!isFinite(Ge)||Math.floor(Ge)!==Ge)?[new st(Ne.key,nt,`integer expected, found ${Ge}`)]:f!=="categorical"&&He==="number"&&E!==void 0&&Ge<E?[new st(Ne.key,nt,"stop domain values must appear in ascending order")]:(E=Ge,f==="categorical"&&Ge in T?[new st(Ne.key,nt,"stop domain values must be unique")]:(T[Ge]=!0,[]))}function Be(Ne){return Ne.validateSpec({key:Ne.key,value:Ne.value,valueSpec:l,validateSpec:Ne.validateSpec,style:Ne.style,styleSpec:Ne.styleSpec})}}function Op(d){const l=(d.expressionContext==="property"?Vw:Y0)(Yh(d.value),d.valueSpec);if(l.result==="error")return l.value.map(S=>new st(`${d.key}${S.key}`,d.value,S.message));const f=l.value.expression||l.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!f.outputDefined())return[new st(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!Kd(f))return[new st(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter"&&!Kd(f))return[new st(d.key,d.value,'"feature-state" data expressions are not supported with filters.')];if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!Mm(f,["zoom","feature-state"]))return[new st(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!Pm(f))return[new st(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gw(d){const l=d.value,f=d.key,S=kr(l);return S!=="boolean"?[new st(f,l,`boolean expected, ${S} found`)]:[]}function Dg(d){const l=d.key,f=d.value,S=kr(f);return S!=="string"?[new st(l,f,`color expected, ${S} found`)]:Jr.parse(String(f))?[]:[new st(l,f,`color expected, "${f}" found`)]}function Yd(d){const l=d.key,f=d.value,S=d.valueSpec,T=[];return Array.isArray(S.values)?S.values.indexOf(qn(f))===-1&&T.push(new st(l,f,`expected one of [${S.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(S.values).indexOf(qn(f))===-1&&T.push(new st(l,f,`expected one of [${Object.keys(S.values).join(", ")}], ${JSON.stringify(f)} found`)),T}function ly(d){return J0(Yh(d.value))?Op(im({},d,{expressionContext:"filter",valueSpec:{value:"boolean"}})):tv(d)}function tv(d){const l=d.value,f=d.key;if(kr(l)!=="array")return[new st(f,l,`array expected, ${kr(l)} found`)];const S=d.styleSpec;let T,E=[];if(l.length<1)return[new st(f,l,"filter array must have at least 1 element")];switch(E=E.concat(Yd({key:`${f}[0]`,value:l[0],valueSpec:S.filter_operator,style:d.style,styleSpec:d.styleSpec})),qn(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&qn(l[1])==="$type"&&E.push(new st(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new st(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(T=kr(l[1]),T!=="string"&&E.push(new st(`${f}[1]`,l[1],`string expected, ${T} found`)));for(let b=2;b<l.length;b++)T=kr(l[b]),qn(l[1])==="$type"?E=E.concat(Yd({key:`${f}[${b}]`,value:l[b],valueSpec:S.geometry_type,style:d.style,styleSpec:d.styleSpec})):T!=="string"&&T!=="number"&&T!=="boolean"&&E.push(new st(`${f}[${b}]`,l[b],`string, number, or boolean expected, ${T} found`));break;case"any":case"all":case"none":for(let b=1;b<l.length;b++)E=E.concat(tv({key:`${f}[${b}]`,value:l[b],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":T=kr(l[1]),l.length!==2?E.push(new st(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):T!=="string"&&E.push(new st(`${f}[1]`,l[1],`string expected, ${T} found`));break}return E}function rv(d,l){const f=d.key,S=d.validateSpec,T=d.style,E=d.styleSpec,b=d.value,s=d.objectKey,N=E[`${l}_${d.layerType}`];if(!N)return[];const V=s.match(/^(.*)-transition$/);if(l==="paint"&&V&&N[V[1]]&&N[V[1]].transition)return S({key:f,value:b,valueSpec:E.transition,style:T,styleSpec:E});const K=d.valueSpec||N[s];if(!K)return[new st(f,b,`unknown property "${s}"`)];let oe;if(kr(b)==="string"&&hm(K)&&!K.tokens&&(oe=/^{([^}]+)}$/.exec(b)))return[new st(f,b,`"${s}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(oe[1])} }\`.`)];const le=[];return d.layerType==="symbol"&&(s==="text-field"&&T&&!T.glyphs&&le.push(new st(f,b,'use of "text-field" requires a style "glyphs" property')),s==="text-font"&&ay(Yh(b))&&qn(b.type)==="identity"&&le.push(new st(f,b,'"text-font" does not support identity functions'))),le.concat(S({key:d.key,value:b,valueSpec:K,style:T,styleSpec:E,expressionContext:"property",propertyType:l,propertyKey:s}))}function nv(d){return rv(d,"paint")}function iv(d){return rv(d,"layout")}function av(d){let l=[];const f=d.value,S=d.key,T=d.style,E=d.styleSpec;if(kr(f)!=="object")return[new st(S,f,`object expected, ${kr(f)} found`)];!f.type&&!f.ref&&l.push(new st(S,f,'either "type" or "ref" is required'));let b=qn(f.type);const s=qn(f.ref);if(f.id){const N=qn(f.id);for(let V=0;V<d.arrayIndex;V++){const K=T.layers[V];qn(K.id)===N&&l.push(new st(S,f.id,`duplicate layer id "${f.id}", previously used at line ${K.id.__line__}`))}}if("ref"in f){["type","source","source-layer","filter","layout"].forEach(V=>{V in f&&l.push(new st(S,f[V],`"${V}" is prohibited for ref layers`))});let N;T.layers.forEach(V=>{qn(V.id)===s&&(N=V)}),N?N.ref?l.push(new st(S,f.ref,"ref cannot reference another ref layer")):b=qn(N.type):l.push(new st(S,f.ref,`ref layer "${s}" not found`))}else if(b!=="background")if(!f.source)l.push(new st(S,f,'missing required property "source"'));else{const N=T.sources&&T.sources[f.source],V=N&&qn(N.type);N?V==="vector"&&b==="raster"?l.push(new st(S,f.source,`layer "${f.id}" requires a raster source`)):V!=="raster-dem"&&b==="hillshade"?l.push(new st(S,f.source,`layer "${f.id}" requires a raster-dem source`)):V!=="raster-dem"&&b==="color-relief"?l.push(new st(S,f.source,`layer "${f.id}" requires a raster-dem source`)):V==="raster"&&b!=="raster"?l.push(new st(S,f.source,`layer "${f.id}" requires a vector source`)):V==="vector"&&!f["source-layer"]?l.push(new st(S,f,`layer "${f.id}" must specify a "source-layer"`)):V==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?l.push(new st(S,f.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b==="line"&&f.paint&&f.paint["line-gradient"]&&(V!=="geojson"||!N.lineMetrics)&&l.push(new st(S,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new st(S,f.source,`source "${f.source}" not found`))}return l=l.concat(vs({key:S,value:f,valueSpec:E.layer,style:d.style,styleSpec:d.styleSpec,validateSpec:d.validateSpec,objectElementValidators:{"*"(){return[]},type(){return d.validateSpec({key:`${S}.type`,value:f.type,valueSpec:E.layer.type,style:d.style,styleSpec:d.styleSpec,validateSpec:d.validateSpec,object:f,objectKey:"type"})},filter:ly,layout(N){return vs({layer:f,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,validateSpec:N.validateSpec,objectElementValidators:{"*"(V){return iv(im({layerType:b},V))}}})},paint(N){return vs({layer:f,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,validateSpec:N.validateSpec,objectElementValidators:{"*"(V){return nv(im({layerType:b},V))}}})}}})),l}function Jh(d){const l=d.value,f=d.key,S=kr(l);return S!=="string"?[new st(f,l,`string expected, ${S} found`)]:[]}function Zw(d){var l;const f=(l=d.sourceName)!==null&&l!==void 0?l:"",S=d.value,T=d.styleSpec,E=T.source_raster_dem,b=d.style;let s=[];const N=kr(S);if(S===void 0)return s;if(N!=="object")return s.push(new st("source_raster_dem",S,`object expected, ${N} found`)),s;const V=qn(S.encoding)==="custom",K=["redFactor","greenFactor","blueFactor","baseShift"],oe=d.value.encoding?`"${d.value.encoding}"`:"Default";for(const le in S)!V&&K.includes(le)?s.push(new st(le,S[le],`In "${f}": "${le}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):E[le]?s=s.concat(d.validateSpec({key:le,value:S[le],valueSpec:E[le],validateSpec:d.validateSpec,style:b,styleSpec:T})):s.push(new st(le,S[le],`unknown property "${le}"`));return s}const F_={promoteId:Hw};function ov(d){const l=d.value,f=d.key,S=d.styleSpec,T=d.style,E=d.validateSpec;if(!l.type)return[new st(f,l,'"type" is required')];const b=qn(l.type);let s;switch(b){case"vector":case"raster":return s=vs({key:f,value:l,valueSpec:S[`source_${b.replace("-","_")}`],style:d.style,styleSpec:S,objectElementValidators:F_,validateSpec:E}),s;case"raster-dem":return s=Zw({sourceName:f,value:l,style:d.style,styleSpec:S,validateSpec:E}),s;case"geojson":if(s=vs({key:f,value:l,valueSpec:S.source_geojson,style:T,styleSpec:S,validateSpec:E,objectElementValidators:F_}),l.cluster)for(const N in l.clusterProperties){const[V,K]=l.clusterProperties[N],oe=typeof V=="string"?[V,["accumulated"],["get",N]]:V;s.push(...Op({key:`${f}.${N}.map`,value:K,expressionContext:"cluster-map"})),s.push(...Op({key:`${f}.${N}.reduce`,value:oe,expressionContext:"cluster-reduce"}))}return s;case"video":return vs({key:f,value:l,valueSpec:S.source_video,style:T,validateSpec:E,styleSpec:S});case"image":return vs({key:f,value:l,valueSpec:S.source_image,style:T,validateSpec:E,styleSpec:S});case"canvas":return[new st(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yd({key:`${f}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Hw({key:d,value:l}){if(kr(l)==="string")return Jh({key:d,value:l});{const f=[];for(const S in l)f.push(...Jh({key:`${d}.${S}`,value:l[S]}));return f}}function sv(d){const l=d.value,f=d.styleSpec,S=f.light,T=d.style;let E=[];const b=kr(l);if(l===void 0)return E;if(b!=="object")return E=E.concat([new st("light",l,`object expected, ${b} found`)]),E;for(const s in l){const N=s.match(/^(.*)-transition$/);N&&S[N[1]]&&S[N[1]].transition?E=E.concat(d.validateSpec({key:s,value:l[s],valueSpec:f.transition,validateSpec:d.validateSpec,style:T,styleSpec:f})):S[s]?E=E.concat(d.validateSpec({key:s,value:l[s],valueSpec:S[s],validateSpec:d.validateSpec,style:T,styleSpec:f})):E=E.concat([new st(s,l[s],`unknown property "${s}"`)])}return E}function lv(d){const l=d.value,f=d.styleSpec,S=f.sky,T=d.style,E=kr(l);if(l===void 0)return[];if(E!=="object")return[new st("sky",l,`object expected, ${E} found`)];let b=[];for(const s in l)S[s]?b=b.concat(d.validateSpec({key:s,value:l[s],valueSpec:S[s],style:T,styleSpec:f})):b=b.concat([new st(s,l[s],`unknown property "${s}"`)]);return b}function uv(d){const l=d.value,f=d.styleSpec,S=f.terrain,T=d.style;let E=[];const b=kr(l);if(l===void 0)return E;if(b!=="object")return E=E.concat([new st("terrain",l,`object expected, ${b} found`)]),E;for(const s in l)S[s]?E=E.concat(d.validateSpec({key:s,value:l[s],valueSpec:S[s],validateSpec:d.validateSpec,style:T,styleSpec:f})):E=E.concat([new st(s,l[s],`unknown property "${s}"`)]);return E}function Ww(d){return Jh(d).length===0?[]:Op(d)}function Xw(d){return Jh(d).length===0?[]:Op(d)}function Kw(d){const l=d.key,f=d.value;if(kr(f)==="array"){if(f.length<1||f.length>4)return[new st(l,f,`padding requires 1 to 4 values; ${f.length} values found`)];const S={type:"number"};let T=[];for(let E=0;E<f.length;E++)T=T.concat(d.validateSpec({key:`${l}[${E}]`,value:f[E],validateSpec:d.validateSpec,valueSpec:S}));return T}else return km({key:l,value:f,valueSpec:{}})}function Yw(d){const l=d.key,f=d.value;if(kr(f)==="array"){const S={type:"number"};if(f.length<1)return[new st(l,f,"array length at least 1 expected, length 0 found")];let T=[];for(let E=0;E<f.length;E++)T=T.concat(d.validateSpec({key:`${l}[${E}]`,value:f[E],validateSpec:d.validateSpec,valueSpec:S}));return T}else return km({key:l,value:f,valueSpec:{}})}function Jw(d){const l=d.key,f=d.value;if(kr(f)==="array"){if(f.length<1)return[new st(l,f,"array length at least 1 expected, length 0 found")];let S=[];for(let T=0;T<f.length;T++)S=S.concat(Dg({key:`${l}[${T}]`,value:f[T]}));return S}else return Dg({key:l,value:f})}function Qw(d){const l=d.key,f=d.value,S=kr(f),T=d.styleSpec;if(S!=="array"||f.length<1||f.length%2!==0)return[new st(l,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let b=0;b<f.length;b+=2)E=E.concat(Yd({key:`${l}[${b}]`,value:f[b],valueSpec:T.layout_symbol["text-anchor"]})),E=E.concat(sy({key:`${l}[${b+1}]`,value:f[b+1],valueSpec:{length:2,value:"number"},validateSpec:d.validateSpec,style:d.style,styleSpec:T}));return E}function cv(d){let l=[];const f=d.value,S=d.key;if(Array.isArray(f)){const T=[],E=[];for(const b in f){f[b].id&&T.includes(f[b].id)&&l.push(new st(S,f,`all the sprites' ids must be unique, but ${f[b].id} is duplicated`)),T.push(f[b].id),f[b].url&&E.includes(f[b].url)&&l.push(new st(S,f,`all the sprites' URLs must be unique, but ${f[b].url} is duplicated`)),E.push(f[b].url);const s={id:{type:"string",required:!0},url:{type:"string",required:!0}};l=l.concat(vs({key:`${S}[${b}]`,value:f[b],valueSpec:s,validateSpec:d.validateSpec}))}return l}else return Jh({key:S,value:f})}function e2(d){const l=d.value,f=d.styleSpec,S=f.projection,T=d.style,E=kr(l);if(l===void 0)return[];if(E!=="object")return[new st("projection",l,`object expected, ${E} found`)];let b=[];for(const s in l)S[s]?b=b.concat(d.validateSpec({key:s,value:l[s],valueSpec:S[s],style:T,styleSpec:f})):b=b.concat([new st(s,l[s],`unknown property "${s}"`)]);return b}function t2(d){const l=d.key;let f=d.value;f=f instanceof String?f.valueOf():f;const S=kr(f);return S==="array"&&!n2(f)&&!r2(f)?[new st(l,f,`projection expected, invalid array ${JSON.stringify(f)} found`)]:["array","string"].includes(S)?[]:[new st(l,f,`projection expected, invalid type "${S}" found`)]}function r2(d){return!!["interpolate","step","literal"].includes(d[0])}function n2(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"}function i2(d){return!!d&&d.constructor===Object}function hv(d){return i2(d.value)?[]:[new st(d.key,d.value,`object expected, ${kr(d.value)} found`)]}const B_={"*"(){return[]},array:sy,boolean:Gw,number:km,color:Dg,constants:Q0,enum:Yd,filter:ly,function:ev,layer:av,object:vs,source:ov,light:sv,sky:lv,terrain:uv,projection:e2,projectionDefinition:t2,string:Jh,formatted:Ww,resolvedImage:Xw,padding:Kw,numberArray:Yw,colorArray:Jw,variableAnchorOffsetCollection:Qw,sprite:cv,state:hv};function pm(d){const l=d.value,f=d.valueSpec,S=d.styleSpec;return d.validateSpec=pm,f.expression&&ay(qn(l))?ev(d):f.expression&&K0(Yh(l))?Op(d):f.type&&B_[f.type]?B_[f.type](d):vs(im({},d,{valueSpec:f.type?S[f.type]:f}))}function pv(d){const l=d.value,f=d.key,S=Jh(d);return S.length||(l.indexOf("{fontstack}")===-1&&S.push(new st(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&S.push(new st(f,l,'"glyphs" url must include a "{range}" token'))),S}function Go(d,l=zb){let f=[];return f=f.concat(pm({key:"",value:d,valueSpec:l.$root,styleSpec:l,style:d,validateSpec:pm,objectElementValidators:{glyphs:pv,"*"(){return[]}}})),d.constants&&(f=f.concat(Q0({key:"constants",value:d.constants}))),dv(f)}Go.source=nl(rl(ov));Go.sprite=nl(rl(cv));Go.glyphs=nl(rl(pv));Go.light=nl(rl(sv));Go.sky=nl(rl(lv));Go.terrain=nl(rl(uv));Go.state=nl(rl(hv));Go.layer=nl(rl(av));Go.filter=nl(rl(ly));Go.paintProperty=nl(rl(nv));Go.layoutProperty=nl(rl(iv));function rl(d){return function(l){return d({...l,validateSpec:pm})}}function dv(d){return[].concat(d).sort((l,f)=>l.line-f.line)}function nl(d){return function(...l){return dv(d.apply(this,l))}}function j_(d){if(!d)return{style:Np[Od[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof d=="string"){const l=o2(d);return l.isValidStyle?{style:l.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:l.isValidJSON?{style:Np[Od[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:d.startsWith("http")?{style:d,requiresUrlMonitoring:!0,isFallback:!1}:d.toLowerCase().includes(".json")?{style:a2(d),requiresUrlMonitoring:!0,isFallback:!1}:{style:h0(d),requiresUrlMonitoring:!0,isFallback:!1}}return d instanceof p0?{style:d.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:d instanceof d0?{style:d.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Go(d).length===0?{style:d,requiresUrlMonitoring:!1,isFallback:!1}:{style:Np[Od[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function a2(d){try{return new URL(d).href}catch{}return new URL(d,location.origin).href}function o2(d){try{const l=JSON.parse(d),f=Go(l);return{isValidJSON:!0,isValidStyle:f.length===0,styleObject:f.length===0?l:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Bu(d,l,f){const S=window.document.createElement(d);return l!==void 0&&(S.className=l),f&&f.appendChild(S),S}function Jd(d){d.parentNode&&d.parentNode.removeChild(d)}class s2{constructor(){xt(this,"_map"),xt(this,"_container"),xt(this,"_terrainButton"),A1(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(l){return this._map=l,this._container=Bu("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Bu("button","maplibregl-ctrl-terrain",this._container),Bu("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Jd(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){fv(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function fv(d){d.hasTerrain()?d.disableTerrain():d.enableTerrain()}class l2 extends E0{constructor(l={}){super({showCompass:l.showCompass??!0,showZoom:l.showZoom??!0,visualizePitch:l.visualizePitch??!0}),xt(this,"_rotateCompassArrow",()=>{const f=this._map.getBearing(),S=this._map.getPitch(),T=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(S*(Math.PI/180))**.5)}) rotateX(${Math.min(70,S)}deg) rotateZ(${-f}deg)`:`rotate(${-f}deg)`;this._compassIcon.style.transform=T}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",f=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:f}):this._map.resetNorth({},{originalEvent:f})}))}_createButton(l,f){const S=super._createButton(l,f);return S.clickFunction=f,S}}const O_=Dt.Marker,U_=Dt.LngLat,u2=Dt.LngLatBounds;class c2 extends V1{constructor(){super(...arguments),xt(this,"lastUpdatedCenter",new U_(0,0)),xt(this,"_updateCamera",l=>{var f;const S=new U_(l.coords.longitude,l.coords.latitude),T=l.coords.accuracy,E={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},b=this._map.getZoom();b>(((f=this.options.fitBoundsOptions)==null?void 0:f.maxZoom)??30)&&(E.zoom=b),this._map.fitBounds(u2.fromLngLat(S,T),E,{geolocateSource:!0});let s=!1;const N=()=>{s=!0};this._map.once("click",N),this._map.once("dblclick",N),this._map.once("dragstart",N),this._map.once("mousedown",N),this._map.once("touchstart",N),this._map.once("wheel",N),this._map.once("moveend",()=>{this._map.off("click",N),this._map.off("dblclick",N),this._map.off("dragstart",N),this._map.off("mousedown",N),this._map.off("touchstart",N),this._map.off("wheel",N),!s&&(this.lastUpdatedCenter=this._map.getCenter())})}),xt(this,"_finishSetupUI",l=>{if(this._map){if(l===!1){const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Bu("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new O_({element:this._dotElement}),this._circleElement=Bu("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new O_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",f=>{const S=f.originalEvent&&f.originalEvent.type==="resize",T=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!f.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!S&&T>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),xt(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const l=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],f=this._map.project(l),S=this._map.unproject([f.x,f.y]),T=this._map.unproject([f.x+20,f.y]),E=S.distanceTo(T)/20,b=Math.ceil(2*this._accuracy/E);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var Bh,jo,jh,Oh,Nd;class h2{constructor(l,f,S){if(no(this,Bh),no(this,jo),no(this,jh),no(this,Oh),no(this,Nd),typeof l=="string"){const T=document.querySelector(l);if(!T)throw new Error(`No element has been found with selector "${l}" when creating an external control.`);Vo(this,jo,T)}else Vo(this,jo,l);f&&Vo(this,jh,T=>{f(Nt(this,Bh),Nt(this,jo),T)}),S&&Vo(this,Oh,T=>{S(Nt(this,Bh),Nt(this,jo),T)}),Vo(this,Nd,Nt(this,jo).parentElement)}onAdd(l){return Vo(this,Bh,l),Nt(this,jh)&&Nt(this,jo).addEventListener("click",Nt(this,jh)),Nt(this,Oh)&&Nt(this,Bh).on("render",Nt(this,Oh)),Jd(Nt(this,jo)),Nt(this,jo)}onRemove(){Nt(this,jh)&&Nt(this,jo).removeEventListener("click",Nt(this,jh)),Nt(this,Oh)&&Nt(this,Bh).off("render",Nt(this,Oh)),Nt(this,Nd)?Nt(this,Nd).appendChild(Nt(this,jo)):Jd(Nt(this,jo))}}Bh=new WeakMap,jo=new WeakMap,jh=new WeakMap,Oh=new WeakMap,Nd=new WeakMap;class p2{constructor(){xt(this,"map"),xt(this,"container"),xt(this,"projectionButton")}onAdd(l){return this.map=l,this.container=Bu("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Bu("button","maplibregl-ctrl-projection",this.container),Bu("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),l.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){Jd(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){mv(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function mv(d){d.getProjection()===void 0&&d.setProjection({type:"mercator"}),d.isGlobeProjection()?d.enableMercatorProjection():d.enableGlobeProjection()}const Fd={"zoom-in":d=>d.zoomIn(),"zoom-out":d=>d.zoomOut(),"toggle-projection":mv,"toggle-terrain":fv,"reset-view":d=>{d.getPitch()===0?d.easeTo({pitch:Math.min(d.getMaxPitch(),80)}):d.resetNorthPitch()},"reset-bearing":d=>{d.rotateTo(0)},"reset-pitch":d=>{d.setPitch(0)},"reset-roll":d=>{d.setRoll(0)}};var em,Bd;class Ng extends h2{constructor(l,f){if(f&&!(f in Fd))throw new Error(`data-maptiler-control value "${f}" is invalid.`);super(l,f&&Fd[f]),no(this,em),no(this,Bd,new Map)}onAdd(l){return Vo(this,em,l),super.onAdd(l)}onRemove(){for(const[l,f]of Nt(this,Bd)){const S=l.deref();S&&S.removeEventListener("click",f)}Nt(this,Bd).clear(),super.onRemove()}configureGroupItem(l,f){if(!f)return;if(!(f in Fd))throw new Error(`data-maptiler-control value "${f}" is invalid.`);const S=T=>{Fd[f](Nt(this,em),l,T)};l.addEventListener("click",S),Nt(this,Bd).set(new WeakRef(l),S)}}em=new WeakMap,Bd=new WeakMap,xt(Ng,"controlCallbacks",Fd);var Uo,Ul,Uh,Vh,ys,tm,Ra,gv,_s,yv;class fg{constructor(l,f){no(this,Ra),no(this,Uo),xt(this,"map"),no(this,Ul),no(this,Uh),no(this,Vh),no(this,ys,!1),no(this,tm),l.style!==void 0&&Vo(this,ys,!0),Vo(this,Uo,{zoomAdjust:-4,position:"top-right",...f,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...l,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...l.containerStyle??{}}}),l.lockZoom!==void 0&&(Nt(this,Uo).minZoom=l.lockZoom,Nt(this,Uo).maxZoom=l.lockZoom)}setStyle(l,f){Nt(this,ys)||this.map.setStyle(l,f),Oo(this,Ra,_s).call(this)}addLayer(l,f){return Nt(this,ys)||this.map.addLayer(l,f),Oo(this,Ra,_s).call(this),this.map}moveLayer(l,f){return Nt(this,ys)||this.map.moveLayer(l,f),Oo(this,Ra,_s).call(this),this.map}removeLayer(l){return Nt(this,ys)||this.map.removeLayer(l),Oo(this,Ra,_s).call(this),this}setLayerZoomRange(l,f,S){return Nt(this,ys)||this.map.setLayerZoomRange(l,f,S),Oo(this,Ra,_s).call(this),this}setFilter(l,f,S){return Nt(this,ys)||this.map.setFilter(l,f,S),Oo(this,Ra,_s).call(this),this}setPaintProperty(l,f,S,T){return Nt(this,ys)||this.map.setPaintProperty(l,f,S,T),Oo(this,Ra,_s).call(this),this}setLayoutProperty(l,f,S,T){return Nt(this,ys)||this.map.setLayoutProperty(l,f,S,T),Oo(this,Ra,_s).call(this),this}setGlyphs(l,f){return Nt(this,ys)||this.map.setGlyphs(l,f),Oo(this,Ra,_s).call(this),this}onAdd(l){Vo(this,Ul,l),Vo(this,Uh,Bu("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[f,S]of Object.entries(Nt(this,Uo).containerStyle))Nt(this,Uh).style.setProperty(f,S);return Nt(this,Uo).container=Nt(this,Uh),Nt(this,Uo).zoom=l.getZoom()+Nt(this,Uo).zoomAdjust,this.map=new bv(Nt(this,Uo)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Oo(this,Ra,gv).call(this,Nt(this,Uo).parentRect),Vo(this,tm,Oo(this,Ra,yv).call(this))}),Nt(this,Uh)}onRemove(){var l;(l=Nt(this,tm))==null||l.call(this),Jd(Nt(this,Uh))}}Uo=new WeakMap,Ul=new WeakMap,Uh=new WeakMap,Vh=new WeakMap,ys=new WeakMap,tm=new WeakMap,Ra=new WeakSet,gv=function(d){d===void 0||d.linePaint===void 0&&d.fillPaint===void 0||(Vo(this,Vh,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Nt(this,Vh)}),(d.lineLayout!==void 0||d.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...d.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...d.linePaint}}),d.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...d.fillPaint}}),Oo(this,Ra,_s).call(this))},_s=function(){if(Nt(this,Vh)===void 0)return;const{devicePixelRatio:d}=window,l=Nt(this,Ul).getCanvas(),f=l.width/d,S=l.height/d,T=Nt(this,Ul).unproject.bind(Nt(this,Ul)),E=T([0,0]),b=T([f,0]),s=T([0,S]),N=T([f,S]);Nt(this,Vh).geometry.coordinates=[[s.toArray(),N.toArray(),b.toArray(),E.toArray(),s.toArray()]];const V=this.map.getSource("parentRect");V!==void 0&&V.setData(Nt(this,Vh))},yv=function(){const{pitchAdjust:d}=Nt(this,Uo),l=()=>{E("parent")},f=()=>{E("minimap")},S=()=>{Nt(this,Ul).on("move",l),this.map.on("move",f)},T=()=>{Nt(this,Ul).off("move",l),this.map.off("move",f)},E=b=>{T();const s=b==="parent"?Nt(this,Ul):this.map,N=b==="parent"?this.map:Nt(this,Ul),V=s.getCenter(),K=s.getZoom()+Nt(this,Uo).zoomAdjust*(b==="parent"?1:-1),oe=s.getBearing(),le=s.getPitch();N.jumpTo({center:V,zoom:K,bearing:oe,pitch:d?le:0}),Oo(this,Ra,_s).call(this),S()};return S(),()=>{T()}};class d2{constructor(l,f=2e3){xt(this,"map"),xt(this,"registeredModules",new Set),xt(this,"viewerType"),this.map=l,this.viewerType="Map",setTimeout(async()=>{if(!ui.telemetry)return;const S=this.preparePayload();try{(await fetch(S,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(T){console.warn("The metrics could not be sent to MapTiler Cloud",T)}},Math.max(1e3,f))}registerModule(l,f){this.registeredModules.add(`${l}:${f}`)}registerViewerType(l="Map"){this.viewerType=l}preparePayload(){const l=new URL(Da.telemetryURL);return l.searchParams.append("sdk",eS()),l.searchParams.append("key",ui.apiKey),l.searchParams.append("mtsid",Ug),l.searchParams.append("session",ui.session?"1":"0"),l.searchParams.append("caching",ui.caching?"1":"0"),l.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),l.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),l.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),l.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&l.searchParams.append("modules",Array.from(this.registeredModules).join("|")),l.href}}var Qd=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var d=0,l=arguments.length;l--;)d+=arguments[l]*arguments[l];return Math.sqrt(d)});function $d(){var d=new Qd(16);return Qd!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d}function f2(d,l,f,S,T,E,b,s,N,V,K,oe,le,Y,Be,Ne,Ze){return d[0]=l,d[1]=f,d[2]=S,d[3]=T,d[4]=E,d[5]=b,d[6]=s,d[7]=N,d[8]=V,d[9]=K,d[10]=oe,d[11]=le,d[12]=Y,d[13]=Be,d[14]=Ne,d[15]=Ze,d}function m2(d,l,f){var S=l[0],T=l[1],E=l[2],b=l[3],s=l[4],N=l[5],V=l[6],K=l[7],oe=l[8],le=l[9],Y=l[10],Be=l[11],Ne=l[12],Ze=l[13],He=l[14],Ge=l[15],nt=f[0],Le=f[1],Re=f[2],Ue=f[3];return d[0]=nt*S+Le*s+Re*oe+Ue*Ne,d[1]=nt*T+Le*N+Re*le+Ue*Ze,d[2]=nt*E+Le*V+Re*Y+Ue*He,d[3]=nt*b+Le*K+Re*Be+Ue*Ge,nt=f[4],Le=f[5],Re=f[6],Ue=f[7],d[4]=nt*S+Le*s+Re*oe+Ue*Ne,d[5]=nt*T+Le*N+Re*le+Ue*Ze,d[6]=nt*E+Le*V+Re*Y+Ue*He,d[7]=nt*b+Le*K+Re*Be+Ue*Ge,nt=f[8],Le=f[9],Re=f[10],Ue=f[11],d[8]=nt*S+Le*s+Re*oe+Ue*Ne,d[9]=nt*T+Le*N+Re*le+Ue*Ze,d[10]=nt*E+Le*V+Re*Y+Ue*He,d[11]=nt*b+Le*K+Re*Be+Ue*Ge,nt=f[12],Le=f[13],Re=f[14],Ue=f[15],d[12]=nt*S+Le*s+Re*oe+Ue*Ne,d[13]=nt*T+Le*N+Re*le+Ue*Ze,d[14]=nt*E+Le*V+Re*Y+Ue*He,d[15]=nt*b+Le*K+Re*Be+Ue*Ge,d}function g2(d,l,f){var S=f[0],T=f[1],E=f[2];return d[0]=l[0]*S,d[1]=l[1]*S,d[2]=l[2]*S,d[3]=l[3]*S,d[4]=l[4]*T,d[5]=l[5]*T,d[6]=l[6]*T,d[7]=l[7]*T,d[8]=l[8]*E,d[9]=l[9]*E,d[10]=l[10]*E,d[11]=l[11]*E,d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15],d}function V_(d,l,f){var S=Math.sin(f),T=Math.cos(f),E=l[4],b=l[5],s=l[6],N=l[7],V=l[8],K=l[9],oe=l[10],le=l[11];return l!==d&&(d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[4]=E*T+V*S,d[5]=b*T+K*S,d[6]=s*T+oe*S,d[7]=N*T+le*S,d[8]=V*T-E*S,d[9]=K*T-b*S,d[10]=oe*T-s*S,d[11]=le*T-N*S,d}function y2(d,l,f){var S=Math.sin(f),T=Math.cos(f),E=l[0],b=l[1],s=l[2],N=l[3],V=l[8],K=l[9],oe=l[10],le=l[11];return l!==d&&(d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[0]=E*T-V*S,d[1]=b*T-K*S,d[2]=s*T-oe*S,d[3]=N*T-le*S,d[8]=E*S+V*T,d[9]=b*S+K*T,d[10]=s*S+oe*T,d[11]=N*S+le*T,d}function $_(d,l,f){var S=Math.sin(f),T=Math.cos(f),E=l[0],b=l[1],s=l[2],N=l[3],V=l[4],K=l[5],oe=l[6],le=l[7];return l!==d&&(d[8]=l[8],d[9]=l[9],d[10]=l[10],d[11]=l[11],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[0]=E*T+V*S,d[1]=b*T+K*S,d[2]=s*T+oe*S,d[3]=N*T+le*S,d[4]=V*T-E*S,d[5]=K*T-b*S,d[6]=oe*T-s*S,d[7]=le*T-N*S,d}function _2(d,l,f,S,T){var E=1/Math.tan(l/2),b;return d[0]=E/f,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=E,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,T!=null&&T!==1/0?(b=1/(S-T),d[10]=(T+S)*b,d[14]=2*T*S*b):(d[10]=-1,d[14]=-2*S),d}var v2=_2;function rm(){var d=new Qd(3);return Qd!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d}function x2(d,l,f){var S=new Qd(3);return S[0]=d,S[1]=l,S[2]=f,S}function mg(d,l){var f=l[0],S=l[1],T=l[2],E=f*f+S*S+T*T;return E>0&&(E=1/Math.sqrt(E)),d[0]=l[0]*E,d[1]=l[1]*E,d[2]=l[2]*E,d}function q_(d,l,f){var S=l[0],T=l[1],E=l[2],b=f[0],s=f[1],N=f[2];return d[0]=T*N-E*s,d[1]=E*b-S*N,d[2]=S*s-T*b,d}(function(){var d=rm();return function(l,f,S,T,E,b){var s,N;for(f||(f=3),S||(S=0),T?N=Math.min(T*f+S,l.length):N=l.length,s=S;s<N;s+=f)d[0]=l[s],d[1]=l[s+1],d[2]=l[s+2],E(d,d,b),l[s]=d[0],l[s+1]=d[1],l[s+2]=d[2];return l}})();function b2(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var G_,Z_;function w2(){return Z_||(Z_=1,G_={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),G_}var gg,H_;function _v(){if(H_)return gg;H_=1;const d=w2(),l={};for(const T of Object.keys(d))l[d[T]]=T;const f={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};gg=f;for(const T of Object.keys(f)){if(!("channels"in f[T]))throw new Error("missing channels property: "+T);if(!("labels"in f[T]))throw new Error("missing channel labels property: "+T);if(f[T].labels.length!==f[T].channels)throw new Error("channel and label counts mismatch: "+T);const{channels:E,labels:b}=f[T];delete f[T].channels,delete f[T].labels,Object.defineProperty(f[T],"channels",{value:E}),Object.defineProperty(f[T],"labels",{value:b})}f.rgb.hsl=function(T){const E=T[0]/255,b=T[1]/255,s=T[2]/255,N=Math.min(E,b,s),V=Math.max(E,b,s),K=V-N;let oe,le;V===N?oe=0:E===V?oe=(b-s)/K:b===V?oe=2+(s-E)/K:s===V&&(oe=4+(E-b)/K),oe=Math.min(oe*60,360),oe<0&&(oe+=360);const Y=(N+V)/2;return V===N?le=0:Y<=.5?le=K/(V+N):le=K/(2-V-N),[oe,le*100,Y*100]},f.rgb.hsv=function(T){let E,b,s,N,V;const K=T[0]/255,oe=T[1]/255,le=T[2]/255,Y=Math.max(K,oe,le),Be=Y-Math.min(K,oe,le),Ne=function(Ze){return(Y-Ze)/6/Be+1/2};return Be===0?(N=0,V=0):(V=Be/Y,E=Ne(K),b=Ne(oe),s=Ne(le),K===Y?N=s-b:oe===Y?N=1/3+E-s:le===Y&&(N=2/3+b-E),N<0?N+=1:N>1&&(N-=1)),[N*360,V*100,Y*100]},f.rgb.hwb=function(T){const E=T[0],b=T[1];let s=T[2];const N=f.rgb.hsl(T)[0],V=1/255*Math.min(E,Math.min(b,s));return s=1-1/255*Math.max(E,Math.max(b,s)),[N,V*100,s*100]},f.rgb.cmyk=function(T){const E=T[0]/255,b=T[1]/255,s=T[2]/255,N=Math.min(1-E,1-b,1-s),V=(1-E-N)/(1-N)||0,K=(1-b-N)/(1-N)||0,oe=(1-s-N)/(1-N)||0;return[V*100,K*100,oe*100,N*100]};function S(T,E){return(T[0]-E[0])**2+(T[1]-E[1])**2+(T[2]-E[2])**2}return f.rgb.keyword=function(T){const E=l[T];if(E)return E;let b=1/0,s;for(const N of Object.keys(d)){const V=d[N],K=S(T,V);K<b&&(b=K,s=N)}return s},f.keyword.rgb=function(T){return d[T]},f.rgb.xyz=function(T){let E=T[0]/255,b=T[1]/255,s=T[2]/255;E=E>.04045?((E+.055)/1.055)**2.4:E/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,s=s>.04045?((s+.055)/1.055)**2.4:s/12.92;const N=E*.4124+b*.3576+s*.1805,V=E*.2126+b*.7152+s*.0722,K=E*.0193+b*.1192+s*.9505;return[N*100,V*100,K*100]},f.rgb.lab=function(T){const E=f.rgb.xyz(T);let b=E[0],s=E[1],N=E[2];b/=95.047,s/=100,N/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,s=s>.008856?s**(1/3):7.787*s+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;const V=116*s-16,K=500*(b-s),oe=200*(s-N);return[V,K,oe]},f.hsl.rgb=function(T){const E=T[0]/360,b=T[1]/100,s=T[2]/100;let N,V,K;if(b===0)return K=s*255,[K,K,K];s<.5?N=s*(1+b):N=s+b-s*b;const oe=2*s-N,le=[0,0,0];for(let Y=0;Y<3;Y++)V=E+1/3*-(Y-1),V<0&&V++,V>1&&V--,6*V<1?K=oe+(N-oe)*6*V:2*V<1?K=N:3*V<2?K=oe+(N-oe)*(2/3-V)*6:K=oe,le[Y]=K*255;return le},f.hsl.hsv=function(T){const E=T[0];let b=T[1]/100,s=T[2]/100,N=b;const V=Math.max(s,.01);s*=2,b*=s<=1?s:2-s,N*=V<=1?V:2-V;const K=(s+b)/2,oe=s===0?2*N/(V+N):2*b/(s+b);return[E,oe*100,K*100]},f.hsv.rgb=function(T){const E=T[0]/60,b=T[1]/100;let s=T[2]/100;const N=Math.floor(E)%6,V=E-Math.floor(E),K=255*s*(1-b),oe=255*s*(1-b*V),le=255*s*(1-b*(1-V));switch(s*=255,N){case 0:return[s,le,K];case 1:return[oe,s,K];case 2:return[K,s,le];case 3:return[K,oe,s];case 4:return[le,K,s];case 5:return[s,K,oe]}},f.hsv.hsl=function(T){const E=T[0],b=T[1]/100,s=T[2]/100,N=Math.max(s,.01);let V,K;K=(2-b)*s;const oe=(2-b)*N;return V=b*N,V/=oe<=1?oe:2-oe,V=V||0,K/=2,[E,V*100,K*100]},f.hwb.rgb=function(T){const E=T[0]/360;let b=T[1]/100,s=T[2]/100;const N=b+s;let V;N>1&&(b/=N,s/=N);const K=Math.floor(6*E),oe=1-s;V=6*E-K,K&1&&(V=1-V);const le=b+V*(oe-b);let Y,Be,Ne;switch(K){default:case 6:case 0:Y=oe,Be=le,Ne=b;break;case 1:Y=le,Be=oe,Ne=b;break;case 2:Y=b,Be=oe,Ne=le;break;case 3:Y=b,Be=le,Ne=oe;break;case 4:Y=le,Be=b,Ne=oe;break;case 5:Y=oe,Be=b,Ne=le;break}return[Y*255,Be*255,Ne*255]},f.cmyk.rgb=function(T){const E=T[0]/100,b=T[1]/100,s=T[2]/100,N=T[3]/100,V=1-Math.min(1,E*(1-N)+N),K=1-Math.min(1,b*(1-N)+N),oe=1-Math.min(1,s*(1-N)+N);return[V*255,K*255,oe*255]},f.xyz.rgb=function(T){const E=T[0]/100,b=T[1]/100,s=T[2]/100;let N,V,K;return N=E*3.2406+b*-1.5372+s*-.4986,V=E*-.9689+b*1.8758+s*.0415,K=E*.0557+b*-.204+s*1.057,N=N>.0031308?1.055*N**(1/2.4)-.055:N*12.92,V=V>.0031308?1.055*V**(1/2.4)-.055:V*12.92,K=K>.0031308?1.055*K**(1/2.4)-.055:K*12.92,N=Math.min(Math.max(0,N),1),V=Math.min(Math.max(0,V),1),K=Math.min(Math.max(0,K),1),[N*255,V*255,K*255]},f.xyz.lab=function(T){let E=T[0],b=T[1],s=T[2];E/=95.047,b/=100,s/=108.883,E=E>.008856?E**(1/3):7.787*E+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,s=s>.008856?s**(1/3):7.787*s+16/116;const N=116*b-16,V=500*(E-b),K=200*(b-s);return[N,V,K]},f.lab.xyz=function(T){const E=T[0],b=T[1],s=T[2];let N,V,K;V=(E+16)/116,N=b/500+V,K=V-s/200;const oe=V**3,le=N**3,Y=K**3;return V=oe>.008856?oe:(V-16/116)/7.787,N=le>.008856?le:(N-16/116)/7.787,K=Y>.008856?Y:(K-16/116)/7.787,N*=95.047,V*=100,K*=108.883,[N,V,K]},f.lab.lch=function(T){const E=T[0],b=T[1],s=T[2];let N;N=Math.atan2(s,b)*360/2/Math.PI,N<0&&(N+=360);const V=Math.sqrt(b*b+s*s);return[E,V,N]},f.lch.lab=function(T){const E=T[0],b=T[1],s=T[2]/360*2*Math.PI,N=b*Math.cos(s),V=b*Math.sin(s);return[E,N,V]},f.rgb.ansi16=function(T,E=null){const[b,s,N]=T;let V=E===null?f.rgb.hsv(T)[2]:E;if(V=Math.round(V/50),V===0)return 30;let K=30+(Math.round(N/255)<<2|Math.round(s/255)<<1|Math.round(b/255));return V===2&&(K+=60),K},f.hsv.ansi16=function(T){return f.rgb.ansi16(f.hsv.rgb(T),T[2])},f.rgb.ansi256=function(T){const E=T[0],b=T[1],s=T[2];return E===b&&b===s?E<8?16:E>248?231:Math.round((E-8)/247*24)+232:16+36*Math.round(E/255*5)+6*Math.round(b/255*5)+Math.round(s/255*5)},f.ansi16.rgb=function(T){let E=T%10;if(E===0||E===7)return T>50&&(E+=3.5),E=E/10.5*255,[E,E,E];const b=(~~(T>50)+1)*.5,s=(E&1)*b*255,N=(E>>1&1)*b*255,V=(E>>2&1)*b*255;return[s,N,V]},f.ansi256.rgb=function(T){if(T>=232){const V=(T-232)*10+8;return[V,V,V]}T-=16;let E;const b=Math.floor(T/36)/5*255,s=Math.floor((E=T%36)/6)/5*255,N=E%6/5*255;return[b,s,N]},f.rgb.hex=function(T){const E=(((Math.round(T[0])&255)<<16)+((Math.round(T[1])&255)<<8)+(Math.round(T[2])&255)).toString(16).toUpperCase();return"000000".substring(E.length)+E},f.hex.rgb=function(T){const E=T.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!E)return[0,0,0];let b=E[0];E[0].length===3&&(b=b.split("").map(oe=>oe+oe).join(""));const s=parseInt(b,16),N=s>>16&255,V=s>>8&255,K=s&255;return[N,V,K]},f.rgb.hcg=function(T){const E=T[0]/255,b=T[1]/255,s=T[2]/255,N=Math.max(Math.max(E,b),s),V=Math.min(Math.min(E,b),s),K=N-V;let oe,le;return K<1?oe=V/(1-K):oe=0,K<=0?le=0:N===E?le=(b-s)/K%6:N===b?le=2+(s-E)/K:le=4+(E-b)/K,le/=6,le%=1,[le*360,K*100,oe*100]},f.hsl.hcg=function(T){const E=T[1]/100,b=T[2]/100,s=b<.5?2*E*b:2*E*(1-b);let N=0;return s<1&&(N=(b-.5*s)/(1-s)),[T[0],s*100,N*100]},f.hsv.hcg=function(T){const E=T[1]/100,b=T[2]/100,s=E*b;let N=0;return s<1&&(N=(b-s)/(1-s)),[T[0],s*100,N*100]},f.hcg.rgb=function(T){const E=T[0]/360,b=T[1]/100,s=T[2]/100;if(b===0)return[s*255,s*255,s*255];const N=[0,0,0],V=E%1*6,K=V%1,oe=1-K;let le=0;switch(Math.floor(V)){case 0:N[0]=1,N[1]=K,N[2]=0;break;case 1:N[0]=oe,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=K;break;case 3:N[0]=0,N[1]=oe,N[2]=1;break;case 4:N[0]=K,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=oe}return le=(1-b)*s,[(b*N[0]+le)*255,(b*N[1]+le)*255,(b*N[2]+le)*255]},f.hcg.hsv=function(T){const E=T[1]/100,b=T[2]/100,s=E+b*(1-E);let N=0;return s>0&&(N=E/s),[T[0],N*100,s*100]},f.hcg.hsl=function(T){const E=T[1]/100,b=T[2]/100*(1-E)+.5*E;let s=0;return b>0&&b<.5?s=E/(2*b):b>=.5&&b<1&&(s=E/(2*(1-b))),[T[0],s*100,b*100]},f.hcg.hwb=function(T){const E=T[1]/100,b=T[2]/100,s=E+b*(1-E);return[T[0],(s-E)*100,(1-s)*100]},f.hwb.hcg=function(T){const E=T[1]/100,b=1-T[2]/100,s=b-E;let N=0;return s<1&&(N=(b-s)/(1-s)),[T[0],s*100,N*100]},f.apple.rgb=function(T){return[T[0]/65535*255,T[1]/65535*255,T[2]/65535*255]},f.rgb.apple=function(T){return[T[0]/255*65535,T[1]/255*65535,T[2]/255*65535]},f.gray.rgb=function(T){return[T[0]/100*255,T[0]/100*255,T[0]/100*255]},f.gray.hsl=function(T){return[0,0,T[0]]},f.gray.hsv=f.gray.hsl,f.gray.hwb=function(T){return[0,100,T[0]]},f.gray.cmyk=function(T){return[0,0,0,T[0]]},f.gray.lab=function(T){return[T[0],0,0]},f.gray.hex=function(T){const E=Math.round(T[0]/100*255)&255,b=((E<<16)+(E<<8)+E).toString(16).toUpperCase();return"000000".substring(b.length)+b},f.rgb.gray=function(T){return[(T[0]+T[1]+T[2])/3/255*100]},gg}var yg,W_;function S2(){if(W_)return yg;W_=1;const d=_v();function l(){const E={},b=Object.keys(d);for(let s=b.length,N=0;N<s;N++)E[b[N]]={distance:-1,parent:null};return E}function f(E){const b=l(),s=[E];for(b[E].distance=0;s.length;){const N=s.pop(),V=Object.keys(d[N]);for(let K=V.length,oe=0;oe<K;oe++){const le=V[oe],Y=b[le];Y.distance===-1&&(Y.distance=b[N].distance+1,Y.parent=N,s.unshift(le))}}return b}function S(E,b){return function(s){return b(E(s))}}function T(E,b){const s=[b[E].parent,E];let N=d[b[E].parent][E],V=b[E].parent;for(;b[V].parent;)s.unshift(b[V].parent),N=S(d[b[V].parent][V],N),V=b[V].parent;return N.conversion=s,N}return yg=function(E){const b=f(E),s={},N=Object.keys(b);for(let V=N.length,K=0;K<V;K++){const oe=N[K];b[oe].parent!==null&&(s[oe]=T(oe,b))}return s},yg}var _g,X_;function T2(){if(X_)return _g;X_=1;const d=_v(),l=S2(),f={},S=Object.keys(d);function T(b){const s=function(...N){const V=N[0];return V==null?V:(V.length>1&&(N=V),b(N))};return"conversion"in b&&(s.conversion=b.conversion),s}function E(b){const s=function(...N){const V=N[0];if(V==null)return V;V.length>1&&(N=V);const K=b(N);if(typeof K=="object")for(let oe=K.length,le=0;le<oe;le++)K[le]=Math.round(K[le]);return K};return"conversion"in b&&(s.conversion=b.conversion),s}return S.forEach(b=>{f[b]={},Object.defineProperty(f[b],"channels",{value:d[b].channels}),Object.defineProperty(f[b],"labels",{value:d[b].labels});const s=l(b);Object.keys(s).forEach(N=>{const V=s[N];f[b][N]=E(V),f[b][N].raw=T(V)})}),_g=f,_g}var C2=T2();const P2=b2(C2);function K_({gl:d,type:l,source:f}){const S=d.createShader(l);if(S===null)throw new Error("Cannot create shader");if(d.shaderSource(S,f),d.compileShader(S),!d.getShaderParameter(S,d.COMPILE_STATUS))throw console.error("Shader compilation error:",d.getShaderInfoLog(S)),d.deleteShader(S),new Error("Cannot compile shader");return S}function M2({gl:d,vertexShaderSource:l,fragmentShaderSource:f}){const S=K_({gl:d,type:d.VERTEX_SHADER,source:l}),T=K_({gl:d,type:d.FRAGMENT_SHADER,source:f}),E=d.createProgram();if(d.attachShader(E,S),d.attachShader(E,T),d.linkProgram(E),!d.getProgramParameter(E,d.LINK_STATUS))throw console.error("Error: ",d.getProgramInfoLog(E)),new Error("Cannot link shader program");return E}function k2(d,l,f){const S=d.getUniformLocation(l,f);if(S===null)throw new Error(`Cannot get uniform location for ${f}`);return S}function vv({gl:d,vertexShaderSource:l,fragmentShaderSource:f,attributesKeys:S,uniformsKeys:T,vertices:E,indices:b}){const s=M2({gl:d,vertexShaderSource:l,fragmentShaderSource:f}),N=S.reduce((Y,Be)=>(Y[Be]=d.getAttribLocation(s,`a_${Be}`),Y),{}),V=T.reduce((Y,Be)=>(Y[Be]=k2(d,s,`u_${Be}`),Y),{}),K=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,K),d.bufferData(d.ARRAY_BUFFER,new Float32Array(E),d.STATIC_DRAW);let oe,le;return b!==void 0&&(oe=d.createBuffer(),le=b.length,d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,oe),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),d.STATIC_DRAW)),{shaderProgram:s,programInfo:{attributesLocations:N,uniformsLocations:V},positionBuffer:K,indexBuffer:oe,indexBufferLength:le}}function nm(d){if(!d)return[1,1,1,0];if(d==="transparent")return[1,1,1,0];try{const l=E2(d),f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(l);if(f!=null&&f.length){const T=!!f[4];return[...P2.hex.rgb(l).map(E=>E/255),T?parseInt(f[4],16)/255:1]}const S=l.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(l.includes("rgb")){const T=l.includes("rgba"),E=[...S.map(b=>parseFloat(b)).map((b,s)=>s<3?b/255:b)];return T||E.push(1),E}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${d} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let Rd;function E2(d){return Rd=Rd??document.createElement("canvas").getContext("2d"),Rd?(Rd.fillStyle=d,Rd.fillStyle):"#000000"}const uy=1,xs=uy/2,bs=uy/2,ws=uy/2,I2=[-.5,-.5,ws,xs,-.5,ws,xs,bs,ws,-.5,bs,ws],A2=[-.5,-.5,-.5,-.5,bs,-.5,xs,bs,-.5,xs,-.5,-.5],z2=[-.5,bs,-.5,-.5,bs,ws,xs,bs,ws,xs,bs,-.5],L2=[-.5,-.5,-.5,xs,-.5,-.5,xs,-.5,ws,-.5,-.5,ws],R2=[xs,-.5,-.5,xs,bs,-.5,xs,bs,ws,xs,-.5,ws],D2=[-.5,-.5,-.5,-.5,-.5,ws,-.5,bs,ws,-.5,bs,-.5],N2=[...I2,...A2,...z2,...L2,...R2,...D2],F2=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],B2=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,Y_=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Kh={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var $h=(d=>(d.POSITIVE_X="pX",d.NEGATIVE_X="nX",d.POSITIVE_Y="pY",d.NEGATIVE_Y="nY",d.POSITIVE_Z="pZ",d.NEGATIVE_Z="nZ",d))($h||{});let Wf,J_,Q_;function j2({gl:d,faces:l,onReady:f,forceRefresh:S}){Wf&&!S&&Q_===JSON.stringify(l)&&f(Wf,J_),Q_=JSON.stringify(l);const T=Wf??d.createTexture();if(d.bindTexture(d.TEXTURE_CUBE_MAP,T),!l){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const E=Object.keys(l).length;if(E!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${E}`);return}const b=Object.entries(l).map(([s,N])=>new Promise((V,K)=>{const oe=s;if(N===void 0){K(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${s} is undefined`));return}const le=new Image;le.crossOrigin="anonymous";const Y=()=>{V({image:le,key:oe})};le.src=N,le.complete&&le.naturalWidth>0?Y():le.onload=Y,le.onerror=()=>{K(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${N}`))}}));Promise.all(b).then(s=>{for(let V=0;V<s.length;V++){const K=d.RGBA,oe=d.RGBA,le=d.UNSIGNED_BYTE,{image:Y,key:Be}=s[V]??{};if(!Y||!Be){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const Ne=O2(d,Be);d.bindTexture(d.TEXTURE_CUBE_MAP,T),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texImage2D(Ne,0,K,oe,le,Y)}d.bindTexture(d.TEXTURE_CUBE_MAP,T),d.generateMipmap(d.TEXTURE_CUBE_MAP),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);const N=s.map(V=>V.image);f(T,N),J_=N,Wf=T}).catch(s=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",s)})}function O2(d,l){if(l===$h.POSITIVE_X)return d.TEXTURE_CUBE_MAP_POSITIVE_X;if(l===$h.NEGATIVE_X)return d.TEXTURE_CUBE_MAP_NEGATIVE_X;if(l===$h.POSITIVE_Y)return d.TEXTURE_CUBE_MAP_POSITIVE_Y;if(l===$h.NEGATIVE_Y)return d.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(l===$h.POSITIVE_Z)return d.TEXTURE_CUBE_MAP_POSITIVE_Z;if(l===$h.NEGATIVE_Z)return d.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${l}`)}function U2(d,l,f){return[kc(d[0],l[0],f),kc(d[1],l[1],f),kc(d[2],l[2],f),kc(d[3],l[3],f)]}function kc(d,l,f){return d+(l-d)*f}const zp="https://api.maptiler.com/resources/space",V2=["vertexPosition"],$2=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],e0="%USE_TEXTURE_MACRO_MARKER%",q2="#define USE_TEXTURE",t0=Kh.stars;function G2(d,l){if(!xv(d))return{color:"transparent"};if(d===!0)return l;const f={...d};if(d.faces||d.path)return delete f.preset,f;const S=d.preset;if(S!==void 0&&!(S in Kh))throw new Error(`[CubemapLayer]: Invalid preset "${S}". Available presets: ${Object.keys(Kh).join(", ")}`);return{...f,color:f.color??Kh[S].color??"hsl(233,100%,92%)"}}class vg{constructor(l){xt(this,"id","Cubemap Layer"),xt(this,"type","custom"),xt(this,"renderingMode","3d"),xt(this,"map"),xt(this,"faces"),xt(this,"useCubemapTexture",!0),xt(this,"currentFadeOpacity",0),xt(this,"cubeMapNeedsUpdate",!1),xt(this,"bgColor"),xt(this,"previousBgColor",[0,0,0,0]),xt(this,"targetBgColor",[0,0,0,0]),xt(this,"transitionDelta",0),xt(this,"gl"),xt(this,"cubemap"),xt(this,"texture"),xt(this,"currentFacesDefinitionKey",""),xt(this,"options"),xt(this,"animationActive",!0),xt(this,"imageIsAnimating",!1),xt(this,"imageFadeInDelta",0);const f=G2(l,t0);this.options=f,this.currentFacesDefinitionKey=JSON.stringify(f.faces??f.preset??f.path),this.bgColor=[0,0,0,0],this.targetBgColor=nm(f.color),this.faces=r0(f),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:l}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const f=$2.filter(S=>S==="cubeSampler"||S==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=vv({gl:this.gl,vertexShaderSource:B2,fragmentShaderSource:this.useCubemapTexture?Y_.replace(e0,q2):Y_.replace(e0,""),attributesKeys:V2,uniformsKeys:f,vertices:N2,indices:F2}),this.cubeMapNeedsUpdate=l,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(l,f){this.map=l,this.gl=f,this.updateCubemap()}onRemove(l,f){this.cubemap&&(f.deleteProgram(this.cubemap.shaderProgram),f.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(l,f){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;j2({gl:l,faces:f,onReady:S=>{this.texture=S,this.animateIn()}})}}prerender(l,f){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const l=()=>{this.transitionDelta<1&&(requestAnimationFrame(l),this.bgColor=U2(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(l)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(l=>{this.imageIsAnimating=!0;const f=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=kc(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(f);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,l()};requestAnimationFrame(f)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(l=>{const f=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=kc(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,l();return}requestAnimationFrame(f)};requestAnimationFrame(f)})}setAnimationActive(l){this.animationActive=l}render(l,f){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,l.disable(l.DEPTH_TEST),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.DST_ALPHA),l.useProgram(this.cubemap.shaderProgram),l.bindBuffer(l.ARRAY_BUFFER,this.cubemap.positionBuffer),l.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,l.FLOAT,!1,0,0),l.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const S=.1,T=1e4,E=l.canvas,b=E.clientWidth/E.clientHeight,s=this.map.transform,N=s.fov*(Math.PI/180),V=$d();v2(V,N,b,S,T),$_(V,V,s.rollInRadians),V_(V,V,-s.pitchInRadians),$_(V,V,s.bearingInRadians);const K=s.center.lat*Math.PI/180,oe=s.center.lng*Math.PI/180;V_(V,V,K),y2(V,V,-oe),l.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,V);const le=$d();if(l.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,le),l.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),l.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_CUBE_MAP,this.texture),l.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),l.drawElements(l.TRIANGLES,this.cubemap.indexBufferLength,l.UNSIGNED_SHORT,0)}setBgColor(l){this.targetBgColor=l,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(l){if(await this.animateOut(),!l.faces&&!l.preset&&!l.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=r0(l),this.currentFacesDefinitionKey=JSON.stringify(l.faces??l.preset??l.path)}async setCubemap(l){const f=typeof l=="boolean"?t0:l;this.options=f;const S=JSON.stringify(f.faces??f.preset??f.path),T=this.currentFacesDefinitionKey!==S;T&&(await this.setCubemapFaces(f),this.cubeMapNeedsUpdate=!0);const E=nm(f.color);if(f.color&&this.targetBgColor.toString()!==E.toString())this.setBgColor(E);else if(!f.color&&f.preset&&f.preset in Kh){const b=Kh[f.preset];this.setBgColor(nm(b.color))}this.updateCubemap({facesNeedUpdate:T})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function xv(d){return d?typeof d=="boolean"?!0:!(!d.path&&!d.preset&&!d.faces&&!d.color||d.preset&&!(d.preset in Kh)||d.faces&&(!d.faces.pX||!d.faces.nX||!d.faces.pY||!d.faces.nY||!d.faces.pZ||!d.faces.nZ)):!1}function r0(d){if(d.faces)return d.faces;if(d.preset)return{pX:`${zp}/${d.preset}/px.webp`,nX:`${zp}/${d.preset}/nx.webp`,pY:`${zp}/${d.preset}/py.webp`,nY:`${zp}/${d.preset}/ny.webp`,pZ:`${zp}/${d.preset}/pz.webp`,nZ:`${zp}/${d.preset}/nz.webp`};if(d.path){const l=d.path.baseUrl,f=d.path.format??"png";return{pX:`${l}/px.${f}`,nX:`${l}/nx.${f}`,pY:`${l}/py.${f}`,nY:`${l}/ny.${f}`,pZ:`${l}/pz.${f}`,nZ:`${l}/nz.${f}`}}return null}const Z2=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,H2=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,jd=2,W2=["position"],X2=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],K2=[-2,-2,0,jd,-2,0,-2,jd,0,jd,jd,0],Fh={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},n0=.06;class xg{constructor(l){if(xt(this,"id","Halo Layer"),xt(this,"type","custom"),xt(this,"renderingMode","3d"),xt(this,"gradient"),xt(this,"scale",0),xt(this,"animationDelta",0),xt(this,"map"),xt(this,"plane"),xt(this,"animationActive",!0),typeof l=="boolean"){this.gradient=Fh;return}this.gradient={...Fh,...l}}onAdd(l,f){this.map=l,this.plane=vv({gl:f,vertexShaderSource:Z2,fragmentShaderSource:H2,attributesKeys:W2,uniformsKeys:X2,vertices:K2}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(l=>{this.animationDelta=0;const f=()=>{if(this.animationDelta<1){this.scale=kc(0,this.gradient.scale,this.animationDelta),this.animationDelta+=n0,this.map.triggerRepaint(),requestAnimationFrame(f);return}l()};requestAnimationFrame(f)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(l=>{const f=()=>{if(this.animationDelta<1){this.scale=kc(this.gradient.scale,0,this.animationDelta),this.animationDelta+=n0,this.map.triggerRepaint(),requestAnimationFrame(f);return}l()};f()})}onRemove(l,f){this.plane!==void 0&&(f.deleteProgram(this.plane.shaderProgram),f.deleteBuffer(this.plane.positionBuffer))}prerender(l,f){}render(l,f){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");l.disable(l.DEPTH_TEST),l.enable(l.BLEND),l.useProgram(this.plane.shaderProgram),l.bindBuffer(l.ARRAY_BUFFER,this.plane.positionBuffer);const S=this.plane.programInfo.attributesLocations.position;l.enableVertexAttribArray(S),l.vertexAttribPointer(S,3,l.FLOAT,!1,0,0);const T=$d(),E=this.scale;g2(T,T,[E,E,E]);const b=$d();m2(b,f.defaultProjectionData.mainMatrix,T);const s=this.plane.programInfo.uniformsLocations.matrix;l.uniformMatrix4fv(s,!1,b);const N=$d(),V=this.map.transform.cameraPosition,K=mg(rm(),V),oe=x2(0,1,0),le=rm();q_(le,oe,K),mg(le,le);const Y=rm();q_(Y,K,le),mg(Y,Y),f2(N,le[0],le[1],le[2],0,Y[0],Y[1],Y[2],0,K[0],K[1],K[2],0,0,0,0,1);const Be=this.plane.programInfo.uniformsLocations.rotationMatrix;l.uniformMatrix4fv(Be,!1,N);const Ne=this.gradient.stops.length,Ze=[],He=[];for(let Ge=0;Ge<=Ne;Ge++)if(Ge<Ne){Ze[Ge]=this.gradient.stops[Ge][0];const nt=nm(this.gradient.stops[Ge][1]);He.push(...nt)}l.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,Ne),l.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Ze)),l.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(He)),l.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,jd),l.uniform1f(this.plane.programInfo.uniformsLocations.scale,E),l.drawArrays(l.TRIANGLE_STRIP,0,4)}async setGradient(l){if(l===!1){await this.animateOut();return}if(await this.animateOut(),!Y2(l)){this.gradient.scale=Fh.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}l===!0?(this.gradient.scale=Fh.scale,this.gradient.stops=Fh.stops):(this.gradient.scale=l.scale??Fh.scale,this.gradient.stops=l.stops??Fh.stops),await this.animateIn()}setAnimationActive(l){this.animationActive=l}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function Y2(d){return typeof d=="boolean"?!0:!(typeof d.scale!="number"||!d.stops||d.stops.length===0||d.stops.some(l=>typeof l[0]!="number"||typeof l[1]!="string"))}const J2={POINT:"POINT",COUNTRY:"COUNTRY"};let bv=class wv extends Dt.Map{constructor(l){L1(l.container),l.apiKey&&(ui.apiKey=l.apiKey);const{style:f,requiresUrlMonitoring:S,isFallback:T}=j_(l.style);T&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),ui.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const E=location.hash;let b={compact:!1};l.customAttribution?b.customAttribution=l.customAttribution:l.attributionControl&&typeof l.attributionControl=="object"&&(b={...b,...l.attributionControl});const s={...l,style:f,maplibreLogo:!1,transformRequest:g_(l.transformRequest),attributionControl:l.forceNoAttributionControl===!0?!1:b};delete s.style,super(s),xt(this,"telemetry"),xt(this,"space"),xt(this,"halo"),xt(this,"options"),xt(this,"isTerrainEnabled",!1),xt(this,"terrainExaggeration",1),xt(this,"primaryLanguage"),xt(this,"terrainGrowing",!1),xt(this,"terrainFlattening",!1),xt(this,"minimap"),xt(this,"forceLanguageUpdate"),xt(this,"languageAlwaysBeenStyle"),xt(this,"isReady",!1),xt(this,"terrainAnimationDuration",1e3),xt(this,"monitoredStyleUrls"),xt(this,"styleInProcess",!1),xt(this,"curentProjection"),xt(this,"originalLabelStyle",new window.Map),xt(this,"isStyleLocalized",!1),xt(this,"languageIsUpdated",!1),xt(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=l,this.setStyle(f),S&&this.monitorStyleUrl(f);const N=()=>{let Y="The distant style could not be loaded.";this.getStyle()?Y+="Leaving the style as is.":(this.setStyle(Np.STREETS),Y+=`Loading default MapTiler Cloud style "${Np.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(Y)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",Y=>{if(Y.error instanceof Dt.AJAXError){const Be=Y.error.url,Ne=new URL(Be);Ne.search="";const Ze=Ne.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Ze)&&(this.monitoredStyleUrls.delete(Ze),N());return}if(this.styleInProcess){N();return}}),ui.caching&&!Mg&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),ui.caching&&Mg&&E1(),typeof l.language>"u")this.primaryLanguage=ui.primaryLanguage;else{const Y=r_(l.language,Or);this.primaryLanguage=Y??ui.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Or.STYLE||this.primaryLanguage===Or.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Or.STYLE,this.terrainExaggeration=l.terrainExaggeration??this.terrainExaggeration,this.curentProjection=l.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!l.geolocate||l.center||l.hash&&E)return;try{if(l.geolocate===J2.COUNTRY){await this.fitToIpBounds();return}}catch(Be){console.warn(Be.message)}let Y;try{await this.centerOnIpPoint(l.zoom),Y=this.getCameraHash()}catch(Be){console.warn(Be.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(Be=>{Y===this.getCameraHash()&&(this.terrain?this.easeTo({center:[Be.coords.longitude,Be.coords.latitude],zoom:l.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[Be.coords.longitude,Be.coords.latitude],zoom:l.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let Y={logo:null};try{const Be=Object.keys(this.style.sourceCaches).map(Ze=>this.getSource(Ze)).filter(Ze=>Ze&&"url"in Ze&&typeof Ze.url=="string"&&Ze.url.includes("tiles.json")),Ne=new URL(Be[0].url);Ne.searchParams.has("key")||Ne.searchParams.append("key",ui.apiKey),Y=await(await fetch(Ne.href)).json()}catch{}if(l.customControls){const Be="[data-maptiler-control-group]",Ne="[data-maptiler-control]",Ze=Re=>{let Ue=Re.dataset.maptilerControl;return(Ue==="true"||Ue==="")&&(Ue=void 0),Ue},He=Re=>Re.dataset.maptilerPosition;let Ge=[...this._container.ownerDocument.querySelectorAll(Be)],nt=[...this._container.ownerDocument.querySelectorAll(Ne)].filter(Re=>Re.closest(Be)===null);if(typeof l.customControls=="string"){const Re=l.customControls;Ge=Ge.filter(Ue=>Ue.matches(Re)||Ue.closest(Re)!==null),nt=nt.filter(Ue=>Ue.matches(Re)||Ue.closest(Re)!==null)}for(const Re of Ge){const Ue=new Ng(Re);this.addControl(Ue,He(Re));for(const pt of Re.querySelectorAll(Ne))Ue.configureGroupItem(pt,Ze(pt))}for(const Re of nt)this.addControl(new Ng(Re,Ze(Re)),He(Re));const Le=()=>{const{lng:Re,lat:Ue}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(Re)),this._container.style.setProperty("--maptiler-center-lat",String(Ue)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};Le(),this.on("render",Le)}if(l.forceNoAttributionControl!==!0)if("logo"in Y&&Y.logo){const Be=Y.logo;this.addControl(new __({logoURL:Be}),l.logoPosition)}else l.maptilerLogo&&this.addControl(new __,l.logoPosition);if(l.scaleControl){const Be=l.scaleControl===!0||l.scaleControl===void 0?"bottom-right":l.scaleControl,Ne=new q1({unit:ui.unit});this.addControl(Ne,Be),ui.on("unit",Ze=>{Ne.setUnit(Ze)})}if(l.navigationControl!==!1){const Be=l.navigationControl===!0||l.navigationControl===void 0?"top-right":l.navigationControl;this.addControl(new l2,Be)}if(l.geolocateControl!==!1){const Be=l.geolocateControl===!0||l.geolocateControl===void 0?"top-right":l.geolocateControl;this.addControl(new c2({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),Be)}if(l.terrainControl){const Be=l.terrainControl===!0||l.terrainControl===void 0?"top-right":l.terrainControl;this.addControl(new s2,Be)}if(l.projectionControl){const Be=l.projectionControl===!0||l.projectionControl===void 0?"top-right":l.projectionControl;this.addControl(new p2,Be)}if(l.fullscreenControl){const Be=l.fullscreenControl===!0||l.fullscreenControl===void 0?"top-right":l.fullscreenControl;this.addControl(new G1({}),Be)}this.isReady=!0,this.fire("ready",{target:this})});let V=!1,K=!1,oe;this.once("ready",()=>{V=!0,K&&this.fire("loadWithTerrain",oe)}),this.once("style.load",()=>{const{minimap:Y}=l;if(typeof Y=="object"){const{zoom:Be,center:Ne,style:Ze,language:He,apiKey:Ge,maptilerLogo:nt,canvasContextAttributes:Le,refreshExpiredTiles:Re,maxBounds:Ue,scrollZoom:pt,minZoom:lt,maxZoom:Ft,boxZoom:Pt,locale:Ur,fadeDuration:Cr,crossSourceCollisions:yr,clickTolerance:fr,bounds:xn,fitBoundsOptions:qr,pixelRatio:Rr,validateStyle:yt}=l;this.minimap=new fg(Y,{zoom:Be,center:Ne,style:Ze,language:He,apiKey:Ge,container:"null",maptilerLogo:nt,canvasContextAttributes:Le,refreshExpiredTiles:Re,maxBounds:Ue,scrollZoom:pt,minZoom:lt,maxZoom:Ft,boxZoom:Pt,locale:Ur,fadeDuration:Cr,crossSourceCollisions:yr,clickTolerance:fr,bounds:xn,fitBoundsOptions:qr,pixelRatio:Rr,validateStyle:yt}),this.addControl(this.minimap,Y.position??"bottom-left")}else Y===!0?(this.minimap=new fg({},l),this.addControl(this.minimap,"bottom-left")):Y!==void 0&&Y!==!1&&(this.minimap=new fg({},l),this.addControl(this.minimap,Y))});const le=Y=>{Y.terrain&&(K=!0,oe={type:"loadWithTerrain",target:this,terrain:Y.terrain},this.off("terrain",le),V&&this.fire("loadWithTerrain",oe))};this.on("terrain",le),l.terrain&&this.enableTerrain(l.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",Be=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",Be)});const Y=this.getLayersOrder()[0];l.space&&this.initSpace({options:l,before:Y}),l.halo&&this.initHalo({options:l,before:Y})}),this.telemetry=new d2(this)}getSpace(){return this.space}setSpace(l){if(l===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(l),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new vg(l),this.once("load",()=>{const f=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,f)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(l){this.halo?this.halo.setAnimationActive(l):this.once("load",()=>{var f;(f=this.halo)==null||f.setAnimationActive(l)})}setSpaceAnimationActive(l){this.space?this.space.setAnimationActive(l):this.once("load",()=>{var f;(f=this.space)==null||f.setAnimationActive(l)})}setSpaceFromStyle({style:l}){var f,S,T;if(this.options.space){this.setSpace(this.options.space);return}const E=(S=(f=l.metadata)==null?void 0:f.maptiler)==null?void 0:S.space;if(!E){this.setSpace({color:"transparent"});return}if(!xv(E)){this.setSpace({color:"transparent"});return}if(JSON.stringify((T=this.space)==null?void 0:T.getConfig())===JSON.stringify(E)){if(this.space&&!this.getLayer(this.space.id)){const b=this.getLayersOrder()[0];this.addLayer(this.space,b)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const b=this.getLayersOrder()[0];this.addLayer(this.space,b)}this.space.setCubemap(E)}})()}setHaloFromStyle({style:l}){var f,S,T;const E=(f=l.metadata)==null?void 0:f.maptiler;if(JSON.stringify((S=this.halo)==null?void 0:S.getConfig())===JSON.stringify(E?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const b=this.getLayersOrder().indexOf(((T=this.space)==null?void 0:T.id)??"")+1,s=this.getLayersOrder()[b];this.addLayer(this.halo,s)}return}if(!(E!=null&&E.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var b;if(this.halo){if(!this.getLayer(this.halo.id)){const N=this.getLayersOrder().indexOf(((b=this.space)==null?void 0:b.id)??"")+1,V=this.getLayersOrder()[N];this.addLayer(this.halo,V)}const s=E?.halo??this.options.halo;s&&this.halo.setGradient(s)}})()}initSpace({options:l=this.options,before:f,spec:S}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,f);return}if(l.space===!1)return;const T=S;if(l.space){this.space=new vg(l.space),this.addLayer(this.space,f);return}T&&(this.space=new vg(T),this.addLayer(this.space,f))}initHalo({options:l=this.options,before:f,spec:S}){if(this.halo&&this.getLayer(this.halo.id)||l.halo===!1)return;const T=S;if(l.halo){this.halo=new xg(l.halo),this.addLayer(this.halo,f);return}T&&(this.halo=new xg(T),this.addLayer(this.halo,f))}getHalo(){return this.halo}setHalo(l){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(l);return}this.halo=new xg(l),this.once("load",()=>{var f;const S=this.getLayersOrder(),T=S[0],E=S.indexOf(((f=this.space)==null?void 0:f.id)??"")+2,b=S[E];this.halo&&this.addLayer(this.halo,this.space?b:T)})}}recreate(){const l={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new wv({...this.options})),this.once("load",()=>{this.jumpTo(l)})}setTerrainAnimationDuration(l){this.terrainAnimationDuration=Math.max(l,0)}async onLoadAsync(){return new Promise(l=>{if(this.loaded()){l(this);return}this.once("load",()=>{l(this)})})}async onReadyAsync(){return new Promise(l=>{if(this.isReady){l(this);return}this.once("ready",()=>{l(this)})})}async onLoadWithTerrainAsync(){return new Promise(l=>{if(this.isReady&&this.terrain){l(this);return}this.once("loadWithTerrain",()=>{l(this)})})}monitorStyleUrl(l){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const f=new URL(l);f.search="",this.monitoredStyleUrls.add(f.href)}setStyle(l,f){var S,T,E,b,s;this.originalLabelStyle.clear(),(S=this.minimap)==null||S.setStyle(l),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const N=j_(l);if(N.requiresUrlMonitoring&&this.monitorStyleUrl(N.style),N.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const V=this.getStyle(),K=N.style;try{super.setStyle(N.style,f),this.styleInProcess=!0}catch(Y){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",Y)}const oe=()=>{const Y=N.style;if(!Y.projection||Y.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:N.style}),this.setHaloFromStyle({style:N.style})},le=Y=>{var Be,Ne,Ze,He;const Ge=Y?.target.getStyle()??N.style,nt=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Ge}):this.initSpace({before:nt,spec:(Ne=(Be=Ge.metadata)==null?void 0:Be.maptiler)==null?void 0:Ne.space}),this.halo?this.setHaloFromStyle({style:Ge}):this.initHalo({before:nt,spec:(He=(Ze=Ge.metadata)==null?void 0:Ze.maptiler)==null?void 0:He.halo})};if(typeof N.style=="string"||N.requiresUrlMonitoring)return this.on("styledata",le),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",le),this.once("styledata",le),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((T=V?.terrain)==null?void 0:T.source)!==((E=K?.terrain)==null?void 0:E.source)||((b=V?.terrain)==null?void 0:b.exaggeration)!==((s=K?.terrain)==null?void 0:s.exaggeration))return this.once("terrain",oe),this;try{le()}catch{}return this}addLayer(l,f){var S;return(S=this.minimap)==null||S.addLayer(l,f),super.addLayer(l,f)}moveLayer(l,f){var S;return(S=this.minimap)==null||S.moveLayer(l,f),super.moveLayer(l,f)}removeLayer(l){var f;return(f=this.minimap)==null||f.removeLayer(l),super.removeLayer(l)}setLayerZoomRange(l,f,S){var T;return(T=this.minimap)==null||T.setLayerZoomRange(l,f,S),super.setLayerZoomRange(l,f,S)}setFilter(l,f,S){var T;return(T=this.minimap)==null||T.setFilter(l,f,S),super.setFilter(l,f,S)}setPaintProperty(l,f,S,T){var E;return(E=this.minimap)==null||E.setPaintProperty(l,f,S,T),super.setPaintProperty(l,f,S,T)}setLayoutProperty(l,f,S,T){var E;return(E=this.minimap)==null||E.setLayoutProperty(l,f,S,T),super.setLayoutProperty(l,f,S,T)}setGlyphs(l,f){var S;return(S=this.minimap)==null||S.setGlyphs(l,f),super.setGlyphs(l,f)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?wg(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(l){var f;(f=this.minimap)==null||f.map.setLanguage(l),this.onStyleReady(()=>{this.setPrimaryLanguage(l)})}setPrimaryLanguage(l){const f=this.getStyleLanguage(),S=r_(l,Or);if(!S){console.warn(`The language "${S}" is not supported.`);return}if(!(S.flag===Or.STYLE.flag&&f&&(f.flag===Or.AUTO.flag||f.flag===Or.VISITOR.flag))&&(S.flag!==Or.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===S&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Or.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=S;let T=S;if(S.flag===Or.STYLE.flag){if(!f){console.warn("The style has no default languages or has an invalid one.");return}T=f}let E=Or.LOCAL.flag,b=["get",E];T.flag===Or.VISITOR.flag?(E=p_().flag,b=["case",["all",["has",E],["has",Or.LOCAL.flag]],["case",["==",["get",E],["get",Or.LOCAL.flag]],["get",Or.LOCAL.flag],["format",["get",E],{"font-scale":.8},`
`,["get",Or.LOCAL.flag],{"font-scale":1.1}]],["get",Or.LOCAL.flag]]):T.flag===Or.VISITOR_ENGLISH.flag?(E=Or.ENGLISH.flag,b=["case",["all",["has",E],["has",Or.LOCAL.flag]],["case",["==",["get",E],["get",Or.LOCAL.flag]],["get",Or.LOCAL.flag],["format",["get",E],{"font-scale":.8},`
`,["get",Or.LOCAL.flag],{"font-scale":1.1}]],["get",Or.LOCAL.flag]]):T.flag===Or.AUTO.flag?(E=p_().flag,b=["coalesce",["get",E],["get",Or.LOCAL.flag]]):T===Or.LOCAL?(E=Or.LOCAL.flag,b=["get",E]):(E=T.flag,b=["coalesce",["get",E],["get",Or.LOCAL.flag]]);const{layers:s}=this.getStyle(),N=this.originalLabelStyle.size===0;if(N){const V=O1(s,this);this.isStyleLocalized=Object.keys(V.localized).length>0}for(const V of s){if(V.type!=="symbol")continue;const K=V,oe=this.getSource(K.source);if(!oe||!("url"in oe&&typeof oe.url=="string")||new URL(oe.url).host!==Da.maptilerApiHost)continue;const{id:le,layout:Y}=K;if(!Y||!("text-field"in Y))continue;let Be;if(N?(Be=this.getLayoutProperty(le,"text-field"),this.originalLabelStyle.set(le,Be)):Be=this.originalLabelStyle.get(le),typeof Be=="string"){const{contains:Ne,exactMatch:Ze}=D1(Be,this.isStyleLocalized);if(!Ne)continue;if(Ze)this.setLayoutProperty(le,"text-field",b);else{const He=N1(Be,b,this.isStyleLocalized);this.setLayoutProperty(le,"text-field",He)}}else{const Ne=R1(Be,b,this.isStyleLocalized);this.setLayoutProperty(le,"text-field",Ne)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(l){if(!this.terrain)return;const f=performance.now(),S=this.terrain.exaggeration,T=l-S,E=()=>{if(!this.terrain||this.terrainFlattening)return;const b=(performance.now()-f)/this.terrainAnimationDuration;if(b<.99){const s=1-(1-b)**4,N=S+s*T;this.terrain.exaggeration=N,requestAnimationFrame(E)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=l,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(E)}enableTerrain(l=this.terrainExaggeration){if(l<0){console.warn("Terrain exaggeration cannot be negative.");return}const f=T=>{!this.terrain||T.type!=="data"||T.dataType!=="source"||!("source"in T)||T.sourceId!=="maptiler-terrain"||T.source.type!=="raster-dem"||T.isSourceLoaded&&(this.off("data",f),this.growTerrain(l))},S=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=l,this.on("data",f),this.addSource(Da.terrainSourceId,{type:"raster-dem",url:Da.terrainSourceURL}),this.setTerrain({source:Da.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(l);return}if(this.loaded()||this.isTerrainEnabled)S();else{const T=()=>{this.getTerrain()&&this.getSource(Da.terrainSourceId)||S()};this.once("load",()=>{T()}),this.once("moveend",()=>{T()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const l=performance.now(),f=this.terrain.exaggeration,S=()=>{if(!this.terrain||this.terrainGrowing)return;const T=(performance.now()-l)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,T<.99){const E=(1-T)**4,b=f*E;this.terrain.exaggeration=b,requestAnimationFrame(S)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Da.terrainSourceId)&&this.removeSource(Da.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(S)}setTerrainExaggeration(l,f=!0){!f&&this.terrain?(this.terrainExaggeration=l,this.terrain.exaggeration=l,this.triggerRepaint()):this.enableTerrain(l)}onStyleReady(l){this.isStyleLoaded()?l():this.once("styledata",()=>{l()})}async fitToIpBounds(){const l=await i_.info();this.fitBounds(l.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(l){const f=await i_.info();this.jumpTo({center:[f.longitude??0,f.latitude??0],zoom:l||11})}getCameraHash(){const l=new Float32Array(5),f=this.getCenter();return l[0]=f.lng,l[1]=f.lat,l[2]=this.getZoom(),l[3]=this.getPitch(),l[4]=this.getBearing(),x1.fromUint8Array(new Uint8Array(l.buffer))}getSdkConfig(){return ui}getMaptilerSessionId(){return Ug}setTransformRequest(l){return super.setTransformRequest(g_(l)),this}isGlobeProjection(){const l=this.getProjection();return l?l.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};Dt.Evented;function Xf(d){const l=d.toString(16);return l.length===1?`0${l}`:l}function Q2(d){return`#${Xf(d[0])}${Xf(d[1])}${Xf(d[2])}${d.length===4?Xf(d[3]):""}`}class qt extends Array{constructor(l={}){super(),xt(this,"min",0),xt(this,"max",1),"min"in l&&(this.min=l.min),"max"in l&&(this.max=l.max),"stops"in l&&this.setStops(l.stops,{clone:!1})}static fromArrayDefinition(l){return new qt({stops:l.map(f=>({value:f[0],color:f[1]}))})}setStops(l,f={clone:!0}){const S=f.clone?this.clone():this;S.length=0;let T=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY;for(let b=0;b<l.length;b+=1)T=Math.min(T,l[b].value),E=Math.max(E,l[b].value),S.push({value:l[b].value,color:l[b].color.slice()});return S.sort((b,s)=>b.value<s.value?-1:1),this.min=T,this.max=E,S}scale(l,f,S={clone:!0}){const T=S.clone,E=this[0].value,b=this.at(-1).value-E,s=f-l,N=[];for(let V=0;V<this.length;V+=1){const K=(this[V].value-E)/b*s+l;T?N.push({value:K,color:this[V].color.slice()}):this[V].value=K}return T?new qt({stops:N}):this}at(l){return l<0?this[this.length+l]:this[l]}clone(){return new qt({stops:this.getRawColorStops()})}getRawColorStops(){const l=[];for(let f=0;f<this.length;f+=1)l.push({value:this[f].value,color:this[f].color});return l}reverse(l={clone:!0}){const f=l.clone?this.clone():this;for(let S=0;S<~~(f.length/2);S+=1){const T=f[S].color;f[S].color=f.at(-(S+1)).color,f.at(-(S+1)).color=T}return f}getBounds(){return{min:this.min,max:this.max}}getColor(l,f={smooth:!0}){if(l<=this[0].value)return this[0].color;if(l>=this.at(-1).value)return this.at(-1).color;for(let S=0;S<this.length-1;S+=1){if(l>this[S+1].value)continue;const T=this[S].color;if(!f.smooth)return T.slice();const E=this[S].value,b=this[S+1].value,s=this[S+1].color,N=(b-l)/(b-E);return T.map((V,K)=>Math.round(V*N+s[K]*(1-N)))}return[0,0,0]}getColorHex(l,f={smooth:!0,withAlpha:!1}){return Q2(this.getColor(l,f))}getColorRelative(l,f={smooth:!0}){const S=this.getBounds();return this.getColor(S.min+l*(S.max-S.min),f)}getCanvasStrip(l={horizontal:!0,size:512,smooth:!0}){const f=document.createElement("canvas");f.width=l.horizontal?l.size:1,f.height=l.horizontal?1:l.size;const S=f.getContext("2d");if(!S)throw new Error("Canvs context is missing");const T=S.getImageData(0,0,f.width,f.height),E=T.data,b=l.size,s=this[0].value,N=(this.at(-1).value-s)/b;for(let V=0;V<b;V+=1){const K=this.getColor(s+V*N,{smooth:l.smooth});E[V*4]=K[0],E[V*4+1]=K[1],E[V*4+2]=K[2],E[V*4+3]=K.length>3?K[3]:255}return S.putImageData(T,0,0),f}resample(l,f=15){const S=this.getBounds(),T=this.scale(0,1),E=1/(f-1);let b;if(l==="ease-in-square")b=Array.from({length:f},(s,N)=>{const V=N*E,K=V**2,oe=T.getColor(K);return{value:V,color:oe}});else if(l==="ease-out-square")b=Array.from({length:f},(s,N)=>{const V=N*E,K=1-(1-V)**2,oe=T.getColor(K);return{value:V,color:oe}});else if(l==="ease-out-sqrt")b=Array.from({length:f},(s,N)=>{const V=N*E,K=V**.5,oe=T.getColor(K);return{value:V,color:oe}});else if(l==="ease-in-sqrt")b=Array.from({length:f},(s,N)=>{const V=N*E,K=1-(1-V)**.5,oe=T.getColor(K);return{value:V,color:oe}});else if(l==="ease-out-exp")b=Array.from({length:f},(s,N)=>{const V=N*E,K=1-2**(-10*V),oe=T.getColor(K);return{value:V,color:oe}});else if(l==="ease-in-exp")b=Array.from({length:f},(s,N)=>{const V=N*E,K=2**(10*V-10),oe=T.getColor(K);return{value:V,color:oe}});else throw new Error("Invalid ressampling method.");return new qt({stops:b}).scale(S.min,S.max)}transparentStart(){const l=this.getRawColorStops();l.unshift({value:l[0].value,color:l[0].color.slice()}),l[1].value+=.001;for(const f of l)f.color.length===3&&f.color.push(255);return l[0].color[3]=0,new qt({stops:l})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}new qt({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new qt({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),new qt({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),new qt({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),new qt({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),new qt({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),new qt({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new qt({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),new qt({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),new qt({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),new qt({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),new qt({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),new qt({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),new qt({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),new qt({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),new qt({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),new qt({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),new qt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),new qt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),new qt({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),new qt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),new qt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),new qt({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),new qt({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),new qt({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),new qt({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),new qt({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),new qt({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),new qt({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),new qt({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),new qt({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),new qt({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),new qt({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),new qt({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),new qt({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),new qt({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),new qt({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),new qt({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),new qt({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),new qt({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),new qt({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),new qt({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]});I1();function eS(){return"3.8.0"}Dt.Map;Dt.Marker;Dt.Popup;Dt.Style;Dt.CanvasSource;Dt.GeoJSONSource;Dt.ImageSource;Dt.RasterTileSource;Dt.RasterDEMTileSource;Dt.VectorTileSource;Dt.VideoSource;Dt.NavigationControl;Dt.GeolocateControl;Dt.AttributionControl;Dt.LogoControl;Dt.ScaleControl;Dt.FullscreenControl;Dt.TerrainControl;Dt.BoxZoomHandler;Dt.ScrollZoomHandler;Dt.CooperativeGesturesHandler;Dt.KeyboardHandler;Dt.TwoFingersTouchPitchHandler;Dt.MapWheelEvent;Dt.MapTouchEvent;Dt.MapMouseEvent;Dt.config;Dt.getVersion;const{setRTLTextPlugin:IS,getRTLTextPluginStatus:AS,LngLat:zS,LngLatBounds:LS,MercatorCoordinate:RS,Evented:DS,AJAXError:NS,prewarm:FS,clearPrewarmedResources:BS,Hash:jS,Point:OS,EdgeInsets:US,DragRotateHandler:VS,DragPanHandler:$S,TwoFingersTouchZoomRotateHandler:qS,DoubleClickZoomHandler:GS,TwoFingersTouchZoomHandler:ZS,TwoFingersTouchRotateHandler:HS,getWorkerCount:WS,setWorkerCount:XS,getMaxParallelImageRequests:KS,setMaxParallelImageRequests:YS,getWorkerUrl:JS,setWorkerUrl:QS,addSourceType:eT,importScriptInWorkers:tT,addProtocol:rT,removeProtocol:nT}=Dt,tS=({events:d,selectedYear:l})=>{const[f,S]=Lr.useState(null),[T,E]=Lr.useState(null),b=Ne=>{switch(Ne){case"critical":return"bg-red-600";case"major":return"bg-orange-500";case"important":return"bg-yellow-500";default:return"bg-blue-500"}},s=Ne=>{switch(Ne){case"critical":return"w-6 h-6";case"major":return"w-5 h-5";case"important":return"w-4 h-4";default:return"w-4 h-4"}},N=Lr.useRef(null),V=Lr.useRef(null),K=Lr.useRef([]),oe={lng:105.8,lat:16.2},le=6,Y=60,Be=20;return ui.apiKey="jcmVafcUwfzyvMikku9V",Lr.useEffect(()=>{V.current||N.current&&(V.current=new bv({container:N.current,style:Np.BACKDROP,center:[oe.lng,oe.lat],zoom:le,pitch:Y,bearing:Be}),V.current.on("load",()=>{const Ne=`https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=${ui.apiKey}`;V.current?.getSource("terrain")||V.current?.addSource("terrain",{type:"raster-dem",url:Ne,tileSize:512}),V.current?.setTerrain({source:"terrain",exaggeration:1.5}),V.current?.getLayer("sky")||V.current?.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,0],"sky-atmosphere-sun-intensity":15}}),V.current?.addControl(new E0,"top-right")}))},[oe.lng,oe.lat,le,Y,Be]),Lr.useEffect(()=>{if(!V.current)return;const Ne=He=>{const Ge=He.category||"other",nt=He.significance==="critical",Le=s(He.significance),Re=b(He.significance),Ue=document.createElement("div");if(Ue.style.display="grid",Ue.style.placeItems="center",nt){const lt=document.createElement("div");lt.className=["rounded-full border-2 border-white shadow-md cursor-pointer animate-ping",Re,Le].join(" "),lt.style.opacity="0.8",lt.style.transform="scale(1.2)",Ue.appendChild(lt)}const pt=document.createElement("div");if(pt.className="flex items-center justify-center",pt.style.width="28px",pt.style.height="28px",pt.title=He.title,He.animationClass&&(Ue.className=He.animationClass),He.placeholderType&&He.placeholderValue){if(He.placeholderType==="image"){const lt=document.createElement("img");lt.src=He.placeholderValue,lt.alt=He.title,lt.style.width="28px",lt.style.height="28px",lt.style.objectFit="cover",lt.style.borderRadius=Ge==="other"?"50%":"8px",lt.className="border-2 border-white shadow-md",pt.appendChild(lt)}else if(He.placeholderType==="emoji"){const lt=document.createElement("span");lt.textContent=He.placeholderValue,lt.style.fontSize="18px",pt.className+=" bg-white/90 rounded-full border-2 border-white shadow-md",pt.appendChild(lt)}else if(He.placeholderType==="text"){const lt=document.createElement("span");lt.textContent=He.placeholderValue,lt.style.fontSize="12px",lt.style.fontWeight="600",pt.className+=" bg-white/90 rounded-full border-2 border-white shadow-md",pt.appendChild(lt)}}else{const lt="http://www.w3.org/2000/svg",Ft=document.createElementNS(lt,"svg");Ft.setAttribute("viewBox","0 0 24 24"),Ft.setAttribute("width","24"),Ft.setAttribute("height","24");const Pt=(yr,fr,xn)=>{const qr=document.createElementNS(lt,"path");return qr.setAttribute("d",yr),qr.setAttribute("fill",fr),qr.setAttribute("stroke",xn),qr.setAttribute("stroke-width","1.5"),qr},Cr={"bg-red-600":"#dc2626","bg-orange-500":"#f97316","bg-yellow-500":"#eab308","bg-blue-500":"#3b82f6"}[Re]||"#3b82f6";switch(Ge){case"party":{const yr=Pt("M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20z",Cr,"#ffffff"),fr=Pt("M12 6l2.12 4.3 4.75.69-3.43 3.34.81 4.74L12 16.9 7.75 19.07l.81-4.74-3.43-3.34 4.75-.69L12 6z","#ffffff","none");Ft.appendChild(yr),Ft.appendChild(fr);break}case"war":{const yr=Pt("M12 3l9 16H3l9-16z",Cr,"#ffffff"),fr=Pt("M12 8v5m0 3h.01","#ffffff","#ffffff");Ft.appendChild(yr),Ft.appendChild(fr);break}case"diplomacy":{const yr=Pt("M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20z",Cr,"#ffffff"),fr=document.createElementNS(lt,"circle");fr.setAttribute("cx","12"),fr.setAttribute("cy","12"),fr.setAttribute("r","4"),fr.setAttribute("fill","#ffffff"),fr.setAttribute("opacity","0.85"),Ft.appendChild(yr),Ft.appendChild(fr);break}case"culture":{const yr=Pt("M12 3l7 9-7 9-7-9 7-9z",Cr,"#ffffff");Ft.appendChild(yr);break}default:{const yr=Pt("M12 2a7 7 0 0 1 7 7c0 5-7 13-7 13S5 14 5 9a7 7 0 0 1 7-7z",Cr,"#ffffff"),fr=document.createElementNS(lt,"circle");fr.setAttribute("cx","12"),fr.setAttribute("cy","10"),fr.setAttribute("r","2.5"),fr.setAttribute("fill","#ffffff"),Ft.appendChild(yr),Ft.appendChild(fr)}}pt.appendChild(Ft)}return Ue.appendChild(pt),Ue};K.current.forEach(He=>He.remove()),K.current=[],d.filter(He=>He.year===l).forEach(He=>{const Ge=Ne(He);Ge.addEventListener("mouseenter",()=>E(He.id)),Ge.addEventListener("mouseleave",()=>E(null)),Ge.addEventListener("click",()=>S(He));const nt=new U1({element:Ge,anchor:"bottom"}).setLngLat([He.location.lng,He.location.lat]).addTo(V.current);K.current.push(nt)})},[d,l]),ge.jsxs("div",{className:"relative w-full h-full",children:[ge.jsx("div",{ref:N,className:"w-full h-[600px] md:h-[700px]"}),f&&ge.jsxs("div",{className:"absolute bottom-4 right-4 w-80 bg-white rounded-lg shadow-2xl border border-gray-200 overflow-hidden z-30",children:[ge.jsx("div",{className:"bg-gradient-to-r from-red-700 to-red-600 text-white p-4",children:ge.jsxs("div",{className:"flex items-start justify-between",children:[ge.jsxs("div",{className:"flex-1",children:[ge.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[ge.jsx(Ex,{className:"w-4 h-4"}),ge.jsx("span",{className:"text-sm",children:f.location.name})]}),ge.jsx("h3",{className:"text-lg",children:f.title}),ge.jsx("p",{className:"text-sm opacity-90",children:new Date(f.year,f.month-1).toLocaleDateString("en-US",{month:"long",year:"numeric"})})]}),ge.jsx("button",{onClick:()=>S(null),className:"text-white hover:text-gray-200 transition-colors",children:""})]})}),ge.jsx("div",{className:"p-4",children:ge.jsxs("div",{className:"flex items-start gap-2",children:[ge.jsx(Cx,{className:"w-4 h-4 text-blue-600 mt-1 flex-shrink-0"}),ge.jsx("p",{className:"text-sm text-gray-700",children:f.description})]})})]}),ge.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        /* Simple bounce for future marker animations */
        @keyframes vh-bounce-kf {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-6px); }
        }
        .vh-bounce {
          animation: vh-bounce-kf 1s ease-in-out infinite;
          will-change: transform;
        }
        /* Spin using global keyframes if present (fallback to custom) */
        @keyframes vh-spin-kf {
          to { transform: rotate(360deg); }
        }
        .vh-spin {
          animation: vh-spin-kf 1s linear infinite;
          will-change: transform;
        }
        /* Ping helper if you want to apply on the wrapper directly */
        @keyframes vh-ping-kf {
          75%, 100% {
            transform: scale(2);
            opacity: 0;
          }
        }
        .vh-ping {
          position: relative;
        }
        .vh-ping::after {
          content: '';
          position: absolute;
          inset: 0;
          border-radius: 9999px;
          background: currentColor;
          opacity: .75;
          animation: vh-ping-kf 1s cubic-bezier(0, 0, .2, 1) infinite;
        }
      `})]})},rS=({minYear:d,maxYear:l,currentYear:f,onYearChange:S})=>{const[T,E]=Lr.useState(!1),b=Lr.useRef(null),s=Ge=>{if(!b.current)return;const nt=b.current.getBoundingClientRect(),Le=Ge-nt.left,Re=Math.max(0,Math.min(1,Le/nt.width)),Ue=Math.round(d+Re*(l-d));S(Ue)},N=Ge=>{E(!0),s(Ge.clientX)},V=Ge=>{T&&s(Ge.clientX)},K=()=>{E(!1)},oe=Ge=>{E(!0),s(Ge.touches[0].clientX)},le=Ge=>{T&&Ge.touches.length>0&&s(Ge.touches[0].clientX)};Lr.useEffect(()=>(T&&(document.addEventListener("mousemove",V),document.addEventListener("mouseup",K),document.addEventListener("touchmove",le),document.addEventListener("touchend",K)),()=>{document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",K),document.removeEventListener("touchmove",le),document.removeEventListener("touchend",K)}),[T]);const Y=(f-d)/(l-d)*100,Be=()=>{f>d&&S(f-1)},Ne=()=>{f<l&&S(f+1)},Ze=[],He=5;for(let Ge=d;Ge<=l;Ge+=He){const nt=(Ge-d)/(l-d)*100;Ze.push({year:Ge,pos:nt})}return l%He!==0&&Ze.push({year:l,pos:100}),ge.jsxs("div",{className:"w-full bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[ge.jsxs("div",{className:"flex items-center justify-between mb-6",children:[ge.jsxs("div",{className:"flex items-center gap-2",children:[ge.jsx(dx,{className:"w-5 h-5 text-red-700"}),ge.jsx("h3",{className:"text-lg text-gray-800",children:"Dng thi gian: 1945 - 1975"})]}),ge.jsxs("div",{className:"flex items-center gap-2",children:[ge.jsx("button",{onClick:Be,disabled:f<=d,className:"p-2 rounded-lg bg-red-700 text-white hover:bg-red-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors","aria-label":"Previous year",children:ge.jsx(mx,{className:"w-4 h-4"})}),ge.jsx("div",{className:"px-4 py-2 bg-red-700 text-white rounded-lg min-w-[80px] text-center",children:f}),ge.jsx("button",{onClick:Ne,disabled:f>=l,className:"p-2 rounded-lg bg-red-700 text-white hover:bg-red-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors","aria-label":"Next year",children:ge.jsx(yx,{className:"w-4 h-4"})})]})]}),ge.jsxs("div",{className:"relative",children:[ge.jsxs("div",{ref:b,className:"relative h-3 bg-gray-200 rounded-full cursor-pointer",onMouseDown:N,onTouchStart:oe,children:[ge.jsx("div",{className:"absolute h-full bg-gradient-to-r from-red-700 to-red-600 rounded-full transition-all",style:{width:`${Y}%`}}),ge.jsx("div",{className:"absolute top-1/2 transform -translate-y-1/2 -translate-x-1/2 w-6 h-6 bg-white border-4 border-red-700 rounded-full shadow-lg cursor-grab active:cursor-grabbing transition-transform hover:scale-110",style:{left:`${Y}%`}})]}),ge.jsx("div",{className:"relative mt-2 mb-12 min-h-[18px] select-none",children:Ze.map(({year:Ge,pos:nt})=>ge.jsxs("div",{className:"absolute transform -translate-x-1/2",style:{left:`${nt}%`},children:[ge.jsx("div",{className:"w-px h-2 bg-gray-400 mx-auto mb-1"}),ge.jsx("span",{className:"text-[10px] md:text-xs text-gray-600 whitespace-nowrap",children:Ge})]},Ge))})]}),ge.jsx("div",{className:"relative mt-12",children:ge.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Ko thanh trt hoc dng nt mi tn  khm ph cc s kin t 1945 n 1975"})}),"q"]})},i0=[{id:"q1",question:"Ch tch H Ch Minh c Tuyn ngn c lp vo ngy no?",options:["15 thng 8 nm 1945","2 thng 9 nm 1945","19 thng 12 nm 1946","7 thng 5 nm 1954"],correctAnswer:1,explanation:"Ch tch H Ch Minh  c Tuyn ngn c lp vo ngy 2 thng 9 nm 1945 ti Qung trng Ba nh, H Ni.",year:1945},{id:"q2",question:"Trn chin quyt nh no  kt thc ch thng tr ca thc dn Php ti Vit Nam?",options:["Trn H Ni","Trn Si Gn","Trn in Bin Ph","Trn Hu"],correctAnswer:2,explanation:"Chin thng in Bin Ph (thng 5/1954) l chin thng v i ca qun i Vit Nam, kt thc ch thng tr ca thc dn Php.",year:1954},{id:"q3",question:"Hip nh Genve nm 1954  tm thi chia ct Vit Nam ti v tuyn no?",options:["V tuyn 15","V tuyn 16","V tuyn 17","V tuyn 18"],correctAnswer:2,explanation:"Hip nh Genve  tm thi chia ct Vit Nam ti v tuyn 17, to ra min Bc v min Nam.",year:1954},{id:"q4",question:"ng Lao ng Vit Nam c thnh lp vo nm no?",options:["Nm 1945","Nm 1950","Nm 1951","Nm 1954"],correctAnswer:2,explanation:"ng Lao ng Vit Nam c thnh lp vo thng 2/1951, k tha ng Cng sn ng Dng.",year:1951},{id:"q5",question:"Mt trn Dn tc Gii phng min Nam Vit Nam c thnh lp vo thi gian no?",options:["Thng 12/1958","Thng 12/1959","Thng 12/1960","Thng 12/1961"],correctAnswer:2,explanation:"Mt trn Dn tc Gii phng min Nam Vit Nam c thnh lp vo thng 12/1960  chng chnh quyn Ng nh Dim.",year:1960},{id:"q6",question:"Cuc tng tin cng ln c pht ng trong dp Tt nm 1968 c tn gi l g?",options:["Tng tin cng Xun","Tng tin cng Tt Mu Thn","Tng tin cng Xun - H","Tng tin cng Cui cng"],correctAnswer:1,explanation:"Tng tin cng v ni dy Tt Mu Thn (thng 1/1968) l cuc tng tin cng ln trn khp min Nam.",year:1968},{id:"q7",question:"Ch tch H Ch Minh qua i vo ngy no?",options:["2 thng 9 nm 1968","2 thng 9 nm 1969","2 thng 9 nm 1970","2 thng 9 nm 1971"],correctAnswer:1,explanation:"Ch tch H Ch Minh qua i vo ngy 2 thng 9 nm 1969, ng 24 nm sau ngy tuyn b c lp.",year:1969},{id:"q8",question:'Chin thng "in Bin Ph trn khng" din ra vo thi gian no?',options:["Thng 12/1971","Thng 12/1972","Thng 12/1973","Thng 12/1974"],correctAnswer:1,explanation:'Chin thng "in Bin Ph trn khng" din ra vo thng 12/1972 khi qun dn H Ni bn ri hng chc my bay B-52 ca M.',year:1972},{id:"q9",question:"Hip nh Paris c k kt vo nm no?",options:["Nm 1971","Nm 1972","Nm 1973","Nm 1974"],correctAnswer:2,explanation:"Hip nh Paris c k kt vo thng 1/1973, dn n vic rt qun i M khi Vit Nam.",year:1973},{id:"q10",question:"Min Nam c gii phng hon ton vo ngy no?",options:["30 thng 4 nm 1974","30 thng 4 nm 1975","1 thng 5 nm 1975","15 thng 4 nm 1975"],correctAnswer:1,explanation:"Min Nam c gii phng hon ton vo ngy 30 thng 4 nm 1975, kt thc chin tranh v thng nht t nc.",year:1975},{id:"q11",question:"on 559 c thnh lp vi mc ch g?",options:["Bo v bin gii","M ng H Ch Minh","Hun luyn qun i","T chc tnh bo"],correctAnswer:1,explanation:"on 559 c thnh lp vo thng 5/1959  m v pht trin ng H Ch Minh, vn chuyn v kh v lng thc vo Nam.",year:1959},{id:"q12",question:"S kin no nh du s ra i ca Qun i nhn dn Vit Nam?",options:["Thnh lp Vit Minh","Thnh lp Vit Nam Tuyn truyn Gii phng qun","Cch mng Thng Tm","Khng chin chng Php"],correctAnswer:1,explanation:"Vit Nam Tuyn truyn Gii phng qun c thnh lp ngy 22/12/1944, nh du s ra i ca Qun i nhn dn Vit Nam.",year:1945},{id:"q13",question:"i hi ng ton quc ln th III hp vo nm no?",options:["Nm 1958","Nm 1959","Nm 1960","Nm 1961"],correctAnswer:2,explanation:"i hi ng ton quc ln th III hp vo thng 9/1960, quyt nh ng li cch mng min Nam.",year:1960},{id:"q14",question:"Th  H Ni c gii phng hon ton vo nm no?",options:["Nm 1953","Nm 1954","Nm 1955","Nm 1956"],correctAnswer:1,explanation:"Th  H Ni c gii phng hon ton vo thng 10/1954, sau 9 nm khng chin chng Php.",year:1954},{id:"q15",question:"Chin dch no m u cho Tng tin cng Xun 1975?",options:["Chin dch H Ch Minh","Chin dch Ty Nguyn","Chin dch Hu -  Nng","Chin dch Si Gn"],correctAnswer:1,explanation:"Chin dch Ty Nguyn (thng 3/1975) vi trn nh Bun Ma Thut m u cho Tng tin cng Xun 1975.",year:1975}],nS=()=>{const[d,l]=Lr.useState(0),[f,S]=Lr.useState(null),[T,E]=Lr.useState(!1),[b,s]=Lr.useState(0),[N,V]=Lr.useState(new Set),[K,oe]=Lr.useState(!1),le=i0[d],Y=i0.length,Be=N.size/Y*100,Ne=Le=>{T||(S(Le),E(!0),Le===le.correctAnswer&&(N.has(d)||s(b+1)),V(new Set(N).add(d)))},Ze=()=>{d<Y-1?(l(d+1),S(null),E(!1)):oe(!0)},He=()=>{d>0&&(l(d-1),S(null),E(!1))},Ge=()=>{l(0),S(null),E(!1),s(0),V(new Set),oe(!1)},nt=Le=>T?Le===le.correctAnswer?"border-green-600 bg-green-50":Le===f&&Le!==le.correctAnswer?"border-red-600 bg-red-50":"border-gray-300 opacity-60":f===Le?"border-red-700 bg-red-50":"border-gray-300 hover:border-red-700 hover:bg-red-50";if(K){const Le=Math.round(b/Y*100);return ge.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-white rounded-lg shadow-xl p-8 text-center",children:[ge.jsx(Kf,{className:"w-20 h-20 text-yellow-500 mx-auto mb-4"}),ge.jsx("h2",{className:"text-3xl text-gray-800 mb-4",children:"Hon thnh bi kim tra!"}),ge.jsx("div",{className:"text-6xl mb-4",children:Le>=80?"":Le>=60?"":""}),ge.jsxs("p",{className:"text-xl text-gray-700 mb-6",children:["Bn t ",ge.jsx("span",{className:"text-red-700",children:b})," trn ",ge.jsx("span",{className:"text-red-700",children:Y})," cu"]}),ge.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-6",children:ge.jsx("div",{className:"bg-gradient-to-r from-red-700 to-red-600 h-4 rounded-full transition-all duration-500",style:{width:`${Le}%`}})}),ge.jsx("p",{className:"text-lg text-gray-600 mb-8",children:Le>=80?"Xut sc! Bn c hiu bit vng vng v giai on lch s ny.":Le>=60?"Tt lm! Bn bit kh nhiu v thi k ny.":"Hy tip tc hc hi! Lch s rt th v."}),ge.jsxs("button",{onClick:Ge,className:"flex items-center gap-2 mx-auto px-6 py-3 bg-red-700 text-white rounded-lg hover:bg-red-800 transition-colors",children:[ge.jsx(Dx,{className:"w-5 h-5"}),"Lm li"]})]})}return ge.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden",children:[ge.jsxs("div",{className:"bg-gradient-to-r from-red-700 to-red-600 text-white p-6",children:[ge.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ge.jsx("h2",{className:"text-2xl",children:"Bi Kim Tra Lch S"}),ge.jsxs("div",{className:"text-right",children:[ge.jsx("div",{className:"text-sm opacity-90",children:"im"}),ge.jsxs("div",{className:"text-xl",children:[b," / ",N.size]})]})]}),ge.jsx("div",{className:"w-full bg-red-900/30 rounded-full h-2",children:ge.jsx("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:`${Be}%`}})}),ge.jsxs("p",{className:"text-sm mt-2 opacity-90",children:["Cu hi ",d+1," / ",Y]})]}),ge.jsxs("div",{className:"p-8",children:[ge.jsxs("div",{className:"mb-2 inline-block px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm",children:["Nm: ",le.year]}),ge.jsx("h3",{className:"text-xl text-gray-800 mb-6",children:le.question}),ge.jsx("div",{className:"space-y-3 mb-6",children:le.options.map((Le,Re)=>ge.jsx("button",{onClick:()=>Ne(Re),disabled:T,className:`w-full text-left p-4 rounded-lg border-2 transition-all ${nt(Re)} ${T?"cursor-default":"cursor-pointer"}`,children:ge.jsxs("div",{className:"flex items-center justify-between",children:[ge.jsx("span",{className:"text-gray-800",children:Le}),T&&ge.jsxs(ge.Fragment,{children:[Re===le.correctAnswer&&ge.jsx(vx,{className:"w-6 h-6 text-green-600"}),Re===f&&Re!==le.correctAnswer&&ge.jsx(bx,{className:"w-6 h-6 text-red-600"})]})]})},Re))}),T&&ge.jsxs("div",{className:`p-4 rounded-lg mb-6 ${f===le.correctAnswer?"bg-green-50 border border-green-200":"bg-yellow-50 border border-yellow-200"}`,children:[ge.jsx("h4",{className:"text-gray-800 mb-2",children:f===le.correctAnswer?" ng!":" Sai"}),ge.jsx("p",{className:"text-gray-700",children:le.explanation})]}),ge.jsxs("div",{className:"flex items-center justify-between",children:[ge.jsx("button",{onClick:He,disabled:d===0,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Trc"}),ge.jsx("button",{onClick:Ze,disabled:!T,className:"px-6 py-3 bg-red-700 text-white rounded-lg hover:bg-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d===Y-1?"Hon thnh":"Tip theo"})]})]})]})},iS="rygqmdtrjovnedqqrvra",aS="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5Z3FtZHRyam92bmVkcXFydnJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NTU2ODksImV4cCI6MjA3ODQzMTY4OX0.OkpOwr9D1nUfAOtC5I-LtGhOFxPfUPICyhCvMrxsbkQ",oS=()=>{const[d,l]=Lr.useState([{id:"1",role:"assistant",content:"Xin cho! Ti l tr l lch s Vit Nam ca bn. Hy hi ti bt c iu g v giai on 1945-1975, ng Cng sn Vit Nam, cc s kin ln, nhn vt quan trng, hoc ti ln hnh nh lch s  phn tch.",timestamp:new Date}]),[f,S]=Lr.useState(""),[T,E]=Lr.useState(!1),[b,s]=Lr.useState(null),[N,V]=Lr.useState(null),K=Lr.useRef(null),oe=Lr.useRef(null),le=()=>{K.current?.scrollIntoView({behavior:"smooth"})};Lr.useEffect(()=>{le()},[d]);const Y=Ze=>{const He=Ze.target.files?.[0];if(He){s(He);const Ge=new FileReader;Ge.onloadend=()=>{V(Ge.result)},Ge.readAsDataURL(He)}},Be=()=>{s(null),V(null),oe.current&&(oe.current.value="")},Ne=async Ze=>{if(Ze.preventDefault(),!f.trim()&&!b||T)return;const He={id:Date.now().toString(),role:"user",content:f.trim(),imageUrl:N||void 0,timestamp:new Date};l([...d,He]),S(""),E(!0);try{const Ge=new FormData;Ge.append("message",f.trim()),b&&Ge.append("image",b);const nt=await fetch(`https://${iS}.supabase.co/functions/v1/make-server-4e12d5d5/chat`,{method:"POST",headers:{Authorization:`Bearer ${aS}`},body:Ge});if(!nt.ok){const Ue=await nt.text();throw console.error("Chat API error:",Ue),new Error("Failed to get response from chatbot")}const Le=await nt.json(),Re={id:(Date.now()+1).toString(),role:"assistant",content:Le.response,timestamp:new Date};l(Ue=>[...Ue,Re])}catch(Ge){console.error("Error sending message:",Ge);const nt={id:(Date.now()+1).toString(),role:"assistant",content:"I apologize, but I encountered an error. Please try again.",timestamp:new Date};l(Le=>[...Le,nt])}finally{E(!1),Be()}};return ge.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden flex flex-col h-[600px]",children:[ge.jsx("div",{className:"bg-gradient-to-r from-red-700 to-red-600 text-white p-4",children:ge.jsxs("div",{className:"flex items-center gap-3",children:[ge.jsx("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center",children:ge.jsx(tg,{className:"w-6 h-6 text-red-700"})}),ge.jsxs("div",{children:[ge.jsx("h3",{className:"text-lg",children:"Tr L AI Lch S Vit Nam"}),ge.jsx("p",{className:"text-sm opacity-90",children:"Hi v cc s kin t 1945-1975"})]})]})}),ge.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[d.map(Ze=>ge.jsxs("div",{className:`flex gap-3 ${Ze.role==="user"?"flex-row-reverse":"flex-row"}`,children:[ge.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${Ze.role==="user"?"bg-red-700":"bg-gray-300"}`,children:Ze.role==="user"?ge.jsx(Ox,{className:"w-5 h-5 text-white"}):ge.jsx(tg,{className:"w-5 h-5 text-gray-700"})}),ge.jsxs("div",{className:`flex-1 max-w-[80%] ${Ze.role==="user"?"items-end":"items-start"} flex flex-col`,children:[ge.jsxs("div",{className:`rounded-lg p-3 ${Ze.role==="user"?"bg-red-700 text-white":"bg-white text-gray-800 border border-gray-200"}`,children:[Ze.imageUrl&&ge.jsx("img",{src:Ze.imageUrl,alt:"Uploaded",className:"max-w-full rounded-lg mb-2 max-h-48 object-cover"}),ge.jsx("p",{className:"whitespace-pre-wrap",children:Ze.content})]}),ge.jsx("span",{className:"text-xs text-gray-500 mt-1",children:Ze.timestamp.toLocaleTimeString()})]})]},Ze.id)),T&&ge.jsxs("div",{className:"flex gap-3",children:[ge.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center",children:ge.jsx(tg,{className:"w-5 h-5 text-gray-700"})}),ge.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:ge.jsxs("div",{className:"flex gap-2",children:[ge.jsx(Mx,{className:"w-5 h-5 text-red-700 animate-spin"}),ge.jsx("span",{className:"text-gray-600",children:"ang suy ngh..."})]})})]}),ge.jsx("div",{ref:K})]}),ge.jsxs("div",{className:"border-t border-gray-200 p-4 bg-white",children:[N&&ge.jsxs("div",{className:"mb-3 relative inline-block",children:[ge.jsx("img",{src:N,alt:"Preview",className:"h-20 rounded-lg border border-gray-300"}),ge.jsx("button",{onClick:Be,className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700",children:ge.jsx(l0,{className:"w-4 h-4"})})]}),ge.jsxs("form",{onSubmit:Ne,className:"flex gap-2",children:[ge.jsx("input",{type:"file",ref:oe,accept:"image/*",onChange:Y,className:"hidden"}),ge.jsx("button",{type:"button",onClick:()=>oe.current?.click(),className:"p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:T,children:ge.jsx(Sx,{className:"w-5 h-5 text-gray-600"})}),ge.jsx("input",{type:"text",value:f,onChange:Ze=>S(Ze.target.value),placeholder:"Hi v lch s Vit Nam (1945-1975)...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent",disabled:T}),ge.jsxs("button",{type:"submit",disabled:!f.trim()&&!b||T,className:"px-6 py-3 bg-red-700 text-white rounded-lg hover:bg-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[ge.jsx(Fx,{className:"w-5 h-5"}),"Gi"]})]}),ge.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Bn c th t cu hi hoc ti ln hnh nh lch s  phn tch"})]})]})},sS=[{id:"1",year:1945,month:2,title:"Thnh lp Vit Nam Tuyn truyn Gii phng qun",description:"Ngy 22/12/1944, i Vit Nam Tuyn truyn Gii phng qun c thnh lp ti Cao Bng di s ch o ca ng v Bc H, nh du s ra i ca Qun i nhn dn Vit Nam.",location:{name:"Cao Bng",lat:22.6667,lng:106.25},significance:"critical"},{id:"2",year:1945,month:8,title:"Cch mng Thng Tm",description:"Vit Minh, do H Ch Minh lnh o, ginh chnh quyn ti H Ni trong Cch mng Thng Tm, nh du s khi u ca nn c lp Vit Nam.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"3",year:1945,month:9,title:"Tuyn ngn c lp",description:"Ch tch H Ch Minh c Tuyn ngn c lp ti Qung trng Ba nh, tuyn b thnh lp nc Vit Nam Dn ch Cng ha.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"4",year:1946,month:3,title:"Hi ngh i biu ton quc ln th nht ca ng",description:"i hi hp ti H Ni, tho lun v quyt nh ng li khng chin chng thc dn Php xm lc.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"major"},{id:"5",year:1946,month:12,title:"Khng chin chng Php bt u",description:"Cuc chin tranh gia Php v Vit Minh bt u, nh du cuc u tranh lu di v c lp ca Vit Nam.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"6",year:1950,month:1,title:"Vit Nam c quc t cng nhn",description:"Lin X v Trung Quc cng nhn nc Vit Nam Dn ch Cng ha, m ra giai on mi trong quan h quc t.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"major"},{id:"7",year:1951,month:2,title:"Thnh lp ng Lao ng Vit Nam",description:"ng Cng sn ng Dng c t chc li thnh ng Lao ng Vit Nam, nh du giai on pht trin mi ca ng.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"8",year:1953,month:12,title:"Chin dch in Bin Ph bt u",description:"Qun i nhn dn Vit Nam khi ng chin dch lch s in Bin Ph di s ch huy ca i tng V Nguyn Gip.",location:{name:"in Bin Ph",lat:21.3833,lng:103.0167},significance:"major"},{id:"9",year:1954,month:5,title:"Chin thng in Bin Ph",description:"Chin thng v i ca qun i Vit Nam trc qun Php ti in Bin Ph, kt thc ch thng tr ca thc dn Php.",location:{name:"in Bin Ph",lat:21.3833,lng:103.0167},significance:"critical"},{id:"10",year:1954,month:7,title:"Hip nh Genve",description:"Hi ngh Genve dn n vic tm thi chia ct Vit Nam ti v tuyn 17.",location:{name:"V tuyn 17",lat:17,lng:107},significance:"critical"},{id:"11",year:1954,month:10,title:"Gii phng Th  H Ni",description:"Qun i v nhn dn H Ni tip qun hon ton Th  sau 9 nm khng chin chng Php.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"12",year:1959,month:5,title:"Thnh lp on 559",description:"Thnh lp on 559  m v pht trin ng H Ch Minh, vn chuyn v kh v lng thc vo Nam.",location:{name:"Ty Nguyn",lat:14,lng:108},significance:"major"},{id:"13",year:1960,month:9,title:"i hi ng ton quc ln th III",description:"i hi hp ti H Ni, quyt nh ng li cch mng min Nam, xy dng ch ngha x hi  min Bc.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"14",year:1960,month:12,title:"Thnh lp Mt trn Dn tc Gii phng min Nam",description:"Mt trn Dn tc Gii phng min Nam Vit Nam c thnh lp  chng chnh quyn Ng nh Dim.",location:{name:"Min Nam",lat:10.8231,lng:106.6297},significance:"critical"},{id:"15",year:1964,month:8,title:"S kin Vnh Bc B",description:"V vic hi qun dn n s gia tng can thip qun s ca M ti Vit Nam.",location:{name:"Vnh Bc B",lat:20,lng:107.5},significance:"critical"},{id:"16",year:1965,month:2,title:"M bt u nm bom min Bc",description:'Chin dch nm bom "Sm st ln" ca M nhm vo min Bc Vit Nam bt u.',location:{name:"Min Bc",lat:21.0285,lng:105.8542},significance:"major"},{id:"17",year:1965,month:3,title:"Qun M  b ln  Nng",description:"Lnh thy nh b M u tin  b ln  Nng, nh du s can thip trc tip ca M.",location:{name:" Nng",lat:16.0544,lng:108.2022},significance:"major"},{id:"18",year:1968,month:1,title:"Tng tin cng v ni dy Tt Mu Thn",description:"Cuc tng tin cng ln ca qun gii phng v Vit Cng trn khp min Nam trong dp Tt.",location:{name:"Si Gn",lat:10.8231,lng:106.6297},significance:"critical"},{id:"19",year:1969,month:6,title:"Thnh lp Chnh ph Cch mng lm thi",description:"Chnh ph Cch mng lm thi Cng ha min Nam Vit Nam c thnh lp.",location:{name:"Min Nam",lat:10.8231,lng:106.6297},significance:"major"},{id:"20",year:1969,month:9,title:"Ch tch H Ch Minh qua i",description:"Ch tch H Ch Minh, ngi cha gi knh yu ca dn tc, qua i nhng s nghip cch mng tip tc.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"21",year:1972,month:3,title:"Chin dch Xun - H 1972",description:"Cuc tng tin cng ln ca qun Bc Vit vt qua vng phi qun s vo min Nam.",location:{name:"Qung Tr",lat:16.75,lng:107.2},significance:"major"},{id:"22",year:1972,month:12,title:"Chin thng in Bin Ph trn khng",description:"Qun v dn H Ni bn ri my bay B-52 ca M trong 12 ngy m.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"23",year:1973,month:1,title:"Hip nh Paris",description:"Hip nh Paris c k kt, dn n vic rt qun i M khi Vit Nam.",location:{name:"Ton quc",lat:16,lng:108},significance:"critical"},{id:"24",year:1975,month:3,title:"Chin dch Ty Nguyn",description:"Chin dch gii phng Ty Nguyn m u cho Tng tin cng v ni dy Xun 1975.",location:{name:"Bun Ma Thut",lat:12.6667,lng:108.05},significance:"major"},{id:"25",year:1975,month:4,title:"Gii phng hon ton min Nam",description:"Qun gii phng tin vo Dinh c Lp Si Gn, kt thc chin tranh v thng nht t nc.",location:{name:"Si Gn",lat:10.8231,lng:106.6297},significance:"critical"},{id:"26",year:1946,month:1,title:"Tng tuyn c u tin sau ngy gii phng",description:" Tng tuyn c trong c nc bu i biu Quc hi kha I nc Vit Nam Dn ch cng ha. y l mt s kin quan trng sau L Tuyn ngn c lp din ra vo ngy 2-9-1945 ch hn 4 thng. Ch tch H Ch Minh  phn tch: y l ln u tin ngi dn Vit Nam c th hin quyn lm ch ca mnh trong mt quc gia theo chnh th Cng ha - Dn ch.",location:{name:"H Ni",lat:21.0285,lng:105.8542},significance:"critical"},{id:"27",year:1945,month:9,title:"Qun Php nh chim Min Nam",description:"Qun Php sau nhiu ngy khiu khch  n sng tn cng vo tr s y ban nhn dn Nam b, tr s Quc gia T v Cuc, Bu in, Nh n, Kho bc, i Pht thanh. Cuc n sng trn u c s hu thun ca M v thc dn Anh.",location:{name:"Si Gn",lat:10.5231,lng:106.8297},significance:"critical"},{id:"28",year:1945,month:8,title:"Qun Tng ko vo gii gip Qun Nht",description:"Di s h tr ca qun i ng Minh, 20 vn qun Tng ko vo nc ta  gii gip qun Nht",location:{name:" Nng",lat:16,lng:108.3},significance:"critical"},{id:"29",year:1945,month:11,title:"Ban Chp Hnh Trung ng ra Ch Th Khng Chin",description:'Ngy 25/11/1945, Ch Th khng chin c a ra, phn tch su sc s bin i ca tnh hnh th gii v trong nc, xc nh r "k th chnh ca nc ta lc ny l thc dn Php xm lc phi tp trung ngn la u tranh vo chng"',location:{name:"H Ni",lat:21.1285,lng:105.8542},significance:"critical"}],a0=d=>sS.filter(l=>l.year===d),lS="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function uS(d){const[l,f]=Lr.useState(!1),S=()=>{f(!0)},{src:T,alt:E,style:b,className:s,...N}=d;return l?ge.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${s??""}`,style:b,children:ge.jsx("div",{className:"flex items-center justify-center w-full h-full",children:ge.jsx("img",{src:lS,alt:"Error loading image",...N,"data-original-url":T})})}):ge.jsx("img",{src:T,alt:E,className:s,style:b,...N,onError:S})}function cS(){const[d,l]=Lr.useState(1945),[f,S]=Lr.useState("map"),[T,E]=Lr.useState(!1),[b,s]=Lr.useState(a0(1945));Lr.useEffect(()=>{s(a0(d))},[d]);const N=V=>{S(V),E(!1),document.getElementById(V)?.scrollIntoView({behavior:"smooth"})};return ge.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[ge.jsx("header",{className:"bg-gradient-to-r from-red-800 to-red-700 text-white shadow-lg sticky top-0 z-50",children:ge.jsxs("div",{className:"container mx-auto px-4 py-4",children:[ge.jsxs("div",{className:"flex items-center justify-between",children:[ge.jsxs("div",{className:"flex items-center gap-3",children:[ge.jsx("div",{className:"w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center",children:ge.jsx("span",{className:"text-2xl",children:""})}),ge.jsxs("div",{children:[ge.jsx("h1",{className:"text-2xl",children:"Lch S Vit Nam 1945-1975"}),ge.jsx("p",{className:"text-sm opacity-90",children:"Con ng Ginh c Lp v Thng Nht t Nc"})]})]}),ge.jsxs("nav",{className:"hidden md:flex items-center gap-6",children:[ge.jsxs("button",{onClick:()=>N("map"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${f==="map"?"bg-white/20":"hover:bg-white/10"}`,children:[ge.jsx(rg,{className:"w-5 h-5"}),"Bn  tng tc"]}),ge.jsxs("button",{onClick:()=>N("quiz"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${f==="quiz"?"bg-white/20":"hover:bg-white/10"}`,children:[ge.jsx(Kf,{className:"w-5 h-5"}),"Trc nghim"]}),ge.jsxs("button",{onClick:()=>N("chat"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${f==="chat"?"bg-white/20":"hover:bg-white/10"}`,children:[ge.jsx(ng,{className:"w-5 h-5"}),"Tr l AI"]})]}),ge.jsx("button",{onClick:()=>E(!T),className:"md:hidden p-2 hover:bg-white/10 rounded-lg transition-colors",children:T?ge.jsx(l0,{className:"w-6 h-6"}):ge.jsx(zx,{className:"w-6 h-6"})})]}),T&&ge.jsxs("nav",{className:"md:hidden mt-4 pt-4 border-t border-white/20 space-y-2",children:[ge.jsxs("button",{onClick:()=>N("map"),className:"w-full flex items-center gap-2 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[ge.jsx(rg,{className:"w-5 h-5"}),"Bn  tng tc"]}),ge.jsxs("button",{onClick:()=>N("quiz"),className:"w-full flex items-center gap-2 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[ge.jsx(Kf,{className:"w-5 h-5"}),"Trc nghim"]}),ge.jsxs("button",{onClick:()=>N("chat"),className:"w-full flex items-center gap-2 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[ge.jsx(ng,{className:"w-5 h-5"}),"Tr l AI"]})]})]})}),ge.jsxs("section",{className:"relative py-20 overflow-hidden",children:[ge.jsx("div",{className:"absolute inset-0 opacity-20",children:ge.jsx(uS,{src:"https://images.unsplash.com/photo-1710702418104-6bf5419ab03d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx2aWV0bmFtJTIwaGlzdG9yaWMlMjByZXZvbHV0aW9ufGVufDF8fHx8MTc2Mjg1NjExOHww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral",alt:"Vietnam historic revolution",className:"w-full h-full object-cover"})}),ge.jsx("div",{className:"container mx-auto px-4 relative z-10",children:ge.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[ge.jsx("div",{className:"inline-block px-4 py-2 bg-red-700 text-white rounded-full mb-6",children:ge.jsxs("span",{className:"flex items-center gap-2",children:[ge.jsx(cx,{className:"w-4 h-4"}),"Kho T Liu Lch S ng Cng Sn Vit Nam"]})}),ge.jsx("h2",{className:"text-5xl md:text-6xl text-gray-800 mb-6",children:"30 Nm Cch Mng"}),ge.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:"Khm ph nhng s kin quan trng, trn chin quyt nh v nhng thi khc lch s  nh hnh hnh trnh ca Vit Nam t ch thng tr thc dn n c lp v thng nht di s lnh o ca ng Cng sn Vit Nam."}),ge.jsxs("div",{className:"flex flex-wrap gap-4 justify-center text-sm",children:[ge.jsxs("div",{className:"px-6 py-3 bg-white rounded-lg shadow-md",children:[ge.jsx("div",{className:"text-red-700",children:"1945"}),ge.jsx("div",{className:"text-gray-600",children:"Cch mng Thng Tm"})]}),ge.jsxs("div",{className:"px-6 py-3 bg-white rounded-lg shadow-md",children:[ge.jsx("div",{className:"text-red-700",children:"1954"}),ge.jsx("div",{className:"text-gray-600",children:"Chin thng in Bin Ph"})]}),ge.jsxs("div",{className:"px-6 py-3 bg-white rounded-lg shadow-md",children:[ge.jsx("div",{className:"text-red-700",children:"1975"}),ge.jsx("div",{className:"text-gray-600",children:"Thng nht t nc"})]})]})]})})]}),ge.jsx("section",{id:"map",className:"py-16 bg-white",children:ge.jsx("div",{className:"container mx-auto px-4",children:ge.jsxs("div",{className:"max-w-6xl mx-auto",children:[ge.jsxs("div",{className:"text-center mb-12",children:[ge.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-full mb-4",children:[ge.jsx(rg,{className:"w-4 h-4"}),ge.jsx("span",{children:"Dng Thi Gian Tng Tc"})]}),ge.jsx("h2",{className:"text-4xl text-gray-800 mb-4",children:"Bn  S Kin Lch S"}),ge.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Khm ph ba thp k lch s Vit Nam. S dng thanh trt thi gian  tm hiu cc s kin din ra trn khp t nc."})]}),ge.jsx("div",{className:"mb-8",children:ge.jsx(rS,{minYear:1945,maxYear:1975,currentYear:d,onYearChange:l})}),ge.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:ge.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[ge.jsxs("div",{children:[ge.jsxs("span",{className:"text-gray-600",children:["S kin nm ",d,":"]}),ge.jsx("span",{className:"ml-2 text-xl text-red-700",children:b.length})]}),b.length>0&&ge.jsx("div",{className:"text-sm text-gray-600",children:"Nhp vo cc im nh du  tm hiu thm v tng s kin"})]})}),ge.jsx("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden",children:ge.jsx("div",{className:"h-[600px] md:h-[700px]",children:ge.jsx(tS,{events:b,selectedYear:d})})})]})})}),ge.jsx("section",{id:"quiz",className:"py-16 bg-gradient-to-br from-gray-50 to-gray-100",children:ge.jsxs("div",{className:"container mx-auto px-4",children:[ge.jsxs("div",{className:"text-center mb-12",children:[ge.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-700 rounded-full mb-4",children:[ge.jsx(Kf,{className:"w-4 h-4"}),ge.jsx("span",{children:"Kim Tra Kin Thc"})]}),ge.jsx("h2",{className:"text-4xl text-gray-800 mb-4",children:"Bi Trc Nghim Lch S"}),ge.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Th thch bn thn vi cc cu hi v nhng s kin ln, nhn vt quan trng v nhng thi khc ng nh trong lch s Vit Nam t 1945-1975."})]}),ge.jsx(nS,{})]})}),ge.jsx("section",{id:"chat",className:"py-16 bg-white",children:ge.jsxs("div",{className:"container mx-auto px-4",children:[ge.jsxs("div",{className:"text-center mb-12",children:[ge.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-full mb-4",children:[ge.jsx(ng,{className:"w-4 h-4"}),ge.jsx("span",{children:"Tr L AI"})]}),ge.jsx("h2",{className:"text-4xl text-gray-800 mb-4",children:"Hi p Cng AI Lch S"}),ge.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"C cu hi v giai on cch mng Vit Nam? Tr l AI ca chng ti c o to vi d liu lch s t 1945-1975 v c th gip tr li cu hi hoc phn tch hnh nh lch s."})]}),ge.jsx(oS,{})]})}),ge.jsx("footer",{className:"bg-gray-900 text-white py-12",children:ge.jsx("div",{className:"container mx-auto px-4",children:ge.jsxs("div",{className:"max-w-4xl mx-auto",children:[ge.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mb-8",children:[ge.jsxs("div",{children:[ge.jsx("h3",{className:"text-lg mb-4",children:"V D n"}),ge.jsx("p",{className:"text-gray-400 text-sm",children:"Ngun ti liu gio dc khm ph con ng ginh c lp v thng nht ca Vit Nam t 1945-1975, tp trung vo vai tr ca ng Cng sn Vit Nam."})]}),ge.jsxs("div",{children:[ge.jsx("h3",{className:"text-lg mb-4",children:"Cc Giai on Chnh"}),ge.jsxs("ul",{className:"text-gray-400 text-sm space-y-2",children:[ge.jsx("li",{children:" Cch mng Thng Tm (1945)"}),ge.jsx("li",{children:" Khng chin chng Php (1946-1954)"}),ge.jsx("li",{children:" Khng chin chng M (1955-1975)"}),ge.jsx("li",{children:" Thng nht t nc (1975)"})]})]}),ge.jsxs("div",{children:[ge.jsx("h3",{className:"text-lg mb-4",children:"Ti Nguyn"}),ge.jsxs("ul",{className:"text-gray-400 text-sm space-y-2",children:[ge.jsx("li",{children:" Bn  dng thi gian tng tc"}),ge.jsx("li",{children:" Bi trc nghim lch s"}),ge.jsx("li",{children:" Tr l AI hi p"}),ge.jsx("li",{children:" Cng c phn tch hnh nh"})]})]})]}),ge.jsx("div",{className:"border-t border-gray-800 pt-8 text-center text-gray-400 text-sm",children:ge.jsx("p",{children:"Ngun ti liu gio dc v lch s cch mng Vit Nam (1945-1975)"})})]})})})]})}ix.createRoot(document.getElementById("root")).render(ge.jsx(cS,{}));
